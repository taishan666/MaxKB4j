import{L as T,a as M}from"./LoginContainer-DPZZ3vrE.js";import{aJ as S,b9 as Z,aY as B,aP as t,bc as c,bw as D,aQ as v,aZ as N,b0 as q,b1 as U,aL as I,aM as G,aR as l,aS as o,aO as w,aT as r,aW as g,aV as b,ch as z,bi as J}from"./chat-BtFLNZ96.js";const O={class:"mb-24"},Q={class:"mb-24"},W={class:"mb-24"},Y={class:"flex-between w-full"},j={class:"operate-container mt-12"},x=S({__name:"ForgotPassword",setup(H){const C=Z(),{theme:k,user:F}=B(),s=t({email:"",code:"",type:"reset_password"}),f=t(),L=t({email:[{required:!0,message:c("views.login.loginForm.email.requiredMessage"),trigger:"blur"},{validator:(e,a,n)=>{!/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/.test(a)&&a!=""?n(new Error(c("views.login.loginForm.email.validatorEmail"))):n()},trigger:"blur"}],code:[{required:!0,message:c("views.login.verificationCode.placeholder")}]}),i=t(!1),d=t(!1),u=t(60),p=t(!1),E=()=>{var e;(e=f.value)==null||e.validate().then(()=>z.checkCode(s.value,p)).then(()=>C.push({name:"ResetPassword",params:s.value}))},P=()=>{var e;(e=f.value)==null||e.validateField("email",a=>{a&&z.sendEmit(s.value.email,"reset_password",p).then(()=>{J(c("views.login.verificationCode.successMessage")),d.value=!0,V()})})},V=()=>{u.value<=0?(d.value=!1,u.value=60):setTimeout(()=>{u.value--,V()},1e3)};return D(()=>{i.value=!0,F.asyncGetProfile().then(()=>{i.value=!1})}),(e,a)=>{const n=v("el-input"),_=v("el-form-item"),h=v("el-button"),R=v("el-form"),A=N("loading");return i.value?U("",!0):q((G(),I(M,{key:0},{default:l(()=>{var $,y;return[o(T,{subTitle:($=w(k).themeInfo)!=null&&$.slogan?(y=w(k).themeInfo)==null?void 0:y.slogan:e.$t("theme.defaultSlogan")},{default:l(()=>[r("h2",O,g(e.$t("views.login.forgotPassword")),1),o(R,{class:"register-form",ref_key:"resetPasswordFormRef",ref:f,model:s.value,rules:L.value},{default:l(()=>[r("div",Q,[o(_,{prop:"email"},{default:l(()=>[o(n,{size:"large",class:"input-item",modelValue:s.value.email,"onUpdate:modelValue":a[0]||(a[0]=m=>s.value.email=m),placeholder:e.$t("views.login.loginForm.email.placeholder")},null,8,["modelValue","placeholder"])]),_:1})]),r("div",W,[o(_,{prop:"code"},{default:l(()=>[r("div",Y,[o(n,{size:"large",class:"code-input",modelValue:s.value.code,"onUpdate:modelValue":a[1]||(a[1]=m=>s.value.code=m),placeholder:e.$t("views.login.verificationCode.placeholder")},null,8,["modelValue","placeholder"]),o(h,{disabled:d.value,size:"large",class:"send-email-button ml-12",onClick:P,loading:i.value},{default:l(()=>[b(g(d.value?`${e.$t("views.login.verificationCode.resend")}（${u.value}s）`:e.$t("views.login.verificationCode.getVerificationCode")),1)]),_:1},8,["disabled","loading"])])]),_:1})])]),_:1},8,["model","rules"]),o(h,{size:"large",type:"primary",class:"w-full",onClick:E},{default:l(()=>[b(g(e.$t("views.login.buttons.checkCode")),1)]),_:1}),r("div",j,[o(h,{class:"register",onClick:a[2]||(a[2]=m=>w(C).push("/login")),link:"",type:"primary",icon:"ArrowLeft"},{default:l(()=>[b(g(e.$t("views.login.buttons.backLogin")),1)]),_:1})])]),_:1},8,["subTitle"])]}),_:1})),[[A,i.value||p.value]])}}});export{x as default};
