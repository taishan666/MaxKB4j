import{ay as Z,aZ as W,a_ as X,bU as ee,aB as l,aQ as ae,b7 as te,b8 as ne,aD as p,a$ as oe,aR as F,aF as u,aS as J,aI as D,b0 as le,aH as i,aE as C,b1 as H,aJ as E,b6 as T,aG as t,aT as Y,aK as B,be as se,b2 as V,bE as re,aV as K,aU as Q,bY as pe}from"./admin-_EJ4kEIX.js";import{_ as ie}from"./ParagraphForm.vue_vue_type_script_setup_true_lang-_GxaFw8Y.js";const de={class:"bold title p-24",style:{"padding-bottom":"0"}},ue={class:"flex align-center"},ce={class:"p-24",style:{"padding-top":"16px"}},me=Z({__name:"ProblemComponent",props:{paragraphId:{},docId:{},knowledgeId:{},apiType:{}},setup(M,{expose:O}){const a=M,S=W(),{params:{id:k,documentId:g}}=S,x=X(()=>ee.knowledge[a.apiType]),q=l(),b=l(!1),y=l(!1),m=l(""),s=l([]),v=l([]),f=l(!1);ae(()=>a.paragraphId,e=>{e&&c()},{immediate:!0});function w(e,r){if(e.id){const I={paragraphId:a.paragraphId||"",problem_id:e.id};V({type:"paragraph",systemType:a.apiType}).putDisassociationProblem(a.knowledgeId||k,g||a.docId,I,b).then(_=>{c()})}else s.value.splice(r,1)}function c(){b.value=!0,V({type:"paragraph",systemType:a.apiType}).getParagraphProblem(a.knowledgeId||k,g||a.docId,a.paragraphId||"").then(e=>{s.value=e.data,b.value=!1}).catch(()=>{b.value=!1})}function A(){y.value=!0,re(()=>{var e;(e=q.value)==null||e.focus()})}function N(e){if(a.paragraphId){const r={paragraphId:a.paragraphId,problem_id:e};(v.value.some(_=>_.id===e)?V({type:"paragraph",systemType:a.apiType}).putAssociationProblem(a.knowledgeId||k,g||a.docId,r,b):V({type:"paragraph",systemType:a.apiType}).postParagraphProblem(a.knowledgeId||k,g||a.docId,a.paragraphId,{content:e},b)).then(()=>{c(),m.value="",y.value=!1})}else{const r=v.value.find(_=>_.id===e),I=r?r.content:e;s.value.some(_=>_.content===I)||s.value.push({content:I}),m.value="",y.value=!1}}const U=e=>{P(e)};function P(e){return V({type:"problem",systemType:a.apiType}).getProblemsPage(a.knowledgeId||k,{current_page:1,page_size:100},e&&{content:e},f).then(r=>{v.value=r.data.records})}return te(()=>{P()}),ne(()=>{s.value=[],m.value="",y.value=!1}),O({problemList:s}),(e,r)=>{const I=p("el-divider"),_=p("Plus"),o=p("el-icon"),n=p("el-button"),L=p("el-option"),h=p("el-select"),$=p("auto-tooltip"),j=p("TagEllipsis"),z=p("el-scrollbar"),G=oe("loading");return u(),F(J,null,[D("p",de,[D("span",ue,[D("span",null,E(e.$t("views.paragraph.relatedProblem.title")),1),i(I,{direction:"vertical",class:"mr-4"}),x.value.problem_relate(T(k))?(u(),C(n,{key:0,text:"",onClick:A},{default:t(()=>[i(o,null,{default:t(()=>[i(_)]),_:1})]),_:1})):H("",!0)])]),le((u(),F("div",null,[i(z,{height:"500px"},{default:t(()=>[D("div",ce,[y.value?(u(),C(h,{key:0,modelValue:m.value,"onUpdate:modelValue":r[0]||(r[0]=d=>m.value=d),filterable:"","allow-create":"","default-first-option":"","reserve-keyword":!1,placeholder:e.$t("views.paragraph.relatedProblem.placeholder"),remote:"","remote-method":U,loading:f.value,onChange:N,onBlur:r[1]||(r[1]=d=>y.value=!1),class:"mb-16","popper-class":"select-popper","popper-append-to-body":!1},{default:t(()=>[(u(!0),F(J,null,Y(v.value,d=>(u(),C(L,{key:d.id,label:d.content,value:d.id},{default:t(()=>[B(E(d.content),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","loading"])):H("",!0),(u(!0),F(J,null,Y(s.value,(d,R)=>(u(),C(j,se({key:R,onClose:be=>w(d,R),class:"question-tag",type:"info",effect:"plain"},{ref_for:!0},x.value.problem_relate(T(k))?{closable:!0}:{}),{default:t(()=>[i($,{content:d.content},{default:t(()=>[B(E(d.content),1)]),_:2},1032,["content"])]),_:2},1040,["onClose"]))),128))])]),_:1})])),[[G,b.value]])],64)}}}),ve={class:"p-24",style:{"padding-bottom":"8px"}},fe={style:{position:"absolute",right:"20px",top:"20px"}},_e={key:0,class:"text-right p-24 pt-0"},ge={class:"dialog-footer"},ke=Z({__name:"ParagraphDialog",props:{title:{},apiType:{}},emits:["refresh"],setup(M,{expose:O,emit:a}){const S=M,k=W(),{params:{id:g,documentId:x}}=k,q=X(()=>ee.knowledge[S.apiType]),b=a,y=l(),m=l(),s=l(!1),v=l(!1),f=l(""),w=l({}),c=l(!1),A=l(""),N=l(""),U=l(null),P=l(null);ae(s,o=>{o||(f.value="",w.value={},c.value=!1,A.value="",N.value="",U.value=null)});const e=()=>{c.value=!1,w.value=K.cloneDeep(U.value)},r=(o,n)=>{o&&!n?(w.value.title=o.title,w.value.content=o.content,U.value=K.cloneDeep(w.value),f.value=o.id,A.value=o.documentId,N.value=o.knowledgeId||g):(c.value=!0,n==="add"&&(P.value=o.position)),s.value=!0},I=async()=>{var o,n,L,h;if(await((o=m.value)==null?void 0:o.validate()))if(v.value=!0,f.value)V({type:"paragraph",systemType:S.apiType}).putParagraph(N.value,x||A.value,f.value,(n=m.value)==null?void 0:n.form,v).then($=>{c.value=!1,b("refresh",$.data)});else{const $=y.value.problemList.length>0?{position:String(P.value)?P.value:null,problemList:y.value.problemList,...(L=m.value)==null?void 0:L.form}:{position:String(P.value)?P.value:null,...(h=m.value)==null?void 0:h.form};V({type:"paragraph",systemType:S.apiType}).postParagraph(g,x,$,v).then(()=>{s.value=!1,b("refresh")})}},_=K.debounce(()=>{I()},200);return O({open:r,dialogVisible:s}),(o,n)=>{const L=p("AppIcon"),h=p("el-button"),$=p("el-scrollbar"),j=p("el-col"),z=p("el-row"),G=p("el-dialog"),d=oe("loading");return u(),C(G,{title:o.title,modelValue:s.value,"onUpdate:modelValue":n[2]||(n[2]=R=>s.value=R),width:"80%",class:"paragraph-dialog","destroy-on-close":"","close-on-click-modal":!1,"close-on-press-escape":!1,onClick:n[3]||(n[3]=Q(()=>{},["stop"]))},pe({default:t(()=>[le((u(),C(z,null,{default:t(()=>[i(j,{span:18},{default:t(()=>[i($,{height:"500","wrap-class":"paragraph-scrollbar"},{default:t(()=>[D("div",ve,[D("div",fe,[f.value&&!c.value?(u(),C(h,{key:0,text:"",onClick:n[0]||(n[0]=R=>c.value=!0)},{default:t(()=>[i(L,{iconName:"app-edit"})]),_:1})):H("",!0)]),i(ie,{ref_key:"paragraphFormRef",ref:m,data:w.value,isEdit:c.value,"knowledge-id":T(g)},null,8,["data","isEdit","knowledge-id"])])]),_:1}),f.value&&c.value?(u(),F("div",_e,[i(h,{onClick:Q(e,["prevent"])},{default:t(()=>[B(E(o.$t("common.cancel")),1)]),_:1}),i(h,{type:"primary",disabled:v.value,onClick:T(_)},{default:t(()=>[B(E(o.$t("common.save")),1)]),_:1},8,["disabled","onClick"])])):H("",!0)]),_:1}),i(j,{span:6,class:"border-l",style:{width:"300px"}},{default:t(()=>[q.value.problem_read(T(g))?(u(),C(me,{key:0,paragraphId:f.value,docId:T(x),knowledgeId:T(g),apiType:o.apiType,ref_key:"ProblemRef",ref:y},null,8,["paragraphId","docId","knowledgeId","apiType"])):H("",!0)]),_:1})]),_:1})),[[d,v.value]])]),_:2},[f.value?void 0:{name:"footer",fn:t(()=>[D("span",ge,[i(h,{onClick:n[1]||(n[1]=Q(R=>s.value=!1,["prevent"]))},{default:t(()=>[B(E(o.$t("common.cancel")),1)]),_:1}),i(h,{disabled:v.value,type:"primary",onClick:T(_)},{default:t(()=>[B(E(o.$t("common.submit")),1)]),_:1},8,["disabled","onClick"])])]),key:"0"}]),1032,["title","modelValue"])}}});export{ke as _};
