const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./dingtalkQrCode-CFte9mOD.js","./logo_dingtalk-CyDPr22R.js","./admin-D1QwKL-A.js","./admin-DmmgVAFl.css","./dingtalkQrCode-CulsC8mV.css","./larkQrCode-Rs4_HEzQ.js","./logo_lark-DULIW3z6.js","./wecomQrCode-DaZVcjTw.js","./wecom.prod-DKW5jE45.js","./wecomQrCode-Cct41S0k.css"])))=>i.map(i=>d[i]);
import{ay as W,aB as u,aA as F,az as re,aP as ie,aD as f,aE as m,aF as a,a_ as ve,aG as i,aH as v,aK as ce,aJ as R,aC as b,bM as G,b9 as ue,bK as fe,dC as K,cn as de,aT as g,aI as r,da as ge,aZ as pe,aU as k,bD as he,dD as ye,aY as J,dE as N,dF as we,aQ as be,b3 as Ce,b4 as Le,b8 as w,c2 as se,cT as ke,bg as xe,dG as ne,c8 as Ae}from"./admin-D1QwKL-A.js";import{_ as De,a as Oe}from"./dynamic-import-helper-B1wUOttj.js";const $e=W({__name:"password",setup($){const h=u(),{chatUser:x}=F(),t=u(!1),C=re(),T=ie(),V=()=>x.passwordAuthentication(d.value.password).then(D=>{C.push({name:"chat",params:{accessToken:x.accessToken},query:T.query})}),A=(D,L,n)=>{L===""?n(new Error(b("chat.passwordValidator.errorMessage1"))):V().catch(()=>{n(new Error(b("chat.passwordValidator.errorMessage2")))})},I=()=>{h.value.validate()},y={password:[{required:!0,validator:A,trigger:"manual"}]},d=u({password:""});return(D,L)=>{const n=f("el-input"),z=f("el-form-item"),U=f("el-button"),Q=f("el-form");return a(),m(Q,{ref_key:"FormRef",ref:h,model:d.value,onSubmit:ve(I,["prevent"])},{default:i(()=>[v(z,{prop:"value",rules:y.password},{default:i(()=>[v(n,{"show-password":"",modelValue:d.value.password,"onUpdate:modelValue":L[0]||(L[0]=l=>d.value.password=l)},null,8,["modelValue"])]),_:1},8,["rules"]),v(U,{class:"w-full mt-8",type:"primary",onClick:I,loading:t.value},{default:i(()=>[ce(R(D.$t("common.confirm")),1)]),_:1},8,["loading"])]),_:1},8,["model"])}}}),Ve=768,Re=()=>{const{common:$}=F(),h=()=>{var C;return((C=document.body)==null?void 0:C.getBoundingClientRect()).width-1<Ve},x=()=>{if(!document.hidden){const t=h();$.toggleDevice(t?K.Mobile:K.Desktop)}};G(()=>{window.addEventListener("resize",x)}),ue(()=>{fe(()=>{h()&&$.toggleDevice(K.Mobile)})})},Ie={},Pe={class:"login-warp flex-center"},Te={class:"login-container w-full h-full"},Me={class:"flex-center w-full h-full"};function Ee($,h){return a(),g("div",Pe,[r("div",Te,[r("div",Me,[ge($.$slots,"default",{},void 0,!0)])])])}const qe=de(Ie,[["render",Ee],["__scopeId","data-v-e5a94abc"]]),Ue={key:0,class:"text-center"},Qe=W({__name:"QrCodeTab",props:{tabs:{}},setup($){const{chatUser:h}=F(),x=$,t=u(""),C=u([]),T=u({app_key:"",app_secret:""});async function V(){try{return await h.getQrSource()}catch{return[]}}ue(async()=>{x.tabs.length>0&&(t.value=x.tabs[0].key),C.value=await V(),A(t.value)});const A=y=>{const d=C.value.find(D=>D.auth_type===y);d&&d.config&&(T.value=d.config)},I=y=>{t.value=y,A(y)};return(y,d)=>{const D=f("el-tab-pane"),L=f("el-tabs");return a(),m(L,{modelValue:t.value,"onUpdate:modelValue":d[0]||(d[0]=n=>t.value=n),onTabChange:I},{default:i(()=>[(a(!0),g(J,null,pe(y.tabs,n=>(a(),m(D,{key:n.key,label:n.value,name:n.key},{default:i(()=>[n.key===t.value?(a(),g("div",Ue,[(a(),m(he(ye(()=>De(Object.assign({"./dingtalkQrCode.vue":()=>N(()=>import("./dingtalkQrCode-CFte9mOD.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url),"./larkQrCode.vue":()=>N(()=>import("./larkQrCode-Rs4_HEzQ.js"),__vite__mapDeps([5,6,2,3]),import.meta.url),"./wecomQrCode.vue":()=>N(()=>import("./wecomQrCode-DaZVcjTw.js"),__vite__mapDeps([7,2,3,8,9]),import.meta.url)}),`./${n.key}QrCode.vue`,2))),{config:T.value},null,8,["config"]))])):k("",!0)]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])}}}),Se={class:"user-login-container p-24"},Fe={key:0,class:"flex-center",style:{"margin-bottom":"32px"}},ze=["src"],Be={key:1,class:"user-login__header"},He={class:"flex-between"},je={class:"flex align-center"},Ke={class:"mr-12 ml-16 flex"},Ne=["src"],Ge=["title"],Je={class:"mb-24"},We={key:0,class:"mb-24"},Ye={key:1},Ze={class:"mb-24"},Xe={class:"mb-24"},eo={key:0,class:"mb-24"},oo={class:"flex-between w-full"},to=["src"],ao={key:2},lo={key:3,class:"login-gradient-divider lighter mt-24"},so={class:"text-center mt-16"},no=W({__name:"index",setup($){Re();const h=re(),{theme:x,chatUser:t,common:C}=F(),{locale:T}=we({useScope:"global"}),V=u(!1),A=ie(),I=u(""),{params:{accessToken:y},query:{mode:d}}=A,D=be(()=>{console.log(C.isMobile());let e="";return!d||d==="pc"?e=C.isMobile()?"mobile":"pc":e=d,console.log(e),e==="pc"}),L=u(),n=u({username:"",password:"",captcha:""}),z=u({username:[{required:!0,message:b("views.login.loginForm.username.requiredMessage"),trigger:"blur"}],password:[{required:!0,message:b("views.login.loginForm.password.requiredMessage"),trigger:"blur"}],captcha:[{required:!0,message:b("views.login.loginForm.captcha.requiredMessage"),trigger:"blur"}]}),U=()=>{var e;(e=L.value)==null||e.validate().then(()=>{c.value==="LDAP"?t.ldapLogin(n.value).then(o=>{h.push({name:"chat",params:{accessToken:t.accessToken},query:A.query})}):t.login(n.value).then(o=>{h.push({name:"chat",params:{accessToken:t.accessToken},query:A.query})})})};function Q(){ne.getCaptcha().then(e=>{I.value=e.data.captcha})}G(()=>{T.value=t.getLanguage(),Q()});const l=u([]),B=u([""]),c=u(""),M=u(!1),Y=u([]);function _e(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const o=Math.random()*16|0;return(e==="x"?o:o&3|8).toString(16)})}function Z(e,o=!1){e==="LDAP"||e===""||ne.getAuthSetting(e,V).then(P=>{if(!P.data||!P.data.config)return;const _=P.data.config,E=new URLSearchParams(A.query).toString();let O=`${_.redirectUrl}/${y}`;E&&(O+=`?${E}`);let p;if(e==="CAS")p=_.ldpUri,p+=p.indexOf("?")!==-1?`&service=${encodeURIComponent(O)}`:`?service=${encodeURIComponent(O)}`;else if(e==="OIDC"){const j=_.scope||"openid+profile+email";p=`${_.authEndpoint}?client_id=${_.clientId}&redirect_uri=${O}&response_type=code&scope=${j}`,_.state&&(p+=`&state=${_.state}`)}else e==="OAuth2"&&(p=`${_.authEndpoint}?client_id=${_.clientId}&response_type=code&redirect_uri=${O}&state=${_e()}`,_.scope&&(p+=`&scope=${_.scope}`));p&&(o?Ae(b("views.login.jump_tip"),"",{confirmButtonText:b("views.login.jump"),cancelButtonText:b("common.cancel"),confirmButtonClass:""}).then(()=>{window.location.href=p}).catch(()=>{}):(console.log("url",p),window.location.href=p))})}function H(e){var o;if(c.value=e==="LDAP"?e:"LOCAL",e!=="LOCAL"&&(c.value=e),e==="QR_CODE"){c.value=e,M.value=!0;return}M.value=!1,n.value={username:"",password:"",captcha:""},Z(e),(o=L.value)==null||o.clearValidate()}return G(()=>{var e;(e=t.chat_profile)!=null&&e.login_value&&(l.value=t.chat_profile.login_value,l.value.includes("LOCAL")?l.value=["LOCAL",...l.value.filter(o=>o!=="LOCAL")]:l.value.includes("LDAP")&&(l.value=["LDAP",...l.value.filter(o=>o!=="LDAP")]),c.value=l.value[0]||"LOCAL",!l.value.includes("LOCAL")&&!l.value.includes("LDAP")&&(c.value=""),l.value.length==1&&["CAS","OIDC","OAuth2"].includes(l.value[0])&&Z(l.value[0]),B.value=l.value.filter(o=>!["CAS","OIDC","OAuth2","LOCAL","LDAP"].includes(o)),l.value=l.value.filter(o=>!["lark","wecom","dingtalk"].includes(o)),B.value.length>0&&(B.value.forEach(o=>{Y.value.push({key:o,value:o==="wecom"?b("views.system.authentication.scanTheQRCode.wecom"):o==="dingtalk"?b("views.system.authentication.scanTheQRCode.dingtalk"):b("views.system.authentication.scanTheQRCode.lark")})}),!l.value.includes("LOCAL")&&!l.value.includes("LDAP")&&(M.value=!0),l.value=["QR_CODE",...l.value]))}),(e,o)=>{const P=f("el-avatar"),_=f("LogoIcon"),E=f("el-card"),O=f("el-input"),p=f("el-form-item"),j=f("el-form"),S=f("el-button"),me=Ce("loading");return V.value?k("",!0):Le((a(),m(qe,{key:0},{default:i(()=>{var X,ee,oe,te,ae,le;return[r("div",Se,[D.value?(a(),g("div",Fe,[w(se)((X=w(t).chat_profile)==null?void 0:X.icon)?(a(),m(P,{key:0,shape:"square",size:32,class:"mr-8",style:{background:"none"}},{default:i(()=>{var s;return[r("img",{src:(s=w(t).chat_profile)==null?void 0:s.icon,alt:""},null,8,ze)]}),_:1})):(a(),m(_,{key:1,height:"32px",class:"mr-8"})),r("h1",null,R((ee=w(t).chat_profile)==null?void 0:ee.application_name),1)])):(a(),g("div",Be,[r("div",He,[r("div",je,[r("div",Ke,[w(se)((oe=w(t).chat_profile)==null?void 0:oe.icon)?(a(),m(P,{key:0,shape:"square",size:32,style:{background:"none"}},{default:i(()=>{var s;return[r("img",{src:(s=w(t).chat_profile)==null?void 0:s.icon,alt:""},null,8,Ne)]}),_:1})):(a(),m(_,{key:1,height:"32px"}))]),r("h4",{class:"ellipsis",style:{"max-width":"270px"},title:(te=w(t).chat_profile)==null?void 0:te.application_name},R((ae=w(t).chat_profile)==null?void 0:ae.application_name),9,Ge)])])])),((le=w(t).chat_profile)==null?void 0:le.authentication_type)=="password"?(a(),m(E,{key:2,class:"login-card"},{default:i(()=>[r("h2",Je,R(e.$t("views.applicationOverview.appInfo.LimitDialog.authenticationValue")),1),v($e)]),_:1})):(a(),m(E,{key:3,class:"login-card",style:{"--el-card-padding":"0"}},{default:i(()=>[!M.value&&(c.value==="LDAP"||c.value==="LOCAL")?(a(),g("h2",We,R(c.value=="LOCAL"?e.$t("views.login.title"):c.value),1)):k("",!0),!M.value&&(c.value==="LDAP"||c.value==="LOCAL")?(a(),g("div",Ye,[v(j,{class:"login-form",rules:z.value,model:n.value,ref_key:"loginFormRef",ref:L,onKeyup:ke(U,["enter"])},{default:i(()=>[r("div",Ze,[v(p,{prop:"username"},{default:i(()=>[v(O,{size:"large",class:"input-item",modelValue:n.value.username,"onUpdate:modelValue":o[0]||(o[0]=s=>n.value.username=s),placeholder:e.$t("views.login.loginForm.username.placeholder")},null,8,["modelValue","placeholder"])]),_:1})]),r("div",Xe,[v(p,{prop:"password"},{default:i(()=>[v(O,{type:"password",size:"large",class:"input-item",modelValue:n.value.password,"onUpdate:modelValue":o[1]||(o[1]=s=>n.value.password=s),placeholder:e.$t("views.login.loginForm.password.placeholder"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1})]),c.value!=="LDAP"?(a(),g("div",eo,[v(p,{prop:"captcha"},{default:i(()=>[r("div",oo,[v(O,{size:"large",class:"input-item",modelValue:n.value.captcha,"onUpdate:modelValue":o[2]||(o[2]=s=>n.value.captcha=s),placeholder:e.$t("views.login.loginForm.captcha.placeholder")},null,8,["modelValue","placeholder"]),r("img",{src:I.value,alt:"",height:"38",class:"ml-8 cursor border border-r-6",onClick:Q},null,8,to)])]),_:1})])):k("",!0)]),_:1},8,["rules","model"]),v(S,{size:"large",type:"primary",class:"w-full",onClick:U,loading:V.value},{default:i(()=>[ce(R(e.$t("views.login.buttons.login")),1)]),_:1},8,["loading"])])):k("",!0),M.value?(a(),g("div",ao,[v(Qe,{tabs:Y.value},null,8,["tabs"])])):k("",!0),l.value.length>1?(a(),g("div",lo,[r("span",null,R(e.$t("views.login.moreMethod")),1)])):k("",!0),r("div",so,[(a(!0),g(J,null,pe(l.value,s=>(a(),g(J,null,[s!=="LOCAL"&&c.value!==s&&s!=="QR_CODE"?(a(),m(S,{circle:"",key:s,class:"login-button-circle color-secondary",onClick:q=>H(s)},{default:i(()=>{var q;return[r("span",{style:xe({"font-size":s==="OAUTH2"?"8px":"10px",color:(q=w(x).themeInfo)==null?void 0:q.theme})},R(s),5)]}),_:2},1032,["onClick"])):k("",!0),s==="QR_CODE"&&c.value!==s?(a(),m(S,{circle:"",key:s,class:"login-button-circle color-secondary",onClick:o[3]||(o[3]=q=>H("QR_CODE"))},{default:i(()=>o[5]||(o[5]=[r("img",{src:Oe,width:"25px"},null,-1)])),_:2,__:[5]},1024)):k("",!0),s==="LOCAL"&&c.value!="LOCAL"?(a(),m(S,{circle:"",key:s,class:"login-button-circle color-secondary",style:{"font-size":"24px"},icon:"UserFilled",onClick:o[4]||(o[4]=q=>H("LOCAL"))})):k("",!0)],64))),256))])]),_:1}))])]}),_:1})),[[me,V.value]])}}}),ro=de(no,[["__scopeId","data-v-f368ed29"]]),uo=Object.freeze(Object.defineProperty({__proto__:null,default:ro},Symbol.toStringTag,{value:"Module"}));export{$e as _,uo as a,Re as u};
