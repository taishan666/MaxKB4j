import{ay as ve,aP as Be,aA as De,aQ as pe,b_ as Ue,aB as d,aR as Te,aX as Ne,aC as f,aD as s,b3 as Se,aE as r,aF as a,aG as o,aI as i,aH as l,b4 as be,aJ as v,a_ as F,aT as H,aU as b,b8 as W,c3 as Ae,c5 as Ce,aK as $,aW as N,b5 as fe,a$ as ae,c9 as we,c4 as Pe,cT as Ee,co as qe,bM as ro,aY as se,c0 as co,aZ as me,cp as uo,cJ as Q,cO as po,de as mo,b9 as fo,dk as vo,dg as _o,e3 as yo,db as go,dl as ho,c1 as ze,ca as ko}from"./admin-DrZ65G2p.js";import{T as wo,_ as To}from"./store-BmIi4GAd.js";import{c as bo,b as He,_ as $o,a as Co}from"./ToolFormDrawer.vue_vue_type_script_setup_true_lang-DbWUcH0Y.js";import{_ as Do}from"./AuthorizedWorkspaceDialog.vue_vue_type_script_setup_true_lang-DZL4CYAz.js";import{_ as So}from"./index.vue_vue_type_script_setup_true_lang-BbM9QvHJ.js";import{M as Ao}from"./MoveToDialog-ApmFGeHS.js";const Io={class:"title-decoration-1 mb-16"},Vo={class:"flex w-full"},Lo=["src"],Ro={class:"title-decoration-1 mb-16"},Mo={class:"mb-8"},xo=`{
  "math": {
    "url": "your_server",
    "type": "sse"
  }
}`,zo=ve({__name:"McpToolFormDrawer",props:{title:String},emits:["refresh"],setup(oe,{expose:Z,emit:A}){const x=Be(),{folder:C,user:p}=De(),T=pe(()=>x.path.includes("shared")?"systemShare":x.path.includes("resource-management")?"systemManage":"workspace"),_=pe(()=>Ue.tool[T.value]),g=A,w=d(),c=d(),D=d(!1),I=d(!1),B=d(!1),z=d(!1),E=d(null),U=d(!1),y=d({name:"",desc:"",code:"",icon:"",inputFieldList:[],initFieldList:[],toolType:"MCP"});Te(B,k=>{var u;k||(D.value=!1,z.value=!1,E.value=null,y.value={name:"",desc:"",code:"",icon:"",inputFieldList:[],initFieldList:[],toolType:"MCP"},(u=c.value)==null||u.clearValidate())});const V=Ne({name:[{required:!0,message:f("views.tool.form.toolName.requiredMessage"),trigger:"blur"}]});function O(){D.value||!R(y.value)?B.value=!1:we(f("common.tip"),f("views.tool.tip.saveMessage"),{confirmButtonText:f("common.confirm"),type:"warning"}).then(()=>{B.value=!1}).catch(()=>{})}function R(k){return Object.values(k).some(u=>Array.isArray(u)?u.length!==0:u!=null&&u!=="")}function le(k){y.value.icon=k}function h(){w.value.open(y.value)}const L=async k=>{k&&await k.validate(u=>{var G,X;if(u)if(D.value)N({type:"tool",systemType:T.value}).putTool((G=y.value)==null?void 0:G.id,y.value,I).then(j=>(fe(f("common.editSuccess")),g("refresh",j.data),p.profile())).then(()=>{B.value=!1});else{const j={folderId:(X=C.currentFolder)==null?void 0:X.id,...y.value};N({type:"tool",systemType:T.value}).postTool(j,I).then(ee=>(fe(f("common.createSuccess")),g("refresh"),p.profile())).then(()=>{B.value=!1})}})};function q(){y.value.code&&(I.value=!0,N({type:"tool",systemType:T.value}).postToolTestConnection({code:y.value.code},I).then(()=>{fe(f("views.system.testSuccess"))}).finally(()=>{I.value=!1}))}return Z({open:k=>{k&&(D.value=!!(k!=null&&k.id),y.value=ae.cloneDeep(k)),B.value=!0,setTimeout(()=>{z.value=!0},100)}}),(k,u)=>{const G=s("el-Avatar"),X=s("el-avatar"),j=s("AppIcon"),ee=s("el-input"),ce=s("el-form-item"),_e=s("el-form"),ye=s("el-text"),S=s("el-button"),J=s("el-drawer"),ue=Se("loading");return a(),r(J,{modelValue:B.value,"onUpdate:modelValue":u[10]||(u[10]=P=>B.value=P),size:"60%","before-close":O},{header:o(()=>[i("h4",null,v(oe.title),1)]),footer:o(()=>{var P;return[i("div",null,[l(S,{loading:I.value,onClick:q},{default:o(()=>[$(v(k.$t("views.system.test")),1)]),_:1},8,["loading"]),l(S,{loading:I.value,onClick:u[8]||(u[8]=Y=>B.value=!1)},{default:o(()=>[$(v(k.$t("common.cancel")),1)]),_:1},8,["loading"]),(D.value?_.value.edit((P=y.value)==null?void 0:P.id):_.value.create())?(a(),r(S,{key:0,type:"primary",onClick:u[9]||(u[9]=Y=>L(c.value)),loading:I.value},{default:o(()=>[$(v(D.value?k.$t("common.save"):k.$t("common.create")),1)]),_:1},8,["loading"])):b("",!0)])]}),default:o(()=>[i("div",null,[i("h4",Io,v(k.$t("views.model.modelForm.title.baseInfo")),1),be((a(),r(_e,{ref_key:"FormRef",ref:c,model:y.value,rules:V,"label-position":"top","require-asterisk-position":"right",onSubmit:u[6]||(u[6]=F(()=>{},["prevent"]))},{default:o(()=>[l(ce,{label:k.$t("views.tool.form.toolName.label"),prop:"name"},{default:o(()=>[i("div",Vo,[y.value.id?(a(),H("div",{key:0,class:"edit-avatar mr-12",onMouseenter:u[0]||(u[0]=P=>U.value=!0),onMouseleave:u[1]||(u[1]=P=>U.value=!1)},[W(Ae)(y.value.icon)?(a(),r(G,{key:0,id:y.value.id,shape:"square",size:32,style:{background:"none"}},{default:o(()=>[i("img",{src:String(y.value.icon),alt:""},null,8,Lo)]),_:1},8,["id"])):(a(),r(X,{key:1,class:"avatar-green",shape:"square",size:32},{default:o(()=>u[11]||(u[11]=[i("img",{src:Ce,style:{width:"58%"},alt:""},null,-1)])),_:1,__:[11]})),U.value?(a(),r(G,{key:2,id:y.value.id,shape:"square",class:"edit-mask",size:32,onClick:h},{default:o(()=>[l(j,{iconName:"app-edit"})]),_:1},8,["id"])):b("",!0)],32)):(a(),r(X,{key:1,class:"avatar-green mr-12",shape:"square",size:32},{default:o(()=>u[12]||(u[12]=[i("img",{src:Ce,style:{width:"58%"},alt:""},null,-1)])),_:1,__:[12]})),l(ee,{modelValue:y.value.name,"onUpdate:modelValue":u[2]||(u[2]=P=>y.value.name=P),placeholder:k.$t("views.tool.form.toolName.placeholder"),maxlength:"64","show-word-limit":"",onBlur:u[3]||(u[3]=P=>{var Y;return y.value.name=(Y=y.value.name)==null?void 0:Y.trim()})},null,8,["modelValue","placeholder"])])]),_:1},8,["label"]),l(ce,{label:k.$t("views.tool.form.toolDescription.label")},{default:o(()=>[l(ee,{modelValue:y.value.desc,"onUpdate:modelValue":u[4]||(u[4]=P=>y.value.desc=P),type:"textarea",placeholder:k.$t("views.tool.form.toolDescription.placeholder"),maxlength:"128","show-word-limit":"",autosize:{minRows:3},onBlur:u[5]||(u[5]=P=>{var Y;return y.value.desc=(Y=y.value.desc)==null?void 0:Y.trim()})},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])),[[ue,I.value]]),i("h4",Ro,[$(v(k.$t("views.tool.form.mcp.label"))+" ",1),u[13]||(u[13]=i("span",{style:{color:"red","margin-left":"-10px"}},"*",-1)),l(ye,{type:"info",class:"color-secondary"},{default:o(()=>[$(v(k.$t("views.tool.form.mcp.tip")),1)]),_:1})]),i("div",Mo,[l(ee,{modelValue:y.value.code,"onUpdate:modelValue":u[7]||(u[7]=P=>y.value.code=P),placeholder:xo,type:"textarea",autosize:{minRows:5}},null,8,["modelValue"])])]),l(bo,{ref_key:"EditAvatarDialogRef",ref:w,onRefresh:le},null,512)]),_:1},8,["modelValue"])}}}),Fo=["src"],Bo={class:"card-footer-left color-secondary"},Uo=ve({__name:"ToolCard",props:{tool:{},getSubTitle:{type:Function},addLoading:{type:Boolean}},emits:["handleAdd","handleDetail"],setup(oe,{emit:Z}){const A=oe,x=Z;return(C,p)=>{const T=s("el-avatar"),_=s("el-text"),g=s("el-button");return a(),r(Ee,{title:A.tool.name,description:A.tool.desc,class:"cursor"},{icon:o(()=>{var w,c,D;return[W(Ae)((w=A.tool)==null?void 0:w.icon)?(a(),r(T,{key:0,shape:"square",size:32,style:{background:"none"}},{default:o(()=>{var I;return[i("img",{src:W(Pe)((I=A.tool)==null?void 0:I.icon),alt:""},null,8,Fo)]}),_:1})):(c=A.tool)!=null&&c.name?(a(),r(T,{key:1,name:(D=A.tool)==null?void 0:D.name,pinyinColor:"",shape:"square",size:32},null,8,["name"])):b("",!0)]}),subTitle:o(()=>[l(_,{class:"color-secondary",size:"small"},{default:o(()=>[$(v(C.getSubTitle(A.tool)),1)]),_:1})]),footer:o(()=>[i("span",Bo,v(`${C.$t("common.author")}: MaxKB`),1),i("div",{class:"card-footer-operation",onClick:p[2]||(p[2]=F(()=>{},["stop"]))},[l(g,{onClick:p[0]||(p[0]=w=>x("handleDetail"))},{default:o(()=>[$(v(C.$t("common.detail")),1)]),_:1}),l(g,{type:"primary",loading:A.addLoading,onClick:p[1]||(p[1]=w=>x("handleAdd"))},{default:o(()=>[$(v(C.$t("common.add")),1)]),_:1},8,["loading"])])]),_:1},8,["title","description"])}}}),Fe=qe(Uo,[["__scopeId","data-v-7ac3eeac"]]),No={class:"flex align-center",style:{"margin-left":"-8px"}},Po={class:"card-header"},Eo={class:"flex-between"},qo={class:"title flex align-center"},Ho=["src"],Oo={class:"ml-16"},Wo={class:"mb-8"},jo={class:"mt-16"},Jo=ve({__name:"InternalDescDrawer",emits:["refresh","addTool"],setup(oe,{expose:Z,emit:A}){const x=A,C=d(!1),p=d(""),T=d({});Te(C,w=>{w||(p.value="")});const _=(w,c)=>{T.value=c,w&&(p.value=ae.cloneDeep(w)),C.value=!0},g=w=>{x("addTool",w),C.value=!1};return Z({open:_}),(w,c)=>{const D=s("Back"),I=s("el-icon"),B=s("el-button"),z=s("el-avatar"),E=s("el-text"),U=s("MdPreview"),y=s("el-drawer");return a(),r(y,{modelValue:C.value,"onUpdate:modelValue":c[3]||(c[3]=V=>C.value=V),size:"60%","append-to-body":!0},{header:o(()=>[i("div",No,[l(B,{class:"cursor mr-4",link:"",onClick:c[0]||(c[0]=F(V=>C.value=!1,["prevent"]))},{default:o(()=>[l(I,{size:20},{default:o(()=>[l(D)]),_:1})]),_:1}),c[4]||(c[4]=i("h4",null,"详情",-1))])]),default:o(()=>{var V,O,R,le;return[i("div",null,[i("div",Po,[i("div",Eo,[i("div",qo,[W(Ae)((V=T.value)==null?void 0:V.icon)?(a(),r(z,{key:0,shape:"square",size:64,style:{background:"none"},class:"mr-8"},{default:o(()=>{var h;return[i("img",{src:(h=T.value)==null?void 0:h.icon,alt:""},null,8,Ho)]}),_:1})):(O=T.value)!=null&&O.name?(a(),r(z,{key:1,name:(R=T.value)==null?void 0:R.name,pinyinColor:"",shape:"square",size:64,class:"mr-8"},null,8,["name"])):b("",!0),i("div",Oo,[i("h3",Wo,v(T.value.name),1),(le=T.value)!=null&&le.desc?(a(),r(E,{key:0,type:"info"},{default:o(()=>[$(v(T.value.desc),1)]),_:1})):b("",!0)])]),i("div",{onClick:c[2]||(c[2]=F(()=>{},["stop"]))},[l(B,{type:"primary",onClick:c[1]||(c[1]=h=>g(T.value))},{default:o(()=>[$(v(w.$t("common.add")),1)]),_:1})])]),i("div",jo,[l(E,{type:"info"},{default:o(()=>[i("div",null,v(w.$t("common.author"))+": MaxKB",1)]),_:1})])]),l(U,{ref:"editorRef",editorId:"preview-only",modelValue:p.value,style:{background:"none"},noImgZoomIn:""},null,8,["modelValue"])])]}),_:1},8,["modelValue"])}}}),Ko={class:"dialog-header flex-between mb-8"},Qo=["id"],Zo={class:"flex align-center",style:{"margin-right":"28px"}},Go=["id"],Xo={key:1},Yo={class:"color-text-primary medium mb-16"},el={class:"color-primary"},ol=ve({__name:"ToolStoreDialog",props:{apiType:{type:String,default:"workspace"}},emits:["refresh"],setup(oe,{expose:Z,emit:A}){const{user:x}=De(),C=oe,p=A,T=d(!1),_=d(!1),g=d(""),w=d(""),c=d([{id:"recommend",title:f("views.tool.toolStore.recommend"),tools:[]},{id:"web_search",title:f("views.tool.toolStore.webSearch"),tools:[]},{id:"database_search",title:f("views.tool.toolStore.databaseQuery"),tools:[]},{id:"image",title:f("views.tool.toolStore.image"),tools:[]},{id:"developer",title:f("views.tool.toolStore.developer"),tools:[]},{id:"send_message",title:f("views.tool.toolStore.sendMessage"),tools:[]}]),D=d(null);function I(h){var L;return((L=c.value.find(q=>q.id===h.label))==null?void 0:L.title)??""}function B(h){w.value=h,D.value=null,T.value=!0}ro(()=>{z()});async function z(){try{const h=await wo.getInternalToolList({name:g.value},_);g.value.length?D.value=h.data:(D.value=null,c.value.forEach(L=>{L.tools=h.data.filter(q=>q.label===L.id)}))}catch(h){console.error(h)}}const E=h=>{h.preventDefault()},U=d();async function y(h){var k;const L=h.icon.replace("icon.png","detail.md"),ie=await(await fetch(L)).text();(k=U.value)==null||k.open(ie,h)}const V=d();function O(h,L){var q;(q=V.value)==null||q.open(h,L)}const R=d(!1);async function le(h){try{await N({type:"tool",systemType:C.apiType}).addInternalTool(h.id,{name:h.name,folderId:w.value},R).then(()=>x.profile()),p("refresh"),fe(f("common.addSuccess")),T.value=!1}catch(L){console.error(L)}}return Z({open:B}),(h,L)=>{const q=s("el-tag"),ie=s("el-input"),k=s("el-divider"),u=s("el-anchor-link"),G=s("el-anchor"),X=s("el-col"),j=s("el-row"),ee=s("el-empty"),ce=s("el-scrollbar"),_e=s("el-dialog"),ye=Se("loading");return a(),H(se,null,[l(_e,{modelValue:T.value,"onUpdate:modelValue":L[1]||(L[1]=S=>T.value=S),width:"1000","append-to-body":"",class:"tool-store-dialog","align-center":"","close-on-click-modal":!1,"close-on-press-escape":!1},{header:o(({titleId:S})=>[i("div",Ko,[i("h4",{id:S,class:"medium"},v(h.$t("views.tool.toolStore.title")),9,Qo),l(q,{class:"store-type default-tag"},{default:o(()=>[$(v(W(f)("views.tool.toolStore.internal")),1)]),_:1}),i("div",Zo,[l(ie,{modelValue:g.value,"onUpdate:modelValue":L[0]||(L[0]=J=>g.value=J),placeholder:h.$t("common.search"),"prefix-icon":"Search",class:"w-240 mr-8",clearable:"",onChange:z},null,8,["modelValue","placeholder"]),l(k,{direction:"vertical"})])])]),default:o(()=>[be((a(),r(co,null,{left:o(()=>[l(G,{direction:"vertical",offset:130,type:"default",container:".category-scrollbar",onClick:E},{default:o(()=>[(a(!0),H(se,null,me(c.value,S=>(a(),r(u,{key:S.id,href:`#category-${S.id}`,title:S.title},null,8,["href","title"]))),128))]),_:1})]),default:o(()=>[l(ce,{class:"layout-bg","wrap-class":"p-16-24 category-scrollbar"},{default:o(()=>[D.value===null?(a(!0),H(se,{key:0},me(c.value,S=>(a(),H("div",{key:S.id},[i("h4",{class:"title-decoration-1 mb-16 mt-8 color-text-primary",id:`category-${S.id}`},v(S.title),9,Go),l(j,{gutter:16},{default:o(()=>[(a(!0),H(se,null,me(S.tools,J=>(a(),r(X,{key:J.id,span:8,class:"mb-16"},{default:o(()=>[l(Fe,{tool:J,addLoading:R.value,"get-sub-title":I,onHandleAdd:ue=>O(J),onHandleDetail:ue=>y(J)},null,8,["tool","addLoading","onHandleAdd","onHandleDetail"])]),_:2},1024))),128))]),_:2},1024)]))),128)):(a(),H("div",Xo,[i("h4",Yo,[i("span",el,v(g.value),1),$(" "+v(W(f)("views.tool.toolStore.searchResult",{count:D.value.length})),1)]),D.value.length?(a(),r(j,{key:0,gutter:16},{default:o(()=>[(a(!0),H(se,null,me(D.value,S=>(a(),r(X,{key:S.id,span:8,class:"mb-16"},{default:o(()=>[l(Fe,{tool:S,addLoading:R.value,"get-sub-title":I,onHandleAdd:J=>O(S),onHandleDetail:J=>y(S)},null,8,["tool","addLoading","onHandleAdd","onHandleDetail"])]),_:2},1024))),128))]),_:1})):(a(),r(ee,{key:1,description:h.$t("common.noData")},null,8,["description"]))]))]),_:1})]),_:1})),[[ye,_.value]])]),_:1},8,["modelValue"]),l(Jo,{ref_key:"internalDescDrawerRef",ref:U,onAddTool:O},null,512),l(He,{ref_key:"addInternalToolDialogRef",ref:V,onRefresh:le},null,512)],64)}}}),ll=ve({__name:"McpToolConfigDialog",setup(oe,{expose:Z}){const A=d(""),x=d(!1),C=d(!1),p=()=>{x.value=!1};return Z({open:_=>{A.value=_.code,x.value=!0}}),(_,g)=>{const w=s("el-input"),c=s("el-button"),D=s("el-form-item"),I=s("el-form"),B=s("el-dialog");return a(),r(B,{title:_.$t("views.tool.mcpConfig"),width:"600",modelValue:x.value,"onUpdate:modelValue":g[4]||(g[4]=z=>x.value=z),"close-on-click-modal":!1,"close-on-press-escape":!1,"destroy-on-close":!0,"before-close":p,"append-to-body":"",class:"mcp-config-dialog"},{default:o(()=>[l(I,{"label-width":"auto","label-position":"top"},{default:o(()=>[l(D,{onMouseenter:g[2]||(g[2]=F(z=>C.value=!0,["stop"])),onMouseleave:g[3]||(g[3]=F(z=>C.value=!1,["stop"]))},{default:o(()=>[l(w,{type:"textarea",modelValue:A.value,"onUpdate:modelValue":g[0]||(g[0]=z=>A.value=z),rows:"8",disabled:"",class:"config-textarea"},null,8,["modelValue"]),be(l(c,{circle:"",class:"copy-icon",onClick:g[1]||(g[1]=F(z=>W(uo)(A.value),["stop"]))},{default:o(()=>[l(Q,{iconName:"app-copy",class:"color-secondary"})]),_:1},512),[[po,C.value]])]),_:1})]),_:1})]),_:1},8,["title","modelValue"])}}}),tl=qe(ll,[["__scopeId","data-v-9cad61b5"]]),nl={class:"flex"},al={class:"flex-between complex-search"},sl={class:"flex align-center"},il={class:"flex align-center"},rl={class:"flex align-center w-full"},cl={class:"pre-wrap ml-8"},ul={class:"lighter"},dl={style:{"max-height":"calc(100vh - 120px)"}},pl=["src"],ml={key:0,class:"flex align-center"},fl={class:"color-secondary"},vl={key:1,class:"flex align-center"},_l={class:"color-secondary"},bl=ve({__name:"ToolListContainer",emits:["refreshFolder"],setup(oe,{emit:Z}){const A=Be(),{folder:x,user:C,tool:p}=De();mo((e,t)=>{p.setToolList([])});const T=Z,_=pe(()=>A.path.includes("shared")?"systemShare":A.path.includes("resource-management")?"systemManage":"workspace"),g=pe(()=>x.currentFolder.id==="share"),w=pe(()=>_.value==="systemShare"),c=pe(()=>Ue.tool[_.value]),D=e=>c.value.edit(e)||c.value.export(e)||c.value.delete(e)||c.value.auth(e)||w.value,I=d();function B(e){I.value.open(e.id)}const z=d(),E=d("name"),U=d({name:"",createUser:"",isActive:null}),y=d([]),V=d(!1),O=d(!1),R=Ne({current_page:1,page_size:30,total:0}),le=()=>{U.value={name:"",createUser:""}},h=d(),L=d(),q=d(""),ie=d(""),k=d();function u(e){const t=ae.cloneDeep(p.toolList),m=t.findIndex(M=>M.id===e.id);t.splice(m,1),p.setToolList(t)}const G=d();function X(e){G.value&&G.value.open(e,"Tool")}function j(e){if((e==null?void 0:e.toolType)==="MCP"){ee(e);return}e!=null&&e.template_id||g.value||(q.value=e?f("views.tool.editTool"):f("views.tool.createTool"),e?N({type:"tool",systemType:_.value}).getToolById(e==null?void 0:e.id,V).then(t=>{h.value.open(t.data)}):h.value.open(e))}function ee(e){e!=null&&e.template_id||g.value||(ie.value=e?f("views.tool.editMcpTool"):f("views.tool.createMcpTool"),e?N({type:"tool",systemType:_.value}).getToolById(e==null?void 0:e.id,V).then(t=>{L.value.open(t.data)}):L.value.open(e))}async function ce(e){if(e.isActive)we(`${f("views.tool.disabled.confirmTitle")}${e.name} ?`,f("views.tool.disabled.confirmMessage"),{confirmButtonText:f("common.status.disable"),confirmButtonClass:"danger"}).then(()=>{const t={isActive:!e.isActive};N({type:"tool",systemType:_.value}).putTool(e.id,t,O).then(()=>{const m=ae.cloneDeep(p.toolList),M=m.findIndex(te=>te.id===e.id);return m[M].isActive=!e.isActive,p.setToolList(m),!0}).catch(()=>!1)});else{const t=await N({type:"tool",systemType:_.value}).getToolById(e.id,O);if((!t.data.initParams||Object.keys(t.data.initParams).length===0)&&t.data.initFieldList&&t.data.initFieldList.length>0&&t.data.initFieldList.filter(M=>M.default_value&&M.show_default_value).length!==t.data.initFieldList.length)return z.value.open(t.data,!e.isActive),!1;const m={isActive:!e.isActive};N({type:"tool",systemType:_.value}).putTool(e.id,m,O).then(()=>{const M=ae.cloneDeep(p.toolList),te=M.findIndex(ge=>ge.id===e.id);return M[te].isActive=!e.isActive,p.setToolList(M),!0}).catch(()=>!1)}}async function _e(e){q.value=f("views.tool.copyTool");const t=await N({type:"tool",systemType:_.value}).getToolById(e.id,O),m=ae.cloneDeep(t.data);delete m.id,m.name=m.name+`  ${f("common.copyTitle")}`,h.value.open(m)}function ye(e){N({type:"tool",systemType:_.value}).exportTool(e.id,e.name,V).catch(t=>{t.response.status!==403&&t.response.data.text().then(m=>{ko(`${f("views.application.tip.ExportError")}:${JSON.parse(m).message}`)})})}function S(e){we(`${f("views.tool.delete.confirmTitle")}：${e.name} ?`,f("views.tool.delete.confirmMessage"),{confirmButtonText:f("common.confirm"),cancelButtonText:f("common.cancel"),confirmButtonClass:"danger"}).then(()=>{N({type:"tool",systemType:_.value}).delTool(e.id,V).then(()=>{const t=ae.cloneDeep(p.toolList),m=t.findIndex(M=>M.id===e.id);t.splice(m,1),p.setToolList(t),fe(f("common.deleteSuccess"))})}).catch(()=>{})}function J(e){N({type:"tool",systemType:_.value}).getToolById(e==null?void 0:e.id,O).then(t=>{z.value.open(t.data)})}const ue=d();function P(){var e;(e=ue.value)==null||e.open(x.currentFolder.id)}const Y=d();function Oe(e,t){var m;(m=Y.value)==null||m.open(e,t)}function We(e,t){t&&N({type:"tool",systemType:_.value}).putTool(e==null?void 0:e.id,{name:e.name},V).then(m=>{fe(f("common.saveSuccess")),de()})}const Ie=d();function je(e){const t=new FormData;t.append("file",e.raw,e.name),t.append("folderId",x.currentFolder.id||C.getWorkspaceId()),Ie.value.clearFiles(),N({type:"tool",systemType:_.value}).postImportTool(t,V).then(async m=>{if(m!=null&&m.data)return p.setToolList([]),C.profile()}).then(()=>{re()}).catch(m=>{m.code===400&&we(f("common.tip"),f("views.application.tip.professionalMessage"),{cancelButtonText:f("common.confirm"),confirmButtonText:f("common.professional")}).then(()=>{window.open("https://tarzan.blog.csdn.net","_blank")})})}const Ve=d();function Je(e){N({type:"tool",systemType:_.value}).getToolById(e==null?void 0:e.id,V).then(t=>{Ve.value.open(t.data)})}function de(e){if(e){const t=ae.cloneDeep(p.toolList),m=t.findIndex(M=>M.id===e.id);t.splice(m,1,e),p.setToolList(t)}else R.total=0,R.current_page=1,p.setToolList([]),re()}const Ke=d();Te(()=>x.currentFolder,e=>{e&&e.id&&(R.current_page=1,p.setToolList([]),re())},{deep:!0,immediate:!0}),Te(()=>p.toolType,()=>{R.current_page=1,p.setToolList([]),re()});function re(){var t;const e={folderId:((t=x.currentFolder)==null?void 0:t.id)||C.getWorkspaceId(),scope:_.value==="systemShare"?"SHARED":"WORKSPACE",toolType:p.toolType||""};U.value[E.value]&&(e[E.value]=U.value[E.value]),N({type:"tool",isShared:g.value,systemType:_.value}).getToolListPage(R,e,V).then(m=>{var M,te;R.total=(M=m.data)==null?void 0:M.total,p.setToolList([...p.toolList,...(te=m.data)==null?void 0:te.records])})}function Qe(){T("refreshFolder")}function $e(){R.current_page=1,p.setToolList([]),re()}return fo(()=>{_.value!=="workspace"&&re(),N({type:"workspace",isShared:g.value,systemType:_.value}).getAllMemberList(C.getWorkspaceId(),V).then(e=>{y.value=e.data})}),(e,t)=>{const m=s("el-option"),M=s("el-select"),te=s("el-input"),ge=s("el-button"),Ze=s("arrow-down"),Le=s("el-icon"),ke=s("el-avatar"),K=s("el-dropdown-item"),Ge=s("el-upload"),Re=s("el-dropdown-menu"),Me=s("el-dropdown"),Xe=s("ToolIcon"),Ye=s("el-text"),eo=s("el-tag"),oo=s("SuccessFilled"),lo=s("el-switch"),to=s("el-divider"),no=s("el-col"),ao=s("el-row"),so=s("el-empty"),io=Se("loading");return a(),H(se,null,[l(vo,null,{header:o(()=>[go(e.$slots,"header")]),search:o(()=>[i("div",nl,[i("div",al,[l(M,{class:"complex-search__left",modelValue:E.value,"onUpdate:modelValue":t[0]||(t[0]=n=>E.value=n),style:{width:"120px"},onChange:le},{default:o(()=>[l(m,{label:e.$t("common.creator"),value:"createUser"},null,8,["label"]),l(m,{label:e.$t("views.tool.form.toolName.label"),value:"name"},null,8,["label"]),l(m,{label:e.$t("views.document.enableStatus.label"),value:"isActive"},null,8,["label"])]),_:1},8,["modelValue"]),E.value==="name"?(a(),r(te,{key:0,modelValue:U.value.name,"onUpdate:modelValue":t[1]||(t[1]=n=>U.value.name=n),onChange:$e,placeholder:e.$t("common.searchBar.placeholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):E.value==="isActive"?(a(),r(M,{key:1,modelValue:U.value.isActive,"onUpdate:modelValue":t[2]||(t[2]=n=>U.value.isActive=n),onChange:$e,filterable:"",clearable:"",style:{width:"220px"}},{default:o(()=>[l(m,{label:e.$t("views.document.enableStatus.enable"),value:"true"},null,8,["label"]),l(m,{label:e.$t("views.document.enableStatus.close"),value:"false"},null,8,["label"])]),_:1},8,["modelValue"])):E.value==="createUser"?(a(),r(M,{key:2,modelValue:U.value.createUser,"onUpdate:modelValue":t[3]||(t[3]=n=>U.value.createUser=n),onChange:$e,filterable:"",clearable:"",style:{width:"220px"}},{default:o(()=>[(a(!0),H(se,null,me(y.value,n=>(a(),r(m,{key:n.id,value:n.id,label:n.nickname},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):b("",!0)]),!g.value&&c.value.create()?(a(),r(ge,{key:0,class:"ml-8",onClick:t[4]||(t[4]=n=>P())},{default:o(()=>[$(v(e.$t("views.tool.toolStore.title")),1)]),_:1})):b("",!0),!g.value&&c.value.create()?(a(),r(Me,{key:1,trigger:"click"},{dropdown:o(()=>[l(Re,{class:"create-dropdown"},{default:o(()=>[l(K,{onClick:t[5]||(t[5]=n=>j())},{default:o(()=>[i("div",sl,[l(ke,{class:"avatar-green",shape:"square",size:32},{default:o(()=>t[10]||(t[10]=[i("img",{src:Ce,style:{width:"58%"},alt:""},null,-1)])),_:1,__:[10]}),t[11]||(t[11]=i("div",{class:"pre-wrap ml-8"},[i("div",{class:"lighter"},"空白创建")],-1))])]),_:1}),l(K,{onClick:t[6]||(t[6]=n=>ee())},{default:o(()=>[i("div",il,[l(ke,{shape:"square",size:32},{default:o(()=>t[12]||(t[12]=[i("img",{src:yo,style:{width:"58%"},alt:""},null,-1)])),_:1,__:[12]}),t[13]||(t[13]=i("div",{class:"pre-wrap ml-8"},[i("div",{class:"lighter"},"创建MCP")],-1))])]),_:1}),l(Ge,{ref_key:"elUploadRef",ref:Ie,"file-list":[],action:"#",multiple:"","auto-upload":!1,"show-file-list":!1,limit:1,"on-change":(n,xe)=>je(n),class:"import-button"},{default:o(()=>[c.value.import()?(a(),r(K,{key:0},{default:o(()=>[i("div",rl,[l(ke,{shape:"square",class:"mt-4",size:36,style:{background:"none"}},{default:o(()=>t[14]||(t[14]=[i("img",{src:To,alt:""},null,-1)])),_:1,__:[14]}),i("div",cl,[i("div",ul,v(e.$t("common.importCreate")),1)])])]),_:1})):b("",!0)]),_:1},8,["on-change"])]),_:1})]),default:o(()=>[l(ge,{type:"primary",class:"ml-8"},{default:o(()=>[$(v(e.$t("common.create"))+" ",1),l(Le,{class:"el-icon--right"},{default:o(()=>[l(Ze)]),_:1})]),_:1})]),_:1})):b("",!0)])]),default:o(()=>[be((a(),H("div",dl,[l(_o,{size:W(p).toolList.length,total:R.total,page_size:R.page_size,current_page:R.current_page,"onUpdate:current_page":t[9]||(t[9]=n=>R.current_page=n),onLoad:re,loading:V.value},{default:o(()=>[W(p).toolList.length>0?(a(),r(ao,{key:0,gutter:15,class:"w-full"},{default:o(()=>[(a(!0),H(se,null,me(W(p).toolList,(n,xe)=>(a(),r(no,{key:xe,xs:24,sm:12,md:12,lg:6,xl:6,class:"mb-16"},{default:o(()=>[l(Ee,{title:n.name,description:n.desc,class:"cursor",onClick:F(he=>j(n),["stop"]),disabled:c.value.edit(n.id)},{icon:o(()=>[n!=null&&n.icon?(a(),r(ke,{key:0,shape:"square",size:32,style:{background:"none"},class:"mr-8"},{default:o(()=>[i("img",{src:W(Pe)(n==null?void 0:n.icon),alt:""},null,8,pl)]),_:2},1024)):(a(),r(Xe,{key:1,size:32,type:n==null?void 0:n.toolType},null,8,["type"]))]),subTitle:o(()=>[l(Ye,{class:"color-secondary lighter",size:"small"},{default:o(()=>[$(v(e.$t("common.creator"))+": "+v(n==null?void 0:n.nickname),1)]),_:2},1024)]),tag:o(()=>[g.value?(a(),r(eo,{key:0,type:"info",class:"info-tag"},{default:o(()=>[$(v(W(f)("views.shared.title")),1)]),_:1})):b("",!0)]),footer:o(()=>[n.isActive?(a(),H("div",ml,[l(Le,{class:"color-success mr-8",style:{"font-size":"16px"}},{default:o(()=>[l(oo)]),_:1}),i("span",fl,v(e.$t("common.status.enabled")),1)])):(a(),H("div",vl,[l(Q,{iconName:"app-disabled",class:"color-secondary mr-8"}),i("span",_l,v(e.$t("common.status.disabled")),1)]))]),mouseEnter:o(()=>[!g.value&&D(n.id)?(a(),H("div",{key:0,onClick:t[8]||(t[8]=F(()=>{},["stop"]))},[c.value.switch(n.id)?(a(),r(lo,{key:0,modelValue:n.isActive,"onUpdate:modelValue":he=>n.isActive=he,"before-change":()=>ce(n),size:"small",class:"mr-4"},null,8,["modelValue","onUpdate:modelValue","before-change"])):b("",!0),l(to,{direction:"vertical"}),l(Me,{trigger:"click"},{dropdown:o(()=>[l(Re,null,{default:o(()=>{var he;return[n.toolType==="MCP"?(a(),r(K,{key:0,onClick:F(ne=>Je(n),["stop"])},{default:o(()=>[l(Q,{iconName:"app-operate-log",class:"color-secondary"}),$(" "+v(e.$t("views.tool.mcpConfig")),1)]),_:2},1032,["onClick"])):b("",!0),n.templateId&&c.value.edit(n.id)?(a(),r(K,{key:1,onClick:F(ne=>Oe(n,!0),["stop"])},{default:o(()=>[l(Q,{iconName:"app-edit",class:"color-secondary"}),$(" "+v(e.$t("common.edit")),1)]),_:2},1032,["onClick"])):b("",!0),!n.templateId&&c.value.edit(n.id)?(a(),r(K,{key:2,onClick:F(ne=>j(n),["stop"])},{default:o(()=>[l(Q,{iconName:"app-edit",class:"color-secondary"}),$(" "+v(e.$t("common.edit")),1)]),_:2},1032,["onClick"])):b("",!0),!n.templateId&&c.value.copy(n.id)&&n.toolType!=="MCP"?(a(),r(K,{key:3,onClick:F(ne=>_e(n),["stop"])},{default:o(()=>[l(Q,{iconName:"app-copy",class:"color-secondary"}),$(" "+v(e.$t("common.copy")),1)]),_:2},1032,["onClick"])):b("",!0),((he=n.initFieldList)==null?void 0:he.length)>0&&c.value.edit(n.id)?(a(),r(K,{key:4,onClick:F(ne=>J(n),["stop"])},{default:o(()=>[l(Q,{iconName:"app-operation",class:"color-secondary"}),$(" "+v(e.$t("common.param.initParam")),1)]),_:2},1032,["onClick"])):b("",!0),_.value==="workspace"&&c.value.auth(n.id)?(a(),r(K,{key:5,onClick:F(ne=>B(n),["stop"])},{default:o(()=>[l(Q,{iconName:"app-resource-authorization",class:"color-secondary"}),$(" "+v(e.$t("views.system.resourceAuthorization.title")),1)]),_:2},1032,["onClick"])):b("",!0),w.value?(a(),r(K,{key:6,onClick:F(ne=>X(n),["stop"])},{default:o(()=>[l(Q,{iconName:"app-lock",class:"color-secondary"}),$(" "+v(e.$t("views.shared.authorized_workspace")),1)]),_:2},1032,["onClick"])):b("",!0),!n.templateId&&c.value.export(n.id)&&n.toolType!=="MCP"?(a(),r(K,{key:7,onClick:F(ne=>ye(n),["stop"])},{default:o(()=>[l(Q,{iconName:"app-export",class:"color-secondary"}),$(" "+v(e.$t("common.export")),1)]),_:2},1032,["onClick"])):b("",!0),c.value.delete(n.id)?(a(),r(K,{key:8,divided:"",onClick:F(ne=>S(n),["stop"])},{default:o(()=>[l(Q,{iconName:"app-delete",class:"color-secondary"}),$(" "+v(e.$t("common.delete")),1)]),_:2},1032,["onClick"])):b("",!0)]}),_:2},1024)]),default:o(()=>[l(ge,{text:"",onClick:t[7]||(t[7]=F(()=>{},["stop"]))},{default:o(()=>[l(Q,{iconName:"app-more"})]),_:1})]),_:2},1024)])):b("",!0)]),_:2},1032,["title","description","onClick","disabled"])]),_:2},1024))),128))]),_:1})):(a(),r(so,{key:1,description:e.$t("common.noData")},null,8,["description"]))]),_:1},8,["size","total","page_size","current_page","loading"])])),[[io,R.current_page===1&&V.value,void 0,{fullscreen:!0,lock:!0}]])]),_:3}),l($o,{ref_key:"InitParamDrawerRef",ref:z,onRefresh:de},null,512),l(Co,{ref_key:"ToolFormDrawerRef",ref:h,onRefresh:de,title:q.value},null,8,["title"]),l(zo,{ref_key:"McpToolFormDrawerRef",ref:L,onRefresh:de,title:ie.value},null,8,["title"]),g.value?b("",!0):(a(),r(ho,{key:0,ref_key:"CreateFolderDialogRef",ref:Ke,onRefresh:Qe},null,512)),l(ol,{ref_key:"toolStoreDialogRef",ref:ue,"api-type":_.value,onRefresh:de},null,8,["api-type"]),l(He,{ref_key:"AddInternalToolDialogRef",ref:Y,onRefresh:We},null,512),l(tl,{ref_key:"McpToolConfigDialogRef",ref:Ve,onRefresh:de},null,512),w.value?(a(),r(Do,{key:1,ref_key:"AuthorizedWorkspaceDialogRef",ref:G},null,512)):b("",!0),_.value==="workspace"?(a(),r(Ao,{key:2,ref_key:"MoveToDialogRef",ref:k,source:W(ze).TOOL,onRefresh:u},null,8,["source"])):b("",!0),_.value==="workspace"?(a(),r(So,{key:3,type:W(ze).TOOL,ref_key:"ResourceAuthorizationDrawerRef",ref:I},null,8,["type"])):b("",!0)],64)}}});export{bl as _};
