import{ay as se,aP as ie,aA as ue,aQ as j,aB as r,aR as re,aX as ce,aD as n,b3 as me,aE as d,aF as s,aG as o,aI as C,b4 as de,aH as t,aK as _,aJ as g,aU as E,aT as D,aY as F,aZ as I,aW as L,b5 as pe,aC as ve}from"./admin-MH3gc4KS.js";import{g as ge}from"./constant-7fze7DVy.js";const fe={class:"flex-between mb-16"},be={class:"flex-between complex-search"},_e={class:"color-text-primary lighter"},he={class:"dialog-footer mt-24"},Ve=se({__name:"index",props:{type:{}},setup(O,{expose:G}){const J=ie(),{user:P}=ue(),R=O,x=j(()=>J.path.includes("resource-management")?"systemManage":"workspace"),$=j(()=>ge()),h=r(!1),S=r();re(h,e=>{var a;e||(y.value="",c.value="nickname",i.value={nickname:"",username:"",permission:void 0},T.value=[],p.current_page=1,p.total=0,v.value=[],(a=S.value)==null||a.clearSelection())});const z=r(!1),y=r(""),T=r([]),c=r("nickname"),i=r({nickname:"",username:"",permission:void 0}),K=()=>{i.value={nickname:"",username:"",permission:void 0}},p=ce({current_page:1,page_size:20,total:0});function Q(){p.current_page=1,b()}function U(){p.current_page=1,b()}const v=r([]),X=e=>{v.value=e},k=r(!1),f=r("");function Y(){v.value.length!==0&&(k.value=!0)}function Z(){if(v.value.length===0||!f.value)return;const e=v.value.map(a=>({userId:a.id,permission:f.value}));B(e),A()}function A(){var e;k.value=!1,f.value="",v.value=[],(e=S.value)==null||e.clearSelection()}function q(e,a){const m=[{userId:a.id,permission:e}];B(m)}function B(e){const a=P.getWorkspaceId()||"default";L({type:"resourceAuthorization",systemType:x.value}).putResourceAuthorization(a,y.value,R.type,e,z).then(()=>{pe(ve("common.submitSuccess")),b()})}const b=()=>{const e=P.getWorkspaceId()||"default",a={};i.value[c.value]&&(a[c.value]=i.value[c.value]),L({type:"resourceAuthorization",systemType:x.value}).getResourceAuthorization(e,y.value,R.type,p,a,z).then(m=>{T.value=m.data.records||[],p.total=m.data.total||0})};return G({open:e=>{y.value=e,h.value=!0,b()}}),(e,a)=>{const m=n("el-button"),w=n("el-option"),M=n("el-select"),H=n("el-input"),V=n("el-table-column"),N=n("el-radio"),W=n("el-radio-group"),ee=n("app-table"),ae=n("el-text"),le=n("el-dialog"),oe=n("el-drawer"),te=me("loading");return s(),d(oe,{modelValue:h.value,"onUpdate:modelValue":a[6]||(a[6]=l=>h.value=l),title:e.$t("views.system.resourceAuthorization.title"),size:"60%","append-to-body":!0},{default:o(()=>[C("div",fe,[t(m,{type:"primary",disabled:v.value.length===0,onClick:Y},{default:o(()=>[_(g(e.$t("views.system.resourceAuthorization.setting.configure")),1)]),_:1},8,["disabled"]),C("div",be,[t(M,{class:"complex-search__left",modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=l=>c.value=l),style:{width:"100px"},onChange:K},{default:o(()=>[t(w,{label:e.$t("views.userManage.userForm.nickname.label"),value:"nickname"},null,8,["label"]),t(w,{label:e.$t("views.login.loginForm.username.label"),value:"username"},null,8,["label"]),t(w,{label:e.$t("views.model.modelForm.permissionType.label"),value:"permission"},null,8,["label"])]),_:1},8,["modelValue"]),c.value==="nickname"?(s(),d(H,{key:0,modelValue:i.value.nickname,"onUpdate:modelValue":a[1]||(a[1]=l=>i.value.nickname=l),onChange:U,placeholder:e.$t("common.search"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):E("",!0),c.value==="username"?(s(),d(H,{key:1,modelValue:i.value.username,"onUpdate:modelValue":a[2]||(a[2]=l=>i.value.username=l),onChange:U,placeholder:e.$t("common.search"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):c.value==="permission"?(s(),d(M,{key:2,modelValue:i.value.permission,"onUpdate:modelValue":a[3]||(a[3]=l=>i.value.permission=l),onChange:U,filterable:"",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"",style:{width:"220px"}},{default:o(()=>[(s(!0),D(F,null,I($.value,(l,u)=>(s(),d(w,{key:u,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):E("",!0)])]),de((s(),d(ee,{ref_key:"multipleTableRef",ref:S,class:"mt-16",data:T.value,"pagination-config":p,onSizeChange:Q,onChangePage:b,onSelectionChange:X,maxTableHeight:200,"row-key":l=>l.id},{default:o(()=>[t(V,{type:"selection",width:"55","reserve-selection":!0}),t(V,{prop:"nickname",label:e.$t("views.userManage.userForm.nickname.label"),"min-width":"120","show-overflow-tooltip":""},null,8,["label"]),t(V,{prop:"username","min-width":"120","show-overflow-tooltip":"",label:e.$t("views.login.loginForm.username.label")},null,8,["label"]),t(V,{label:e.$t("common.operation"),align:"left",width:"340"},{default:o(({row:l})=>[t(W,{modelValue:l.permission,"onUpdate:modelValue":u=>l.permission=u,onChange:u=>q(u,l)},{default:o(()=>[(s(!0),D(F,null,I($.value,(u,ne)=>(s(),d(N,{key:ne,value:u.value,class:"mr-16"},{default:o(()=>[_(g(u.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["label"])]),_:1},8,["data","pagination-config","row-key"])),[[te,z.value]]),t(le,{modelValue:k.value,"onUpdate:modelValue":a[5]||(a[5]=l=>k.value=l),title:e.$t("views.system.resourceAuthorization.setting.configure"),"destroy-on-close":"",onClose:A},{footer:o(()=>[C("div",he,[t(m,{onClick:A},{default:o(()=>[_(g(e.$t("common.cancel")),1)]),_:1}),t(m,{type:"primary",onClick:Z},{default:o(()=>[_(g(e.$t("common.confirm")),1)]),_:1})])]),default:o(()=>[t(W,{modelValue:f.value,"onUpdate:modelValue":a[4]||(a[4]=l=>f.value=l),class:"radio-block"},{default:o(()=>[(s(!0),D(F,null,I($.value,(l,u)=>(s(),d(N,{key:u,value:l.value,class:"mr-16"},{default:o(()=>[C("p",_e,g(l.label),1),t(ae,{class:"color-secondary lighter"},{default:o(()=>[_(g(l.desc),1)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"])]),_:1},8,["modelValue","title"])}}});export{Ve as _};
