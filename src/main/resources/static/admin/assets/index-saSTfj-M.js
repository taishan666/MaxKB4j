import{l as xe,_ as Fe}from"./vue-draggable-plus-Dng2Mvn3.js";import{ay as _e,aZ as ye,aB as u,aQ as we,b7 as ke,aD as d,aE as m,aF as r,aU as B,aG as o,aH as l,d5 as He,aI as k,aK as b,aJ as v,b2 as N,a_ as W,bU as Te,a$ as Ve,b0 as fe,ci as Me,b1 as h,aR as U,b6 as R,cp as O,cr as Qe,c3 as Re,aC as V,b3 as he,co as Ie,aP as Je,bW as Oe,aS as me,aT as Pe,aV as We}from"./admin-BOU8h_tu.js";import{_ as Ue}from"./ParagraphDialog.vue_vue_type_script_setup_true_lang-DMO9bzNN.js";import{_ as Be}from"./index.vue_vue_type_script_setup_true_lang-C7U-3PHL.js";import"./ParagraphForm.vue_vue_type_script_setup_true_lang-Dfq_ooAm.js";const Ze={class:"dialog-footer"},Ae=_e({__name:"SelectDocumentDialog",props:{apiType:{}},emits:["refresh"],setup(oe,{expose:Z,emit:$}){const K=oe,_=ye(),{params:{id:A,documentId:S}}=_,D=$,f=u(),q=u({}),g=u(!1),C=u(!1),L=u([]);we(g,p=>{var y;p||(L.value=[],(y=f.value)==null||y.clearValidate())});const z=p=>{L.value=p,g.value=!0},x=async()=>{var p;if(await((p=f.value)==null?void 0:p.validate())){const y={idList:L.value};N({type:"paragraph",systemType:K.apiType}).putMigrateMulParagraph(A,S,f.value.form.knowledgeId,f.value.form.documentId,y,C).then(()=>{D("refresh"),g.value=!1})}};function i(){N({type:"knowledge",systemType:K.apiType}).getKnowledgeDetail(A,C).then(p=>{q.value=p.data})}ke(()=>{i()});function Q(p){localStorage.setItem(A+"chat_knowledge_id",p)}function F(p){localStorage.setItem(A+"chat_document_id",p)}return Z({open:z,dialogVisible:g}),(p,y)=>{const G=d("el-button"),X=d("el-dialog");return r(),m(X,{title:`${p.$t("views.chatLog.selectKnowledge")}/${p.$t("common.fileUpload.document")}`,modelValue:g.value,"onUpdate:modelValue":y[1]||(y[1]=M=>g.value=M),width:"500","close-on-click-modal":!1,"close-on-press-escape":!1,onClick:y[2]||(y[2]=B(()=>{},["stop"]))},{footer:o(()=>[k("span",Ze,[l(G,{onClick:y[0]||(y[0]=B(M=>g.value=!1,["prevent"]))},{default:o(()=>[b(v(p.$t("common.cancel")),1)]),_:1}),l(G,{type:"primary",onClick:x,loading:C.value},{default:o(()=>[b(v(p.$t("views.document.setting.migration")),1)]),_:1},8,["loading"])])]),default:o(()=>[l(He,{ref_key:"SelectKnowledgeDocumentRef",ref:f,apiType:p.apiType,onChangeKnowledge:Q,onChangeDocument:F,isApplication:!0,"workspace-id":q.value.workspaceId},null,8,["apiType","workspace-id"])]),_:1},8,["title","modelValue"])}}}),Xe={key:0,class:"mk-sticky"},Ye={class:"mr-8"},ea={class:"mr-8"},aa={class:"w-full flex-between",style:{"line-height":"22px"}},ta={class:"flex align-center"},la={class:"mb-16"},oa=_e({__name:"ParagraphCard",props:{data:{},disabled:{type:Boolean},showMoveUp:{type:Boolean},showMoveDown:{type:Boolean}},emits:["dialogVisibleChange","clickCard","changeState","deleteParagraph","refresh","refreshMigrateParagraph","move"],setup(oe,{emit:Z}){const $=oe,K=ye(),{params:{id:_,documentId:A},query:{from:S}}=K,D=W(()=>S),f=W(()=>Te.knowledge[D.value]),q=a=>f.value.doc_generate(a)||f.value.doc_edit(a),g=Z,C=u(!1),L=u(!1),z=u({}),x=u(!1),i=u(!1);function Q(){x.value=!0,i.value=!1}function F(){x.value=i.value}async function p(a){const n={isActive:!a.isActive};await N({type:"paragraph",systemType:D.value}).putParagraph(_,A,a.id,n,L).then(()=>(g("changeState",a.id),!0)).catch(()=>!1)}function y(){N({type:"knowledge",systemType:D.value}).getKnowledgeDetail(_,C).then(a=>{z.value=a.data})}const G=u();function X(a){G.value&&G.value.open([a.id],"paragraph",a.id)}function M(a){Re(`${V("views.paragraph.delete.confirmTitle")} ${a.title||"-"} ?`,V("views.paragraph.delete.confirmMessage"),{confirmButtonText:V("common.confirm"),confirmButtonClass:"danger"}).then(()=>{N({type:"paragraph",systemType:D.value}).delParagraph(_,A,a.id,C).then(()=>{g("deleteParagraph",a.id),he(V("common.deleteSuccess"))})}).catch(()=>{})}const c=u(),Y=u("");function T(a){$.disabled||(Y.value=V("views.paragraph.paragraphDetail"),c.value.open(a))}const ce=f.value.doc_edit(_);function ne(a){!ce||ie.value||($.disabled?g("clickCard"):T(a))}function se(a){Y.value=V("views.paragraph.addParagraph"),c.value.open(a,"add")}const ee=u();function pe(a){ee.value.open([a.id])}function ae(a){g("refresh",a)}function ve(){g("refreshMigrateParagraph",$.data)}const ie=W(()=>{var a,n,H;return((a=c.value)==null?void 0:a.dialogVisible)||((n=ee.value)==null?void 0:n.dialogVisible)||((H=G.value)==null?void 0:H.dialogVisible)});return ke(()=>{y()}),we(ie,a=>{g("dialogVisibleChange",a)}),(a,n)=>{const H=d("el-switch"),re=d("el-divider"),te=d("el-button"),de=d("CirclePlus"),e=d("el-icon"),t=d("el-dropdown-item"),w=d("ArrowRight"),E=d("el-dropdown-menu"),J=d("el-dropdown"),I=d("el-card"),ue=d("MdPreview"),ge=Ve("loading");return fe((r(),m(I,{shadow:"hover",class:Me(["paragraph-box cursor",a.data.isActive?"":"disabled"]),onMouseenter:n[10]||(n[10]=P=>Q()),onMouseleave:n[11]||(n[11]=P=>F()),onClick:n[12]||(n[12]=B(P=>ne(a.data),["stop"]))},{default:o(()=>[a.disabled?h("",!0):fe((r(),U("div",Xe,[q(R(_))?(r(),m(I,{key:0,class:"paragraph-box-operation mt-8 mr-8",shadow:"always",style:{"--el-card-padding":"8px 12px","--el-card-border-radius":"8px"},onClick:n[8]||(n[8]=B(()=>{},["stop"]))},{default:o(()=>[f.value.doc_edit(R(_))?(r(),m(H,{key:0,loading:L.value,modelValue:a.data.isActive,"onUpdate:modelValue":n[0]||(n[0]=P=>a.data.isActive=P),"before-change":()=>p(a.data),size:"small"},null,8,["loading","modelValue","before-change"])):h("",!0),l(re,{direction:"vertical"}),k("span",Ye,[f.value.doc_edit(R(_))?(r(),m(te,{key:0,link:"",onClick:n[1]||(n[1]=B(P=>T(a.data),["stop"]))},{default:o(()=>[l(O,{iconName:"app-edit",size:16,title:a.$t("common.edit")},null,8,["title"])]),_:1})):h("",!0)]),k("span",ea,[f.value.doc_edit(R(_))?(r(),m(te,{key:0,link:"",onClick:n[2]||(n[2]=B(P=>se(a.data),["stop"]))},{default:o(()=>[l(e,{size:16,title:a.$t("common.add")},{default:o(()=>[l(e,null,{default:o(()=>[l(de)]),_:1})]),_:1},8,["title"])]),_:1})):h("",!0)]),q(R(_))?(r(),m(J,{key:1,trigger:"click",teleported:!1},{dropdown:o(()=>[l(E,{style:{"min-width":"140px"}},{default:o(()=>[f.value.doc_generate(R(_))?(r(),m(t,{key:0,onClick:n[3]||(n[3]=B(P=>X(a.data),["stop"]))},{default:o(()=>[l(O,{iconName:"app-generate-question"}),b(" "+v(a.$t("views.document.generateQuestion.title")),1)]),_:1})):h("",!0),f.value.doc_edit(R(_))?(r(),m(t,{key:1,onClick:n[4]||(n[4]=B(P=>pe(a.data),["stop"]))},{default:o(()=>[l(O,{iconName:"app-migrate"}),b(" "+v(a.$t("views.document.setting.migration")),1)]),_:1})):h("",!0),f.value.doc_edit(R(_))?(r(),m(t,{key:2},{default:o(()=>[l(J,{class:"w-full",trigger:"hover","show-arrow":!1,placement:"right-start","popper-class":"move-position-popper"},{dropdown:o(()=>[l(E,null,{default:o(()=>[$.showMoveUp?(r(),m(t,{key:0,onClick:n[5]||(n[5]=B(P=>g("move","up"),["stop"]))},{default:o(()=>[b(v(a.$t("views.document.movePosition.moveUp")),1)]),_:1})):h("",!0),$.showMoveDown?(r(),m(t,{key:1,onClick:n[6]||(n[6]=B(P=>g("move","down"),["stop"]))},{default:o(()=>[b(v(a.$t("views.document.movePosition.moveDown")),1)]),_:1})):h("",!0)]),_:1})]),default:o(()=>[k("div",aa,[k("div",ta,[l(O,{iconName:"app-migrate"}),b(" "+v(a.$t("views.document.movePosition.title")),1)]),l(e,{class:"color-input-placeholder",size:16,style:{"margin-right":"0"}},{default:o(()=>[l(w)]),_:1})])]),_:1})]),_:1})):h("",!0),f.value.doc_edit(R(_))?(r(),m(t,{key:3,onClick:n[7]||(n[7]=B(P=>M(a.data),["stop"]))},{default:o(()=>[l(O,{iconName:"app-delete"}),b(" "+v(a.$t("common.delete")),1)]),_:1})):h("",!0)]),_:1})]),default:o(()=>[l(te,{text:""},{default:o(()=>[l(O,{iconName:"app-more"})]),_:1})]),_:1})):h("",!0)]),_:1})):h("",!0)],512)),[[Qe,x.value]]),k("h2",la,v(a.data.title||"-"),1),l(ue,{ref:"editorRef",editorId:"preview-only",modelValue:a.data.content,class:"maxkb-md",style:{background:"none"},onClickPreview:n[9]||(n[9]=P=>ne(a.data))},null,8,["modelValue"]),l(Ue,{ref_key:"ParagraphDialogRef",ref:c,title:Y.value,onRefresh:ae,apiType:D.value},null,8,["title","apiType"]),l(Ae,{ref_key:"SelectDocumentDialogRef",ref:ee,onRefresh:ve,apiType:D.value,"workspace-id":z.value.workspaceId},null,8,["apiType","workspace-id"]),l(Be,{ref_key:"GenerateRelatedDialogRef",ref:G,onRefresh:ae,apiType:D.value},null,8,["apiType"])]),_:1},8,["class"])),[[ge,C.value]])}}}),Se=Ie(oa,[["__scopeId","data-v-fef0ff0d"]]),na={class:"paragraph p-12-24"},sa={class:"flex align-center",style:{width:"78%"}},ia={style:{display:"inline-block"}},ra={class:"break-all"},da={key:0,class:"header-button"},ua={class:"flex-between p-12-16 border-b"},ca={class:"paragraph-sidebar p-16"},pa=["title"],va={class:"w-full"},ga={key:1},ma={class:"paragraph-detail"},fa=["id"],ha={key:0,class:"paragraph-card flex w-full"},_a=["id"],ya={key:0,class:"mul-operation border-t w-full"},wa={class:"ml-8"},ka=_e({__name:"index",setup(oe){const Z=ye(),{params:{id:$,documentId:K},query:{from:_,isShared:A}}=Z,S=W(()=>_),D=W(()=>A==="true"),f=W(()=>Te.knowledge[S.value]),q=u(),g=u(),C=u(!1),L=u(!1),z=u({}),x=u({}),i=u([]),Q=u(""),F=u(""),p=u("title"),y=u(!1);we(()=>{var e;return(e=g.value)==null?void 0:e.dialogVisible},e=>{y.value=e});function G(e){y.value=e}const X=(e,t)=>{var w;e.preventDefault(),(w=document.querySelector(`${t}`))==null||w.scrollIntoView({behavior:"smooth",block:"start"})},M=u(!1),c=u([]);function Y(e){const t=c.value.indexOf(e);t===-1?c.value.push(e):c.value.splice(t,1)}const T=Je({current_page:1,page_size:30,total:0});function ce(e){const t=i.value.findIndex(w=>w.id===e);i.value.splice(t,1)}function ne(e){const t=i.value.findIndex(w=>w.id===e);i.value[t].isActive=!i.value[t].isActive}function se(e){e&&(c.value=[e.id]),i.value=i.value.filter(t=>!c.value.includes(t.id)),c.value=[],he(V("views.document.tip.migrationSuccess"))}function ee(e){q.value.open(c.value)}function pe(){Re(`${V("views.document.delete.confirmTitle1")} ${c.value.length} ${V("views.document.delete.confirmTitle2")}`,V("views.paragraph.delete.confirmMessage"),{confirmButtonText:V("common.confirm"),confirmButtonClass:"danger"}).then(()=>{N({type:"paragraph",systemType:S.value}).putMulParagraph($,K,c.value,L).then(()=>{i.value=i.value.filter(e=>!c.value.includes(e.id)),c.value=[],he(V("views.document.delete.successMessage"))})}).catch(()=>{})}function ae(e){M.value=e,c.value=[]}function ve(){T.current_page=1,i.value=[],n()}function ie(){Q.value=V("views.paragraph.addParagraph"),g.value.open()}function a(){N({type:"document",isShared:D.value,systemType:S.value}).getDocumentDetail($,K,C).then(e=>{z.value=e.data}),N({type:"knowledge",isShared:A.value,systemType:S.value}).getKnowledgeDetail($,C).then(e=>{x.value=e.data})}function n(){N({type:"paragraph",isShared:D.value,systemType:S.value}).getParagraphPage($,K,T,F.value&&{[p.value]:F.value},C).then(e=>{i.value=[...i.value,...e.data.records],T.total=e.data.total})}function H(e){if(e){const t=i.value.findIndex(w=>w.id===e.id);i.value.splice(t,1,e)}else T.current_page=1,i.value=[],n()}const re=u();function te(e){const t=[];c.value.map(w=>{w&&t.push(w)}),re.value.open(t,"paragraph")}function de(e,t,w){const E=We.cloneDeep(t);E&&(E.newPosition=E.newPosition+1);const J=E??{paragraphId:i.value[e.newIndex].id,newPosition:i.value[e.newIndex+1].position};if(N({type:"paragraph",systemType:S.value}).putAdjustPosition($,K,J,C),t){const I=i.value.splice(w,1)[0];i.value.splice(t.newPosition,0,I)}}return ke(()=>{a(),n()}),(e,t)=>{var $e,De;const w=d("back-button"),E=d("el-link"),J=d("el-text"),I=d("el-button"),ue=d("el-option"),ge=d("el-select"),P=d("el-input"),ze=d("el-anchor-link"),Ne=d("el-anchor"),be=d("el-scrollbar"),Ke=d("el-empty"),Le=d("el-checkbox"),Ge=d("InfiniteScroll"),Ee=d("el-checkbox-group"),je=d("el-card"),qe=Ve("loading");return r(),U("div",na,[k("div",sa,[l(w,{to:"-1",style:{"margin-left":"-4px"}}),k("h3",ia,v(($e=z.value)==null?void 0:$e.name),1),((De=z.value)==null?void 0:De.type)==="1"?(r(),m(J,{key:0,type:"info"},{default:o(()=>{var s,j;return[b("（"+v(e.$t("views.document.form.sourceUrl.label"))+"：",1),l(E,{href:(j=(s=z.value)==null?void 0:s.meta)==null?void 0:j.sourceUrl,target:"_blank"},{default:o(()=>{var le,Ce;return[k("span",ra,v((Ce=(le=z.value)==null?void 0:le.meta)==null?void 0:Ce.sourceUrl),1)]}),_:1},8,["href"]),t[9]||(t[9]=b("） ",-1))]}),_:1,__:[9]})):h("",!0)]),!D.value&&f.value.doc_edit(R($))?(r(),U("div",da,[M.value===!1?(r(),m(I,{key:0,onClick:t[0]||(t[0]=s=>ae(!0))},{default:o(()=>[b(v(e.$t("views.paragraph.setting.batchSelected")),1)]),_:1})):h("",!0),M.value===!0?(r(),m(I,{key:1,onClick:t[1]||(t[1]=s=>ae(!1))},{default:o(()=>[b(v(e.$t("views.paragraph.setting.cancelSelected")),1)]),_:1})):h("",!0),M.value===!1?(r(),m(I,{key:2,onClick:ie,type:"primary",disabled:C.value},{default:o(()=>[b(v(e.$t("views.paragraph.addParagraph")),1)]),_:1},8,["disabled"])):h("",!0)])):h("",!0),fe((r(),m(je,{style:{"--el-card-padding":"0"},class:"paragraph__main mt-16"},{default:o(()=>[k("div",ua,[k("span",null,v(T.total)+" "+v(e.$t("views.paragraph.paragraph_count")),1),l(P,{modelValue:F.value,"onUpdate:modelValue":t[3]||(t[3]=s=>F.value=s),placeholder:e.$t("common.search"),class:"input-with-select",style:{width:"260px"},onChange:ve,clearable:""},{prepend:o(()=>[l(ge,{modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=s=>p.value=s),placeholder:"Select",style:{width:"80px"}},{default:o(()=>[l(ue,{label:e.$t("common.title"),value:"title"},null,8,["label"]),l(ue,{label:e.$t("common.content"),value:"content"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue","placeholder"])]),l(Oe,{showCollapse:""},{left:o(()=>[k("div",ca,[l(be,{class:"paragraph-scollbar"},{default:o(()=>[l(Ne,{direction:"vertical",type:"default",offset:130,container:".paragraph-scollbar",onClick:X},{default:o(()=>[(r(!0),U(me,null,Pe(i.value,(s,j)=>(r(),U(me,{key:s.id},[s.title?(r(),m(ze,{key:0,href:`#m${s.id}`,title:s.title},{default:o(()=>[k("span",{title:s.title},v(s.title),9,pa)]),_:2},1032,["href","title"])):h("",!0)],64))),128))]),_:1})]),_:1})])]),default:o(()=>[k("div",va,[i.value.length==0?(r(),m(Ke,{key:0,description:e.$t("common.noData")},null,8,["description"])):(r(),U("div",ga,[l(be,{class:"paragraph-scollbar"},{default:o(()=>[k("div",ma,[l(Ee,{modelValue:c.value,"onUpdate:modelValue":t[6]||(t[6]=s=>c.value=s)},{default:o(()=>[l(Ge,{size:i.value.length,total:T.total,page_size:T.page_size,current_page:T.current_page,"onUpdate:current_page":t[5]||(t[5]=s=>T.current_page=s),onLoad:n,loading:C.value},{default:o(()=>[l(R(xe),{ref:"el",modelValue:i.value,"onUpdate:modelValue":t[4]||(t[4]=s=>i.value=s),disabled:M.value===!0||D.value||y.value||!f.value.doc_edit(R($)),handle:".handle",animation:150,ghostClass:"ghost",onEnd:de},{default:o(()=>[(r(!0),U(me,null,Pe(i.value,(s,j)=>(r(),U("div",{key:s.id,id:`m${s.id}`,class:"flex mb-16"},[M.value===!0?(r(),U("div",ha,[l(Le,{value:s.id},null,8,["value"]),l(Se,{data:s,class:Me(["mb-8 w-full",{"is-selected":c.value.includes(s.id)}]),disabled:!0,onClickCard:le=>Y(s.id)},null,8,["data","class","onClickCard"])])):(r(),U("div",{key:1,class:"handle paragraph-card flex w-full",id:s.id},[t[10]||(t[10]=k("img",{src:Fe,alt:"",height:"15",class:"handle-img mr-8 mt-24 cursor"},null,-1)),l(Se,{data:s,showMoveUp:j!==0,showMoveDown:j<i.value.length-1,class:"mb-8 w-full",onChangeState:ne,onDeleteParagraph:ce,onMove:le=>de(null,{paragraphId:s.id,newPosition:le==="up"?j-1:j+1},j),onRefresh:H,onRefreshMigrateParagraph:se,disabled:D.value,onDialogVisibleChange:G},null,8,["data","showMoveUp","showMoveDown","onMove","disabled"])],8,_a))],8,fa))),128))]),_:1},8,["modelValue","disabled"])]),_:1},8,["size","total","page_size","current_page","loading"])]),_:1},8,["modelValue"])])]),_:1})]))])]),_:1}),M.value===!0?(r(),U("div",ya,[l(I,{disabled:c.value.length===0,onClick:t[7]||(t[7]=s=>te())},{default:o(()=>[b(v(e.$t("views.document.generateQuestion.title")),1)]),_:1},8,["disabled"]),l(I,{disabled:c.value.length===0,onClick:t[8]||(t[8]=s=>ee())},{default:o(()=>[b(v(e.$t("views.document.setting.migration")),1)]),_:1},8,["disabled"]),l(I,{disabled:c.value.length===0,onClick:pe},{default:o(()=>[b(v(e.$t("common.delete")),1)]),_:1},8,["disabled"]),k("span",wa,v(e.$t("common.selected"))+" "+v(c.value.length)+" "+v(e.$t("views.document.items")),1)])):h("",!0)]),_:1})),[[qe,T.current_page===1&&C.value||L.value]]),l(Ue,{ref_key:"ParagraphDialogRef",ref:g,title:Q.value,apiType:S.value,onRefresh:H},null,8,["title","apiType"]),l(Ae,{ref_key:"SelectDocumentDialogRef",ref:q,onRefresh:se,apiType:S.value,workspaceId:x.value.workspaceId},null,8,["apiType","workspaceId"]),l(Be,{ref_key:"GenerateRelatedDialogRef",ref:re,onRefresh:H,apiType:S.value},null,8,["apiType"])])}}}),Sa=Ie(ka,[["__scopeId","data-v-aeda1e26"]]);export{Sa as default};
