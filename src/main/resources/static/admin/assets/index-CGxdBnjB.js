import{ed as ne,fs as ke,aJ as se,cE as i,aS as s,aT as y,aM as r,cI as t,aN as n,aX as a,aO as u,cO as E,cN as V,aQ as $e,df as Ve,d5 as v,cT as Le,d0 as De,aL as h,cU as Ce,aU as te,cG as N,cH as U,aV as oe,dI as xe,eD as Oe,cP as Se}from"./admin-CM9VkLWb.js";import{W as Me}from"./workspace-7E840uRJ.js";const A="/operate_log",Ne=(L,_,c)=>ne(`${A}/${L.current_page}/${L.page_size}`,_,c),Ue=()=>ne(`${A}/menu_operation_option/`,void 0,void 0),ze=(L,_)=>{ke("log.xlsx",`${A}/export/`,L,void 0,_)},j={getOperateLog:Ne,getMenuList:Ue,exportOperateLog:ze},Ee={class:"border border-r-6 mb-16",style:{"white-space":"pre-wrap",height:"400px"}},Ye={class:"p-16"},Ie={class:"dialog-footer mt-16"},Pe=se({__name:"DetailDialog",setup(L,{expose:_}){const c=i(!1),d=i();return _({open:p=>{d.value=JSON.stringify(p.details,null,4),c.value=!0}}),(p,w)=>{const D=s("el-scrollbar"),C=s("el-button"),k=s("el-dialog");return r(),y(k,{title:p.$t("views.operateLog.table.opt.label"),modelValue:c.value,"onUpdate:modelValue":w[1]||(w[1]=S=>c.value=S),"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:t(()=>[n("span",Ie,[a(C,{onClick:w[0]||(w[0]=E(S=>c.value=!1,["prevent"]))},{default:t(()=>[V(u(p.$t("views.operateLog.close")),1)]),_:1})])]),default:t(()=>[n("div",Ee,[a(D,null,{default:t(()=>[n("div",Ye,u(d.value),1)]),_:1})])]),_:1},8,["title","modelValue"])}}}),Te={class:"operate-log p-16-24"},je={class:"mb-16"},Ae={class:"p-24"},Fe={class:"flex-between"},He={style:{display:"flex"}},We={class:"flex-between complex-search"},Be={class:"filter"},Je={class:"form-item mb-16"},Re={class:"text-right"},qe={class:"text-ellipsis"},Ge={class:"filter"},Qe={class:"form-item mb-16"},Xe={class:"text-right"},Ke={key:0},Ze={key:1,style:{color:"red"}},el={class:"mr-4"},ll=se({__name:"index",setup(L){const{user:_}=$e(),c=i(!1),d=i([]),O=i(!1),p=i([]),w=i(),D=i(!1),C=Ve({current_page:1,page_size:20,total:0}),k=i(""),S=i([]),z=i(7),$=i("user"),Y=i(""),x=i({start_time:"",end_time:""}),F=i(""),ie=[{value:7,label:v("views.applicationOverview.monitor.pastDayOptions.past7Days")},{value:30,label:v("views.applicationOverview.monitor.pastDayOptions.past30Days")},{value:90,label:v("views.applicationOverview.monitor.pastDayOptions.past90Days")},{value:183,label:v("views.applicationOverview.monitor.pastDayOptions.past183Days")},{value:"other",label:v("common.custom")}],re=[{value:"user",label:v("views.operateLog.table.user.label")},{value:"status",label:v("views.operateLog.table.status.label")},{value:"ip_address",label:v("views.operateLog.table.ip_address.label")}],ue=[{value:"200",label:v("views.operateLog.table.status.success")},{value:"500",label:v("views.operateLog.table.status.fail")}],H=i([]),W=i([]);function B(e){e==="clear"&&(d.value=[]),m(),c.value=!1}function J(e){e==="clear"&&(p.value=[]),m(),O.value=!1}function pe(e){m()}function ce(e){$.value=e,k.value&&m()}function R(e){e!=="other"&&(x.value.start_time=Oe(e),x.value.end_time="",m())}function de(e){x.value.start_time=e[0],x.value.end_time=e[1],m()}function ve(e){w.value.open(e)}function me(){C.current_page=1,m()}function q(){let e={start_time:x.value.start_time,end_time:x.value.end_time};return k.value&&$.value!=="status"&&(e[$.value]=k.value),$.value==="status"&&(e.status=Y.value),d.value.length>0&&(e.menu=JSON.stringify(d.value)),p.value.length>0&&(e.workspace_ids=JSON.stringify(p.value)),e}function m(){return j.getOperateLog(C,q(),D).then(e=>{S.value=e.data.records,C.total=e.data.total})}function _e(){return j.getMenuList().then(e=>{e.data.filter((f,M,I)=>M===I.findIndex(P=>P.menu===f.menu)).forEach(f=>{H.value.push({label:f.menu_label,value:f.menu})})})}const fe=()=>{j.exportOperateLog(q(),D)};async function be(){if(_.isEE()){const e=await Me.getSystemWorkspaceList(D);W.value=e.data.map(o=>({label:o.name,value:o.id}))}}return Le(()=>{_e(),be(),R(z.value)}),(e,o)=>{const f=s("el-option"),M=s("el-select"),I=s("el-date-picker"),P=s("el-input"),b=s("el-button"),G=s("Filter"),Q=s("el-icon"),X=s("el-checkbox"),K=s("el-checkbox-group"),Z=s("el-scrollbar"),ee=s("el-popover"),g=s("el-table-column"),le=s("el-tooltip"),ge=s("AppIcon"),he=s("app-table"),ye=s("el-card"),we=De("loading");return r(),h("div",Te,[n("h2",je,u(e.$t("views.operateLog.title")),1),a(ye,{style:{"--el-card-padding":"0"},class:"main-calc-height"},{default:t(()=>[n("div",Ae,[n("div",Fe,[n("div",null,[a(M,{modelValue:z.value,"onUpdate:modelValue":o[0]||(o[0]=l=>z.value=l),class:"mr-12",onChange:R,style:{width:"180px"}},{default:t(()=>[(r(),h(N,null,U(ie,l=>a(f,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),z.value==="other"?(r(),y(I,{key:0,modelValue:F.value,"onUpdate:modelValue":o[1]||(o[1]=l=>F.value=l),type:"daterange","start-placeholder":e.$t("views.applicationOverview.monitor.startDatePlaceholder"),"end-placeholder":e.$t("views.applicationOverview.monitor.endDatePlaceholder"),format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:de},null,8,["modelValue","start-placeholder","end-placeholder"])):te("",!0)]),n("div",He,[n("div",We,[a(M,{modelValue:$.value,"onUpdate:modelValue":o[2]||(o[2]=l=>$.value=l),class:"complex-search__left",onChange:ce,style:{width:"120px"}},{default:t(()=>[(r(),h(N,null,U(re,l=>a(f,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),$.value==="status"?(r(),y(M,{key:0,modelValue:Y.value,"onUpdate:modelValue":o[3]||(o[3]=l=>Y.value=l),onChange:pe,style:{width:"220px"},clearable:""},{default:t(()=>[(r(),h(N,null,U(ue,l=>a(f,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])):(r(),y(P,{key:1,modelValue:k.value,"onUpdate:modelValue":o[4]||(o[4]=l=>k.value=l),onChange:m,placeholder:e.$t("common.search"),"prefix-icon":"Search",style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"]))]),a(b,{onClick:fe,style:{"margin-left":"10px"}},{default:t(()=>[V(u(e.$t("common.export")),1)]),_:1})])]),Ce((r(),y(he,{class:"mt-16",data:S.value,"pagination-config":C,onSizeChange:me,onChangePage:m},{default:t(()=>[a(g,{prop:"menu",label:e.$t("views.operateLog.table.menu.label"),width:"160"},{header:t(()=>[n("div",null,[n("span",null,u(e.$t("views.operateLog.table.menu.label")),1),a(ee,{width:200,trigger:"click",visible:c.value},{reference:t(()=>[a(b,{style:{"margin-top":"-2px"},type:d.value&&d.value.length>0?"primary":"",link:"",onClick:o[5]||(o[5]=l=>c.value=!c.value)},{default:t(()=>[a(Q,null,{default:t(()=>[a(G)]),_:1})]),_:1},8,["type"])]),default:t(()=>[n("div",Be,[n("div",Je,[n("div",{onClick:o[7]||(o[7]=E(()=>{},["stop"]))},[a(Z,{height:"300",style:{margin:"0 0 0 10px"}},{default:t(()=>[a(K,{modelValue:d.value,"onUpdate:modelValue":o[6]||(o[6]=l=>d.value=l),style:{display:"flex","flex-direction":"column"}},{default:t(()=>[(r(!0),h(N,null,U(H.value,l=>(r(),y(X,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])])]),n("div",Re,[a(b,{size:"small",onClick:o[8]||(o[8]=l=>B("clear"))},{default:t(()=>[V(u(e.$t("common.clear")),1)]),_:1}),a(b,{type:"primary",onClick:B,size:"small"},{default:t(()=>[V(u(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"])])]),_:1},8,["label"]),a(g,{prop:"operate",label:e.$t("views.operateLog.table.operate.detail")},{default:t(({row:l})=>{var T;return[a(le,{content:l.operate+((T=l.operation_object)!=null&&T.name?`【${l.operation_object.name}】`:""),effect:"dark",placement:"top"},{default:t(()=>{var ae;return[n("span",qe,u(l.operate+((ae=l.operation_object)!=null&&ae.name?`【${l.operation_object.name}】`:"")),1)]}),_:2},1032,["content"])]}),_:1},8,["label"]),a(g,{width:"120",prop:"user.username",label:e.$t("views.operateLog.table.user.label")},null,8,["label"]),oe(_).isEE()?(r(),y(g,{key:0,width:"200",prop:"workspace_name",label:e.$t("views.workspace.title")},{header:t(()=>[n("div",null,[n("span",null,u(e.$t("views.workspace.title")),1),a(ee,{width:200,trigger:"click",visible:O.value},{reference:t(()=>[a(b,{style:{"margin-top":"-2px"},type:p.value&&p.value.length>0?"primary":"",link:"",onClick:o[9]||(o[9]=l=>O.value=!O.value)},{default:t(()=>[a(Q,null,{default:t(()=>[a(G)]),_:1})]),_:1},8,["type"])]),default:t(()=>[n("div",Ge,[n("div",Qe,[n("div",{onClick:o[11]||(o[11]=E(()=>{},["stop"]))},[a(Z,{height:"300",style:{margin:"0 0 0 10px"}},{default:t(()=>[a(K,{modelValue:p.value,"onUpdate:modelValue":o[10]||(o[10]=l=>p.value=l),style:{display:"flex","flex-direction":"column"}},{default:t(()=>[(r(!0),h(N,null,U(W.value,l=>(r(),y(X,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])])]),n("div",Xe,[a(b,{size:"small",onClick:o[12]||(o[12]=l=>J("clear"))},{default:t(()=>[V(u(e.$t("common.clear")),1)]),_:1}),a(b,{type:"primary",onClick:J,size:"small"},{default:t(()=>[V(u(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"])])]),_:1},8,["label"])):te("",!0),a(g,{prop:"status",label:e.$t("views.operateLog.table.status.label"),width:"100"},{default:t(({row:l})=>[l.status===200?(r(),h("span",Ke,u(e.$t("views.operateLog.table.status.success")),1)):(r(),h("span",Ze,u(e.$t("views.operateLog.table.status.fail")),1))]),_:1},8,["label"]),a(g,{prop:"ip_address",label:e.$t("views.operateLog.table.ip_address.label"),width:"160"},null,8,["label"]),a(g,{label:e.$t("views.operateLog.table.operateTime.label"),width:"180"},{default:t(({row:l})=>[V(u(oe(xe)(l.createTime)),1)]),_:1},8,["label"]),a(g,{label:e.$t("common.operation"),width:"60",align:"left",fixed:"right"},{default:t(({row:l})=>[n("span",el,[a(le,{effect:"dark",content:e.$t("views.operateLog.table.opt.label"),placement:"top"},{default:t(()=>[a(b,{type:"primary",text:"",onClick:E(T=>ve(l),["stop"]),class:"text-button"},{default:t(()=>[a(ge,{iconName:"app-operate-log"})]),_:2},1032,["onClick"])]),_:2},1032,["content"])])]),_:1},8,["label"])]),_:1},8,["data","pagination-config"])),[[we,D.value]])]),a(Pe,{ref_key:"DetailDialogRef",ref:w},null,512)]),_:1})])}}}),ol=Se(ll,[["__scopeId","data-v-475ff2a5"]]);export{ol as default};
