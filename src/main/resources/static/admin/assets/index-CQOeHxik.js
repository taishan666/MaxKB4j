import{ay as ye,aP as Ae,aB as v,bO as W,bN as g,bP as y,aQ as R,aX as K,b9 as Ue,aR as oe,aT as H,aI as o,aH as s,aJ as h,b8 as O,c0 as Oe,aG as i,aD as r,aW as N,b4 as ne,b3 as Te,aE as w,aU as F,b6 as re,aK as z,aC as ie,aF as b,b5 as ke,cn as Re}from"./admin-BFI6zo2F.js";const we={class:"group p-16-24"},Ie={class:"mb-16"},Se={class:"color-secondary"},De={class:"flex"},Le={class:"user-left border-r"},Pe={class:"p-24 pb-0"},Ne={class:"medium mb-12"},Ve={class:"list-height-left"},$e={class:"p-16"},Me=["title"],Ge={class:"user-right"},We={class:"flex-between"},Ke={class:"flex align-center"},He=["title"],Fe={class:"color-input-placeholder ml-4"},ze={key:0,class:"flex align-center"},Be={class:"color-secondary mr-8"},je={class:"flex-between mb-16",style:{"margin-top":"18px"}},xe={class:"flex complex-search"},Je=ye({__name:"index",setup(Qe){const u=Ae(),{params:{id:B,folderId:ue}}=u,j=v({APPLICATION:new W([g.ADMIN,g.WORKSPACE_MANAGE.getWorkspaceRole,g.USER.getWorkspaceRole],[y.APPLICATION_CHAT_USER_EDIT,y.APPLICATION_CHAT_USER_EDIT.getApplicationWorkspaceResourcePermission(B)],[],"OR"),KNOWLEDGE:new W([g.ADMIN,g.WORKSPACE_MANAGE.getWorkspaceRole,g.USER.getWorkspaceRole],[y.KNOWLEDGE_CHAT_USER_EDIT,y.KNOWLEDGE_CHAT_USER_EDIT.getKnowledgeWorkspaceResourcePermission(B)],[],"OR"),RESOURCE_APPLICATION:[g.ADMIN,y.RESOURCE_APPLICATION_CHAT_USER_EDIT],RESOURCE_KNOWLEDGE:[g.ADMIN,y.RESOURCE_KNOWLEDGE_CHAT_USER_EDIT],SHAREDKNOWLEDGE:new W([g.ADMIN],[y.SHARED_KNOWLEDGE_CHAT_USER_EDIT],[],"OR")}),x=R(()=>{var e,a,n;if(u.path.includes("shared"))return"SHAREDKNOWLEDGE";if(u.path.includes("resource-management")){if(((e=u.meta)==null?void 0:e.resourceType)==="KNOWLEDGE")return"RESOURCE_KNOWLEDGE";if(((a=u.meta)==null?void 0:a.resourceType)==="APPLICATION")return"RESOURCE_APPLICATION"}return(n=u.meta)==null?void 0:n.resourceType}),T=K({resource_id:u.params.id,resourceType:u.meta.resourceType}),I=v(""),S=v(!1),D=v([]),V=v([]),t=v(),L=R(()=>u.path.includes("shared")?"systemShare":u.path.includes("resource-management")?"systemManage":"workspace");async function J(){try{const e=await N({type:"chatUser",isShared:X.value,systemType:L.value}).getUserGroupList(T,S);D.value=e.data,V.value=Q(D.value,I.value)}catch(e){console.error(e)}}Ue(async()=>{await J(),t.value=D.value[0]});function Q(e,a){return a.length?e.filter(n=>n.name.toLowerCase().includes(a.toLowerCase())):e}oe(I,e=>{V.value=Q(D.value,e)});const d=K({});function ce(e){for(const a in d)delete d[a];t.value=e}async function de(){var a,n,_,m,p;const e=[{user_group_id:(a=t.value)==null?void 0:a.id,is_auth:!((n=t.value)!=null&&n.is_auth)}];try{await N({type:"chatUser",systemType:L.value}).editUserGroupList(T,e,S),await J(),t.value={name:(_=t.value)==null?void 0:_.name,id:(m=t.value)==null?void 0:m.id,is_auth:!((p=t.value)!=null&&p.is_auth)},C()}catch(M){console.error(M)}}const $=v(!1),f=v("username"),E=v({username:"",nickname:"",source:""}),A=K({current_page:1,page_size:20,total:0}),U=v([]),X=R(()=>ue==="share");async function C(){var n,_;if(!((n=t.value)!=null&&n.id))return;const e={},a=E.value[f.value];a!=null&&a!==""&&(e[f.value]=a);try{const m=await N({type:"chatUser",isShared:X.value,systemType:L.value}).getUserGroupUserList(T,(_=t.value)==null?void 0:_.id,A,e,$);m.data.records.forEach(p=>{d[p.id]===void 0&&(d[p.id]=p.is_auth),p.is_auth=d[p.id]}),U.value=m.data.records,A.total=m.data.total}catch(m){console.error(m)}}function me(){A.current_page=1,C()}oe(()=>{var e;return(e=t.value)==null?void 0:e.id},()=>{A.current_page=1,C()});const q=R(()=>U.value.length>0&&U.value.every(e=>d[e.id])),pe=R(()=>!q.value&&U.value.some(e=>d[e.id])),ve=e=>{U.value.forEach(a=>{a.is_auth=e,d[a.id]=e})},he=(e,a)=>{a.is_auth=e,d[a.id]=e};async function _e(){var e;try{const a=Object.entries(d).map(([n,_])=>({chatUserId:n,is_auth:_}));await N({type:"chatUser",systemType:L.value}).putUserGroupUser(T,(e=t.value)==null?void 0:e.id,a,$),ke(ie("common.saveSuccess"))}catch(a){console.error(a)}}return(e,a)=>{const n=r("el-input"),_=r("common-list"),m=r("el-scrollbar"),p=r("el-divider"),M=r("UserFilled"),ge=r("el-icon"),be=r("el-switch"),c=r("el-option"),Y=r("el-select"),fe=r("el-button"),P=r("el-table-column"),Z=r("el-checkbox"),Ee=r("app-table"),Ce=r("el-card"),ee=Te("loading");return b(),H("div",we,[o("div",Ie,[o("h2",null,h(e.$t("views.chatUser.title")),1),o("div",Se,h(T.resourceType===O(Oe).APPLICATION?e.$t("views.chatUser.applicationTitleTip"):e.$t("views.chatUser.knowledgeTitleTip")),1)]),s(Ce,{style:{"--el-card-padding":"0"}},{default:i(()=>{var ae,le,se,te;return[o("div",De,[o("div",Le,[o("div",Pe,[o("h4",Ne,h(e.$t("views.chatUser.group.title")),1),s(n,{modelValue:I.value,"onUpdate:modelValue":a[0]||(a[0]=l=>I.value=l),placeholder:e.$t("common.search"),"prefix-icon":"Search",clearable:""},null,8,["modelValue","placeholder"])]),o("div",Ve,[ne((b(),w(m,null,{default:i(()=>{var l;return[o("div",$e,[s(_,{data:V.value,onClick:ce,"default-active":(l=t.value)==null?void 0:l.id},{default:i(({row:k})=>[o("span",{class:"ellipsis-1",title:k.name},h(k.name),9,Me)]),empty:i(()=>a[5]||(a[5]=[o("span",null,null,-1)])),_:1},8,["data","default-active"])])]}),_:1})),[[ee,S.value]])])]),ne((b(),H("div",Ge,[o("div",We,[o("div",Ke,[o("h4",{class:"medium ellipsis",title:(ae=t.value)==null?void 0:ae.name},h(((le=t.value)==null?void 0:le.name)||"-"),9,He),s(p,{direction:"vertical",class:"mr-8 ml-8"}),s(ge,{class:"color-input-placeholder"},{default:i(()=>[s(M)]),_:1}),o("span",Fe,h(A.total),1)]),!O(u).path.includes("share/")&&O(re)(j.value[x.value],"OR")?(b(),H("div",ze,[o("div",Be,h(e.$t("views.chatUser.autoAuthorization")),1),s(be,{size:"small","model-value":(se=t.value)==null?void 0:se.is_auth,onClick:de,loading:S.value},null,8,["model-value","loading"])])):F("",!0)]),o("div",je,[o("div",xe,[s(Y,{class:"complex-search__left",modelValue:f.value,"onUpdate:modelValue":a[1]||(a[1]=l=>f.value=l),style:{width:"120px"}},{default:i(()=>[s(c,{label:e.$t("views.login.loginForm.username.label"),value:"username"},null,8,["label"]),s(c,{label:e.$t("views.userManage.userForm.nickname.label"),value:"nickname"},null,8,["label"]),s(c,{label:e.$t("views.userManage.source.label"),value:"source"},null,8,["label"])]),_:1},8,["modelValue"]),f.value==="username"?(b(),w(n,{key:0,modelValue:E.value.username,"onUpdate:modelValue":a[2]||(a[2]=l=>E.value.username=l),onChange:C,placeholder:e.$t("common.inputPlaceholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):f.value==="nickname"?(b(),w(n,{key:1,modelValue:E.value.nickname,"onUpdate:modelValue":a[3]||(a[3]=l=>E.value.nickname=l),onChange:C,placeholder:e.$t("common.inputPlaceholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):f.value==="source"?(b(),w(Y,{key:2,modelValue:E.value.source,"onUpdate:modelValue":a[4]||(a[4]=l=>E.value.source=l),onChange:C,placeholder:e.$t("common.selectPlaceholder"),style:{width:"220px"},clearable:""},{default:i(()=>[s(c,{label:e.$t("views.userManage.source.local"),value:"LOCAL"},null,8,["label"]),s(c,{label:"CAS",value:"CAS"}),s(c,{label:"LDAP",value:"LDAP"}),s(c,{label:"OIDC",value:"OIDC"}),s(c,{label:"OAuth2",value:"OAuth2"}),s(c,{label:e.$t("views.userManage.source.wecom"),value:"wecom"},null,8,["label"]),s(c,{label:e.$t("views.userManage.source.lark"),value:"lark"},null,8,["label"]),s(c,{label:e.$t("views.userManage.source.dingtalk"),value:"dingtalk"},null,8,["label"])]),_:1},8,["modelValue","placeholder"])):F("",!0)]),!O(u).path.includes("share/")&&O(re)(j.value[x.value],"OR")?(b(),w(fe,{key:0,type:"primary",disabled:(te=t.value)==null?void 0:te.is_auth,onClick:_e},{default:i(()=>[z(h(O(ie)("common.save")),1)]),_:1},8,["disabled"])):F("",!0)]),s(Ee,{data:U.value,"pagination-config":A,onSizeChange:me,onChangePage:C,maxTableHeight:350},{default:i(()=>[s(P,{prop:"nickname",label:e.$t("views.userManage.userForm.nickname.label")},null,8,["label"]),s(P,{prop:"username",label:e.$t("views.login.loginForm.username.label")},null,8,["label"]),s(P,{prop:"source",label:e.$t("views.userManage.source.label")},{default:i(({row:l})=>[z(h(l.source==="LOCAL"?e.$t("views.userManage.source.local"):l.source==="wecom"?e.$t("views.userManage.source.wecom"):l.source==="lark"?e.$t("views.userManage.source.lark"):l.source==="dingtalk"?e.$t("views.userManage.source.dingtalk"):l.source==="OAUTH2"||l.source==="OAuth2"?"OAuth2":l.source),1)]),_:1},8,["label"]),s(P,{width:140,align:"center"},{header:i(()=>{var l;return[s(Z,{"model-value":q.value,indeterminate:pe.value,disabled:(l=t.value)==null?void 0:l.is_auth,onChange:ve},{default:i(()=>[z(h(e.$t("views.chatUser.authorization")),1)]),_:1},8,["model-value","indeterminate","disabled"])]}),default:i(({row:l})=>{var k;return[s(Z,{modelValue:l.is_auth,"onUpdate:modelValue":G=>l.is_auth=G,indeterminate:l.indeterminate,disabled:(k=t.value)==null?void 0:k.is_auth,onChange:G=>he(G,l)},null,8,["modelValue","onUpdate:modelValue","indeterminate","disabled","onChange"])]}),_:1})]),_:1},8,["data","pagination-config"])])),[[ee,$.value]])])]}),_:1})])}}}),qe=Re(Je,[["__scopeId","data-v-492699b9"]]);export{qe as default};
