import{ay as me,aP as ve,aQ as F,aB as s,aX as be,aC as W,aR as ne,aD as n,aE as w,aF as _,aG as t,aH as l,aI as b,a_ as Z,aK as D,aJ as f,aW as q,b5 as Y,b3 as he,c1 as De,b4 as ye,ds as Te,aU as O,aT as de,aY as we,aZ as $e,bC as Se,cn as Ve,b_ as Pe,b8 as B,c9 as Re,b9 as Me,d7 as xe,c6 as Ce}from"./admin-DTQ9awQz.js";import{_ as Le}from"./ParagraphDialog.vue_vue_type_script_setup_true_lang-CNDnSjPo.js";import"./ParagraphForm.vue_vue_type_script_setup_true_lang-PcwYxYhb.js";const qe={class:"dialog-footer"},ze=me({__name:"CreateProblemDialog",emits:["refresh"],setup(re,{expose:E,emit:$}){const V=ve(),{params:{id:h}}=V,y=F(()=>V.path.includes("shared")?"systemShare":V.path.includes("resource-management")?"systemManage":"workspace"),N=$,P=s(),k=s(!1),R=s({data:""}),C=be({data:[{required:!0,message:W("views.problem.tip.requiredMessage"),trigger:"blur"}]}),p=s(!1);ne(p,o=>{o||(R.value={data:""})});const d=()=>{p.value=!0},T=async o=>{o&&await o.validate((c,m)=>{if(c){const x=R.value.data.split(`
`).filter(function(z){return z!==""});q({type:"problem",systemType:y.value}).postProblems(h,x,k).then(z=>{Y(W("common.createSuccess")),N("refresh"),p.value=!1})}})};return E({open:d}),(o,c)=>{const m=n("el-input"),x=n("el-form-item"),z=n("el-form"),I=n("el-button"),M=n("el-dialog");return _(),w(M,{title:o.$t("views.problem.createProblem"),modelValue:p.value,"onUpdate:modelValue":c[3]||(c[3]=H=>p.value=H),"close-on-click-modal":!1,"close-on-press-escape":!1,"destroy-on-close":!0},{footer:t(()=>[b("span",qe,[l(I,{onClick:c[1]||(c[1]=Z(H=>p.value=!1,["prevent"]))},{default:t(()=>[D(f(o.$t("common.cancel")),1)]),_:1}),l(I,{type:"primary",onClick:c[2]||(c[2]=H=>T(P.value)),loading:k.value},{default:t(()=>[D(f(o.$t("common.confirm")),1)]),_:1},8,["loading"])])]),default:t(()=>[l(z,{"label-position":"top",ref_key:"problemFormRef",ref:P,rules:C,model:R.value,"require-asterisk-position":"right"},{default:t(()=>[l(x,{label:o.$t("views.problem.title"),prop:"data"},{default:t(()=>[l(m,{modelValue:R.value.data,"onUpdate:modelValue":c[0]||(c[0]=H=>R.value.data=H),placeholder:o.$t("views.problem.tip.placeholder"),rows:10,type:"textarea"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])}}}),Be={class:"bold title align-center p-24 pb-0"},Ne={class:"p-8",style:{"padding-bottom":"8px"}},Ue={class:"flex lighter align-center"},Ae={class:"p-24",style:{"padding-bottom":"8px","padding-top":"16px"}},Ee={class:"flex-between mb-16"},He={class:"bold title align-center"},je={class:"dialog-footer"},Fe=me({__name:"RelateProblemDialog",emits:["refresh"],setup(re,{expose:E,emit:$}){const V=ve(),{params:{id:h}}=V,y=F(()=>V.path.includes("shared")?"systemShare":V.path.includes("resource-management")?"systemManage":"workspace"),N=$,P=s(!1),k=s(!1),R=s([]),C=s([]),p=s([]),d=s(""),T=s([]),o=s([]),c=s(""),m=s(""),x=s("title"),z=s(""),I=s(!1),M=be({current_page:1,page_size:50,total:0});function H(){const a={problem_id_list:T.value,paragraphList:o.value.map(r=>({paragraphId:r.id,documentId:r.documentId}))};q({type:"problem",systemType:y.value}).putMulAssociationProblem(h,a,k).then(()=>{Y(W("views.problem.tip.relatedSuccess")),P.value=!1})}function i(a){if(I.value)J(a.id)?o.value.splice(o.value.indexOf(a.id),1):o.value.push(a);else{const r={paragraphId:a.id,problemId:d.value};J(a.id)?q({type:"paragraph",systemType:y.value}).putDisassociationProblem(h,a.documentId,r,k).then(()=>{j(d.value)}):q({type:"paragraph",systemType:y.value}).putAssociationProblem(h,a.documentId,r,k).then(()=>{j(d.value)})}}function U(){M.current_page=1,p.value=[],c.value&&G(c.value)}function te(a){M.current_page=1,p.value=[],c.value=a.id,G(a.id)}function ee(){q({type:"document",systemType:y.value}).getDocumentList(h,k).then(a=>{var r;C.value=a.data,R.value=a.data,c.value=((r=C.value)==null?void 0:r.length)>0?C.value[0].id:"",c.value&&G(c.value)})}function G(a){q({type:"paragraph",systemType:y.value}).getParagraphPage(h,a||c.value,M,m.value&&{[x.value]:m.value},k).then(r=>{p.value=[...p.value,...r.data.records],M.total=r.data.total})}function j(a){q({type:"problem",systemType:y.value}).getDetailProblems(h,a,k).then(r=>{o.value=r.data})}function X(a){return o.value.filter(r=>r.documentId===a).length}function J(a){return o.value.some(r=>r.id===a)}return ne(P,a=>{a||(R.value=[],C.value=[],p.value=[],o.value=[],I.value=!1,c.value="",m.value="",x.value="title",N("refresh"))}),ne(z,a=>{var r;p.value=[],R.value=a?C.value.filter(Q=>Q.name.includes(a)):C.value,c.value=((r=R.value)==null?void 0:r.length)>0?R.value[0].id:""}),E({open:a=>{ee(),a.length==1?(d.value=a[0],j(a)):a.length>1&&(T.value=a,I.value=!0),P.value=!0}}),(a,r)=>{const Q=n("el-input"),ae=n("auto-tooltip"),le=n("el-badge"),S=n("el-scrollbar"),L=n("el-col"),oe=n("el-text"),e=n("el-option"),u=n("el-select"),A=n("el-empty"),fe=n("CardBox"),K=n("InfiniteScroll"),_e=n("el-row"),ie=n("el-button"),ue=n("el-dialog"),ce=he("loading");return _(),w(ue,{title:a.$t("views.problem.relateParagraph.title"),modelValue:P.value,"onUpdate:modelValue":r[5]||(r[5]=g=>P.value=g),width:"80%",class:"paragraph-dialog","destroy-on-close":"","close-on-click-modal":!1,"close-on-press-escape":!1},De({default:t(()=>[ye((_(),w(_e,null,{default:t(()=>[l(L,{span:6},{default:t(()=>[l(S,{height:"500","wrap-class":"paragraph-scrollbar"},{default:t(()=>[b("div",Be,f(a.$t("views.problem.relateParagraph.selectDocument")),1),b("div",Ne,[l(Q,{modelValue:z.value,"onUpdate:modelValue":r[0]||(r[0]=g=>z.value=g),placeholder:a.$t("views.problem.relateParagraph.placeholder"),"prefix-icon":"Search",clearable:""},null,8,["modelValue","placeholder"]),l(Te,{data:R.value,class:"mt-8",onClick:te,"default-active":c.value},{default:t(({row:g})=>[b("span",Ue,[l(ae,{content:g.name},{default:t(()=>[D(f(g.name),1)]),_:2},1032,["content"]),X(g.id)?(_(),w(le,{key:0,value:X(g.id),type:"primary",class:"paragraph-badge ml-4"},null,8,["value"])):O("",!0)])]),_:1},8,["data","default-active"])])]),_:1})]),_:1}),l(L,{span:18,class:"border-l"},{default:t(()=>[l(S,{height:"500","wrap-class":"paragraph-scrollbar"},{default:t(()=>[b("div",Ae,[b("div",Ee,[b("div",He,[D(f(a.$t("components.selectParagraph.title"))+" ",1),l(oe,null,{default:t(()=>[D(" （"+f(a.$t("views.problem.relateParagraph.selectedParagraph"))+"："+f(X(c.value))+" "+f(a.$t("views.problem.relateParagraph.count"))+"） ",1)]),_:1})]),l(Q,{modelValue:m.value,"onUpdate:modelValue":r[2]||(r[2]=g=>m.value=g),placeholder:a.$t("common.search"),class:"input-with-select",style:{width:"260px"},onChange:U},{prepend:t(()=>[l(u,{modelValue:x.value,"onUpdate:modelValue":r[1]||(r[1]=g=>x.value=g),placeholder:"Select",style:{width:"80px"}},{default:t(()=>[l(e,{label:a.$t("common.title"),value:"title"},null,8,["label"]),l(e,{label:a.$t("common.content"),value:"content"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue","placeholder"])]),p.value.length==0?(_(),w(A,{key:0,description:a.$t("common.noData")},null,8,["description"])):(_(),w(K,{key:1,size:p.value.length,total:M.total,page_size:M.page_size,current_page:M.current_page,"onUpdate:current_page":r[3]||(r[3]=g=>M.current_page=g),onLoad:G,loading:k.value},{default:t(()=>[(_(!0),de(we,null,$e(p.value,(g,ge)=>(_(),w(fe,{key:ge,shadow:"hover",title:g.title||"-",description:g.content,class:Se(["paragraph-card cursor mb-16",J(g.id)?"selected":""]),showIcon:!1,onClick:ke=>i(g)},null,8,["title","description","class","onClick"]))),128))]),_:1},8,["size","total","page_size","current_page","loading"]))])]),_:1})]),_:1})]),_:1})),[[ce,k.value]])]),_:2},[I.value?{name:"footer",fn:t(()=>[b("div",je,[l(ie,{onClick:r[4]||(r[4]=g=>P.value=!1)},{default:t(()=>[D(f(a.$t("common.cancel")),1)]),_:1}),l(ie,{type:"primary",onClick:H},{default:t(()=>[D(f(a.$t("common.confirm")),1)]),_:1})])]),key:"0"}:void 0]),1032,["title","modelValue"])}}}),Ie=Ve(Fe,[["__scopeId","data-v-e3c93b3a"]]),We={class:"p-8"},Qe={class:"footer-content flex-between"},Ge=me({__name:"DetailProblemDrawer",props:{currentId:{},currentContent:{},next:{},pre:{},pre_disable:{type:Boolean},next_disable:{type:Boolean}},emits:["update:currentId","update:currentContent","refresh"],setup(re,{expose:E,emit:$}){const V=re,h=$,y=ve(),{params:{id:N}}=y,P=F(()=>y.path.includes("shared")?"systemShare":y.path.includes("resource-management")?"systemManage":"workspace"),k=F(()=>Pe.knowledge[P.value]),R=s(),C=s(),p=s(!1),d=s(!1),T=s([]);function o(i){const U={paragraphId:i.id,problem_id:V.currentId};q({type:"paragraph",systemType:P.value}).putDisassociationProblem(i.knowledgeId,i.document_id,U,p).then(()=>{I()})}function c(){R.value.open([V.currentId])}function m(i){C.value.open(i)}function x(i){if(i){const U={content:i};q({type:"problem",systemType:P.value}).putProblems(N,V.currentId,U,p).then(()=>{h("update:currentContent",i),Y(W("common.modifySuccess"))})}else Re(W("views.problem.tip.errorMessage"))}function z(){T.value=[]}function I(){V.currentId&&d.value&&q({type:"problem",systemType:P.value}).getDetailProblems(N,V.currentId,p).then(i=>{T.value=i.data})}function M(){I()}return ne(()=>V.currentId,()=>{T.value=[],I()}),ne(d,i=>{i||(h("update:currentId",""),h("update:currentContent",""),h("refresh"))}),E({open:()=>{I(),d.value=!0}}),(i,U)=>{const te=n("ReadWrite"),ee=n("el-form-item"),G=n("AppIcon"),j=n("el-button"),X=n("el-tooltip"),J=n("el-scrollbar"),se=n("Document"),a=n("el-icon"),r=n("el-text"),Q=n("CardBox"),ae=n("el-form"),le=n("el-drawer"),S=he("loading");return _(),w(le,{modelValue:d.value,"onUpdate:modelValue":U[1]||(U[1]=L=>d.value=L),size:"60%",onClose:z},{header:t(()=>[b("h4",null,f(i.$t("views.problem.detailProblem")),1)]),footer:t(()=>[b("div",null,[k.value.doc_edit(B(N))?(_(),w(j,{key:0,onClick:c},{default:t(()=>[D(f(i.$t("views.problem.relateParagraph.title")),1)]),_:1})):O("",!0),l(j,{onClick:i.pre,disabled:i.pre_disable||p.value},{default:t(()=>[D(f(i.$t("views.chatLog.buttons.prev")),1)]),_:1},8,["onClick","disabled"]),l(j,{onClick:i.next,disabled:i.next_disable||p.value},{default:t(()=>[D(f(i.$t("views.chatLog.buttons.next")),1)]),_:1},8,["onClick","disabled"])])]),default:t(()=>[b("div",null,[l(J,null,{default:t(()=>[b("div",We,[ye((_(),w(ae,{"label-position":"top",onSubmit:U[0]||(U[0]=Z(()=>{},["prevent"]))},{default:t(()=>[l(ee,{label:i.$t("views.problem.title")},{default:t(()=>[l(te,{onChange:x,data:i.currentContent,showEditIcon:k.value.problem_edit(B(N)),maxlength:256},null,8,["data","showEditIcon"])]),_:1},8,["label"]),l(ee,{label:i.$t("views.problem.relateParagraph.title")},{default:t(()=>[(_(!0),de(we,null,$e(T.value,(L,oe)=>(_(),w(Q,{key:oe,title:L.title||"-",class:"cursor mb-8",showIcon:!1,onClick:Z(e=>k.value.doc_edit(B(N))&&m(L),["stop"]),style:{height:"210px"}},{tag:t(()=>[l(X,{effect:"dark",content:i.$t("views.problem.setting.cancelRelated"),placement:"top"},{default:t(()=>[k.value.problem_relate(B(N))?(_(),w(j,{key:0,type:"primary",text:"",onClick:Z(e=>o(L),["stop"])},{default:t(()=>[l(G,{iconName:"app-quxiaoguanlian"})]),_:2},1032,["onClick"])):O("",!0)]),_:2},1032,["content"])]),footer:t(()=>[b("div",Qe,[l(r,null,{default:t(()=>[l(a,null,{default:t(()=>[l(se)]),_:1}),D(" "+f(L==null?void 0:L.documentName),1)]),_:2},1024)])]),default:t(()=>[l(J,{height:"110"},{default:t(()=>[D(f(L.content),1)]),_:2},1024)]),_:2},1032,["title","onClick"]))),128))]),_:1},8,["label"])]),_:1})),[[S,p.value]])])]),_:1}),l(Le,{ref_key:"ParagraphDialogRef",ref:C,title:i.$t("views.paragraph.editParagraph"),apiType:P.value,onRefresh:M},null,8,["title","apiType"]),l(Ie,{ref_key:"RelateProblemDialogRef",ref:R,onRefresh:M},null,512)])]),_:1},8,["modelValue"])}}}),Je={class:"document p-16-24"},Ke={class:"mb-16"},Oe={class:"main-calc-height"},Xe={class:"p-24"},Ye={class:"flex-between"},Ze={key:1},et={class:"mr-4"},ot=me({__name:"index",setup(re){const E=ve(),{params:{id:$,folderId:V}}=E,h=F(()=>E.path.includes("shared")?"systemShare":E.path.includes("resource-management")?"systemManage":E.path.includes("share/")?"workspaceShare":"workspace"),y=F(()=>Pe.knowledge[h.value]),N=F(()=>V==="share"),P=s(),k=s(),R=s(),C=s(!1),p=s(""),d=s(""),T=s(""),o=be({current_page:1,page_size:10,total:0}),c=s(""),m=s([]),x=F(()=>m.value.map((e,u)=>({[e.id]:u})).reduce((e,u)=>({...e,...u}),{})),z=s(),I=s([]);function M(e){const u=[];e?u.push(e.id):I.value.map(A=>{A&&u.push(A.id)}),P.value.open(u)}function H(){R.value.open()}const i=e=>{I.value=e};function U(e){C.value=!0;const u=[e];q({type:"problem",systemType:h.value}).postProblems($,u).then(()=>{S(),Y(W("common.createSuccess"))}).catch(()=>{C.value=!1})}function te(){const e=[];I.value.map(u=>{u&&e.push(u.id)}),q({type:"problem",systemType:h.value}).putMulProblem($,e,C).then(()=>{var u;Y(W("views.document.delete.successMessage")),(u=z.value)==null||u.clearSelection(),S()})}function ee(e){q({type:"problem",systemType:h.value}).delProblems($,e.id,C).then(()=>{Y(W("common.deleteSuccess")),S()})}function G(e,u){if(e){const A={content:e};q({type:"problem",systemType:h.value}).putProblems($,u,A,C).then(()=>{S(),Y(W("common.modifySuccess"))})}else Re(W("views.problem.tip.errorMessage"))}function j(e){p.value=e.id}function X(){p.value=""}const J=()=>{let e=x.value[d.value]+1;if(e>=m.value.length){if(e+(o.current_page-1)*o.page_size>=o.total-1)return;o.current_page=o.current_page+1,S().then(()=>{e=0,d.value=m.value[e].id,T.value=m.value[e].content})}else d.value=m.value[e].id,T.value=m.value[e].content},se=F(()=>x.value[d.value]-1<0&&o.current_page<=1),a=F(()=>{const e=x.value[d.value]+1;return e>=m.value.length&&e+(o.current_page-1)*o.page_size>=o.total-1}),r=()=>{let e=x.value[d.value]-1;if(e<0){if(o.current_page<=1)return;o.current_page=o.current_page-1,S().then(()=>{e=o.page_size-1,d.value=m.value[e].id,T.value=m.value[e].content})}else d.value=m.value[e].id,T.value=m.value[e].content};function Q(e,u){u&&u.type==="selection"||E.path.includes("share/")||e.paragraph_count&&(d.value=e.id,T.value=e.content,k.value.open())}const ae=({row:e})=>d.value===(e==null?void 0:e.id)?"highlight":"";function le(){o.current_page=1,S()}function S(){return q({type:"problem",isShared:N.value,systemType:h.value}).getProblemsPage($,o,c.value&&{content:c.value},C).then(e=>{m.value=e.data.records,o.total=e.data.total})}function L(){var e;S(),(e=z.value)==null||e.clearSelection()}function oe(){o.current_page=1,S()}return Me(()=>{S()}),xe(()=>{}),(e,u)=>{const A=n("el-button"),fe=n("el-input"),K=n("el-table-column"),_e=n("ReadWrite"),ie=n("el-link"),ue=n("AppIcon"),ce=n("el-tooltip"),g=n("app-table"),ge=n("el-card"),ke=he("loading");return _(),de("div",Je,[b("h2",Ke,f(e.$t("views.problem.title")),1),l(ge,{style:{"--el-card-padding":"0"}},{default:t(()=>[b("div",Oe,[b("div",Xe,[b("div",Ye,[b("div",null,[y.value.problem_create(B($))?(_(),w(A,{key:0,type:"primary",onClick:H},{default:t(()=>[D(f(e.$t("views.problem.createProblem")),1)]),_:1})):O("",!0),y.value.problem_relate(B($))?(_(),w(A,{key:1,onClick:u[0]||(u[0]=v=>M()),disabled:I.value.length===0},{default:t(()=>[D(f(e.$t("views.problem.relateParagraph.title")),1)]),_:1},8,["disabled"])):O("",!0),y.value.problem_delete(B($))?(_(),w(A,{key:2,onClick:te,disabled:I.value.length===0},{default:t(()=>[D(f(e.$t("views.problem.setting.batchDelete")),1)]),_:1},8,["disabled"])):O("",!0)]),l(fe,{modelValue:c.value,"onUpdate:modelValue":u[1]||(u[1]=v=>c.value=v),placeholder:e.$t("views.problem.searchBar.placeholder"),"prefix-icon":"Search",class:"w-240",onChange:S,clearable:""},null,8,["modelValue","placeholder"])]),ye((_(),w(g,{ref_key:"multipleTableRef",ref:z,class:"mt-16",data:m.value,"pagination-config":o,"quick-create":y.value.problem_create(B($)),quickCreateName:e.$t("views.problem.quickCreateName"),quickCreatePlaceholder:e.$t("views.problem.quickCreateProblem"),quickCreateMaxlength:256,onSizeChange:le,onChangePage:S,onCellMouseEnter:j,onCellMouseLeave:X,onCreatQuick:U,onRowClick:Q,onSelectionChange:i,"row-class-name":ae,"row-key":v=>v.id},{default:t(()=>[l(K,{type:"selection",width:"55","reserve-selection":!0}),l(K,{prop:"content",label:e.$t("views.problem.title"),"min-width":"280"},{default:t(({row:v})=>[l(_e,{onChange:pe=>G(pe,v.id),data:v.content,showEditIcon:y.value.problem_edit(B($))&&v.id===p.value,maxlength:256},null,8,["onChange","data","showEditIcon"])]),_:1},8,["label"]),l(K,{prop:"paragraph_count",label:e.$t("views.problem.table.paragraph_count"),align:"right","min-width":"100"},{default:t(({row:v})=>[v.paragraph_count?(_(),w(ie,{key:0,type:"primary",onClick:Z(pe=>Q(v),["stop"])},{default:t(()=>[D(f(v.paragraphCount),1)]),_:2},1032,["onClick"])):(_(),de("span",Ze,f(v.paragraphCount),1))]),_:1},8,["label"]),l(K,{prop:"createTime",label:e.$t("common.createTime"),width:"170"},{default:t(({row:v})=>[D(f(B(Ce)(v.createTime)),1)]),_:1},8,["label"]),l(K,{prop:"update_time",label:e.$t("views.problem.table.updateTime"),width:"170"},{default:t(({row:v})=>[D(f(B(Ce)(v.updateTime)),1)]),_:1},8,["label"]),l(K,{label:e.$t("common.operation"),align:"left",fixed:"right"},{default:t(({row:v})=>[b("div",null,[b("span",et,[l(ce,{effect:"dark",content:e.$t("views.problem.relateParagraph.title"),placement:"top"},{default:t(()=>[y.value.problem_relate(B($))?(_(),w(A,{key:0,type:"primary",text:"",onClick:Z(pe=>M(v),["stop"])},{default:t(()=>[l(ue,{iconName:"app-generate-question"})]),_:2},1032,["onClick"])):O("",!0)]),_:2},1032,["content"])]),b("span",null,[l(ce,{effect:"dark",content:e.$t("common.delete"),placement:"top"},{default:t(()=>[y.value.problem_delete(B($))?(_(),w(A,{key:0,type:"primary",text:"",onClick:Z(pe=>ee(v),["stop"])},{default:t(()=>[l(ue,{iconName:"app-delete"})]),_:2},1032,["onClick"])):O("",!0)]),_:2},1032,["content"])])])]),_:1},8,["label"])]),_:1},8,["data","pagination-config","quick-create","quickCreateName","quickCreatePlaceholder","row-key"])),[[ke,C.value]])])])]),_:1}),l(ze,{ref_key:"CreateProblemDialogRef",ref:R,onRefresh:oe},null,512),l(Ge,{next:J,pre:r,ref_key:"DetailProblemRef",ref:k,currentId:d.value,"onUpdate:currentId":u[2]||(u[2]=v=>d.value=v),currentContent:T.value,"onUpdate:currentContent":u[3]||(u[3]=v=>T.value=v),pre_disable:se.value,next_disable:a.value,onRefresh:L},null,8,["currentId","currentContent","pre_disable","next_disable"]),l(Ie,{ref_key:"RelateProblemDialogRef",ref:P,onRefresh:L},null,512)])}}});export{ot as default};
