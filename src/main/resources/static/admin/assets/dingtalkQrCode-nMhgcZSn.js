import{_ as m}from"./logo_dingtalk-CyDPr22R.js";import{aJ as f,aK as h,aQ as _,fW as k,cE as y,aP as w,cF as C,aL as v,aM as q,aN as a,aO as R,cG as Q,d3 as S}from"./admin-B8yAtLQA.js";const T={class:"flex-center mb-16"},E=f({__name:"dingtalkQrCode",props:{config:{}},setup(c){const o=c,d=h(),{chatUser:p}=_(),{load:l}=k("https://g.alicdn.com/dingding/h5-dingtalk-login/0.21.0/ddlogin.js"),i=y(!1),n=w(),{params:{accessToken:r}}=n,u=async()=>{try{if(await l(!0),!i.value)return;const e={appKey:o.config.app_key,appSecret:o.config.app_secret,corp_id:o.config.corp_id},t=encodeURIComponent(window.location.origin);window.DTFrameLogin({id:"ding-talk-qr",width:280,height:280},{redirect_uri:t,client_id:e.appKey,scope:"openid corpid",response_type:"code",state:"fit2cloud-ding-chat-qr",prompt:"consent",corpId:e.corp_id},s=>{const g=s.authCode;p.dingCallback(g,r).then(()=>{d.push({name:"chat",params:{accessToken:r},query:n.query})})},s=>{S(s)})}catch{}};return C(()=>o.config,e=>{e.app_key&&e.corp_id&&(i.value=!0,u())},{immediate:!0}),(e,t)=>(q(),v(Q,null,[a("div",T,[t[0]||(t[0]=a("img",{src:m,alt:"",width:"24px",class:"mr-4"},null,-1)),a("h2",null,R(e.$t("views.system.authentication.scanTheQRCode.dingtalkQrCode")),1)]),t[1]||(t[1]=a("div",{class:"ding-talk-qrName"},[a("div",{id:"ding-talk-qr"})],-1))],64))}});export{E as default};
