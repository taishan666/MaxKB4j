import{b2 as se,b1 as re,b0 as ce,ay as H,aB as k,aX as B,aC as i,b9 as J,aD as s,b3 as N,aT as w,aF as p,aH as l,aG as n,b4 as F,aI as U,aK as P,aJ as _,aE as I,b8 as A,bO as W,bN as X,bP as Y,b5 as O,d$ as ge,aY as z,aZ as G,c9 as te,aU as D,cu as fe,cn as de,bD as he}from"./admin-BcWypnGv.js";import{_ as ve,a as _e,b as be,c as we,d as ye}from"./logo_wechat-BQQCOajc.js";const ae="/chat_user/auth",Ve=(y,e)=>se(`${ae}/${y}/detail`,void 0,e),ke=(y,e)=>ce(`${ae}/connection`,y,void 0,e),$e=(y,e,h)=>re(`${ae}/${y}/info`,e,void 0,h),le="/chat_user/auth/platform",Ue=y=>se(`${le}/source`,void 0,y),Pe=(y,e)=>ce(`${le}/source`,y,void 0,e),Ce=(y,e)=>re(`${le}/source`,y,void 0,e),S={getAuthSetting:Ve,postAuthSetting:ke,putAuthSetting:$e,getPlatformInfo:Ue,updateConfig:Pe,validateConnection:Ce},Ae={class:"authentication-setting__main main-calc-height"},Se={class:"form-container p-24"},Ee=H({__name:"LDAP",setup(y){const e=k({id:"",auth_type:"LDAP",config:{ldap_server:"",base_dn:"",password:"",ou:"",ldap_filter:"",ldap_mapping:""},isActive:!0}),h=k(),m=k(!1),f=B({"config.ldap_server":[{required:!0,message:i("views.system.authentication.ldap.serverPlaceholder"),trigger:"blur"}],"config.base_dn":[{required:!0,message:i("views.system.authentication.ldap.bindDNPlaceholder"),trigger:"blur"}],"config.password":[{required:!0,message:i("views.login.loginForm.password.placeholder"),trigger:"blur"}],"config.ou":[{required:!0,message:i("views.system.authentication.ldap.ouPlaceholder"),trigger:"blur"}],"config.ldap_filter":[{required:!0,message:i("views.system.authentication.ldap.ldap_filterPlaceholder"),trigger:"blur"}],"config.ldap_mapping":[{required:!0,message:i("views.system.authentication.ldap.ldap_mappingPlaceholder"),trigger:"blur"}]}),V=async(t,o)=>{t&&await t.validate((u,r)=>{u&&(o?S.postAuthSetting(e.value,m).then(C=>{O(i("views.system.testSuccess"))}):S.putAuthSetting(e.value.auth_type,e.value,m).then(C=>{O(i("common.saveSuccess"))}))})};function c(){S.getAuthSetting(e.value.auth_type,m).then(t=>{t.data&&JSON.stringify(t.data)!=="{}"&&(e.value=t.data,t.data.config.ldap_mapping&&(e.value.config.ldap_mapping=JSON.stringify(JSON.parse(t.data.config.ldap_mapping))))})}return J(()=>{c()}),(t,o)=>{const u=s("el-input"),r=s("el-form-item"),C=s("el-checkbox"),T=s("el-form"),E=s("el-button"),d=s("el-scrollbar"),g=N("hasPermission"),v=N("loading");return p(),w("div",Ae,[l(d,null,{default:n(()=>[F((p(),w("div",Se,[l(T,{ref_key:"authFormRef",ref:h,rules:f,model:e.value,"label-position":"top","require-asterisk-position":"right"},{default:n(()=>[l(r,{label:t.$t("views.system.authentication.ldap.address"),prop:"config.ldap_server"},{default:n(()=>[l(u,{modelValue:e.value.config.ldap_server,"onUpdate:modelValue":o[0]||(o[0]=a=>e.value.config.ldap_server=a),placeholder:t.$t("views.system.authentication.ldap.serverPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:t.$t("views.system.authentication.ldap.bindDN"),prop:"config.base_dn"},{default:n(()=>[l(u,{modelValue:e.value.config.base_dn,"onUpdate:modelValue":o[1]||(o[1]=a=>e.value.config.base_dn=a),placeholder:t.$t("views.system.authentication.ldap.bindDNPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:t.$t("views.system.password"),prop:"config.password"},{default:n(()=>[l(u,{modelValue:e.value.config.password,"onUpdate:modelValue":o[2]||(o[2]=a=>e.value.config.password=a),placeholder:t.$t("views.login.loginForm.password.placeholder"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:t.$t("views.system.authentication.ldap.ou"),prop:"config.ou"},{default:n(()=>[l(u,{modelValue:e.value.config.ou,"onUpdate:modelValue":o[3]||(o[3]=a=>e.value.config.ou=a),placeholder:t.$t("views.system.authentication.ldap.ouPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:t.$t("views.system.authentication.ldap.ldap_filter"),prop:"config.ldap_filter"},{default:n(()=>[l(u,{modelValue:e.value.config.ldap_filter,"onUpdate:modelValue":o[4]||(o[4]=a=>e.value.config.ldap_filter=a),placeholder:t.$t("views.system.authentication.ldap.ldap_filterPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:t.$t("views.system.authentication.ldap.ldap_mapping"),prop:"config.ldap_mapping"},{default:n(()=>[l(u,{modelValue:e.value.config.ldap_mapping,"onUpdate:modelValue":o[5]||(o[5]=a=>e.value.config.ldap_mapping=a),placeholder:'{"name":"name","email":"mail","username":"cn"}'},null,8,["modelValue"])]),_:1},8,["label"]),l(r,null,{default:n(()=>[l(C,{modelValue:e.value.isActive,"onUpdate:modelValue":o[6]||(o[6]=a=>e.value.isActive=a)},{default:n(()=>[P(_(t.$t("views.system.authentication.ldap.enableAuthentication")),1)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["rules","model"]),U("div",null,[l(E,{onClick:o[7]||(o[7]=a=>V(h.value,"test")),disabled:m.value},{default:n(()=>[P(_(t.$t("views.system.test")),1)]),_:1},8,["disabled"]),F((p(),I(E,{onClick:o[8]||(o[8]=a=>V(h.value)),type:"primary",disabled:m.value},{default:n(()=>[P(_(t.$t("common.save")),1)]),_:1},8,["disabled"])),[[g,new(A(W))([A(X).ADMIN],[A(Y).CHAT_USER_AUTH_EDIT],[],"OR")]])])])),[[v,m.value]])]),_:1})])}}}),Ie={class:"authentication-setting__main main-calc-height"},Re={class:"form-container p-24"},Te=H({__name:"CAS",setup(y){const e=k({id:"",auth_type:"CAS",config:{ldpUri:"",validateUrl:"",redirectUrl:""},isActive:!0}),h=k(),m=k(!1),f=B({"config.ldpUri":[{required:!0,message:i("views.system.authentication.cas.ldpUriPlaceholder"),trigger:"blur"}],"config.validateUrl":[{required:!0,message:i("views.system.authentication.cas.validateUrlPlaceholder"),trigger:"blur"}],"config.redirectUrl":[{required:!0,message:i("views.system.authentication.cas.redirectUrlPlaceholder"),trigger:"blur"}]}),V=async t=>{t&&await t.validate((o,u)=>{o&&S.putAuthSetting(e.value.auth_type,e.value,m).then(r=>{O(i("common.saveSuccess"))})})};function c(){S.getAuthSetting(e.value.auth_type,m).then(t=>{t.data&&JSON.stringify(t.data)!=="{}"&&(t.data.config.validateUrl||(t.data.config.validateUrl=t.data.config.ldpUri),e.value=t.data),e.value.config.redirectUrl||(e.value.config.redirectUrl=window.location.origin+window.MaxKB.chatPrefix+"/api/auth/cas")})}return J(()=>{c()}),(t,o)=>{const u=s("el-input"),r=s("el-form-item"),C=s("el-checkbox"),T=s("el-form"),E=s("el-button"),d=s("el-scrollbar"),g=N("hasPermission"),v=N("loading");return p(),w("div",Ie,[l(d,null,{default:n(()=>[F((p(),w("div",Re,[l(T,{ref_key:"authFormRef",ref:h,rules:f,model:e.value,"label-position":"top","require-asterisk-position":"right"},{default:n(()=>[l(r,{label:t.$t("views.system.authentication.cas.ldpUri"),prop:"config.ldpUri"},{default:n(()=>[l(u,{modelValue:e.value.config.ldpUri,"onUpdate:modelValue":o[0]||(o[0]=a=>e.value.config.ldpUri=a),placeholder:t.$t("views.system.authentication.cas.ldpUriPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:t.$t("views.system.authentication.cas.validateUrl"),prop:"config.validateUrl"},{default:n(()=>[l(u,{modelValue:e.value.config.validateUrl,"onUpdate:modelValue":o[1]||(o[1]=a=>e.value.config.validateUrl=a),placeholder:t.$t("views.system.authentication.cas.validateUrlPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:t.$t("views.system.authentication.cas.redirectUrl"),prop:"config.redirectUrl"},{default:n(()=>[l(u,{modelValue:e.value.config.redirectUrl,"onUpdate:modelValue":o[2]||(o[2]=a=>e.value.config.redirectUrl=a),placeholder:t.$t("views.system.authentication.cas.redirectUrlPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,null,{default:n(()=>[l(C,{modelValue:e.value.isActive,"onUpdate:modelValue":o[3]||(o[3]=a=>e.value.isActive=a)},{default:n(()=>[P(_(t.$t("views.system.authentication.cas.enableAuthentication")),1)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["rules","model"]),U("div",null,[F((p(),I(E,{onClick:o[4]||(o[4]=a=>V(h.value)),type:"primary",disabled:m.value},{default:n(()=>[P(_(t.$t("common.save")),1)]),_:1},8,["disabled"])),[[g,new(A(W))([A(X).ADMIN],[A(Y).CHAT_USER_AUTH_EDIT],[],"OR")]])])])),[[v,m.value]])]),_:1})])}}}),qe={class:"authentication-setting__main main-calc-height"},De={class:"form-container p-24"},Me=H({__name:"OIDC",setup(y){const e=k({id:"",auth_type:"OIDC",config:{authEndpoint:"",tokenEndpoint:"",userInfoEndpoint:"",scope:"",state:"",clientId:"",clientSecret:"",fieldMapping:'{"username": "preferred_username", "email": "email"}',redirectUrl:""},isActive:!0}),h=k(),m=k(!1),f=B({"config.authEndpoint":[{required:!0,message:i("views.system.authentication.oidc.authEndpointPlaceholder"),trigger:"blur"}],"config.tokenEndpoint":[{required:!0,message:i("views.system.authentication.oidc.tokenEndpointPlaceholder"),trigger:"blur"}],"config.userInfoEndpoint":[{required:!0,message:i("views.system.authentication.oidc.userInfoEndpointPlaceholder"),trigger:"blur"}],"config.scope":[{required:!0,message:i("views.system.authentication.oidc.scopePlaceholder"),trigger:"blur"}],"config.clientId":[{required:!0,message:i("views.system.authentication.oidc.clientIdPlaceholder"),trigger:"blur"}],"config.clientSecret":[{required:!0,message:i("views.system.authentication.oidc.clientSecretPlaceholder"),trigger:"blur"}],"config.fieldMapping":[{required:!0,message:i("views.system.authentication.oauth2.filedMappingPlaceholder"),trigger:"blur"}],"config.redirectUrl":[{required:!0,message:i("views.system.authentication.oidc.redirectUrlPlaceholder"),trigger:"blur"}],"config.logoutEndpoint":[{required:!0,message:i("views.system.authentication.oidc.logoutEndpointPlaceholder"),trigger:"blur"}]}),V=async(t,o)=>{t&&await t.validate((u,r)=>{u&&S.putAuthSetting(e.value.auth_type,e.value,m).then(C=>{O(i("common.saveSuccess"))})})};function c(){S.getAuthSetting(e.value.auth_type,m).then(t=>{t.data&&JSON.stringify(t.data)!=="{}"&&(e.value=t.data,(e.value.config.fieldMapping===""||e.value.config.fieldMapping===void 0)&&(e.value.config.fieldMapping='{"username": "preferred_username", "email": "email"}')),e.value.config.redirectUrl||(e.value.config.redirectUrl=window.location.origin+window.MaxKB.chatPrefix+"/api/auth/oidc")})}return J(()=>{c()}),(t,o)=>{const u=s("el-input"),r=s("el-form-item"),C=s("el-checkbox"),T=s("el-form"),E=s("el-button"),d=s("el-scrollbar"),g=N("hasPermission"),v=N("loading");return p(),w("div",qe,[l(d,null,{default:n(()=>[F((p(),w("div",De,[l(T,{ref_key:"authFormRef",ref:h,rules:f,model:e.value,"label-position":"top","require-asterisk-position":"right"},{default:n(()=>[l(r,{label:t.$t("views.system.authentication.oidc.authEndpoint"),prop:"config.authEndpoint"},{default:n(()=>[l(u,{modelValue:e.value.config.authEndpoint,"onUpdate:modelValue":o[0]||(o[0]=a=>e.value.config.authEndpoint=a),placeholder:t.$t("views.system.authentication.oidc.authEndpointPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:t.$t("views.system.authentication.oidc.tokenEndpoint"),prop:"config.tokenEndpoint"},{default:n(()=>[l(u,{modelValue:e.value.config.tokenEndpoint,"onUpdate:modelValue":o[1]||(o[1]=a=>e.value.config.tokenEndpoint=a),placeholder:t.$t("views.system.authentication.oidc.tokenEndpointPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:t.$t("views.system.authentication.oidc.userInfoEndpoint"),prop:"config.userInfoEndpoint"},{default:n(()=>[l(u,{modelValue:e.value.config.userInfoEndpoint,"onUpdate:modelValue":o[2]||(o[2]=a=>e.value.config.userInfoEndpoint=a),placeholder:t.$t("views.system.authentication.oidc.userInfoEndpointPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:"Scope",prop:"config.scope"},{default:n(()=>[l(u,{modelValue:e.value.config.scope,"onUpdate:modelValue":o[3]||(o[3]=a=>e.value.config.scope=a),placeholder:"openid+profile+email "},null,8,["modelValue"])]),_:1}),l(r,{label:"State",prop:"config.state"},{default:n(()=>[l(u,{modelValue:e.value.config.state,"onUpdate:modelValue":o[4]||(o[4]=a=>e.value.config.state=a),placeholder:""},null,8,["modelValue"])]),_:1}),l(r,{label:t.$t("views.system.authentication.oidc.clientId"),prop:"config.clientId"},{default:n(()=>[l(u,{modelValue:e.value.config.clientId,"onUpdate:modelValue":o[5]||(o[5]=a=>e.value.config.clientId=a),placeholder:t.$t("views.system.authentication.oidc.clientIdPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:t.$t("views.system.authentication.oidc.clientSecret"),prop:"config.clientSecret"},{default:n(()=>[l(u,{modelValue:e.value.config.clientSecret,"onUpdate:modelValue":o[6]||(o[6]=a=>e.value.config.clientSecret=a),placeholder:t.$t("views.system.authentication.oidc.clientSecretPlaceholder"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:t.$t("views.system.authentication.oauth2.filedMapping"),prop:"config.fieldMapping"},{default:n(()=>[l(u,{modelValue:e.value.config.fieldMapping,"onUpdate:modelValue":o[7]||(o[7]=a=>e.value.config.fieldMapping=a),placeholder:t.$t("views.system.authentication.oauth2.filedMappingPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:t.$t("views.system.authentication.oidc.redirectUrl"),prop:"config.redirectUrl"},{default:n(()=>[l(u,{modelValue:e.value.config.redirectUrl,"onUpdate:modelValue":o[8]||(o[8]=a=>e.value.config.redirectUrl=a),placeholder:t.$t("views.system.authentication.oidc.redirectUrlPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,null,{default:n(()=>[l(C,{modelValue:e.value.isActive,"onUpdate:modelValue":o[9]||(o[9]=a=>e.value.isActive=a)},{default:n(()=>[P(_(t.$t("views.system.authentication.oidc.enableAuthentication")),1)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["rules","model"]),U("div",null,[F((p(),I(E,{onClick:o[10]||(o[10]=a=>V(h.value)),type:"primary",disabled:m.value},{default:n(()=>[P(_(t.$t("common.save")),1)]),_:1},8,["disabled"])),[[g,new(A(W))([A(X).ADMIN],[A(Y).CHAT_USER_AUTH_EDIT],[],"OR")]])])])),[[v,m.value]])]),_:1})])}}}),Ne={class:"flex align-center",style:{"margin-left":"-8px"}},Fe={class:"dialog-footer"},Oe=H({__name:"EditModal",emits:["refresh"],setup(y,{expose:e,emit:h}){const m=k(!1),f=k(!1),V=k(),c=B({key:"",logoSrc:"",name:"",isActive:!1,isValid:!1,config:{}}),t=a=>({corp_id:"Corp ID",app_key:(c==null?void 0:c.key)!="lark"?"APP Key":"App ID",app_secret:"APP Secret",agent_id:"Agent ID",callback_url:i("views.application.applicationAccess.callback")})[a]||(a?a.charAt(0).toUpperCase()+a.slice(1):""),o=a=>{switch(a){case"app_key":return[{required:!0,message:i("views.system.authentication.scanTheQRCode.appKeyPlaceholder"),trigger:["blur","change"]}];case"app_secret":return[{required:!0,message:i("views.system.authentication.scanTheQRCode.appSecretPlaceholder"),trigger:["blur","change"]}];case"corp_id":return[{required:!0,message:i("views.system.authentication.scanTheQRCode.corpIdPlaceholder"),trigger:["blur","change"]}];case"agent_id":return[{required:!0,message:i("views.system.authentication.scanTheQRCode.agentIdPlaceholder"),trigger:["blur","change"]}];case"callback_url":return[{required:!0,message:i("views.application.applicationAccess.callbackTip"),trigger:["blur","change"]},{pattern:/^https?:\/\/.+/,message:i("views.system.authentication.scanTheQRCode.callbackWarning"),trigger:["blur","change"]}];default:return[]}};e({open:async a=>{var Q;m.value=!0,f.value=!0,Object.assign(c,a);const $=window.location.origin+window.MaxKB.chatPrefix+"/api";switch(a.key){case"wecom":c.config.app_key&&(c.config.agent_id=c.config.app_key,delete c.config.app_key),c.config.callback_url=`${$}/auth/wecom`;break;case"dingtalk":c.config.agent_id&&(c.config.corp_id=c.config.agent_id,delete c.config.agent_id),c.config={corp_id:c.config.corp_id,app_key:c.config.app_key,app_secret:c.config.app_secret,callback_url:$},c.config.callback_url=`${$}/auth/dingtalk`;break;case"lark":c.config.callback_url=`${$}/auth/lark`;break}(Q=V.value)==null||Q.clearValidate()}});const r=()=>{var a;(a=V.value)==null||a.validate($=>{$?v():te(i("views.system.authentication.scanTheQRCode.validateFailedTip"))})},C=()=>{var a;m.value=!1,(a=V.value)==null||a.clearValidate(),g("refresh")};function T(){S.validateConnection(c,f).then(a=>{a.data?O(i("views.system.authentication.scanTheQRCode.validateSuccess")):te(i("views.system.authentication.scanTheQRCode.validateFailed"))})}const E=new Set(["app_secret","client_secret","secret"]),d=a=>E.has(a),g=h;function v(){S.updateConfig(c,f).then(a=>{var $;O(i("common.saveSuccess")),g("refresh"),m.value=!1,($=V.value)==null||$.clearValidate()})}return(a,$)=>{const Q=s("el-input"),K=s("el-form-item"),L=s("el-button"),Z=s("el-drawer");return p(),I(Z,{modelValue:m.value,"onUpdate:modelValue":$[0]||($[0]=j=>m.value=j),size:"60%","append-to-body":!0,"destroy-on-close":!0,onClose:C},{header:n(()=>[U("div",Ne,[U("h4",null,_(c.name+a.$t("views.system.authentication.scanTheQRCode.setting")),1)])]),footer:n(()=>[U("span",Fe,[l(L,{onClick:C},{default:n(()=>[P(_(a.$t("common.cancel")),1)]),_:1}),l(L,{onClick:T},{default:n(()=>[P(_(a.$t("views.system.authentication.scanTheQRCode.validate")),1)]),_:1}),l(L,{type:"primary",onClick:r},{default:n(()=>[P(_(a.$t("common.save")),1)]),_:1})])]),default:n(()=>[l(A(ge),{model:c.config,"label-width":"120px","label-position":"top","require-asterisk-position":"right",ref_key:"formRef",ref:V},{default:n(()=>[(p(!0),w(z,null,G(c.config,(j,q)=>(p(),I(K,{key:q,label:t(q),prop:q,rules:o(q)},{default:n(()=>[l(Q,{modelValue:c.config[q],"onUpdate:modelValue":x=>c.config[q]=x,type:d(q)?"password":"text","show-password":d(q)},null,8,["modelValue","onUpdate:modelValue","type","show-password"])]),_:2},1032,["label","prop","rules"]))),128))]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),Qe={class:"scan-height"},Be={class:"flex-between"},He={class:"flex align-center"},Je=["src"],Le={class:"ml-8"},Ke={key:1},je={class:"mr-4"},ze={key:0,class:"border-t mt-16"},Ge={class:"mt-4 mb-16 flex align-center"},We={key:0,class:"vertical-middle lighter break-all ellipsis-1"},Xe={key:1,class:"vertical-middle lighter break-all ellipsis-1"},Ye={key:2,class:"vertical-middle lighter break-all ellipsis-1"},Ze={class:"ml-4"},xe=H({__name:"SCAN",setup(y){const e=k(),h=k(!1),m=B(V()),f=B({});J(()=>{o()});function V(){return[c("wecom",i("views.system.authentication.scanTheQRCode.wecom")),c("dingtalk",i("views.system.authentication.scanTheQRCode.dingtalk")),c("lark",i("views.system.authentication.scanTheQRCode.lark"))]}function c(d,g){let v="";switch(d){case"wecom":v="wechat-work";break;case"dingtalk":v="dingtalk";break;case"lark":v="lark";break;default:v="";break}const a={...d==="wecom"?{corp_id:"",agent_id:""}:{app_key:""},app_secret:"",callback_url:""};return{key:d,logoSrc:new URL(Object.assign({"../../../../assets/logo/logo_dingtalk.svg":ye,"../../../../assets/logo/logo_lark.svg":we,"../../../../assets/logo/logo_slack.svg":be,"../../../../assets/logo/logo_wechat-work.svg":_e,"../../../../assets/logo/logo_wechat.svg":ve})[`../../../../assets/logo/logo_${v}.svg`],import.meta.url).href,name:g,isActive:!1,isValid:!1,config:a}}function t(d,g){return{corp_id:"Corp ID",app_key:(g==null?void 0:g.key)!="lark"?"APP Key":"App ID",app_secret:"APP Secret",agent_id:"Agent ID",callback_url:i("views.application.applicationAccess.callback")}[d]||(d?d.charAt(0).toUpperCase()+d.slice(1):"")}function o(){h.value=!0,S.getPlatformInfo(h).then(d=>{d&&m.forEach(g=>{const v=d.data.find(a=>a.auth_type===g.key);if(v){if(Object.assign(g,{isValid:v.is_valid,isActive:v.isActive,config:v.config}),g.key==="dingtalk"){const{corp_id:a,app_key:$,app_secret:Q}=g.config;g.config={corp_id:a,app_key:$,app_secret:Q,callback_url:g.config.callback_url}}f[g.key]={},f[g.key].app_secret=!1}})})}function u(d){S.validateConnection(d,h).then(g=>{g.data?O(i("views.system.authentication.scanTheQRCode.validateSuccess")):te(i("views.system.authentication.scanTheQRCode.validateFailed"))})}function r(){o()}function C(d){S.updateConfig(d,h).then(g=>{O(i("common.saveSuccess"))})}function T(d){f[d]||(f[d]={}),f[d].app_secret=!f[d].app_secret}function E(d){var g;(g=e.value)==null||g.open(d)}return(d,g)=>{const v=s("el-tag"),a=s("el-button"),$=s("el-switch"),Q=s("el-text"),K=s("AppIcon"),L=s("View"),Z=s("el-icon"),j=s("el-col"),q=s("el-row"),x=s("el-collapse-transition"),ue=s("el-card"),pe=s("el-scrollbar"),me=N("loading");return F((p(),w("div",Qe,[l(pe,null,{default:n(()=>[(p(!0),w(z,null,G(m,b=>(p(),w("div",{key:b.key,class:"mb-16"},[l(ue,{class:"border-none mb-16",shadow:"none"},{default:n(()=>[U("div",Be,[U("div",He,[U("img",{src:b.logoSrc,alt:"",width:"24px"},null,8,Je),U("h5",Le,_(b.name),1),b.isValid?(p(),I(v,{key:0,type:"success",class:"ml-8"},{default:n(()=>[P(_(d.$t("views.system.authentication.scanTheQRCode.effective")),1)]),_:1})):D("",!0)]),U("div",null,[b.isValid?D("",!0):(p(),I(a,{key:0,type:"primary",onClick:M=>E(b)},{default:n(()=>[P(_(d.$t("views.system.authentication.scanTheQRCode.access")),1)]),_:2},1032,["onClick"])),b.isValid?(p(),w("span",Ke,[U("span",je,_(b.isActive?d.$t("views.system.authentication.scanTheQRCode.alreadyTurnedOn"):d.$t("views.system.authentication.scanTheQRCode.notEnabled")),1),l($,{size:"small",modelValue:b.isActive,"onUpdate:modelValue":M=>b.isActive=M,disabled:!b.isValid,onChange:M=>C(b)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])])):D("",!0)])]),l(x,null,{default:n(()=>[b.isValid?(p(),w("div",ze,[l(q,{gutter:12,class:"mt-16"},{default:n(()=>[(p(!0),w(z,null,G(b.config,(M,R)=>(p(),I(j,{key:R,span:12},{default:n(()=>{var oe,ne;return[l(Q,{type:"info",class:"lighter"},{default:n(()=>[P(_(t(R,b)),1)]),_:2},1024),U("div",Ge,[R!=="app_secret"?(p(),w("span",We,_(M),1)):D("",!0),R==="app_secret"&&!((oe=f[b.key])!=null&&oe[R])?(p(),w("span",Xe,"************")):D("",!0),R==="app_secret"&&((ne=f[b.key])!=null&&ne[R])?(p(),w("span",Ye,_(M),1)):D("",!0),U("span",null,[l(a,{type:"primary",text:"",onClick:()=>A(fe)(M)},{default:n(()=>[l(K,{iconName:"app-copy"})]),_:2},1032,["onClick"])]),U("span",Ze,[R==="app_secret"?(p(),I(a,{key:0,type:"primary",text:"",onClick:ee=>T(b.key)},{default:n(()=>{var ee,ie;return[R==="app_secret"&&!((ee=f[b.key])!=null&&ee[R])?(p(),I(K,{key:0,iconName:"app-password-hide"})):D("",!0),R==="app_secret"&&((ie=f[b.key])!=null&&ie[R])?(p(),I(Z,{key:1},{default:n(()=>[l(L)]),_:1})):D("",!0)]}),_:2},1032,["onClick"])):D("",!0)])])]}),_:2},1024))),128))]),_:2},1024),l(a,{type:"primary",onClick:M=>E(b)},{default:n(()=>[P(_(d.$t("common.edit")),1)]),_:2},1032,["onClick"]),l(a,{onClick:M=>u(b)},{default:n(()=>[P(_(d.$t("views.system.authentication.scanTheQRCode.validate")),1)]),_:2},1032,["onClick"])])):D("",!0)]),_:2},1024)]),_:2},1024)]))),128)),l(Oe,{ref_key:"EditModelRef",ref:e,onRefresh:r},null,512)]),_:1})])),[[me,h.value]])}}}),et=de(xe,[["__scopeId","data-v-8dd3fe16"]]),tt={class:"authentication-setting__main main-calc-height"},at={class:"form-container p-24"},lt=H({__name:"OAuth2",setup(y){const e=k({id:"",auth_type:"OAuth2",config:{authEndpoint:"",tokenEndpoint:"",userInfoEndpoint:"",scope:"",clientId:"",clientSecret:"",redirectUrl:"",fieldMapping:""},isActive:!0}),h=k(),m=k(!1),f=B({"config.authEndpoint":[{required:!0,message:i("views.system.authentication.oauth2.authEndpointPlaceholder"),trigger:"blur"}],"config.tokenEndpoint":[{required:!0,message:i("views.system.authentication.oauth2.tokenEndpointPlaceholder"),trigger:"blur"}],"config.userInfoEndpoint":[{required:!0,message:i("views.system.authentication.oauth2.userInfoEndpointPlaceholder"),trigger:"blur"}],"config.scope":[{required:!0,message:i("views.system.authentication.oauth2.scopePlaceholder"),trigger:"blur"}],"config.clientId":[{required:!0,message:i("views.system.authentication.oauth2.clientIdPlaceholder"),trigger:"blur"}],"config.clientSecret":[{required:!0,message:i("views.system.authentication.oauth2.clientSecretPlaceholder"),trigger:"blur"}],"config.redirectUrl":[{required:!0,message:i("views.system.authentication.oauth2.redirectUrlPlaceholder"),trigger:"blur"}],"config.fieldMapping":[{required:!0,message:i("views.system.authentication.oauth2.filedMappingPlaceholder"),trigger:"blur"}]}),V=async(t,o)=>{t&&await t.validate((u,r)=>{u&&S.putAuthSetting(e.value.auth_type,e.value,m).then(C=>{O(i("common.saveSuccess"))})})};function c(){S.getAuthSetting(e.value.auth_type,m).then(t=>{t.data&&JSON.stringify(t.data)!=="{}"&&(e.value=t.data),e.value.config.redirectUrl||(e.value.config.redirectUrl=window.location.origin+window.MaxKB.chatPrefix+"/api/auth/oauth2")})}return J(()=>{c()}),(t,o)=>{const u=s("el-input"),r=s("el-form-item"),C=s("el-checkbox"),T=s("el-form"),E=s("el-button"),d=s("el-scrollbar"),g=N("hasPermission"),v=N("loading");return p(),w("div",tt,[l(d,null,{default:n(()=>[F((p(),w("div",at,[l(T,{ref_key:"authFormRef",ref:h,rules:f,model:e.value,"label-position":"top","require-asterisk-position":"right"},{default:n(()=>[l(r,{label:t.$t("views.system.authentication.oauth2.authEndpoint"),prop:"config.authEndpoint"},{default:n(()=>[l(u,{modelValue:e.value.config.authEndpoint,"onUpdate:modelValue":o[0]||(o[0]=a=>e.value.config.authEndpoint=a),placeholder:t.$t("views.system.authentication.oauth2.authEndpointPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:t.$t("views.system.authentication.oauth2.tokenEndpoint"),prop:"config.tokenEndpoint"},{default:n(()=>[l(u,{modelValue:e.value.config.tokenEndpoint,"onUpdate:modelValue":o[1]||(o[1]=a=>e.value.config.tokenEndpoint=a),placeholder:t.$t("views.system.authentication.oauth2.tokenEndpointPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:t.$t("views.system.authentication.oauth2.userInfoEndpoint"),prop:"config.userInfoEndpoint"},{default:n(()=>[l(u,{modelValue:e.value.config.userInfoEndpoint,"onUpdate:modelValue":o[2]||(o[2]=a=>e.value.config.userInfoEndpoint=a),placeholder:t.$t("views.system.authentication.oauth2.userInfoEndpointPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:t.$t("views.system.authentication.oauth2.scope"),prop:"config.scope"},{default:n(()=>[l(u,{modelValue:e.value.config.scope,"onUpdate:modelValue":o[3]||(o[3]=a=>e.value.config.scope=a),placeholder:t.$t("views.system.authentication.oauth2.scopePlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:t.$t("views.system.authentication.oauth2.clientId"),prop:"config.clientId"},{default:n(()=>[l(u,{modelValue:e.value.config.clientId,"onUpdate:modelValue":o[4]||(o[4]=a=>e.value.config.clientId=a),placeholder:t.$t("views.system.authentication.oauth2.clientIdPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:t.$t("views.system.authentication.oauth2.clientSecret"),prop:"config.clientSecret"},{default:n(()=>[l(u,{modelValue:e.value.config.clientSecret,"onUpdate:modelValue":o[5]||(o[5]=a=>e.value.config.clientSecret=a),placeholder:t.$t("views.system.authentication.oauth2.clientSecretPlaceholder"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:t.$t("views.system.authentication.oauth2.redirectUrl"),prop:"config.redirectUrl"},{default:n(()=>[l(u,{modelValue:e.value.config.redirectUrl,"onUpdate:modelValue":o[6]||(o[6]=a=>e.value.config.redirectUrl=a),placeholder:t.$t("views.system.authentication.oauth2.redirectUrlPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:t.$t("views.system.authentication.oauth2.filedMapping"),prop:"config.fieldMapping"},{default:n(()=>[l(u,{modelValue:e.value.config.fieldMapping,"onUpdate:modelValue":o[7]||(o[7]=a=>e.value.config.fieldMapping=a),placeholder:t.$t("views.system.authentication.oauth2.filedMappingPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,null,{default:n(()=>[l(C,{modelValue:e.value.isActive,"onUpdate:modelValue":o[8]||(o[8]=a=>e.value.isActive=a)},{default:n(()=>[P(_(t.$t("views.system.authentication.oauth2.enableAuthentication")),1)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["rules","model"]),U("div",null,[F((p(),I(E,{onClick:o[9]||(o[9]=a=>V(h.value)),type:"primary",disabled:m.value},{default:n(()=>[P(_(t.$t("common.save")),1)]),_:1},8,["disabled"])),[[g,new(A(W))([A(X).ADMIN],[A(Y).CHAT_USER_AUTH_EDIT],[],"OR")]])])])),[[v,m.value]])]),_:1})])}}}),ot={class:"authentication-setting p-16-24"},nt={class:"mb-16"},it=H({__name:"index",setup(y){const e=k("LDAP"),h=[{label:i("views.system.authentication.ldap.title"),name:"LDAP",component:Ee},{label:i("views.system.authentication.cas.title"),name:"CAS",component:Te},{label:i("views.system.authentication.oidc.title"),name:"OIDC",component:Me},{label:i("views.system.authentication.oauth2.title"),name:"OAuth2",component:lt},{label:i("views.system.authentication.scanTheQRCode.title"),name:"SCAN",component:et}];return J(()=>{}),(m,f)=>{const V=s("el-tab-pane"),c=s("el-tabs");return p(),w("div",ot,[U("h4",nt,_(m.$t("views.system.authentication.title")),1),l(c,{modelValue:e.value,"onUpdate:modelValue":f[0]||(f[0]=t=>e.value=t),class:"mt-4"},{default:n(()=>[(p(),w(z,null,G(h,(t,o)=>l(V,{key:o,label:t.label,name:t.name},{default:n(()=>[(p(),I(he(t.component)))]),_:2},1032,["label","name"])),64))]),_:1},8,["modelValue"])])}}}),ct=de(it,[["__scopeId","data-v-229b756b"]]);export{ct as default};
