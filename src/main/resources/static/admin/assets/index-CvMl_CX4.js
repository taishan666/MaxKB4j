const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./dingtalkQrCode-wbIGSUCd.js","./logo_dingtalk-CyDPr22R.js","./admin-BYKfadXe.js","./admin-CBkz333K.css","./dingtalkQrCode-CulsC8mV.css","./larkQrCode-BLQHYwRE.js","./logo_lark-DULIW3z6.js","./wecomQrCode-BuW1XvSa.js","./wecom.prod-CCkvMpRe.js","./wecomQrCode-Cct41S0k.css"])))=>i.map(i=>d[i]);
import{aJ as G,cE as u,aQ as z,aK as re,aP as ie,aS as f,aT as m,aM as a,cO as ve,cI as i,aX as v,cN as ce,aO as R,d4 as C,e4 as J,cT as ue,dr as fe,e5 as j,cP as de,aL as g,aN as r,d1 as ge,cH as pe,aU as b,cX as he,e6 as ye,cG as X,d_ as K,e3 as we,aR as Ce,d0 as Le,cU as ke,aV as w,cJ as se,dq as be,cV as xe,dS as ne,d5 as Ae}from"./admin-BYKfadXe.js";import{_ as Oe,a as $e}from"./dynamic-import-helper-B1wUOttj.js";const De=G({__name:"password",setup(D){const h=u(),{chatUser:x}=z(),t=u(!1),L=re(),T=ie(),V=()=>x.passwordAuthentication(d.value.password).then(O=>{L.push({name:"chat",params:{accessToken:x.accessToken},query:T.query})}),A=(O,k,n)=>{k===""?n(new Error(C("chat.passwordValidator.errorMessage1"))):V().catch(()=>{n(new Error(C("chat.passwordValidator.errorMessage2")))})},P=()=>{h.value.validate()},y={password:[{required:!0,validator:A,trigger:"manual"}]},d=u({password:""});return(O,k)=>{const n=f("el-input"),F=f("el-form-item"),U=f("el-button"),S=f("el-form");return a(),m(S,{ref_key:"FormRef",ref:h,model:d.value,onSubmit:ve(P,["prevent"])},{default:i(()=>[v(F,{prop:"value",rules:y.password},{default:i(()=>[v(n,{"show-password":"",modelValue:d.value.password,"onUpdate:modelValue":k[0]||(k[0]=l=>d.value.password=l)},null,8,["modelValue"])]),_:1},8,["rules"]),v(U,{class:"w-full mt-8",type:"primary",onClick:P,loading:t.value},{default:i(()=>[ce(R(O.$t("common.confirm")),1)]),_:1},8,["loading"])]),_:1},8,["model"])}}}),Ve=768,Re=()=>{const{common:D}=z(),h=()=>{var L;return((L=document.body)==null?void 0:L.getBoundingClientRect()).width-1<Ve},x=()=>{if(!document.hidden){const t=h();D.toggleDevice(t?j.Mobile:j.Desktop)}};J(()=>{window.addEventListener("resize",x)}),ue(()=>{fe(()=>{h()&&D.toggleDevice(j.Mobile)})})},Pe={},Ie={class:"login-warp flex-center"},Te={class:"login-container w-full h-full"},Me={class:"flex-center w-full h-full"};function qe(D,h){return a(),g("div",Ie,[r("div",Te,[r("div",Me,[ge(D.$slots,"default",{},void 0,!0)])])])}const Ee=de(Pe,[["render",qe],["__scopeId","data-v-e5a94abc"]]),Ue={key:0,class:"text-center"},Se=G({__name:"QrCodeTab",props:{tabs:{}},setup(D){const{chatUser:h}=z(),x=D,t=u(""),L=u([]),T=u({app_key:"",app_secret:""});async function V(){try{return await h.getQrSource()}catch{return[]}}ue(async()=>{x.tabs.length>0&&(t.value=x.tabs[0].key),L.value=await V(),A(t.value)});const A=y=>{const d=L.value.find(O=>O.auth_type===y);d&&d.config&&(T.value=d.config)},P=y=>{t.value=y,A(y)};return(y,d)=>{const O=f("el-tab-pane"),k=f("el-tabs");return a(),m(k,{modelValue:t.value,"onUpdate:modelValue":d[0]||(d[0]=n=>t.value=n),onTabChange:P},{default:i(()=>[(a(!0),g(X,null,pe(y.tabs,n=>(a(),m(O,{key:n.key,label:n.value,name:n.key},{default:i(()=>[n.key===t.value?(a(),g("div",Ue,[(a(),m(he(ye(()=>Oe(Object.assign({"./dingtalkQrCode.vue":()=>K(()=>import("./dingtalkQrCode-wbIGSUCd.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url),"./larkQrCode.vue":()=>K(()=>import("./larkQrCode-BLQHYwRE.js"),__vite__mapDeps([5,6,2,3]),import.meta.url),"./wecomQrCode.vue":()=>K(()=>import("./wecomQrCode-BuW1XvSa.js"),__vite__mapDeps([7,2,3,8,9]),import.meta.url)}),`./${n.key}QrCode.vue`,2))),{config:T.value},null,8,["config"]))])):b("",!0)]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])}}}),Qe={class:"user-login-container p-24"},ze={key:0,class:"flex-center",style:{"margin-bottom":"32px"}},Fe=["src"],Be={key:1,class:"user-login__header"},Ne={class:"flex-between"},He={class:"flex align-center"},je={class:"mr-12 ml-16 flex"},Ke=["src"],Je=["title"],Xe={class:"mb-24"},Ge={key:0,class:"mb-24"},We={key:1},Ye={class:"mb-24"},Ze={class:"mb-24"},eo={key:0,class:"mb-24"},oo={class:"flex-between w-full"},to=["src"],ao={key:2},lo={key:3,class:"login-gradient-divider lighter mt-24"},so={class:"text-center mt-16"},no=G({__name:"index",setup(D){Re();const h=re(),{theme:x,chatUser:t,common:L}=z(),{locale:T}=we({useScope:"global"}),V=u(!1),A=ie(),P=u(""),{params:{accessToken:y},query:{mode:d}}=A,O=Ce(()=>{console.log(L.isMobile());let e="";return!d||d==="pc"?e=L.isMobile()?"mobile":"pc":e=d,console.log(e),e==="pc"}),k=u(),n=u({username:"",password:"",captcha:""}),F=u({username:[{required:!0,message:C("views.login.loginForm.username.requiredMessage"),trigger:"blur"}],password:[{required:!0,message:C("views.login.loginForm.password.requiredMessage"),trigger:"blur"}],captcha:[{required:!0,message:C("views.login.loginForm.captcha.requiredMessage"),trigger:"blur"}]}),U=()=>{var e;(e=k.value)==null||e.validate().then(()=>{c.value==="LDAP"?t.ldapLogin(n.value).then(o=>{h.push({name:"chat",params:{accessToken:t.accessToken},query:A.query})}):t.login(n.value).then(o=>{h.push({name:"chat",params:{accessToken:t.accessToken},query:A.query})})})};function S(){ne.getCaptcha().then(e=>{P.value=e.data.captcha})}J(()=>{T.value=t.getLanguage(),S()});const l=u([]),B=u([""]),c=u(""),M=u(!1),W=u([]);function _e(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const o=Math.random()*16|0;return(e==="x"?o:o&3|8).toString(16)})}function Y(e,o=!1){e==="LDAP"||e===""||ne.getAuthSetting(e,V).then(I=>{if(!I.data||!I.data.config)return;const _=I.data.config,q=new URLSearchParams(A.query).toString();let $=`${_.redirectUrl}/${y}`;q&&($+=`?${q}`);let p;if(e==="CAS")p=_.ldpUri,p+=p.indexOf("?")!==-1?`&service=${encodeURIComponent($)}`:`?service=${encodeURIComponent($)}`;else if(e==="OIDC"){const H=_.scope||"openid+profile+email";p=`${_.authEndpoint}?client_id=${_.clientId}&redirect_uri=${$}&response_type=code&scope=${H}`,_.state&&(p+=`&state=${_.state}`)}else e==="OAuth2"&&(p=`${_.authEndpoint}?client_id=${_.clientId}&response_type=code&redirect_uri=${$}&state=${_e()}`,_.scope&&(p+=`&scope=${_.scope}`));p&&(o?Ae(C("views.login.jump_tip"),"",{confirmButtonText:C("views.login.jump"),cancelButtonText:C("common.cancel"),confirmButtonClass:""}).then(()=>{window.location.href=p}).catch(()=>{}):(console.log("url",p),window.location.href=p))})}function N(e){var o;if(c.value=e==="LDAP"?e:"LOCAL",e!=="LOCAL"&&(c.value=e),e==="QR_CODE"){c.value=e,M.value=!0;return}M.value=!1,n.value={username:"",password:"",captcha:""},Y(e),(o=k.value)==null||o.clearValidate()}return J(()=>{var e;(e=t.chat_profile)!=null&&e.login_value&&(l.value=t.chat_profile.login_value,l.value.includes("LOCAL")?l.value=["LOCAL",...l.value.filter(o=>o!=="LOCAL")]:l.value.includes("LDAP")&&(l.value=["LDAP",...l.value.filter(o=>o!=="LDAP")]),c.value=l.value[0]||"LOCAL",!l.value.includes("LOCAL")&&!l.value.includes("LDAP")&&(c.value=""),l.value.length==1&&["CAS","OIDC","OAuth2"].includes(l.value[0])&&Y(l.value[0]),B.value=l.value.filter(o=>!["CAS","OIDC","OAuth2","LOCAL","LDAP"].includes(o)),l.value=l.value.filter(o=>!["lark","wecom","dingtalk"].includes(o)),B.value.length>0&&(B.value.forEach(o=>{W.value.push({key:o,value:o==="wecom"?C("views.system.authentication.scanTheQRCode.wecom"):o==="dingtalk"?C("views.system.authentication.scanTheQRCode.dingtalk"):C("views.system.authentication.scanTheQRCode.lark")})}),!l.value.includes("LOCAL")&&!l.value.includes("LDAP")&&(M.value=!0),l.value=["QR_CODE",...l.value]))}),(e,o)=>{const I=f("el-avatar"),_=f("LogoIcon"),q=f("el-card"),$=f("el-input"),p=f("el-form-item"),H=f("el-form"),Q=f("el-button"),me=Le("loading");return V.value?b("",!0):ke((a(),m(Ee,{key:0},{default:i(()=>{var Z,ee,oe,te,ae,le;return[r("div",Qe,[O.value?(a(),g("div",ze,[w(se)((Z=w(t).chat_profile)==null?void 0:Z.icon)?(a(),m(I,{key:0,shape:"square",size:32,class:"mr-8",style:{background:"none"}},{default:i(()=>{var s;return[r("img",{src:(s=w(t).chat_profile)==null?void 0:s.icon,alt:""},null,8,Fe)]}),_:1})):(a(),m(_,{key:1,height:"32px",class:"mr-8"})),r("h1",null,R((ee=w(t).chat_profile)==null?void 0:ee.application_name),1)])):(a(),g("div",Be,[r("div",Ne,[r("div",He,[r("div",je,[w(se)((oe=w(t).chat_profile)==null?void 0:oe.icon)?(a(),m(I,{key:0,shape:"square",size:32,style:{background:"none"}},{default:i(()=>{var s;return[r("img",{src:(s=w(t).chat_profile)==null?void 0:s.icon,alt:""},null,8,Ke)]}),_:1})):(a(),m(_,{key:1,height:"32px"}))]),r("h4",{class:"ellipsis",style:{"max-width":"270px"},title:(te=w(t).chat_profile)==null?void 0:te.application_name},R((ae=w(t).chat_profile)==null?void 0:ae.application_name),9,Je)])])])),((le=w(t).chat_profile)==null?void 0:le.authentication_type)=="password"?(a(),m(q,{key:2,class:"login-card"},{default:i(()=>[r("h2",Xe,R(e.$t("views.applicationOverview.appInfo.LimitDialog.authenticationValue")),1),v(De)]),_:1})):(a(),m(q,{key:3,class:"login-card",style:{"--el-card-padding":"0"}},{default:i(()=>[!M.value&&(c.value==="LDAP"||c.value==="LOCAL")?(a(),g("h2",Ge,R(c.value=="LOCAL"?e.$t("views.login.title"):c.value),1)):b("",!0),!M.value&&(c.value==="LDAP"||c.value==="LOCAL")?(a(),g("div",We,[v(H,{class:"login-form",rules:F.value,model:n.value,ref_key:"loginFormRef",ref:k,onKeyup:be(U,["enter"])},{default:i(()=>[r("div",Ye,[v(p,{prop:"username"},{default:i(()=>[v($,{size:"large",class:"input-item",modelValue:n.value.username,"onUpdate:modelValue":o[0]||(o[0]=s=>n.value.username=s),placeholder:e.$t("views.login.loginForm.username.placeholder")},null,8,["modelValue","placeholder"])]),_:1})]),r("div",Ze,[v(p,{prop:"password"},{default:i(()=>[v($,{type:"password",size:"large",class:"input-item",modelValue:n.value.password,"onUpdate:modelValue":o[1]||(o[1]=s=>n.value.password=s),placeholder:e.$t("views.login.loginForm.password.placeholder"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1})]),c.value!=="LDAP"?(a(),g("div",eo,[v(p,{prop:"captcha"},{default:i(()=>[r("div",oo,[v($,{size:"large",class:"input-item",modelValue:n.value.captcha,"onUpdate:modelValue":o[2]||(o[2]=s=>n.value.captcha=s),placeholder:e.$t("views.login.loginForm.captcha.placeholder")},null,8,["modelValue","placeholder"]),r("img",{src:P.value,alt:"",height:"38",class:"ml-8 cursor border border-r-6",onClick:S},null,8,to)])]),_:1})])):b("",!0)]),_:1},8,["rules","model"]),v(Q,{size:"large",type:"primary",class:"w-full",onClick:U,loading:V.value},{default:i(()=>[ce(R(e.$t("views.login.buttons.login")),1)]),_:1},8,["loading"])])):b("",!0),M.value?(a(),g("div",ao,[v(Se,{tabs:W.value},null,8,["tabs"])])):b("",!0),l.value.length>1?(a(),g("div",lo,[r("span",null,R(e.$t("views.login.moreMethod")),1)])):b("",!0),r("div",so,[(a(!0),g(X,null,pe(l.value,s=>(a(),g(X,null,[s!=="LOCAL"&&c.value!==s&&s!=="QR_CODE"?(a(),m(Q,{circle:"",key:s,class:"login-button-circle color-secondary",onClick:E=>N(s)},{default:i(()=>{var E;return[r("span",{style:xe({"font-size":s==="OAUTH2"?"8px":"10px",color:(E=w(x).themeInfo)==null?void 0:E.theme})},R(s),5)]}),_:2},1032,["onClick"])):b("",!0),s==="QR_CODE"&&c.value!==s?(a(),m(Q,{circle:"",key:s,class:"login-button-circle color-secondary",onClick:o[3]||(o[3]=E=>N("QR_CODE"))},{default:i(()=>o[5]||(o[5]=[r("img",{src:$e,width:"25px"},null,-1)])),_:2,__:[5]},1024)):b("",!0),s==="LOCAL"&&c.value!="LOCAL"?(a(),m(Q,{circle:"",key:s,class:"login-button-circle color-secondary",style:{"font-size":"24px"},icon:"UserFilled",onClick:o[4]||(o[4]=E=>N("LOCAL"))})):b("",!0)],64))),256))])]),_:1}))])]}),_:1})),[[me,V.value]])}}}),ro=de(no,[["__scopeId","data-v-f368ed29"]]),uo=Object.freeze(Object.defineProperty({__proto__:null,default:ro},Symbol.toStringTag,{value:"Module"}));export{De as _,uo as a,Re as u};
