import{ay as se,aZ as ie,aA as ue,a_ as E,aB as r,aQ as re,aP as ce,aD as n,a$ as me,aE as d,aF as s,aG as o,aI as C,b0 as de,aH as t,aK as _,aJ as g,b1 as L,aR as D,aS as F,aT as I,b2 as O,b3 as pe,aC as ve}from"./admin-_EJ4kEIX.js";import{g as ge}from"./constant-JlVnlya9.js";const fe={class:"flex-between mb-16"},be={class:"flex-between complex-search"},_e={class:"color-text-primary lighter"},he={class:"dialog-footer mt-24"},Ve=se({__name:"index",props:{type:{}},setup(W,{expose:G}){const J=ie(),{user:P}=ue(),R=W,x=E(()=>J.path.includes("resource-management")?"systemManage":"workspace"),$=E(()=>ge()),h=r(!1),S=r();re(h,e=>{var l;e||(y.value="",c.value="nickname",i.value={nickname:"",username:"",permission:void 0},T.value=[],p.current_page=1,p.total=0,v.value=[],(l=S.value)==null||l.clearSelection())});const z=r(!1),y=r(""),T=r([]),c=r("nickname"),i=r({nickname:"",username:"",permission:void 0}),K=()=>{i.value={nickname:"",username:"",permission:void 0}},p=ce({current_page:1,page_size:20,total:0});function Q(){p.current_page=1,b()}function A(){p.current_page=1,b()}const v=r([]),Z=e=>{v.value=e},k=r(!1),f=r("");function q(){v.value.length!==0&&(k.value=!0)}function X(){if(v.value.length===0||!f.value)return;const e=v.value.map(l=>({userId:l.id,permission:f.value}));B(e),U()}function U(){var e;k.value=!1,f.value="",v.value=[],(e=S.value)==null||e.clearSelection()}function Y(e,l){const m=[{userId:l.id,permission:e}];B(m)}function B(e){const l=P.getWorkspaceId()||"default";O({type:"resourceAuthorization",systemType:x.value}).putResourceAuthorization(l,y.value,R.type,e,z).then(()=>{pe(ve("common.submitSuccess")),b()})}const b=()=>{const e=P.getWorkspaceId()||"default",l={};i.value[c.value]&&(l[c.value]=i.value[c.value]),O({type:"resourceAuthorization",systemType:x.value}).getResourceAuthorization(e,y.value,R.type,p,l,z).then(m=>{T.value=m.data.records||[],p.total=m.data.total||0})};return G({open:e=>{y.value=e,h.value=!0,b()}}),(e,l)=>{const m=n("el-button"),w=n("el-option"),M=n("el-select"),H=n("el-input"),V=n("el-table-column"),N=n("el-radio"),j=n("el-radio-group"),ee=n("app-table"),le=n("el-text"),ae=n("el-dialog"),oe=n("el-drawer"),te=me("loading");return s(),d(oe,{modelValue:h.value,"onUpdate:modelValue":l[6]||(l[6]=a=>h.value=a),title:e.$t("views.system.resourceAuthorization.title"),size:"60%","append-to-body":!0},{default:o(()=>[C("div",fe,[t(m,{type:"primary",disabled:v.value.length===0,onClick:q},{default:o(()=>[_(g(e.$t("views.system.resourceAuthorization.setting.configure")),1)]),_:1},8,["disabled"]),C("div",be,[t(M,{class:"complex-search__left",modelValue:c.value,"onUpdate:modelValue":l[0]||(l[0]=a=>c.value=a),style:{width:"100px"},onChange:K},{default:o(()=>[t(w,{label:e.$t("views.userManage.userForm.nickname.label"),value:"nickname"},null,8,["label"]),t(w,{label:e.$t("views.login.loginForm.username.label"),value:"username"},null,8,["label"]),t(w,{label:e.$t("views.model.modelForm.permissionType.label"),value:"permission"},null,8,["label"])]),_:1},8,["modelValue"]),c.value==="nickname"?(s(),d(H,{key:0,modelValue:i.value.nickname,"onUpdate:modelValue":l[1]||(l[1]=a=>i.value.nickname=a),onChange:A,placeholder:e.$t("common.search"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):L("",!0),c.value==="username"?(s(),d(H,{key:1,modelValue:i.value.username,"onUpdate:modelValue":l[2]||(l[2]=a=>i.value.username=a),onChange:A,placeholder:e.$t("common.search"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):c.value==="permission"?(s(),d(M,{key:2,modelValue:i.value.permission,"onUpdate:modelValue":l[3]||(l[3]=a=>i.value.permission=a),onChange:A,filterable:"",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"",style:{width:"220px"}},{default:o(()=>[(s(!0),D(F,null,I($.value,(a,u)=>(s(),d(w,{key:u,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):L("",!0)])]),de((s(),d(ee,{ref_key:"multipleTableRef",ref:S,class:"mt-16",data:T.value,"pagination-config":p,onSizeChange:Q,onChangePage:b,onSelectionChange:Z,maxTableHeight:200,"row-key":a=>a.id},{default:o(()=>[t(V,{type:"selection",width:"55","reserve-selection":!0}),t(V,{prop:"nickname",label:e.$t("views.userManage.userForm.nickname.label"),"min-width":"120","show-overflow-tooltip":""},null,8,["label"]),t(V,{prop:"username","min-width":"120","show-overflow-tooltip":"",label:e.$t("views.login.loginForm.username.label")},null,8,["label"]),t(V,{label:e.$t("common.operation"),align:"left",width:"340"},{default:o(({row:a})=>[t(j,{modelValue:a.permission,"onUpdate:modelValue":u=>a.permission=u,onChange:u=>Y(u,a)},{default:o(()=>[(s(!0),D(F,null,I($.value,(u,ne)=>(s(),d(N,{key:ne,value:u.value,class:"mr-16"},{default:o(()=>[_(g(u.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["label"])]),_:1},8,["data","pagination-config","row-key"])),[[te,z.value]]),t(ae,{modelValue:k.value,"onUpdate:modelValue":l[5]||(l[5]=a=>k.value=a),title:e.$t("views.system.resourceAuthorization.setting.configure"),"destroy-on-close":"",onClose:U},{footer:o(()=>[C("div",he,[t(m,{onClick:U},{default:o(()=>[_(g(e.$t("common.cancel")),1)]),_:1}),t(m,{type:"primary",onClick:X},{default:o(()=>[_(g(e.$t("common.confirm")),1)]),_:1})])]),default:o(()=>[t(j,{modelValue:f.value,"onUpdate:modelValue":l[4]||(l[4]=a=>f.value=a),class:"radio-block"},{default:o(()=>[(s(!0),D(F,null,I($.value,(a,u)=>(s(),d(N,{key:u,value:a.value,class:"mr-16"},{default:o(()=>[C("p",_e,g(a.label),1),t(le,{class:"color-secondary lighter"},{default:o(()=>[_(g(a.desc),1)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"])]),_:1},8,["modelValue","title"])}}});export{Ve as _};
