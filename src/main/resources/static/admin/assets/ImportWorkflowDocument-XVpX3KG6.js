import{ay as z,az as J,aP as Q,aB as d,aQ as W,aM as j,b9 as X,aD as y,b3 as Y,aT as C,aF as r,aI as k,aH as $,cM as Z,aJ as E,aG as i,b4 as ee,aE as c,cN as te,bD as ae,b8 as oe,aU as D,aK as f,aW as K,b6 as s,bN as n,bP as a,bO as ne,bG as se,bK as le,cx as re}from"./admin-DTQ9awQz.js";import{_ as ue,a as de}from"./KnowledgeBase.vue_vue_type_script_setup_true_lang-BwcJGRdl.js";import{_ as ie}from"./Result.vue_vue_type_script_setup_true_lang-C5iZDmn4.js";const ce={class:"upload-document p-12-24"},_e={class:"flex align-center mb-16"},me={style:{display:"inline-block"}},pe={class:"upload-document__main flex"},Ee={class:"upload-document__component main-calc-height"},ge={class:"upload-component p-24",style:{"min-width":"850px"}},ve={class:"upload-document__footer text-right border-t"},Re=z({__name:"ImportWorkflowDocument",setup(ke){se("upload",(e,l)=>re.postUploadFile(e,t,"KNOWLEDGE",l));const w=J(),g=Q(),b=d(0),{params:{folderId:_},query:{id:t}}=g,S=W(()=>g.path.includes("shared")?"systemShare":g.path.includes("resource-management")?"systemManage":"workspace"),T={dataSource:de,knowledgeBase:ue,result:ie},u=d(!1),m=d(),O=d(),R=d({}),o=d("dataSource"),p=d(null),A=W(()=>{var l,h;const e=(h=(l=p.value)==null?void 0:l.nodes)==null?void 0:h.find(N=>N.type===j.KnowledgeBase);return e?e.properties.userInputFieldList:[]}),I=()=>{m.value.validate().then(()=>{R.value[o.value]=m.value.get_data(),o.value="knowledgeBase"})},M=()=>{m.value.validate().then(()=>{o.value="dataSource"})},L=()=>{m.value.validate().then(()=>{R.value[o.value]=m.value.get_data(),K({type:"knowledge",systemType:S.value}).workflowUpload(t,R.value,u).then(e=>{O.value=e.data.id,o.value="result"})})};function G(){K({type:"knowledge",systemType:S.value}).getKnowledgeDetail(t,u).then(e=>{p.value=e.data.workFlow})}const U=()=>{o.value="dataSource",b.value++,O.value=void 0;const e=p.value;p.value=null,R.value={},le(()=>{p.value=e})},B=()=>{w.push({path:`/knowledge/${t}/${_}/2/document`})},P=()=>g.path.includes("resource-management")?w.push({path:x()}):g.path.includes("shared")?w.push({path:H()}):w.push({path:F()}),H=()=>s([n.ADMIN,a.SHARED_KNOWLEDGE_DOCUMENT_READ],"OR")?`/knowledge/${t}/shared/2/document`:s([n.ADMIN,a.SHARED_KNOWLEDGE_PROBLEM_READ],"OR")?`/knowledge/${t}/shared/2/problem`:s([n.ADMIN,a.SHARED_KNOWLEDGE_HIT_TEST_READ],"OR")?`/knowledge/${t}/shared/2/hit-test`:s([n.ADMIN,a.SHARED_KNOWLEDGE_CHAT_USER_READ],"OR")?`/knowledge/${t}/shared/2/chat-user`:s([n.ADMIN,a.SHARED_KNOWLEDGE_EDIT],"OR")?`/knowledge/${t}/shared/2/setting`:"/system/shared/knowledge",x=()=>s([n.ADMIN,a.RESOURCE_KNOWLEDGE_DOCUMENT_READ],"OR")?`/knowledge/${t}/resource-management/2/document`:s([n.ADMIN,a.RESOURCE_KNOWLEDGE_PROBLEM_READ],"OR")?`/knowledge/${t}/resource-management/2/problem`:s([n.ADMIN,a.RESOURCE_KNOWLEDGE_HIT_TEST],"OR")?`/knowledge/${t}/resource-management/2/hit-test`:s([n.ADMIN,a.RESOURCE_KNOWLEDGE_CHAT_USER_READ],"OR")?`/knowledge/${t}/resource-management/2/chat-user`:s([n.ADMIN,a.RESOURCE_KNOWLEDGE_EDIT],"OR")?`/knowledge/${t}/resource-management/2/setting`:"/system/resource-management/knowledge",F=()=>{const e=l=>s([new ne([n.USER],[a.KNOWLEDGE.getKnowledgeWorkspaceResourcePermission(t)],[],"AND"),n.WORKSPACE_MANAGE.getWorkspaceRole,l.getWorkspacePermissionWorkspaceManageRole,l.getKnowledgeWorkspaceResourcePermission(t)],"OR");return e(a.KNOWLEDGE_DOCUMENT_READ)?`/knowledge/${t}/${_}/2/document`:e(a.KNOWLEDGE_PROBLEM_READ)?`/knowledge/${t}/${_}/2/problem`:e(a.KNOWLEDGE_HIT_TEST_READ)?`/knowledge/${t}/${_}/2/hit-test`:e(a.KNOWLEDGE_CHAT_USER_READ)?`/knowledge/${t}/${_}/2/chat-user`:e(a.KNOWLEDGE_EDIT)?`/knowledge/${t}/${_}/2/setting`:"/knowledge"};return X(()=>{G()}),(e,l)=>{const h=y("el-scrollbar"),N=y("el-card"),v=y("el-button"),V=Y("loading");return r(),C("div",ce,[k("div",_e,[$(Z,{onClick:P,style:{"margin-left":"-4px"}}),k("h3",me,E(e.$t("views.document.importDocument")),1)]),$(N,{style:{"--el-card-padding":"0"}},{default:i(()=>[ee((r(),C("div",pe,[k("div",Ee,[$(h,null,{default:i(()=>[k("div",ge,[(r(),c(te,{key:b.value,include:["dataSource","knowledgeBase"]},[(r(),c(ae(T[o.value]),{ref_key:"ActionRef",ref:m,loading:u.value,"onUpdate:loading":l[0]||(l[0]=q=>u.value=q),workflow:p.value,knowledgeId:oe(t),id:O.value},null,40,["loading","workflow","knowledgeId","id"]))],1024))])]),_:1})])])),[[V,u.value]])]),_:1}),k("div",ve,[o.value=="result"?(r(),c(v,{key:0,onClick:U},{default:i(()=>[f(E(e.$t("views.document.buttons.continueImporting")),1)]),_:1})):D("",!0),A.value.length>0&&o.value=="knowledgeBase"?(r(),c(v,{key:1,loading:u.value,onClick:M},{default:i(()=>[f(E(e.$t("common.steps.prev")),1)]),_:1},8,["loading"])):D("",!0),A.value.length>0&&o.value=="dataSource"?(r(),c(v,{key:2,disabled:u.value,onClick:I},{default:i(()=>[f(E(e.$t("common.steps.next")),1)]),_:1},8,["disabled"])):D("",!0),(A.value.length>0?o.value=="knowledgeBase":o.value=="dataSource")?(r(),c(v,{key:3,onClick:L,type:"primary",disabled:u.value},{default:i(()=>[f(E(e.$t("views.document.buttons.import")),1)]),_:1},8,["disabled"])):D("",!0),o.value=="result"?(r(),c(v,{key:4,type:"primary",onClick:B},{default:i(()=>[f(E(e.$t("views.knowledge.ResultSuccess.buttons.toDocument")),1)]),_:1})):D("",!0)])])}}});export{Re as default};
