import{ec as Se,fj as ke,ed as ae,aJ as _e,aQ as ve,aP as ge,aR as D,cE as c,dP as Y,dN as T,dO as $,cZ as L,df as fe,cT as he,aS as l,aL as G,aM as n,aN as u,aX as s,aO as f,aT as v,aU as F,aV as b,dL as te,cI as o,cN as U,cG as re,cH as ce,eG as Ce,cJ as Ae,cK as Te,ew as $e,fk as De,cP as Ee,d4 as w,cF as Le,d0 as Me,dM as ee,cU as We,dx as Ne}from"./admin-CylDRYrg.js";import{g as Ue}from"./constant-DGIcxMTF.js";import{l as Ve}from"./permission-api--UfB0zkl.js";import"./system-CkhRQyt6.js";import"./workspace-JyzjqSWG.js";const q="/workspace",xe=(h,d,g,E,C,i)=>ae(`${q}/${h}/user_resource_permission/user/${d}/resource/${g}/${E.current_page}/${E.page_size}`,C,i),ze=(h,d,g,E,C)=>Se(`${q}/${h}/user_resource_permission/user/${d}/resource/${g}`,E,{},C),Ke=(h,d)=>ae(`${q}/${h}/user_list`,void 0,d),we=(h,d)=>ae(`${q}/${h}/user_member`,void 0,d),Ge=(h,d,g,E)=>d=="MODEL"?Promise.resolve(ke.success([{id:"default",name:"根目录",desc:null,parent_id:null,children:[]}])):ae(`${q}/${h}/${d}/folder`,g,E),ue={getResourceAuthorization:xe,putResourceAuthorization:ze,getUserList:Ke,getUserMember:we,getSystemFolder:Ge},Fe={class:"permission-setting p-24 flex"},je={class:"resource-authorization__table"},He={class:"mb-16"},Be={class:"flex-between mb-16"},Je={class:"flex-between complex-search"},qe=["src"],Qe=["innerHTML"],Xe=["title"],Ze={class:"color-text-primary lighter"},Ye={class:"dialog-footer mt-24"},et=_e({__name:"PermissionTable",props:{data:{},type:{},getData:{type:Function}},emits:["submitPermissions"],setup(h,{expose:d,emit:g}){const{model:E}=ve(),C=ge(),i=h,M=g,I=D(()=>Ue()),Q=c({APPLICATION:new Y([T.ADMIN,T.WORKSPACE_MANAGE],[$.APPLICATION_WORKSPACE_USER_RESOURCE_PERMISSION_EDIT,$.APPLICATION_WORKSPACE_USER_RESOURCE_PERMISSION_EDIT.getWorkspacePermissionWorkspaceManageRole],[],"OR"),KNOWLEDGE:new Y([T.ADMIN,T.WORKSPACE_MANAGE],[$.KNOWLEDGE_WORKSPACE_USER_RESOURCE_PERMISSION_EDIT,$.KNOWLEDGE_WORKSPACE_USER_RESOURCE_PERMISSION_EDIT.getWorkspacePermissionWorkspaceManageRole],[],"OR"),TOOL:new Y([T.ADMIN,T.WORKSPACE_MANAGE],[$.TOOL_WORKSPACE_USER_RESOURCE_PERMISSION_EDIT,$.TOOL_WORKSPACE_USER_RESOURCE_PERMISSION_EDIT.getWorkspacePermissionWorkspaceManageRole],[],"OR"),MODEL:new Y([T.ADMIN,T.WORKSPACE_MANAGE],[$.MODEL_WORKSPACE_USER_RESOURCE_PERMISSION_EDIT,$.MODEL_WORKSPACE_USER_RESOURCE_PERMISSION_EDIT.getWorkspacePermissionWorkspaceManageRole],[],"OR")}),j=D(()=>i.type===L.KNOWLEDGE),H=D(()=>i.type===L.APPLICATION),oe=D(()=>i.type===L.TOOL),V=D(()=>i.type===L.MODEL),X=c(),_=c("name"),y=c({name:"",permission:void 0}),se=()=>{y.value={name:"",permission:void 0}},W=fe({current_page:1,page_size:20,total:0});function B(){W.current_page=1,i.getData&&i.getData()}function P(){W.current_page=1,i.getData&&i.getData()}const A=c([]),le=a=>{A.value=a},x=c(!1),t=c("");function p(){A.value.length!==0&&(x.value=!0)}function m(){if(A.value.length===0||!t.value)return;const a=A.value.map(r=>({targetId:r.id,permission:t.value}));M("submitPermissions",a),O()}function O(){var a;x.value=!1,t.value="",A.value=[],(a=X.value)==null||a.clearSelection()}function z(a,r){const S=[{targetId:r.id,permission:a}];M("submitPermissions",S)}const N=c([]);function K(){E.asyncGetProvider().then(a=>{N.value=a==null?void 0:a.data})}const ne=D(()=>a=>{var r;return(r=N.value.find(S=>S.provider===a.icon))==null?void 0:r.icon});return he(()=>{V.value&&K()}),d({paginationConfig:W,searchForm:y,searchType:_}),(a,r)=>{var me;const S=l("el-button"),J=l("el-option"),k=l("el-select"),Z=l("el-input"),ie=l("el-table-column"),be=l("KnowledgeIcon"),ye=l("el-avatar"),Oe=l("el-space"),de=l("el-radio"),pe=l("el-radio-group"),Re=l("el-text"),Ie=l("el-dialog");return n(),G("div",Fe,[u("div",je,[u("h4",He,f(a.$t("views.system.resourceAuthorization.permissionSetting")),1),u("div",Be,[b(te)(Q.value[((me=b(C).meta)==null?void 0:me.resource)||"APPLICATION"],"OR")?(n(),v(S,{key:0,type:"primary",disabled:A.value.length===0,onClick:p},{default:o(()=>[U(f(a.$t("views.system.resourceAuthorization.setting.configure")),1)]),_:1},8,["disabled"])):F("",!0),u("div",Je,[s(k,{class:"complex-search__left",modelValue:_.value,"onUpdate:modelValue":r[0]||(r[0]=e=>_.value=e),style:{width:"80px"},onChange:se},{default:o(()=>[s(J,{label:a.$t("common.name"),value:"name"},null,8,["label"]),s(J,{label:a.$t("views.model.modelForm.permissionType.label"),value:"permission"},null,8,["label"])]),_:1},8,["modelValue"]),_.value==="name"?(n(),v(Z,{key:0,modelValue:y.value.name,"onUpdate:modelValue":r[1]||(r[1]=e=>y.value.name=e),onChange:P,placeholder:a.$t("common.searchBar.placeholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):_.value==="permission"?(n(),v(k,{key:1,modelValue:y.value.permission,"onUpdate:modelValue":r[2]||(r[2]=e=>y.value.permission=e),onChange:P,filterable:"",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"",style:{width:"220px"}},{default:o(()=>[(n(!0),G(re,null,ce(I.value,(e,R)=>(n(),v(J,{key:R,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):F("",!0)])]),s(Ce,{ref_key:"multipleTableRef",ref:X,class:"mt-16",data:i.data,"pagination-config":W,onSizeChange:B,onChangePage:i.getData,onSelectionChange:le,maxTableHeight:320,"row-key":e=>e.id},{default:o(()=>[s(ie,{type:"selection",width:"55","reserve-selection":!0}),s(ie,{prop:"name",label:a.$t("common.name")},{default:o(({row:e})=>[s(Oe,{size:8},{default:o(()=>[j.value?(n(),v(be,{key:0,size:20,type:e.icon},null,8,["type"])):b(Ae)(e==null?void 0:e.icon)&&!V.value?(n(),v(ye,{key:1,style:{background:"none"},shape:"square",size:20},{default:o(()=>[u("img",{src:b(Te)(e==null?void 0:e.icon),alt:""},null,8,qe)]),_:2},1024)):H.value?(n(),v($e,{key:2,height:"20px"})):oe.value?(n(),v(De,{key:3,size:20,type:e==null?void 0:e.toolType},null,8,["type"])):V.value?(n(),G("span",{key:4,style:{width:"20px",height:"20px",display:"inline-block"},innerHTML:ne.value(e)},null,8,Qe)):F("",!0),u("span",{title:e==null?void 0:e.name,class:"ellipsis-1"},f(e==null?void 0:e.name),9,Xe)]),_:2},1024)]),_:1},8,["label"]),s(ie,{label:a.$t("common.operation"),align:"left"},{default:o(({row:e})=>[s(pe,{modelValue:e.permission,"onUpdate:modelValue":R=>e.permission=R,onChange:R=>z(R,e)},{default:o(()=>[(n(!0),G(re,null,ce(I.value,(R,Pe)=>(n(),v(de,{key:Pe,value:R.value,class:"mr-16"},{default:o(()=>[U(f(R.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["label"])]),_:1},8,["data","pagination-config","onChangePage","row-key"])]),s(Ie,{modelValue:x.value,"onUpdate:modelValue":r[4]||(r[4]=e=>x.value=e),title:a.$t("views.system.resourceAuthorization.setting.configure"),"destroy-on-close":"",onClose:O},{footer:o(()=>[u("div",Ye,[s(S,{onClick:O},{default:o(()=>[U(f(a.$t("common.cancel")),1)]),_:1}),s(S,{type:"primary",onClick:m},{default:o(()=>[U(f(a.$t("common.confirm")),1)]),_:1})])]),default:o(()=>[s(pe,{modelValue:t.value,"onUpdate:modelValue":r[3]||(r[3]=e=>t.value=e),class:"radio-block"},{default:o(()=>[(n(!0),G(re,null,ce(I.value,(e,R)=>(n(),v(de,{key:R,value:e.value,class:"mr-16"},{default:o(()=>[u("p",Ze,f(e.label),1),s(Re,{class:"color-secondary lighter"},{default:o(()=>[U(f(e.desc),1)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"])])}}}),tt=Ee(et,[["__scopeId","data-v-3ee70972"]]),at={class:"resource-authorization p-16-24"},ot={class:"flex align-center mb-16"},st={class:"ml-4 color-text-primary"},lt={class:"flex"},nt={class:"resource-authorization__left border-r"},it={class:"p-24 pb-0"},rt={class:"mb-12"},ct={class:"list-height-left"},ut={class:"p-8-16"},dt={class:"flex-between"},pt={class:"flex"},mt=["title"],_t=_e({__name:"index",setup(h){const d=ge(),{user:g}=ve(),E=c(!1),C=c(!1),i=c([]),M=c([]),I=c(""),Q=c(""),j=c(""),H=c([]),oe=fe([{label:w("views.knowledge.title"),type:L.KNOWLEDGE},{label:w("views.application.title"),type:L.APPLICATION},{label:w("views.tool.title"),type:L.TOOL},{label:w("views.model.title"),type:L.MODEL}]),V=D(()=>{const t=d.path.lastIndexOf("/"),p=d.path.substring(t+1).toUpperCase();return oe.filter(m=>m.type===p)[0]});Le(j,t=>{t?M.value=i.value.filter(p=>p.nickname.toLowerCase().includes(t.toLowerCase())):M.value=i.value});function X(t){var m;const p=P.value||g.getWorkspaceId()||"default";ue.putResourceAuthorization(p,I.value,((m=d.meta)==null?void 0:m.resource)||"APPLICATION",t,C).then(()=>{Ne(w("common.submitSuccess")),y()})}const _=c(),y=()=>{var m;const t=P.value||g.getWorkspaceId()||"default",p={};_.value.searchForm[_.value.searchType]&&(p[_.value.searchType]=_.value.searchForm[_.value.searchType]),ue.getResourceAuthorization(t,I.value,((m=d.meta)==null?void 0:m.resource)||"APPLICATION",_.value.paginationConfig,p,C).then(O=>{H.value=O.data.records||[],_.value.paginationConfig.total=O.data.total||0})};function se(t){I.value=t.id,Q.value=t.type,y()}function W(t){const p=P.value||g.getWorkspaceId()||"default";ue.getUserMember(p,E).then(m=>{var O,z,N,K;i.value=m.data,M.value=m.data,i.value.length>0?(I.value=(z=(O=i.value)==null?void 0:O[0])==null?void 0:z.id,Q.value=(K=(N=i.value)==null?void 0:N[0])==null?void 0:K.type,y()):H.value=[]})}const B=c([]),P=c(""),A=D(()=>B.value.find(t=>t.id==P.value));async function le(){const t=await Ve("workspace").getSystemWorkspaceList(E);B.value=t.data,P.value=g.getWorkspaceId()||"default"}function x(t){P.value=t.id,W()}return he(()=>{g.isEE()&&le(),W()}),(t,p)=>{const m=l("el-breadcrumb-item"),O=l("el-breadcrumb"),z=l("el-divider"),N=l("WorkspaceDropdown"),K=l("el-input"),ne=l("el-text"),a=l("common-list"),r=l("el-scrollbar"),S=l("el-card"),J=Me("loading");return n(),G("div",at,[u("div",ot,[s(O,{"separator-icon":"ArrowRight"},{default:o(()=>[s(m,null,{default:o(()=>[U(f(b(w)("views.system.resourceAuthorization.title")),1)]),_:1}),s(m,null,{default:o(()=>[u("h5",st,f(V.value.label),1)]),_:1})]),_:1}),b(te)(b(ee).IS_EE,"OR")?(n(),v(z,{key:0,class:"ml-24",direction:"vertical"})):F("",!0),b(te)(b(ee).IS_EE,"OR")?(n(),v(N,{key:1,data:B.value,currentWorkspace:A.value,onChangeWorkspace:x},null,8,["data","currentWorkspace"])):F("",!0)]),s(S,{style:{"--el-card-padding":"0",height:"calc(100vh - 140px)"}},{default:o(()=>[u("div",lt,[u("div",nt,[u("div",it,[u("h4",rt,f(t.$t("views.system.resourceAuthorization.member")),1),s(K,{modelValue:j.value,"onUpdate:modelValue":p[0]||(p[0]=k=>j.value=k),placeholder:t.$t("common.search"),"prefix-icon":"Search",clearable:""},null,8,["modelValue","placeholder"])]),u("div",ct,[s(r,null,{default:o(()=>[u("div",ut,[We((n(),v(a,{data:M.value,onClick:se,"default-active":I.value},{default:o(({row:k})=>[u("div",dt,[u("div",pt,[u("span",{class:"mr-8 ellipsis-1",title:k.nickname},f(k.nickname),9,mt),b(te)([b(ee).IS_EE,b(ee).IS_PE],"OR")?(n(),v(ne,{key:0,class:"color-input-placeholder ellipsis-1",title:k.roles.join("，")},{default:o(()=>{var Z;return[U("("+f((Z=k.roles)==null?void 0:Z.join("，"))+")",1)]}),_:2},1032,["title"])):F("",!0)])])]),_:1},8,["data","default-active"])),[[J,E.value]])])]),_:1})])]),s(tt,{data:H.value,type:V.value.type,ref_key:"PermissionTableRef",ref:_,getData:y,onSubmitPermissions:X},null,8,["data","type"])])]),_:1})])}}}),bt=Ee(_t,[["__scopeId","data-v-957fbede"]]);export{bt as default};
