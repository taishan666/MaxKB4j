import{aJ as $e,aK as Ce,aP as Ve,aQ as xe,aR as Ue,cS as Ae,cE as d,df as Se,d5 as f,cF as Ne,cT as Te,ea as Le,aS as n,aL as S,aM as s,aX as o,cI as a,cN as v,aO as r,aV as b,aN as i,aT as c,aU as N,cG as J,cH as W,cJ as Pe,cK as Fe,cL as Me,cM as ze,cO as T,dI as ne,fg as R,d6 as Ee,dx as Ie,d4 as Re}from"./admin-BcxOdjvc.js";import{l as Be}from"./permission-api-DtxKZpmo.js";import"./workspace-BmcpoxFI.js";const Oe={class:"p-16-24"},Je={class:"ml-4 color-text-primary"},We={class:"flex-between mb-16"},De={class:"complex-search"},qe={class:"table-name flex align-center"},He=["src"],Ke={class:"filter"},Ge={class:"form-item mb-16"},Qe={class:"text-right"},Xe={key:0,class:"flex align-center"},je={class:"color-secondary"},Ye={key:1,class:"flex align-center"},Ze={class:"color-secondary"},ea={class:"filter"},aa={class:"form-item mb-16 ml-4"},la={class:"text-right"},ta={class:"mr-8"},oa={class:"mr-8"},ca=$e({__name:"ApplicationResourceIndex",setup(na){const se=Ce();Ve();const{user:D,application:ie}=xe(),_=Ue(()=>Ae.application.systemManage),re=()=>_.value.overview_read()||_.value.access_read()||_.value.edit()||_.value.chat_log_read()||_.value.chat_user_read()||_.value.auth(),ce=()=>_.value.export()||_.value.delete(),B=d([]);function pe(e){var p,V;(V=(p=e==null?void 0:e.work_flow)==null?void 0:p.nodes)==null||V.filter(u=>u.id==="base-node").map(u=>{B.value=u.properties.api_input_field_list?u.properties.api_input_field_list.map(m=>({name:m.variable,value:m.default_value})):u.properties.inputFieldList?u.properties.inputFieldList.filter(m=>m.assignment_method==="api_input").map(m=>({name:m.variable,value:m.default_value})):[]});const t=q(B.value)?"?"+q(B.value):"";R.getAccessToken(e.id,L).then(u=>{var m;window.open(ie.location+((m=u==null?void 0:u.data)==null?void 0:m.accessToken)+t)})}function q(e){const t=new URLSearchParams;return e.forEach(p=>{t.append(encodeURIComponent(p.name),encodeURIComponent(p.value))}),t.toString()}function ue(e){Ee(`${f("views.application.delete.confirmTitle")}${e.name} ?`,f("views.application.delete.confirmMessage"),{confirmButtonText:f("common.confirm"),cancelButtonText:f("common.cancel"),confirmButtonClass:"danger"}).then(()=>{R.delApplication(e.id,L).then(()=>{const t=P.value.findIndex(p=>p.id===e.id);P.value.splice(t,1),Ie(f("common.deleteSuccess"))})}).catch(()=>{})}const de=e=>{R.exportApplication(e.id,e.name,L).catch(t=>{t.response.status!==403&&t.response.data.text().then(p=>{Re(`${f("views.application.tip.ExportError")}:${JSON.parse(p).message}`)})})},y=d("name"),k=d({name:"",createUser:""}),H=d([]),L=d(!1),P=d([]),O=Se({current_page:1,page_size:20,total:0}),F=d([]),M=d(!1),w=d([]),z=d(!1),$=d([]),me=d([{label:f("views.application.status.published"),value:!0},{label:f("views.application.status.unpublished"),value:!1}]),x=d(""),E=d([]);Ne([()=>F.value,()=>x.value],()=>{x.value.length||(E.value=F.value),E.value=F.value.filter(e=>e.label.toLowerCase().includes(x.value.toLowerCase()))},{immediate:!0});function K(e){e==="clear"&&(w.value=[]),x.value="",C(),M.value=!1}function G(e){e==="clear"&&($.value=[]),C(),z.value=!1}async function ve(){if(D.isEE()){const e=await Be("workspace").getSystemWorkspaceList(L);F.value=e.data.map(t=>({label:t.name,value:t.id}))}}const _e=()=>{k.value={name:"",createUser:""}};function C(){const e={};k.value[y.value]&&(e[y.value]=k.value[y.value]),w.value.length>0&&(e.workspace_ids=JSON.stringify(w.value)),$.value.length>0&&(e.status=JSON.stringify($.value)),R.getApplication(O,e,L).then(t=>{var p,V;O.total=(p=t.data)==null?void 0:p.total,P.value=(V=t.data)==null?void 0:V.records})}return Te(()=>{ve(),C(),Le.getAllMemberList("").then(e=>{H.value=e.data})}),(e,t)=>{const p=n("el-breadcrumb-item"),V=n("el-breadcrumb"),u=n("el-option"),m=n("el-select"),Q=n("el-input"),X=n("el-avatar"),I=n("el-icon"),g=n("el-table-column"),j=n("el-tag"),Y=n("Filter"),h=n("el-button"),Z=n("el-checkbox"),ee=n("el-checkbox-group"),ae=n("el-popover"),fe=n("SuccessFilled"),U=n("AppIcon"),he=n("el-scrollbar"),be=n("el-empty"),le=n("el-tooltip"),te=n("el-dropdown-item"),ge=n("el-dropdown-menu"),ye=n("el-dropdown"),ke=n("app-table"),we=n("el-card");return s(),S("div",Oe,[o(V,{"separator-icon":"ArrowRight"},{default:a(()=>[o(p,null,{default:a(()=>[v(r(b(f)("views.system.resource_management.label")),1)]),_:1}),o(p,null,{default:a(()=>[i("h5",Je,r(b(f)("views.application.title")),1)]),_:1})]),_:1}),o(we,{class:"mt-16",style:{height:"calc(var(--app-main-height) + 20px)"}},{default:a(()=>[i("div",We,[i("div",De,[o(m,{class:"complex-search__left",modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=l=>y.value=l),style:{width:"120px"},onChange:_e},{default:a(()=>[o(u,{label:e.$t("common.creator"),value:"createUser"},null,8,["label"]),o(u,{label:e.$t("common.name"),value:"name"},null,8,["label"])]),_:1},8,["modelValue"]),y.value==="name"?(s(),c(Q,{key:0,modelValue:k.value.name,"onUpdate:modelValue":t[1]||(t[1]=l=>k.value.name=l),onChange:C,placeholder:e.$t("common.searchBar.placeholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):y.value==="createUser"?(s(),c(m,{key:1,modelValue:k.value.createUser,"onUpdate:modelValue":t[2]||(t[2]=l=>k.value.createUser=l),onChange:C,clearable:"",filterable:"",style:{width:"220px"}},{default:a(()=>[(s(!0),S(J,null,W(H.value,l=>(s(),c(u,{key:l.id,value:l.id,label:l.nickname},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):N("",!0)])]),o(ke,{data:P.value,"pagination-config":O,onSizeChange:C,onChangePage:C,maxTableHeight:260},{default:a(()=>[o(g,{width:"220",label:e.$t("common.name"),"show-overflow-tooltip":""},{default:a(l=>[i("div",qe,[o(I,{size:"24",class:"mr-8"},{default:a(()=>{var A;return[b(Pe)((A=l.row)==null?void 0:A.icon)?(s(),c(X,{key:0,shape:"square",size:24,style:{background:"none"},class:"mr-8"},{default:a(()=>{var oe;return[i("img",{src:b(Fe)((oe=l.row)==null?void 0:oe.icon),alt:""},null,8,He)]}),_:2},1024)):(s(),c(X,{key:1,class:"avatar-green",shape:"square",size:24},{default:a(()=>t[13]||(t[13]=[i("img",{src:Me,style:{width:"58%"},alt:""},null,-1)])),_:1,__:[13]}))]}),_:2},1024),v(" "+r(l.row.name),1)])]),_:1},8,["label"]),o(g,{prop:"toolType",label:e.$t("views.system.resource_management.type"),width:"160"},{default:a(l=>[b(ze)(l.row.type)?(s(),c(j,{key:0,type:"warning",style:{height:"22px"}},{default:a(()=>[v(r(e.$t("views.application.workflow")),1)]),_:1})):(s(),c(j,{key:1,class:"blue-tag",style:{height:"22px"}},{default:a(()=>[v(r(e.$t("views.application.simple")),1)]),_:1}))]),_:1},8,["label"]),o(g,{width:"150",prop:"isPublish",label:e.$t("common.status.label"),"show-overflow-tooltip":""},{header:a(()=>[i("div",null,[i("span",null,r(e.$t("common.status.label")),1),o(ae,{width:100,trigger:"click",visible:z.value},{reference:a(()=>[o(h,{style:{"margin-top":"-2px"},type:$.value&&$.value.length>0?"primary":"",link:"",onClick:t[3]||(t[3]=l=>z.value=!z.value)},{default:a(()=>[o(I,null,{default:a(()=>[o(Y)]),_:1})]),_:1},8,["type"])]),default:a(()=>[i("div",Ke,[i("div",Ge,[i("div",{onClick:t[5]||(t[5]=T(()=>{},["stop"]))},[o(ee,{modelValue:$.value,"onUpdate:modelValue":t[4]||(t[4]=l=>$.value=l),style:{display:"flex","flex-direction":"column"}},{default:a(()=>[(s(!0),S(J,null,W(me.value,l=>(s(),c(Z,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])]),i("div",Qe,[o(h,{size:"small",onClick:t[6]||(t[6]=l=>G("clear"))},{default:a(()=>[v(r(e.$t("common.clear")),1)]),_:1}),o(h,{type:"primary",onClick:G,size:"small"},{default:a(()=>[v(r(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"])])]),default:a(l=>[l.row.isPublish?(s(),S("div",Xe,[o(I,{class:"color-success mr-8",style:{"font-size":"16px"}},{default:a(()=>[o(fe)]),_:1}),i("span",je,r(e.$t("views.application.status.published")),1)])):(s(),S("div",Ye,[o(U,{iconName:"app-disabled",class:"color-secondary mr-8"}),i("span",Ze,r(e.$t("views.application.status.unpublished")),1)]))]),_:1},8,["label"]),b(D).isEE()?(s(),c(g,{key:0,width:"150",prop:"workspace_name",label:e.$t("views.workspace.title"),"show-overflow-tooltip":""},{header:a(()=>[i("div",null,[i("span",null,r(e.$t("views.workspace.title")),1),o(ae,{width:200,trigger:"click",visible:M.value},{reference:a(()=>[o(h,{style:{"margin-top":"-2px"},type:w.value&&w.value.length>0?"primary":"",link:"",onClick:t[7]||(t[7]=l=>M.value=!M.value)},{default:a(()=>[o(I,null,{default:a(()=>[o(Y)]),_:1})]),_:1},8,["type"])]),default:a(()=>[i("div",ea,[i("div",aa,[i("div",{onClick:t[10]||(t[10]=T(()=>{},["stop"]))},[o(Q,{modelValue:x.value,"onUpdate:modelValue":t[8]||(t[8]=l=>x.value=l),placeholder:e.$t("common.search"),"prefix-icon":"Search",clearable:""},null,8,["modelValue","placeholder"]),E.value.length?(s(),c(he,{key:0,height:"300"},{default:a(()=>[o(ee,{modelValue:w.value,"onUpdate:modelValue":t[9]||(t[9]=l=>w.value=l),style:{display:"flex","flex-direction":"column"}},{default:a(()=>[(s(!0),S(J,null,W(E.value,l=>(s(),c(Z,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):(s(),c(be,{key:1,description:e.$t("common.noData")},null,8,["description"]))])])]),i("div",la,[o(h,{size:"small",onClick:t[11]||(t[11]=l=>K("clear"))},{default:a(()=>[v(r(e.$t("common.clear")),1)]),_:1}),o(h,{type:"primary",onClick:K,size:"small"},{default:a(()=>[v(r(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"])])]),_:1},8,["label"])):N("",!0),o(g,{prop:"nickname",label:e.$t("common.creator"),"show-overflow-tooltip":""},null,8,["label"]),o(g,{label:e.$t("views.application.publishTime"),width:"180"},{default:a(({row:l})=>[v(r(b(ne)(l.update_time)),1)]),_:1},8,["label"]),o(g,{label:e.$t("common.createTime"),width:"180"},{default:a(({row:l})=>[v(r(b(ne)(l.createTime)),1)]),_:1},8,["label"]),o(g,{label:e.$t("common.operation"),align:"left",width:"120",fixed:"right"},{default:a(({row:l})=>[o(le,{effect:"dark",content:e.$t("views.application.operation.toChat"),placement:"top"},{default:a(()=>[i("span",ta,[o(h,{type:"primary",text:"",title:e.$t("views.application.operation.toChat"),onClick:T(A=>pe(l),["stop"])},{default:a(()=>[o(U,{iconName:"app-create-chat"})]),_:2},1032,["title","onClick"])])]),_:2},1032,["content"]),re()?(s(),c(le,{key:0,effect:"dark",content:e.$t("views.system.resource_management.management"),placement:"top"},{default:a(()=>[i("span",oa,[o(h,{type:"primary",text:"",title:e.$t("views.system.resource_management.management"),onClick:A=>b(se).push({path:`/application/resource-management/${l.id}/${l.type}/overview`})},{default:a(()=>[o(U,{iconName:"app-admin-operation"})]),_:2},1032,["title","onClick"])])]),_:2},1032,["content"])):N("",!0),ce()?(s(),c(ye,{key:1,trigger:"click"},{dropdown:a(()=>[o(ge,null,{default:a(()=>[_.value.export()?(s(),c(te,{key:0,onClick:T(A=>de(l),["stop"])},{default:a(()=>[o(U,{iconName:"app-export",class:"color-secondary"}),v(" "+r(e.$t("common.export")),1)]),_:2},1032,["onClick"])):N("",!0),_.value.delete()?(s(),c(te,{key:1,onClick:T(A=>ue(l),["stop"])},{default:a(()=>[o(U,{iconName:"app-delete",class:"color-secondary"}),v(" "+r(e.$t("common.delete")),1)]),_:2},1032,["onClick"])):N("",!0)]),_:2},1024)]),default:a(()=>[o(h,{text:"",onClick:t[12]||(t[12]=T(()=>{},["stop"]))},{default:a(()=>[o(U,{iconName:"app-more"})]),_:1})]),_:2},1024)):N("",!0)]),_:1},8,["label"])]),_:1},8,["data","pagination-config"])]),_:1})])}}});export{ca as default};
