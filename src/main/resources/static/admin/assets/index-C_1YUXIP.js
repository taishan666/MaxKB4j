import{aJ as G,cE as i,e3 as fe,aS as l,d0 as z,aT as W,aM as b,cI as n,aN as _,aX as a,cN as U,aO as C,cU as D,e9 as ve,d4 as r,dt as j,db as te,cT as ae,cF as ne,aL as J,cG as ke,aV as y,dM as ee,dK as I,dL as N,aU as q,cO as L,d5 as X,cP as le,cW as we,dI as oe}from"./admin-B8yAtLQA.js";import{_ as be}from"./MemberFormContent.vue_vue_type_script_setup_true_lang-BN4h13V6.js";import{R as ge}from"./system-CkhRQyt6.js";import{l as O}from"./permission-api-DE36sdM7.js";import"./workspace-DrAxOqdY.js";const he={style:{flex:"auto"}},$e=G({__name:"AddMemberDrawer",props:{currentWorkspace:{}},emits:["refresh"],setup(K,{expose:g,emit:$}){const v=K,k=$,m=i(!1),d=i(!1),f=i([]),R=i(!1),E=i([]),M=i([]),V=i([]);async function u(){var e;try{const s=await ve.getUserList(R);M.value=[{path:"user_ids",label:r("views.role.member.title"),rules:[{required:!0,message:`${r("common.selectPlaceholder")}${r("views.role.member.title")}`}],selectProps:{options:((e=s.data)==null?void 0:e.map(p=>({label:p.nickname,value:p.id})))||[],placeholder:`${r("common.selectPlaceholder")}${r("views.role.member.title")}`}}]}catch(s){console.error(s)}}async function t(){var e;try{const s=await O("workspace").getWorkspaceRoleList(R);V.value=[{path:"role_ids",label:r("views.role.member.role"),rules:[{required:!0,message:`${r("common.selectPlaceholder")}${r("views.role.member.role")}`}],selectProps:{options:((e=s.data.filter(p=>p.type!==ge.ADMIN))==null?void 0:e.map(p=>({label:p.name,value:p.id})))||[],placeholder:`${r("common.selectPlaceholder")}${r("views.role.member.role")}`}}]}catch(s){console.error(s)}}function c(){E.value=[...M.value,...V.value],f.value=[{user_ids:[],role_ids:[]}]}fe(async()=>{await u(),await t(),c()});function h(){c(),d.value=!0}function w(){d.value=!1}const P=i();function o(){var e;(e=P.value)==null||e.validate().then(async s=>{var p;s&&(await O("workspace").CreateWorkspaceMember((p=v.currentWorkspace)==null?void 0:p.id,f.value,m),j(r("common.addSuccess")),w(),k("refresh"))})}return g({open:h}),(e,s)=>{const p=l("el-button"),F=l("el-drawer"),B=z("loading");return b(),W(F,{modelValue:d.value,"onUpdate:modelValue":s[2]||(s[2]=S=>d.value=S),size:"600","destroy-on-close":!0,"before-close":w},{header:n(()=>[_("h4",null,C(e.$t("views.role.member.add")),1)]),default:n(()=>[D(a(be,{ref_key:"memberFormContentRef",ref:P,models:E.value,form:f.value,"onUpdate:form":s[0]||(s[0]=S=>f.value=S),keepOneLine:""},null,8,["models","form"]),[[B,R.value]])]),footer:n(()=>[_("div",he,[a(p,{onClick:w},{default:n(()=>[U(C(e.$t("common.cancel")),1)]),_:1}),a(p,{type:"primary",onClick:s[1]||(s[1]=S=>o()),loading:m.value},{default:n(()=>[U(C(e.$t("common.add")),1)]),_:1},8,["loading"])])]),_:1},8,["modelValue"])}}}),Ce={class:"flex-between mb-16"},ye={class:"flex complex-search"},We=G({__name:"Member",props:{currentWorkspace:{}},setup(K){const g=K,$=i(!1),v=i("username"),k=i({username:"",nickname:""}),m=te({current_page:1,page_size:20,total:0}),d=i([]);async function f(){var t,c;if((t=g.currentWorkspace)!=null&&t.id)try{const h={[v.value]:k.value[v.value]},w=await O("workspace").getWorkspaceMemberList((c=g.currentWorkspace)==null?void 0:c.id,m,h,$);d.value=w.data.records,m.total=w.data.total}catch(h){console.error(h)}}function R(){m.current_page=1,f()}ae(()=>{f()}),ne(()=>{var t;return(t=g.currentWorkspace)==null?void 0:t.id},()=>{f()});const E=({row:t,column:c,rowIndex:h,columnIndex:w})=>{if(c.property==="nickname"||c.property==="username"){const P=d.value.filter(o=>o.dialogueNumber===t.dialogueNumber);return h===d.value.findIndex(o=>o.dialogueNumber===t.dialogueNumber)?{rowspan:P.length,colspan:1}:{rowspan:0,colspan:0}}},M=i();function V(){var t;(t=M.value)==null||t.open()}function u(t){X(`${r("views.workspace.member.delete.confirmTitle")}${t.nickname} ?`,"",{confirmButtonText:r("common.confirm"),confirmButtonClass:"danger"}).then(()=>{var c;$.value=!0,O("workspace").deleteWorkspaceMember((c=g.currentWorkspace)==null?void 0:c.id,t.user_relation_id,$).then(()=>{j(r("common.deleteSuccess")),f()})}).catch(()=>{})}return(t,c)=>{const h=l("el-button"),w=l("el-option"),P=l("el-select"),o=l("el-input"),e=l("el-table-column"),s=l("AppIcon"),p=l("el-tooltip"),F=l("app-table"),B=z("hasPermission"),S=z("loading");return b(),J(ke,null,[_("div",Ce,[D((b(),W(h,{type:"primary",onClick:V},{default:n(()=>[U(C(t.$t("views.role.member.add")),1)]),_:1})),[[B,new(y(ee))([y(I).ADMIN,y(I).WORKSPACE_MANAGE.getWorkspaceRole],[y(N).WORKSPACE_ADD_MEMBER,y(N).WORKSPACE_WORKSPACE_ADD_MEMBER.getWorkspacePermissionWorkspaceManageRole],[],"OR")]]),_("div",ye,[a(P,{class:"complex-search__left",modelValue:v.value,"onUpdate:modelValue":c[0]||(c[0]=A=>v.value=A),style:{width:"120px"}},{default:n(()=>[a(w,{label:t.$t("views.login.loginForm.username.label"),value:"username"},null,8,["label"]),a(w,{label:t.$t("views.userManage.userForm.nickname.label"),value:"nickname"},null,8,["label"])]),_:1},8,["modelValue"]),v.value==="username"?(b(),W(o,{key:0,modelValue:k.value.username,"onUpdate:modelValue":c[1]||(c[1]=A=>k.value.username=A),onChange:f,placeholder:t.$t("common.inputPlaceholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):v.value==="nickname"?(b(),W(o,{key:1,modelValue:k.value.nickname,"onUpdate:modelValue":c[2]||(c[2]=A=>k.value.nickname=A),onChange:f,placeholder:t.$t("common.inputPlaceholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):q("",!0)])]),D((b(),W(F,{data:d.value,"pagination-config":m,onSizeChange:R,onChangePage:f,class:"member-table","span-method":E,maxTableHeight:320},{default:n(()=>[a(e,{prop:"nickname",label:t.$t("views.userManage.userForm.nickname.label")},null,8,["label"]),a(e,{prop:"username",label:t.$t("views.login.loginForm.username.label")},null,8,["label"]),a(e,{prop:"role_name",label:t.$t("views.role.member.role")},null,8,["label"]),a(e,{label:t.$t("common.operation"),width:"100",fixed:"right"},{default:n(({row:A})=>[a(p,{effect:"dark",content:`${t.$t("views.role.member.delete.button")}`,placement:"top"},{default:n(()=>[D((b(),W(h,{type:"primary",text:"",onClick:L(H=>u(A),["stop"])},{default:n(()=>[a(s,{iconName:"app-delete-users"})]),_:2},1032,["onClick"])),[[B,new(y(ee))([y(I).ADMIN,y(I).WORKSPACE_MANAGE.getWorkspaceRole],[y(N).WORKSPACE_REMOVE_MEMBER,y(N).WORKSPACE_WORKSPACE_REMOVE_MEMBER.getWorkspacePermissionWorkspaceManageRole],[],"OR")]])]),_:2},1032,["content"])]),_:1},8,["label"])]),_:1},8,["data","pagination-config"])),[[S,$.value]]),a($e,{ref_key:"addMemberDrawerRef",ref:M,currentWorkspace:g.currentWorkspace,onRefresh:f},null,8,["currentWorkspace"])],64)}}}),Re=le(We,[["__scopeId","data-v-aaaa1da4"]]),Me={class:"dialog-footer"},Pe=G({__name:"CreateOrUpdateWorkspaceDialog",emits:["refresh"],setup(K,{expose:g,emit:$}){const v=$,k=i(!1),m={name:""},d=i({...m});function f(u){u?d.value={id:u.id,name:u.name}:d.value={...m},k.value=!0}const R=i(),E=te({name:[{required:!0,message:`${r("common.inputPlaceholder")}${r("views.workspace.name")}`,trigger:"blur"}]}),M=i(!1),V=async u=>{u&&await u.validate(t=>{t&&O("workspace").CreateOrUpdateWorkspace(d.value,M).then(c=>{j(d.value.id?r("common.renameSuccess"):r("common.createSuccess")),v("refresh",c.data),k.value=!1})})};return g({open:f}),(u,t)=>{const c=l("el-input"),h=l("el-form-item"),w=l("el-form"),P=l("el-button"),o=l("el-dialog");return b(),W(o,{title:`${d.value.id?u.$t("common.rename"):u.$t("common.create")}${u.$t("views.workspace.title")}`,modelValue:k.value,"onUpdate:modelValue":t[4]||(t[4]=e=>k.value=e),"close-on-click-modal":!1,"close-on-press-escape":!1,"destroy-on-close":!0},{footer:n(()=>[_("span",Me,[a(P,{onClick:t[2]||(t[2]=L(e=>k.value=!1,["prevent"]))},{default:n(()=>[U(C(u.$t("common.cancel")),1)]),_:1}),a(P,{type:"primary",onClick:t[3]||(t[3]=e=>V(R.value)),loading:M.value},{default:n(()=>[U(C(d.value.id?u.$t("common.save"):u.$t("common.create")),1)]),_:1},8,["loading"])])]),default:n(()=>[a(w,{"label-position":"top",ref_key:"formRef",ref:R,rules:E,model:d.value,"require-asterisk-position":"right",onSubmit:t[1]||(t[1]=L(()=>{},["prevent"]))},{default:n(()=>[a(h,{label:u.$t("views.workspace.name"),prop:"name"},{default:n(()=>[a(c,{modelValue:d.value.name,"onUpdate:modelValue":t[0]||(t[0]=e=>d.value.name=e),maxlength:"64","show-word-limit":"",placeholder:`${u.$t("common.inputPlaceholder")}${u.$t("views.workspace.name")}`},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])}}}),Ae={class:"workspace-manage p-16-24"},Ee={class:"mb-16"},Ve={class:"flex main-calc-height"},Se={class:"workspace-left border-r"},De={class:"p-24 pb-0"},Oe={class:"flex-between mb-12"},Ie={class:"medium"},Ne={class:"list-height-left"},Ue={class:"p-8-16"},Fe={class:"flex-between"},Be=["title"],Te={class:"workspace-right p-24"},Le={class:"flex align-center mb-16"},Ke={class:"medium"},xe={class:"color-input-placeholder ml-4"},ze=G({__name:"index",setup(K){const g=i(""),$=i(!1),v=i([]),k=i([]),m=i();async function d(){try{const o=await O("workspace").getSystemWorkspaceList($);v.value=o.data,k.value=M(v.value,g.value)}catch(o){console.error(o)}}ae(async()=>{await d(),m.value=v.value[0]});const f=()=>oe([I.ADMIN,N.WORKSPACE_EDIT],"OR"),R=()=>oe([I.ADMIN,N.WORKSPACE_DELETE],"OR");async function E(o){await d(),o?m.value=o:m.value=v.value.find(e=>{var s;return e.id===((s=m.value)==null?void 0:s.id)})}function M(o,e){return e.length?o.filter(s=>s.name.toLowerCase().includes(e.toLowerCase())):o}ne(g,o=>{k.value=M(v.value,o)});function V(o){m.value=o}const u=i();function t(o){var e;(e=u.value)==null||e.open(o)}async function c(o){try{return await O("workspace").deleteWorkspaceCheck(o)}catch(e){console.log(e)}}async function h(o){const e=await c(o.id);(e?e.data.can_delete:!0)?X(`${r("views.workspace.delete.confirmTitle")}${o.name} ?`,r("views.workspace.delete.confirmContent"),{confirmButtonText:r("common.confirm"),confirmButtonClass:"danger"}).then(()=>{O("workspace").deleteWorkspace(o.id,$).then(async()=>{var p;j(r("common.deleteSuccess")),await d(),m.value=o.id===((p=m.value)==null?void 0:p.id)?v.value[0]:m.value})}):X(`${r("views.workspace.delete.confirmTitle")}${o.name} ?`,e?e.data.message:r("views.workspace.delete.confirmContent"),{showConfirmButton:!1,cancelButtonText:r("common.close")})}const w=i("");function P(o){w.value=o.id}return(o,e)=>{const s=l("Plus"),p=l("el-icon"),F=l("el-button"),B=l("el-tooltip"),S=l("el-input"),A=l("AppIcon"),H=l("el-dropdown-item"),se=l("el-dropdown-menu"),re=l("el-dropdown"),ce=l("common-list"),ie=l("el-scrollbar"),me=l("el-divider"),de=l("UserFilled"),ue=l("el-card"),pe=z("hasPermission"),Q=z("loading");return b(),J("div",Ae,[_("h2",Ee,C(o.$t("views.workspace.title")),1),a(ue,{style:{"--el-card-padding":"0"}},{default:n(()=>{var Y,Z;return[_("div",Ve,[_("div",Se,[_("div",De,[_("div",Oe,[_("h4",Ie,C(o.$t("views.workspace.list")),1),a(B,{effect:"dark",content:`${o.$t("common.create")}${o.$t("views.workspace.title")}`,placement:"top"},{default:n(()=>[D((b(),W(F,{type:"primary",text:"",onClick:e[0]||(e[0]=x=>t())},{default:n(()=>[a(p,{size:18},{default:n(()=>[a(s)]),_:1})]),_:1})),[[pe,[y(I).ADMIN,y(N).WORKSPACE_CREATE]]])]),_:1},8,["content"])]),a(S,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=x=>g.value=x),placeholder:o.$t("common.search"),"prefix-icon":"Search",clearable:""},null,8,["modelValue","placeholder"])]),_("div",Ne,[D((b(),W(ie,null,{default:n(()=>{var x;return[_("div",Ue,[a(ce,{data:k.value,onClick:V,"default-active":(x=m.value)==null?void 0:x.id,onMouseenter:P,onMouseleave:e[3]||(e[3]=T=>w.value="")},{default:n(({row:T})=>[_("div",Fe,[_("span",{class:"ellipsis",title:T.name},C(T.name),9,Be),D(_("div",{onClick:e[2]||(e[2]=L(()=>{},["stop"]))},[f()||R()?(b(),W(re,{key:0,teleported:!1,trigger:"click"},{dropdown:n(()=>[a(se,{style:{"min-width":"80px"}},{default:n(()=>[f()?(b(),W(H,{key:0,onClick:L(_e=>t(T),["stop"]),class:"p-8"},{default:n(()=>[a(A,{iconName:"app-edit",class:"color-secondary"}),U(" "+C(o.$t("common.rename")),1)]),_:2},1032,["onClick"])):q("",!0),R()?(b(),W(H,{key:1,onClick:L(_e=>h(T),["stop"]),class:"border-t p-8"},{default:n(()=>[a(A,{iconName:"app-delete",class:"color-secondary"}),U(" "+C(o.$t("common.delete")),1)]),_:2},1032,["onClick"])):q("",!0)]),_:2},1024)]),default:n(()=>[a(F,{text:""},{default:n(()=>[a(A,{iconName:"app-more"})]),_:1})]),_:2},1024)):q("",!0)],512),[[we,w.value===T.id]])])]),empty:n(()=>e[4]||(e[4]=[_("span",null,null,-1)])),_:1},8,["data","default-active"])])]}),_:1})),[[Q,$.value]])])]),D((b(),J("div",Te,[_("div",Le,[_("h4",Ke,C((Y=m.value)==null?void 0:Y.name),1),a(me,{direction:"vertical",class:"mr-8 ml-8"}),a(p,{class:"color-input-placeholder"},{default:n(()=>[a(de)]),_:1}),_("span",xe,C((Z=m.value)==null?void 0:Z.user_count),1)]),a(Re,{currentWorkspace:m.value},null,8,["currentWorkspace"])])),[[Q,$.value]])])]}),_:1}),a(Pe,{ref_key:"createOrUpdateWorkspaceDialogRef",ref:u,onRefresh:E},null,512)])}}}),Xe=le(ze,[["__scopeId","data-v-e3d7ac94"]]);export{Xe as default};
