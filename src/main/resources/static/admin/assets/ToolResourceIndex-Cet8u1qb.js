import{aJ as Se,aQ as xe,cE as d,df as Ue,aR as Fe,cS as Ie,cF as Me,cT as Re,e9 as Be,aS as n,aL as N,aM as s,aX as o,cI as a,cN as h,aO as u,aV as A,d5 as m,aN as c,aT as r,aU as _,cG as ee,cH as te,cK as Pe,cL as De,d1 as b,cO as g,dI as le,fi as v,d4 as Ee,d6 as oe,dx as ae,c$ as ze}from"./admin-B6VfIzX8.js";import{_ as Oe,a as je,b as Je}from"./ToolFormDrawer.vue_vue_type_script_setup_true_lang-CovVckF5.js";import{l as We}from"./permission-api-1dUlRgrk.js";import"./FieldFormDialog.vue_vue_type_script_setup_true_lang-DVVsm00I.js";import"./workspace-BhW8Tcd4.js";var ne=(F=>(F.CUSTOM="common.custom",F.INTERNAL="views.tool.toolStore.internal",F))(ne||{});const qe={class:"resource-manage_tool p-16-24"},He={class:"ml-4 color-text-primary"},Ge={class:"flex-between mb-16"},Ke={class:"complex-search"},Qe={class:"table-name flex align-center"},Xe=["src"],Ye={key:0},Ze={key:1},et={key:0,class:"flex align-center"},tt={class:"color-secondary"},lt={key:1,class:"flex align-center"},ot={class:"color-secondary"},at={class:"filter"},nt={class:"form-item mb-16 ml-4"},st={class:"text-right"},it={class:"mr-8"},ct={class:"mr-8"},rt={class:"mr-8"},_t=Se({__name:"ToolResourceIndex",setup(F){const{user:W}=xe(),k=d("name"),$=d({name:"",createUser:""}),q=d([]),L=d(!1),S=d(!1),H=d([]),x=Ue({current_page:1,page_size:20,total:0}),I=d([]),M=d(!1),T=d([]),f=Fe(()=>Ie.tool.systemManage),se=e=>{var t;return f.value.export()||f.value.delete()||((t=e.initFieldList)==null?void 0:t.length)>0&&f.value.edit()};function ie(e){v.exportTool(e.id,e.name,L).catch(t=>{t.response.status!==403&&t.response.data.text().then(i=>{Ee(`${m("views.application.tip.ExportError")}:${JSON.parse(i).message}`)})})}function ce(e){oe(`${m("views.tool.delete.confirmTitle")}ï¼š${e.name} ?`,m("views.tool.delete.confirmMessage"),{confirmButtonText:m("common.confirm"),cancelButtonText:m("common.cancel"),confirmButtonClass:"danger"}).then(()=>{v.delTool(e.id,L).then(()=>{p(),ae(m("common.deleteSuccess"))})}).catch(()=>{})}function re(e){v.getToolById(e==null?void 0:e.id,S).then(t=>{D.value.open(t.data)})}async function de(e){P.value=m("views.tool.copyTool");const t=await v.getToolById(e.id,S),i=ze.cloneDeep(t.data);delete i.id,i.name=i.name+`  ${m("common.copyTitle")}`,R.value.open(i)}const R=d(),P=d("");function me(e){e!=null&&e.template_id||(P.value=m("views.tool.editTool"),e?v.getToolById(e==null?void 0:e.id,L).then(t=>{R.value.open(t.data)}):R.value.open(e))}const G=d();function ue(e,t){var i;(i=G.value)==null||i.open(e,t)}function pe(e,t){t&&v.putTool(e==null?void 0:e.id,{name:e.name},L).then(i=>{ae(m("common.saveSuccess")),E()})}const D=d();async function fe(e){if(e.isActive)oe(`${m("views.tool.disabled.confirmTitle")}${e.name} ?`,m("views.tool.disabled.confirmMessage"),{confirmButtonText:m("common.status.disable"),confirmButtonClass:"danger"}).then(()=>{const t={isActive:!e.isActive};v.putTool(e.id,t,S).then(()=>(p(),!0)).catch(()=>!1)});else{const t=await v.getToolById(e.id,S);if((!t.data.initParams||Object.keys(t.data.initParams).length===0)&&t.data.initFieldList&&t.data.initFieldList.length>0&&t.data.initFieldList.filter(C=>C.default_value&&C.show_default_value).length!==t.data.initFieldList.length)return D.value.open(t.data,!e.isActive),!1;const i={isActive:!e.isActive};v.putTool(e.id,i,S).then(()=>(p(),!0)).catch(()=>!1)}}const U=d(""),B=d([]);Me([()=>I.value,()=>U.value],()=>{U.value.length||(B.value=I.value),B.value=I.value.filter(e=>e.label.toLowerCase().includes(U.value.toLowerCase()))},{immediate:!0});function K(e){e==="clear"&&(T.value=[]),p(),M.value=!1}async function _e(){if(W.isEE()){const e=await We("workspace").getSystemWorkspaceList(L);I.value=e.data.map(t=>({label:t.name,value:t.id}))}}const ve=()=>{$.value={name:"",createUser:""}};function p(){const e={};$.value[k.value]&&(e[k.value]=$.value[k.value]),T.value.length>0&&(e.workspace_ids=JSON.stringify(T.value)),v.getToolListPage(x,e,L).then(t=>{var i,C;x.total=(i=t.data)==null?void 0:i.total,H.value=(C=t.data)==null?void 0:C.records})}function E(e){e||(x.total=0,x.current_page=1),p()}return Re(()=>{_e(),p(),Be.getAllMemberList("").then(e=>{q.value=e.data})}),(e,t)=>{const i=n("el-breadcrumb-item"),C=n("el-breadcrumb"),z=n("el-option"),Q=n("el-select"),X=n("el-input"),Y=n("el-avatar"),O=n("el-icon"),y=n("el-table-column"),he=n("SuccessFilled"),ge=n("Filter"),w=n("el-button"),ye=n("el-checkbox"),be=n("el-checkbox-group"),ke=n("el-scrollbar"),$e=n("el-empty"),Te=n("el-popover"),Ce=n("el-switch"),we=n("el-divider"),j=n("el-tooltip"),J=n("el-dropdown-item"),Ve=n("el-dropdown-menu"),Ne=n("el-dropdown"),Ae=n("app-table"),Le=n("el-card");return s(),N("div",qe,[o(C,{"separator-icon":"ArrowRight"},{default:a(()=>[o(i,null,{default:a(()=>[h(u(A(m)("views.system.resource_management.label")),1)]),_:1}),o(i,null,{default:a(()=>[c("h5",He,u(A(m)("views.tool.title")),1)]),_:1})]),_:1}),o(Le,{class:"mt-16",style:{height:"calc(var(--app-main-height) + 20px)"}},{default:a(()=>[c("div",Ge,[c("div",Ke,[o(Q,{class:"complex-search__left",modelValue:k.value,"onUpdate:modelValue":t[0]||(t[0]=l=>k.value=l),style:{width:"120px"},onChange:ve},{default:a(()=>[o(z,{label:e.$t("common.creator"),value:"createUser"},null,8,["label"]),o(z,{label:e.$t("views.tool.form.toolName.label"),value:"name"},null,8,["label"])]),_:1},8,["modelValue"]),k.value==="name"?(s(),r(X,{key:0,modelValue:$.value.name,"onUpdate:modelValue":t[1]||(t[1]=l=>$.value.name=l),onChange:p,placeholder:e.$t("common.searchBar.placeholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):k.value==="createUser"?(s(),r(Q,{key:1,modelValue:$.value.createUser,"onUpdate:modelValue":t[2]||(t[2]=l=>$.value.createUser=l),onChange:p,filterable:"",clearable:"",style:{width:"220px"}},{default:a(()=>[(s(!0),N(ee,null,te(q.value,l=>(s(),r(z,{key:l.id,value:l.id,label:l.nickname},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):_("",!0)])]),o(Ae,{data:H.value,"pagination-config":x,onSizeChange:p,onChangePage:p,maxTableHeight:260},{default:a(()=>[o(y,{width:"220",label:e.$t("common.name"),"show-overflow-tooltip":""},{default:a(({row:l})=>[c("div",Qe,[o(O,{size:"24",class:"mr-8"},{default:a(()=>[l!=null&&l.icon?(s(),r(Y,{key:0,shape:"square",size:24,style:{background:"none"},class:"mr-8"},{default:a(()=>[c("img",{src:A(Pe)(l==null?void 0:l.icon),alt:""},null,8,Xe)]),_:2},1024)):(s(),r(Y,{key:1,class:"avatar-green",shape:"square",size:24},{default:a(()=>t[10]||(t[10]=[c("img",{src:De,style:{width:"58%"},alt:""},null,-1)])),_:1,__:[10]}))]),_:2},1024),h(" "+u(l.name),1)])]),_:1},8,["label"]),o(y,{prop:"toolType",label:e.$t("views.system.resource_management.type")},{default:a(l=>[l.row.toolType==="MCP"?(s(),N("span",Ye," MCP ")):(s(),N("span",Ze,u(e.$t(A(ne)[l.row.template_id?"INTERNAL":"CUSTOM"])),1))]),_:1},8,["label"]),o(y,{label:e.$t("common.status.label"),width:"120"},{default:a(({row:l})=>[l.isActive?(s(),N("div",et,[o(O,{class:"color-success mr-8",style:{"font-size":"16px"}},{default:a(()=>[o(he)]),_:1}),c("span",tt,u(e.$t("common.status.enabled")),1)])):(s(),N("div",lt,[o(b,{iconName:"app-disabled",class:"color-secondary mr-8"}),c("span",ot,u(e.$t("common.status.disabled")),1)]))]),_:1},8,["label"]),A(W).isEE()?(s(),r(y,{key:0,width:"150",prop:"workspace_name",label:e.$t("views.workspace.title"),"show-overflow-tooltip":""},{header:a(()=>[c("div",null,[c("span",null,u(e.$t("views.workspace.title")),1),o(Te,{width:200,trigger:"click",visible:M.value},{reference:a(()=>[o(w,{style:{"margin-top":"-2px"},type:T.value&&T.value.length>0?"primary":"",link:"",onClick:t[3]||(t[3]=l=>M.value=!M.value)},{default:a(()=>[o(O,null,{default:a(()=>[o(ge)]),_:1})]),_:1},8,["type"])]),default:a(()=>[c("div",at,[c("div",nt,[c("div",{onClick:t[6]||(t[6]=g(()=>{},["stop"]))},[o(X,{modelValue:U.value,"onUpdate:modelValue":t[4]||(t[4]=l=>U.value=l),placeholder:e.$t("common.search"),"prefix-icon":"Search",clearable:""},null,8,["modelValue","placeholder"]),B.value.length?(s(),r(ke,{key:0,height:"300"},{default:a(()=>[o(be,{modelValue:T.value,"onUpdate:modelValue":t[5]||(t[5]=l=>T.value=l),style:{display:"flex","flex-direction":"column"}},{default:a(()=>[(s(!0),N(ee,null,te(B.value,l=>(s(),r(ye,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):(s(),r($e,{key:1,description:e.$t("common.noData")},null,8,["description"]))])])]),c("div",st,[o(w,{size:"small",onClick:t[7]||(t[7]=l=>K("clear"))},{default:a(()=>[h(u(e.$t("common.clear")),1)]),_:1}),o(w,{type:"primary",onClick:K,size:"small"},{default:a(()=>[h(u(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"])])]),_:1},8,["label"])):_("",!0),o(y,{prop:"nickname",label:e.$t("common.creator"),"show-overflow-tooltip":""},null,8,["label"]),o(y,{label:e.$t("views.document.table.updateTime"),width:"180"},{default:a(({row:l})=>[h(u(A(le)(l.update_time)),1)]),_:1},8,["label"]),o(y,{label:e.$t("common.createTime"),width:"180"},{default:a(({row:l})=>[h(u(A(le)(l.createTime)),1)]),_:1},8,["label"]),o(y,{label:e.$t("common.operation"),align:"left",width:"160",fixed:"right"},{default:a(({row:l})=>[c("span",{onClick:t[8]||(t[8]=g(()=>{},["stop"]))},[f.value.switch()?(s(),r(Ce,{key:0,modelValue:l.isActive,"onUpdate:modelValue":V=>l.isActive=V,"before-change":()=>fe(l),size:"small",class:"mr-4"},null,8,["modelValue","onUpdate:modelValue","before-change"])):_("",!0)]),o(we,{direction:"vertical"}),l.template_id&&f.value.edit()?(s(),r(j,{key:0,effect:"dark",content:e.$t("common.edit"),placement:"top"},{default:a(()=>[c("span",it,[o(w,{type:"primary",text:"",onClick:g(V=>ue(l,!0),["stop"]),title:e.$t("common.edit")},{default:a(()=>[o(b,{iconName:"app-edit"})]),_:2},1032,["onClick","title"])])]),_:2},1032,["content"])):_("",!0),!l.template_id&&f.value.edit()?(s(),r(j,{key:1,effect:"dark",content:e.$t("common.edit"),placement:"top"},{default:a(()=>[c("span",ct,[o(w,{type:"primary",text:"",onClick:g(V=>me(l),["stop"]),title:e.$t("common.edit")},{default:a(()=>[o(b,{iconName:"app-edit"})]),_:2},1032,["onClick","title"])])]),_:2},1032,["content"])):_("",!0),!l.template_id&&f.value.copy()?(s(),r(j,{key:2,effect:"dark",content:e.$t("common.copy"),placement:"top"},{default:a(()=>[c("span",rt,[o(w,{type:"primary",text:"",onClick:g(V=>de(l),["stop"]),title:e.$t("common.copy")},{default:a(()=>[o(b,{iconName:"app-copy"})]),_:2},1032,["onClick","title"])])]),_:2},1032,["content"])):_("",!0),se(l)?(s(),r(Ne,{key:3,trigger:"click"},{dropdown:a(()=>[o(Ve,null,{default:a(()=>{var V;return[((V=l.initFieldList)==null?void 0:V.length)>0&&f.value.edit()?(s(),r(J,{key:0,onClick:g(Z=>re(l),["stop"])},{default:a(()=>[o(b,{iconName:"app-operation",class:"color-secondary"}),h(" "+u(e.$t("common.param.initParam")),1)]),_:2},1032,["onClick"])):_("",!0),!l.template_id&&f.value.export()?(s(),r(J,{key:1,onClick:g(Z=>ie(l),["stop"])},{default:a(()=>[o(b,{iconName:"app-export",class:"color-secondary"}),h(" "+u(e.$t("common.export")),1)]),_:2},1032,["onClick"])):_("",!0),f.value.delete()?(s(),r(J,{key:2,divided:"",onClick:g(Z=>ce(l),["stop"])},{default:a(()=>[o(b,{iconName:"app-delete",class:"color-secondary"}),h(" "+u(e.$t("common.delete")),1)]),_:2},1032,["onClick"])):_("",!0)]}),_:2},1024)]),default:a(()=>[o(w,{text:"",onClick:t[9]||(t[9]=g(()=>{},["stop"]))},{default:a(()=>[o(b,{iconName:"app-more"})]),_:1})]),_:2},1024)):_("",!0)]),_:1},8,["label"])]),_:1},8,["data","pagination-config"])]),_:1}),o(Oe,{ref_key:"InitParamDrawerRef",ref:D,onRefresh:E},null,512),o(je,{ref_key:"ToolFormDrawerRef",ref:R,onRefresh:E,title:P.value},null,8,["title"]),o(Je,{ref_key:"AddInternalToolDialogRef",ref:G,onRefresh:pe},null,512)])}}});export{_t as default};
