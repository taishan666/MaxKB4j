import{ay as Ue,aA as xe,aB as m,aX as Se,aQ as Fe,b_ as Be,aR as Ie,b9 as Re,aL as Me,aD as n,aT as A,aF as s,aH as o,aG as a,aK as h,aJ as u,b8 as L,aC as d,aI as c,aE as r,aU as _,aY as ee,aZ as te,c3 as De,c4 as Pe,co as y,a_ as g,c6 as le,cO as v,c9 as Ee,c8 as oe,b5 as ae,a$ as ze}from"./admin-C1F6ScCT.js";import{_ as Oe,a as je,b as Je}from"./ToolFormDrawer.vue_vue_type_script_setup_true_lang-CKYeElAm.js";import{l as We}from"./permission-api-DtGASVsc.js";import"./FieldFormDialog.vue_vue_type_script_setup_true_lang-D6sytb8k.js";import"./workspace-CDakrkaW.js";var ne=(F=>(F.CUSTOM="common.custom",F.INTERNAL="views.tool.toolStore.internal",F))(ne||{});const qe={class:"resource-manage_tool p-16-24"},He={class:"ml-4 color-text-primary"},Ge={class:"flex-between mb-16"},Ke={class:"complex-search"},Qe={class:"table-name flex align-center"},Xe=["src"],Ye={key:0},Ze={key:1},et={key:0,class:"flex align-center"},tt={class:"color-secondary"},lt={key:1,class:"flex align-center"},ot={class:"color-secondary"},at={class:"filter"},nt={class:"form-item mb-16 ml-4"},st={class:"text-right"},it={class:"mr-8"},ct={class:"mr-8"},rt={class:"mr-8"},_t=Ue({__name:"ToolResourceIndex",setup(F){const{user:W}=xe(),k=m("name"),$=m({name:"",createUser:""}),q=m([]),N=m(!1),U=m(!1),H=m([]),x=Se({current_page:1,page_size:20,total:0}),B=m([]),I=m(!1),T=m([]),f=Fe(()=>Be.tool.systemManage),se=e=>{var t;return f.value.export()||f.value.delete()||((t=e.initFieldList)==null?void 0:t.length)>0&&f.value.edit()};function ie(e){v.exportTool(e.id,e.name,N).catch(t=>{t.response.status!==403&&t.response.data.text().then(i=>{Ee(`${d("views.application.tip.ExportError")}:${JSON.parse(i).message}`)})})}function ce(e){oe(`${d("views.tool.delete.confirmTitle")}ï¼š${e.name} ?`,d("views.tool.delete.confirmMessage"),{confirmButtonText:d("common.confirm"),cancelButtonText:d("common.cancel"),confirmButtonClass:"danger"}).then(()=>{v.delTool(e.id,N).then(()=>{p(),ae(d("common.deleteSuccess"))})}).catch(()=>{})}function re(e){v.getToolById(e==null?void 0:e.id,U).then(t=>{P.value.open(t.data)})}async function me(e){D.value=d("views.tool.copyTool");const t=await v.getToolById(e.id,U),i=ze.cloneDeep(t.data);delete i.id,i.name=i.name+`  ${d("common.copyTitle")}`,R.value.open(i)}const R=m(),D=m("");function de(e){e!=null&&e.template_id||(D.value=d("views.tool.editTool"),e?v.getToolById(e==null?void 0:e.id,N).then(t=>{R.value.open(t.data)}):R.value.open(e))}const G=m();function ue(e,t){var i;(i=G.value)==null||i.open(e,t)}function pe(e,t){t&&v.putTool(e==null?void 0:e.id,{name:e.name},N).then(i=>{ae(d("common.saveSuccess")),E()})}const P=m();async function fe(e){if(e.isActive)oe(`${d("views.tool.disabled.confirmTitle")}${e.name} ?`,d("views.tool.disabled.confirmMessage"),{confirmButtonText:d("common.status.disable"),confirmButtonClass:"danger"}).then(()=>{const t={isActive:!e.isActive};v.putTool(e.id,t,U).then(()=>(p(),!0)).catch(()=>!1)});else{const t=await v.getToolById(e.id,U);if((!t.data.initParams||Object.keys(t.data.initParams).length===0)&&t.data.initFieldList&&t.data.initFieldList.length>0&&t.data.initFieldList.filter(C=>C.defaultValue&&C.show_default_value).length!==t.data.initFieldList.length)return P.value.open(t.data,!e.isActive),!1;const i={isActive:!e.isActive};v.putTool(e.id,i,U).then(()=>(p(),!0)).catch(()=>!1)}}const S=m(""),M=m([]);Ie([()=>B.value,()=>S.value],()=>{S.value.length||(M.value=B.value),M.value=B.value.filter(e=>e.label.toLowerCase().includes(S.value.toLowerCase()))},{immediate:!0});function K(e){e==="clear"&&(T.value=[]),p(),I.value=!1}async function _e(){if(W.isEE()){const e=await We("workspace").getSystemWorkspaceList(N);B.value=e.data.map(t=>({label:t.name,value:t.id}))}}const ve=()=>{$.value={name:"",createUser:""}};function p(){const e={};$.value[k.value]&&(e[k.value]=$.value[k.value]),T.value.length>0&&(e.workspace_ids=JSON.stringify(T.value)),v.getToolListPage(x,e,N).then(t=>{var i,C;x.total=(i=t.data)==null?void 0:i.total,H.value=(C=t.data)==null?void 0:C.records})}function E(e){e||(x.total=0,x.current_page=1),p()}return Re(()=>{_e(),p(),Me.getAllMemberList("").then(e=>{q.value=e.data})}),(e,t)=>{const i=n("el-breadcrumb-item"),C=n("el-breadcrumb"),z=n("el-option"),Q=n("el-select"),X=n("el-input"),Y=n("el-avatar"),O=n("el-icon"),b=n("el-table-column"),he=n("SuccessFilled"),ge=n("Filter"),w=n("el-button"),be=n("el-checkbox"),ye=n("el-checkbox-group"),ke=n("el-scrollbar"),$e=n("el-empty"),Te=n("el-popover"),Ce=n("el-switch"),we=n("el-divider"),j=n("el-tooltip"),J=n("el-dropdown-item"),Ve=n("el-dropdown-menu"),Ae=n("el-dropdown"),Le=n("app-table"),Ne=n("el-card");return s(),A("div",qe,[o(C,{"separator-icon":"ArrowRight"},{default:a(()=>[o(i,null,{default:a(()=>[h(u(L(d)("views.system.resource_management.label")),1)]),_:1}),o(i,null,{default:a(()=>[c("h5",He,u(L(d)("views.tool.title")),1)]),_:1})]),_:1}),o(Ne,{class:"mt-16",style:{height:"calc(var(--app-main-height) + 20px)"}},{default:a(()=>[c("div",Ge,[c("div",Ke,[o(Q,{class:"complex-search__left",modelValue:k.value,"onUpdate:modelValue":t[0]||(t[0]=l=>k.value=l),style:{width:"120px"},onChange:ve},{default:a(()=>[o(z,{label:e.$t("common.creator"),value:"createUser"},null,8,["label"]),o(z,{label:e.$t("views.tool.form.toolName.label"),value:"name"},null,8,["label"])]),_:1},8,["modelValue"]),k.value==="name"?(s(),r(X,{key:0,modelValue:$.value.name,"onUpdate:modelValue":t[1]||(t[1]=l=>$.value.name=l),onChange:p,placeholder:e.$t("common.searchBar.placeholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):k.value==="createUser"?(s(),r(Q,{key:1,modelValue:$.value.createUser,"onUpdate:modelValue":t[2]||(t[2]=l=>$.value.createUser=l),onChange:p,filterable:"",clearable:"",style:{width:"220px"}},{default:a(()=>[(s(!0),A(ee,null,te(q.value,l=>(s(),r(z,{key:l.id,value:l.id,label:l.nickname},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):_("",!0)])]),o(Le,{data:H.value,"pagination-config":x,onSizeChange:p,onChangePage:p,maxTableHeight:260},{default:a(()=>[o(b,{width:"220",label:e.$t("common.name"),"show-overflow-tooltip":""},{default:a(({row:l})=>[c("div",Qe,[o(O,{size:"24",class:"mr-8"},{default:a(()=>[l!=null&&l.icon?(s(),r(Y,{key:0,shape:"square",size:24,style:{background:"none"},class:"mr-8"},{default:a(()=>[c("img",{src:L(De)(l==null?void 0:l.icon),alt:""},null,8,Xe)]),_:2},1024)):(s(),r(Y,{key:1,class:"avatar-green",shape:"square",size:24},{default:a(()=>t[10]||(t[10]=[c("img",{src:Pe,style:{width:"58%"},alt:""},null,-1)])),_:1,__:[10]}))]),_:2},1024),h(" "+u(l.name),1)])]),_:1},8,["label"]),o(b,{prop:"toolType",label:e.$t("views.system.resource_management.type")},{default:a(l=>[l.row.toolType==="MCP"?(s(),A("span",Ye," MCP ")):(s(),A("span",Ze,u(e.$t(L(ne)[l.row.template_id?"INTERNAL":"CUSTOM"])),1))]),_:1},8,["label"]),o(b,{label:e.$t("common.status.label"),width:"120"},{default:a(({row:l})=>[l.isActive?(s(),A("div",et,[o(O,{class:"color-success mr-8",style:{"font-size":"16px"}},{default:a(()=>[o(he)]),_:1}),c("span",tt,u(e.$t("common.status.enabled")),1)])):(s(),A("div",lt,[o(y,{iconName:"app-disabled",class:"color-secondary mr-8"}),c("span",ot,u(e.$t("common.status.disabled")),1)]))]),_:1},8,["label"]),L(W).isEE()?(s(),r(b,{key:0,width:"150",prop:"workspace_name",label:e.$t("views.workspace.title"),"show-overflow-tooltip":""},{header:a(()=>[c("div",null,[c("span",null,u(e.$t("views.workspace.title")),1),o(Te,{width:200,trigger:"click",visible:I.value},{reference:a(()=>[o(w,{style:{"margin-top":"-2px"},type:T.value&&T.value.length>0?"primary":"",link:"",onClick:t[3]||(t[3]=l=>I.value=!I.value)},{default:a(()=>[o(O,null,{default:a(()=>[o(ge)]),_:1})]),_:1},8,["type"])]),default:a(()=>[c("div",at,[c("div",nt,[c("div",{onClick:t[6]||(t[6]=g(()=>{},["stop"]))},[o(X,{modelValue:S.value,"onUpdate:modelValue":t[4]||(t[4]=l=>S.value=l),placeholder:e.$t("common.search"),"prefix-icon":"Search",clearable:""},null,8,["modelValue","placeholder"]),M.value.length?(s(),r(ke,{key:0,height:"300"},{default:a(()=>[o(ye,{modelValue:T.value,"onUpdate:modelValue":t[5]||(t[5]=l=>T.value=l),style:{display:"flex","flex-direction":"column"}},{default:a(()=>[(s(!0),A(ee,null,te(M.value,l=>(s(),r(be,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):(s(),r($e,{key:1,description:e.$t("common.noData")},null,8,["description"]))])])]),c("div",st,[o(w,{size:"small",onClick:t[7]||(t[7]=l=>K("clear"))},{default:a(()=>[h(u(e.$t("common.clear")),1)]),_:1}),o(w,{type:"primary",onClick:K,size:"small"},{default:a(()=>[h(u(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"])])]),_:1},8,["label"])):_("",!0),o(b,{prop:"nickname",label:e.$t("common.creator"),"show-overflow-tooltip":""},null,8,["label"]),o(b,{label:e.$t("views.document.table.updateTime"),width:"180"},{default:a(({row:l})=>[h(u(L(le)(l.updateTime)),1)]),_:1},8,["label"]),o(b,{label:e.$t("common.createTime"),width:"180"},{default:a(({row:l})=>[h(u(L(le)(l.createTime)),1)]),_:1},8,["label"]),o(b,{label:e.$t("common.operation"),align:"left",width:"160",fixed:"right"},{default:a(({row:l})=>[c("span",{onClick:t[8]||(t[8]=g(()=>{},["stop"]))},[f.value.switch()?(s(),r(Ce,{key:0,modelValue:l.isActive,"onUpdate:modelValue":V=>l.isActive=V,"before-change":()=>fe(l),size:"small",class:"mr-4"},null,8,["modelValue","onUpdate:modelValue","before-change"])):_("",!0)]),o(we,{direction:"vertical"}),l.template_id&&f.value.edit()?(s(),r(j,{key:0,effect:"dark",content:e.$t("common.edit"),placement:"top"},{default:a(()=>[c("span",it,[o(w,{type:"primary",text:"",onClick:g(V=>ue(l,!0),["stop"]),title:e.$t("common.edit")},{default:a(()=>[o(y,{iconName:"app-edit"})]),_:2},1032,["onClick","title"])])]),_:2},1032,["content"])):_("",!0),!l.template_id&&f.value.edit()?(s(),r(j,{key:1,effect:"dark",content:e.$t("common.edit"),placement:"top"},{default:a(()=>[c("span",ct,[o(w,{type:"primary",text:"",onClick:g(V=>de(l),["stop"]),title:e.$t("common.edit")},{default:a(()=>[o(y,{iconName:"app-edit"})]),_:2},1032,["onClick","title"])])]),_:2},1032,["content"])):_("",!0),!l.template_id&&f.value.copy()?(s(),r(j,{key:2,effect:"dark",content:e.$t("common.copy"),placement:"top"},{default:a(()=>[c("span",rt,[o(w,{type:"primary",text:"",onClick:g(V=>me(l),["stop"]),title:e.$t("common.copy")},{default:a(()=>[o(y,{iconName:"app-copy"})]),_:2},1032,["onClick","title"])])]),_:2},1032,["content"])):_("",!0),se(l)?(s(),r(Ae,{key:3,trigger:"click"},{dropdown:a(()=>[o(Ve,null,{default:a(()=>{var V;return[((V=l.initFieldList)==null?void 0:V.length)>0&&f.value.edit()?(s(),r(J,{key:0,onClick:g(Z=>re(l),["stop"])},{default:a(()=>[o(y,{iconName:"app-operation",class:"color-secondary"}),h(" "+u(e.$t("common.param.initParam")),1)]),_:2},1032,["onClick"])):_("",!0),!l.template_id&&f.value.export()?(s(),r(J,{key:1,onClick:g(Z=>ie(l),["stop"])},{default:a(()=>[o(y,{iconName:"app-export",class:"color-secondary"}),h(" "+u(e.$t("common.export")),1)]),_:2},1032,["onClick"])):_("",!0),f.value.delete()?(s(),r(J,{key:2,divided:"",onClick:g(Z=>ce(l),["stop"])},{default:a(()=>[o(y,{iconName:"app-delete",class:"color-secondary"}),h(" "+u(e.$t("common.delete")),1)]),_:2},1032,["onClick"])):_("",!0)]}),_:2},1024)]),default:a(()=>[o(w,{text:"",onClick:t[9]||(t[9]=g(()=>{},["stop"]))},{default:a(()=>[o(y,{iconName:"app-more"})]),_:1})]),_:2},1024)):_("",!0)]),_:1},8,["label"])]),_:1},8,["data","pagination-config"])]),_:1}),o(Oe,{ref_key:"InitParamDrawerRef",ref:P,onRefresh:E},null,512),o(je,{ref_key:"ToolFormDrawerRef",ref:R,onRefresh:E,title:D.value},null,8,["title"]),o(Je,{ref_key:"AddInternalToolDialogRef",ref:G,onRefresh:pe},null,512)])}}});export{_t as default};
