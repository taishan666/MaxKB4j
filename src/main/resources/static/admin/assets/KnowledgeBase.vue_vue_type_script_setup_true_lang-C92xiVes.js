import{ay as L,aA as M,aP as z,aQ as u,aB as l,aO as A,aC as G,aR as U,aD as k,aE as y,aF as f,aG as _,aI as C,aH as x,aJ as V,aT as H,aY as J,aZ as O,bC as P,aK as Q,bD as Y,b8 as Z,bE as j,bF as W,aM as m,aW as X,bG as ee,b3 as ae,b4 as te}from"./admin-S7vQ7JSu.js";const oe={class:"title-decoration-1 mb-16 mt-4"},re={class:"flex align-center"},ie=L({__name:"DataSource",props:{workflow:{},knowledgeId:{},loading:{type:Boolean}},emits:["update:loading"],setup(b,{expose:h,emit:v}){const{user:D}=M(),d=z(),c=b,S=u(()=>d.path.includes("shared")?"systemShare":d.path.includes("resource-management")?"systemManage":"workspace"),B=l([]),I=u(()=>D.getWorkspaceId()),F=v,r=u({get:()=>c.loading,set:e=>{F("update:loading",e)}}),t=l(),o=l({nodeId:""}),n=l({}),g=u({get:()=>({...n.value,...o.value}),set:e=>{n.value=e}}),p=u(()=>{var e,a;return(a=(e=c.workflow)==null?void 0:e.nodes)==null?void 0:a.filter(i=>i.properties.kind===A.DataSource)}),N=l({current_tool_id:void 0});ee("get_extra",()=>N.value);const $=e=>{o.value.nodeId=e;const a=p.value.find(i=>i.id==e);a.properties.nodeData&&a.properties.nodeData.toolLibId&&(N.value.current_tool_id=a.properties.nodeData.toolLibId),e=a?[m.DataSourceLocalNode,m.DataSourceWebNode].includes(a.type)?a.type:a.properties.nodeData.toolLibId:e,X({type:"knowledge",systemType:S.value}).getKnowledgeWorkflowFormList(c.knowledgeId,[m.DataSourceLocalNode,m.DataSourceWebNode].includes(a.type)?"local":"tool",e,a,r).then(i=>{var w;(w=t.value)==null||w.render(i.data)})},K=l({nodeId:{required:!0,trigger:"blur",message:G("views.tool.dataSource.requiredMessage")}}),R=()=>{var e;return(e=t.value)==null?void 0:e.validate()},T=()=>g.value;return U(p,()=>{o.value.nodeId||p.value&&p.value.length>0&&$(p.value[0].id)},{immediate:!0}),h({validate:R,get_data:T}),(e,a)=>{const i=k("el-card"),w=k("el-col"),q=k("el-row"),E=k("el-form-item");return f(),y(W,{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=s=>g.value=s),render_data:B.value,model:g.value,ref_key:"dynamicsFormRef",ref:t,"label-position":"top","require-asterisk-position":"right","other-params":{current_workspace_id:I.value,current_knowledge_id:e.knowledgeId}},{default:_(()=>[C("h4",oe,V(e.$t("views.tool.dataSource.selectDataSource")),1),x(E,{label:e.$t("views.tool.dataSource.title"),prop:"nodeId",rules:K.value.nodeId},{default:_(()=>[x(q,{class:"w-full",gutter:8},{default:_(()=>[(f(!0),H(J,null,O(p.value,s=>(f(),y(w,{span:8,key:s.id},{default:_(()=>[x(i,{shadow:"never",class:P(["card-checkbox cursor w-full mb-8",o.value.nodeId===s.id?"active":""]),style:{"--el-card-padding":"4px 12px"},onClick:ne=>$(s.id)},{default:_(()=>[C("div",re,[(f(),y(Y(Z(j)(`${s.type}-icon`)),{class:"mr-8",size:20,item:s==null?void 0:s.properties.nodeData},null,8,["item"])),Q(" "+V(s.properties.nodeName),1)])]),_:2},1032,["class","onClick"])]),_:2},1024))),128))]),_:1})]),_:1},8,["label","rules"])]),_:1},8,["modelValue","render_data","model","other-params"])}}}),se={class:"title-decoration-1 mb-16 mt-4"},ue=L({__name:"KnowledgeBase",props:{workflow:{}},setup(b,{expose:h}){const v=b,D=l(),d=l({}),c=l(),S=()=>{var r;return(r=c.value)==null?void 0:r.validate()},B=u(()=>{var t,o;return((o=(t=v.workflow)==null?void 0:t.nodes)==null?void 0:o.find(n=>n.type===m.KnowledgeBase)).properties.user_input_config.title}),I=u(()=>{var t,o;const r=(o=(t=v.workflow)==null?void 0:t.nodes)==null?void 0:o.find(n=>n.type===m.KnowledgeBase);return r?r.properties.user_input_field_list:[]});return h({validate:S,get_data:()=>d.value}),(r,t)=>{const o=ae("loading");return te((f(),y(W,{modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=n=>d.value=n),render_data:I.value,model:d.value,ref_key:"dynamicsFormRef",ref:c,"label-position":"top","require-asterisk-position":"right"},{default:_(()=>[C("h4",se,V(B.value||r.$t("chat.userInput")),1)]),_:1},8,["modelValue","render_data","model"])),[[o,D.value]])}}});export{ue as _,ie as a};
