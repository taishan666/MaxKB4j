import{L as R,a as T}from"./LoginContainer-BjVVWYvk.js";import{aJ as M,aK as S,aQ as U,cE as t,d4 as m,e4 as B,aS as v,d0 as D,cU as Z,aU as q,aT as I,aM as G,cI as l,aX as o,aV as w,aN as r,aO as g,cN as C,ea as z,dx as J}from"./admin-CylDRYrg.js";const K={class:"mb-24"},O={class:"mb-24"},Q={class:"mb-24"},X={class:"flex-between w-full"},j={class:"operate-container mt-12"},Y=M({__name:"ForgotPassword",setup(x){const b=S(),{theme:k,user:E}=U(),s=t({email:"",code:"",type:"reset_password"}),f=t(),F=t({email:[{required:!0,message:m("views.login.loginForm.email.requiredMessage"),trigger:"blur"},{validator:(e,a,n)=>{!/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/.test(a)&&a!=""?n(new Error(m("views.login.loginForm.email.validatorEmail"))):n()},trigger:"blur"}],code:[{required:!0,message:m("views.login.verificationCode.placeholder")}]}),i=t(!1),d=t(!1),u=t(60),p=t(!1),L=()=>{var e;(e=f.value)==null||e.validate().then(()=>z.checkCode(s.value,p)).then(()=>b.push({name:"ResetPassword",params:s.value}))},A=()=>{var e;(e=f.value)==null||e.validateField("email",a=>{a&&z.sendEmit(s.value.email,"reset_password",p).then(()=>{J(m("views.login.verificationCode.successMessage")),d.value=!0,V()})})},V=()=>{u.value<=0?(d.value=!1,u.value=60):setTimeout(()=>{u.value--,V()},1e3)};return B(()=>{i.value=!0,E.asyncGetProfile().then(()=>{i.value=!1})}),(e,a)=>{const n=v("el-input"),_=v("el-form-item"),h=v("el-button"),N=v("el-form"),P=D("loading");return i.value?q("",!0):Z((G(),I(T,{key:0},{default:l(()=>{var $,y;return[o(R,{subTitle:($=w(k).themeInfo)!=null&&$.slogan?(y=w(k).themeInfo)==null?void 0:y.slogan:e.$t("theme.defaultSlogan")},{default:l(()=>[r("h2",K,g(e.$t("views.login.forgotPassword")),1),o(N,{class:"register-form",ref_key:"resetPasswordFormRef",ref:f,model:s.value,rules:F.value},{default:l(()=>[r("div",O,[o(_,{prop:"email"},{default:l(()=>[o(n,{size:"large",class:"input-item",modelValue:s.value.email,"onUpdate:modelValue":a[0]||(a[0]=c=>s.value.email=c),placeholder:e.$t("views.login.loginForm.email.placeholder")},null,8,["modelValue","placeholder"])]),_:1})]),r("div",Q,[o(_,{prop:"code"},{default:l(()=>[r("div",X,[o(n,{size:"large",class:"code-input",modelValue:s.value.code,"onUpdate:modelValue":a[1]||(a[1]=c=>s.value.code=c),placeholder:e.$t("views.login.verificationCode.placeholder")},null,8,["modelValue","placeholder"]),o(h,{disabled:d.value,size:"large",class:"send-email-button ml-12",onClick:A,loading:i.value},{default:l(()=>[C(g(d.value?`${e.$t("views.login.verificationCode.resend")}（${u.value}s）`:e.$t("views.login.verificationCode.getVerificationCode")),1)]),_:1},8,["disabled","loading"])])]),_:1})])]),_:1},8,["model","rules"]),o(h,{size:"large",type:"primary",class:"w-full",onClick:L},{default:l(()=>[C(g(e.$t("views.login.buttons.checkCode")),1)]),_:1}),r("div",j,[o(h,{class:"register",onClick:a[2]||(a[2]=c=>w(b).push("/login")),link:"",type:"primary",icon:"ArrowLeft"},{default:l(()=>[C(g(e.$t("views.login.buttons.backLogin")),1)]),_:1})])]),_:1},8,["subTitle"])]}),_:1})),[[P,i.value||p.value]])}}});export{Y as default};
