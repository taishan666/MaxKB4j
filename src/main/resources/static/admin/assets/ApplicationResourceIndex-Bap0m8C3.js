import{ay as $e,az as Ce,aP as Ve,aA as xe,aQ as Ae,b_ as Ue,aB as m,aX as Se,aC as f,aR as Te,b9 as Fe,aL as Le,aD as n,aT as S,aF as s,aH as o,aG as a,aK as v,aJ as r,b8 as h,aI as i,aE as c,aU as T,aY as D,aZ as J,c2 as Ne,c3 as Pe,c4 as ze,c5 as Ie,a_ as F,c6 as ne,c7 as M,c8 as Ee,b5 as Be,c9 as Me}from"./admin-Cb1J-0y0.js";import{l as Re}from"./permission-api-BLWuuo_T.js";import"./workspace-5QAIFT56.js";const Oe={class:"p-16-24"},De={class:"ml-4 color-text-primary"},Je={class:"flex-between mb-16"},We={class:"complex-search"},qe={class:"table-name flex align-center"},He=["src"],Ge={class:"filter"},Ke={class:"form-item mb-16"},Qe={class:"text-right"},Xe={key:0,class:"flex align-center"},Ye={class:"color-secondary"},Ze={key:1,class:"flex align-center"},je={class:"color-secondary"},ea={class:"filter"},aa={class:"form-item mb-16 ml-4"},la={class:"text-right"},ta={class:"mr-8"},oa={class:"mr-8"},ca=$e({__name:"ApplicationResourceIndex",setup(na){const se=Ce();Ve();const{user:W,application:ie}=xe(),_=Ae(()=>Ue.application.systemManage),re=()=>_.value.overview_read()||_.value.access_read()||_.value.edit()||_.value.chat_log_read()||_.value.chat_user_read()||_.value.auth(),ce=()=>_.value.export()||_.value.delete(),R=m([]);function pe(e){var p,V;(V=(p=e==null?void 0:e.workFlow)==null?void 0:p.nodes)==null||V.filter(u=>u.id==="base-node").map(u=>{R.value=u.properties.apiInputFieldList?u.properties.apiInputFieldList.map(d=>({name:d.variable,value:d.defaultValue})):u.properties.inputFieldList?u.properties.inputFieldList.filter(d=>d.assignment_method==="api_input").map(d=>({name:d.variable,value:d.defaultValue})):[]});const t=q(R.value)?"?"+q(R.value):"";M.getAccessToken(e.id,L).then(u=>{var d;window.open(ie.location+((d=u==null?void 0:u.data)==null?void 0:d.accessToken)+t)})}function q(e){const t=new URLSearchParams;return e.forEach(p=>{t.append(encodeURIComponent(p.name),encodeURIComponent(p.value))}),t.toString()}function ue(e){Ee(`${f("views.application.delete.confirmTitle")}${e.name} ?`,f("views.application.delete.confirmMessage"),{confirmButtonText:f("common.confirm"),cancelButtonText:f("common.cancel"),confirmButtonClass:"danger"}).then(()=>{M.delApplication(e.id,L).then(()=>{const t=N.value.findIndex(p=>p.id===e.id);N.value.splice(t,1),Be(f("common.deleteSuccess"))})}).catch(()=>{})}const me=e=>{M.exportApplication(e.id,e.name,L).catch(t=>{t.response.status!==403&&t.response.data.text().then(p=>{Me(`${f("views.application.tip.ExportError")}:${JSON.parse(p).message}`)})})},y=m("name"),k=m({name:"",createUser:""}),H=m([]),L=m(!1),N=m([]),O=Se({current_page:1,page_size:20,total:0}),P=m([]),z=m(!1),w=m([]),I=m(!1),$=m([]),de=m([{label:f("views.application.status.published"),value:!0},{label:f("views.application.status.unpublished"),value:!1}]),x=m(""),E=m([]);Te([()=>P.value,()=>x.value],()=>{x.value.length||(E.value=P.value),E.value=P.value.filter(e=>e.label.toLowerCase().includes(x.value.toLowerCase()))},{immediate:!0});function G(e){e==="clear"&&(w.value=[]),x.value="",C(),z.value=!1}function K(e){e==="clear"&&($.value=[]),C(),I.value=!1}async function ve(){if(W.isEE()){const e=await Re("workspace").getSystemWorkspaceList(L);P.value=e.data.map(t=>({label:t.name,value:t.id}))}}const _e=()=>{k.value={name:"",createUser:""}};function C(){const e={};k.value[y.value]&&(e[y.value]=k.value[y.value]),w.value.length>0&&(e.workspace_ids=JSON.stringify(w.value)),$.value.length>0&&(e.status=JSON.stringify($.value)),M.getApplication(O,e,L).then(t=>{var p,V;O.total=(p=t.data)==null?void 0:p.total,N.value=(V=t.data)==null?void 0:V.records})}return Fe(()=>{ve(),C(),Le.getAllMemberList("").then(e=>{H.value=e.data})}),(e,t)=>{const p=n("el-breadcrumb-item"),V=n("el-breadcrumb"),u=n("el-option"),d=n("el-select"),Q=n("el-input"),X=n("el-avatar"),B=n("el-icon"),g=n("el-table-column"),Y=n("el-tag"),Z=n("Filter"),b=n("el-button"),j=n("el-checkbox"),ee=n("el-checkbox-group"),ae=n("el-popover"),fe=n("SuccessFilled"),A=n("AppIcon"),be=n("el-scrollbar"),he=n("el-empty"),le=n("el-tooltip"),te=n("el-dropdown-item"),ge=n("el-dropdown-menu"),ye=n("el-dropdown"),ke=n("app-table"),we=n("el-card");return s(),S("div",Oe,[o(V,{"separator-icon":"ArrowRight"},{default:a(()=>[o(p,null,{default:a(()=>[v(r(h(f)("views.system.resource_management.label")),1)]),_:1}),o(p,null,{default:a(()=>[i("h5",De,r(h(f)("views.application.title")),1)]),_:1})]),_:1}),o(we,{class:"mt-16",style:{height:"calc(var(--app-main-height) + 20px)"}},{default:a(()=>[i("div",Je,[i("div",We,[o(d,{class:"complex-search__left",modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=l=>y.value=l),style:{width:"120px"},onChange:_e},{default:a(()=>[o(u,{label:e.$t("common.creator"),value:"createUser"},null,8,["label"]),o(u,{label:e.$t("common.name"),value:"name"},null,8,["label"])]),_:1},8,["modelValue"]),y.value==="name"?(s(),c(Q,{key:0,modelValue:k.value.name,"onUpdate:modelValue":t[1]||(t[1]=l=>k.value.name=l),onChange:C,placeholder:e.$t("common.searchBar.placeholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):y.value==="createUser"?(s(),c(d,{key:1,modelValue:k.value.createUser,"onUpdate:modelValue":t[2]||(t[2]=l=>k.value.createUser=l),onChange:C,clearable:"",filterable:"",style:{width:"220px"}},{default:a(()=>[(s(!0),S(D,null,J(H.value,l=>(s(),c(u,{key:l.id,value:l.id,label:l.nickname},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):T("",!0)])]),o(ke,{data:N.value,"pagination-config":O,onSizeChange:C,onChangePage:C,maxTableHeight:260},{default:a(()=>[o(g,{width:"220",label:e.$t("common.name"),"show-overflow-tooltip":""},{default:a(l=>[i("div",qe,[o(B,{size:"24",class:"mr-8"},{default:a(()=>{var U;return[h(Ne)((U=l.row)==null?void 0:U.icon)?(s(),c(X,{key:0,shape:"square",size:24,style:{background:"none"},class:"mr-8"},{default:a(()=>{var oe;return[i("img",{src:h(Pe)((oe=l.row)==null?void 0:oe.icon),alt:""},null,8,He)]}),_:2},1024)):(s(),c(X,{key:1,class:"avatar-green",shape:"square",size:24},{default:a(()=>t[13]||(t[13]=[i("img",{src:ze,style:{width:"58%"},alt:""},null,-1)])),_:1,__:[13]}))]}),_:2},1024),v(" "+r(l.row.name),1)])]),_:1},8,["label"]),o(g,{prop:"toolType",label:e.$t("views.system.resource_management.type"),width:"160"},{default:a(l=>[h(Ie)(l.row.type)?(s(),c(Y,{key:0,type:"warning",style:{height:"22px"}},{default:a(()=>[v(r(e.$t("views.application.workflow")),1)]),_:1})):(s(),c(Y,{key:1,class:"blue-tag",style:{height:"22px"}},{default:a(()=>[v(r(e.$t("views.application.simple")),1)]),_:1}))]),_:1},8,["label"]),o(g,{width:"150",prop:"isPublish",label:e.$t("common.status.label"),"show-overflow-tooltip":""},{header:a(()=>[i("div",null,[i("span",null,r(e.$t("common.status.label")),1),o(ae,{width:100,trigger:"click",visible:I.value},{reference:a(()=>[o(b,{style:{"margin-top":"-2px"},type:$.value&&$.value.length>0?"primary":"",link:"",onClick:t[3]||(t[3]=l=>I.value=!I.value)},{default:a(()=>[o(B,null,{default:a(()=>[o(Z)]),_:1})]),_:1},8,["type"])]),default:a(()=>[i("div",Ge,[i("div",Ke,[i("div",{onClick:t[5]||(t[5]=F(()=>{},["stop"]))},[o(ee,{modelValue:$.value,"onUpdate:modelValue":t[4]||(t[4]=l=>$.value=l),style:{display:"flex","flex-direction":"column"}},{default:a(()=>[(s(!0),S(D,null,J(de.value,l=>(s(),c(j,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])]),i("div",Qe,[o(b,{size:"small",onClick:t[6]||(t[6]=l=>K("clear"))},{default:a(()=>[v(r(e.$t("common.clear")),1)]),_:1}),o(b,{type:"primary",onClick:K,size:"small"},{default:a(()=>[v(r(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"])])]),default:a(l=>[l.row.isPublish?(s(),S("div",Xe,[o(B,{class:"color-success mr-8",style:{"font-size":"16px"}},{default:a(()=>[o(fe)]),_:1}),i("span",Ye,r(e.$t("views.application.status.published")),1)])):(s(),S("div",Ze,[o(A,{iconName:"app-disabled",class:"color-secondary mr-8"}),i("span",je,r(e.$t("views.application.status.unpublished")),1)]))]),_:1},8,["label"]),h(W).isEE()?(s(),c(g,{key:0,width:"150",prop:"workspace_name",label:e.$t("views.workspace.title"),"show-overflow-tooltip":""},{header:a(()=>[i("div",null,[i("span",null,r(e.$t("views.workspace.title")),1),o(ae,{width:200,trigger:"click",visible:z.value},{reference:a(()=>[o(b,{style:{"margin-top":"-2px"},type:w.value&&w.value.length>0?"primary":"",link:"",onClick:t[7]||(t[7]=l=>z.value=!z.value)},{default:a(()=>[o(B,null,{default:a(()=>[o(Z)]),_:1})]),_:1},8,["type"])]),default:a(()=>[i("div",ea,[i("div",aa,[i("div",{onClick:t[10]||(t[10]=F(()=>{},["stop"]))},[o(Q,{modelValue:x.value,"onUpdate:modelValue":t[8]||(t[8]=l=>x.value=l),placeholder:e.$t("common.search"),"prefix-icon":"Search",clearable:""},null,8,["modelValue","placeholder"]),E.value.length?(s(),c(be,{key:0,height:"300"},{default:a(()=>[o(ee,{modelValue:w.value,"onUpdate:modelValue":t[9]||(t[9]=l=>w.value=l),style:{display:"flex","flex-direction":"column"}},{default:a(()=>[(s(!0),S(D,null,J(E.value,l=>(s(),c(j,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):(s(),c(he,{key:1,description:e.$t("common.noData")},null,8,["description"]))])])]),i("div",la,[o(b,{size:"small",onClick:t[11]||(t[11]=l=>G("clear"))},{default:a(()=>[v(r(e.$t("common.clear")),1)]),_:1}),o(b,{type:"primary",onClick:G,size:"small"},{default:a(()=>[v(r(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"])])]),_:1},8,["label"])):T("",!0),o(g,{prop:"nickname",label:e.$t("common.creator"),"show-overflow-tooltip":""},null,8,["label"]),o(g,{label:e.$t("views.application.publishTime"),width:"180"},{default:a(({row:l})=>[v(r(h(ne)(l.updateTime)),1)]),_:1},8,["label"]),o(g,{label:e.$t("common.createTime"),width:"180"},{default:a(({row:l})=>[v(r(h(ne)(l.createTime)),1)]),_:1},8,["label"]),o(g,{label:e.$t("common.operation"),align:"left",width:"120",fixed:"right"},{default:a(({row:l})=>[o(le,{effect:"dark",content:e.$t("views.application.operation.toChat"),placement:"top"},{default:a(()=>[i("span",ta,[o(b,{type:"primary",text:"",title:e.$t("views.application.operation.toChat"),onClick:F(U=>pe(l),["stop"])},{default:a(()=>[o(A,{iconName:"app-create-chat"})]),_:2},1032,["title","onClick"])])]),_:2},1032,["content"]),re()?(s(),c(le,{key:0,effect:"dark",content:e.$t("views.system.resource_management.management"),placement:"top"},{default:a(()=>[i("span",oa,[o(b,{type:"primary",text:"",title:e.$t("views.system.resource_management.management"),onClick:U=>h(se).push({path:`/application/resource-management/${l.id}/${l.type}/overview`})},{default:a(()=>[o(A,{iconName:"app-admin-operation"})]),_:2},1032,["title","onClick"])])]),_:2},1032,["content"])):T("",!0),ce()?(s(),c(ye,{key:1,trigger:"click"},{dropdown:a(()=>[o(ge,null,{default:a(()=>[_.value.export()?(s(),c(te,{key:0,onClick:F(U=>me(l),["stop"])},{default:a(()=>[o(A,{iconName:"app-export",class:"color-secondary"}),v(" "+r(e.$t("common.export")),1)]),_:2},1032,["onClick"])):T("",!0),_.value.delete()?(s(),c(te,{key:1,onClick:F(U=>ue(l),["stop"])},{default:a(()=>[o(A,{iconName:"app-delete",class:"color-secondary"}),v(" "+r(e.$t("common.delete")),1)]),_:2},1032,["onClick"])):T("",!0)]),_:2},1024)]),default:a(()=>[o(b,{text:"",onClick:t[12]||(t[12]=F(()=>{},["stop"]))},{default:a(()=>[o(A,{iconName:"app-more"})]),_:1})]),_:2},1024)):T("",!0)]),_:1},8,["label"])]),_:1},8,["data","pagination-config"])]),_:1})])}}});export{ca as default};
