import{aJ as j,aP as G,aR as x,cE as k,df as B,d5 as e,aT as g,cI as c,c_ as z,d4 as K,aS as p,aU as _,aN as o,aL as D,aX as d,aO as i,cH as J,cG as X,aV as Z,d3 as le,cN as r,aM as n,dx as Q,cS as ce,cT as se}from"./admin-B6VfIzX8.js";const oe={class:"flex align-center",style:{"margin-left":"-8px"}},ne={class:"title-decoration-1 mb-16"},pe={key:0,class:"flex align-center mb-16"},re={class:"lighter mr-8"},de={class:"title-decoration-1 mb-16"},ue={class:"color-primary",href:"https://mp.weixin.qq.com/advanced/advanced?action=dev&t=advanced/dev",target:"_blank"},ge={class:"color-primary",href:"https://open-dev.dingtalk.com/fe/app?hash=%23%2Fcorp%2Fapp#/corp/app",target:"_blank"},ve={class:"color-primary",href:"https://work.weixin.qq.com/wework_admin/frame#apps",target:"_blank"},me={class:"primary",href:"https://open.feishu.cn/app/",target:"_blank"},we=j({__name:"AccessSettingDrawer",emits:["refresh"],setup(W,{expose:T,emit:C}){const S=G(),{params:{id:I}}=S,$=x(()=>S.path.includes("resource-management")?"systemManage":"workspace"),L=C,v=k(),b=k(!1),h=k(!1),A=k(!1),t=k("wechat"),l=B({wechat:{app_id:"",app_secret:"",token:"",encoding_aes_key:"",is_certification:!1,callback_url:""},dingtalk:{client_id:"",client_secret:"",callback_url:""},wecom:{app_id:"",agent_id:"",secret:"",token:"",encoding_aes_key:"",callback_url:""},lark:{app_id:"",app_secret:"",verification_token:"",callback_url:""},slack:{signing_secret:"",bot_user_token:"",callback_url:""}}),m=B({wechat:{app_id:[{required:!0,message:e("views.application.applicationAccess.wechatSetting.appIdPlaceholder"),trigger:"blur"}],app_secret:[{required:!0,message:e("views.application.applicationAccess.wechatSetting.appSecretPlaceholder"),trigger:"blur"}],token:[{required:!0,message:e("views.application.applicationAccess.wechatSetting.tokenPlaceholder"),trigger:"blur"}],encoding_aes_key:[{required:!0,message:e("views.application.applicationAccess.wechatSetting.aesKeyPlaceholder"),trigger:"blur"}]},dingtalk:{client_id:[{required:!0,message:e("views.application.applicationAccess.dingtalkSetting.clientIdPlaceholder"),trigger:"blur"}],client_secret:[{required:!0,message:e("views.application.applicationAccess.dingtalkSetting.clientSecretPlaceholder"),trigger:"blur"}]},wecom:{app_id:[{required:!0,message:e("views.application.applicationAccess.wecomSetting.cropIdPlaceholder"),trigger:"blur"}],agent_id:[{required:!0,message:e("views.application.applicationAccess.wecomSetting.agentIdPlaceholder"),trigger:"blur"}],secret:[{required:!0,message:e("views.application.applicationAccess.wecomSetting.secretPlaceholder"),trigger:"blur"}],token:[{required:!0,message:e("views.application.applicationAccess.wecomSetting.tokenPlaceholder"),trigger:"blur"}],encoding_aes_key:[{required:!0,message:e("views.application.applicationAccess.wecomSetting.encodingAesKeyPlaceholder"),trigger:"blur"}]},lark:{app_id:[{required:!0,message:e("views.application.applicationAccess.larkSetting.appIdPlaceholder"),trigger:"blur"}],app_secret:[{required:!0,message:e("views.application.applicationAccess.larkSetting.appSecretPlaceholder"),trigger:"blur"}],verification_token:[{required:!1,message:e("views.application.applicationAccess.larkSetting.verificationTokenPlaceholder"),trigger:"blur"}]},slack:{signing_secret:[{required:!0,message:e("views.application.applicationAccess.slackSetting.signingSecretPlaceholder"),trigger:"blur"}],bot_user_token:[{required:!0,message:e("views.application.applicationAccess.slackSetting.botUserTokenPlaceholder"),trigger:"blur"}]}}),y={wechat:{app_id:{label:e("views.application.applicationAccess.wechatSetting.appId"),placeholder:""},app_secret:{label:e("views.application.applicationAccess.wechatSetting.appSecret"),placeholder:""},token:{label:e("views.application.applicationAccess.wechatSetting.token"),placeholder:""},encoding_aes_key:{label:e("views.application.applicationAccess.wechatSetting.aesKey"),placeholder:""}},dingtalk:{client_id:{label:"Client ID",placeholder:""},client_secret:{label:"Client Secret",placeholder:""}},wecom:{app_id:{label:e("views.application.applicationAccess.wecomSetting.cropId"),placeholder:""},agent_id:{label:"Agent ID",placeholder:""},secret:{label:"Secret",placeholder:""},token:{label:"Token",placeholder:""},encoding_aes_key:{label:"EncodingAESKey",placeholder:""}},lark:{app_id:{label:"App ID",placeholder:""},app_secret:{label:"App Secret",placeholder:""},verification_token:{label:"Verification Token",placeholder:""}},slack:{signing_secret:{label:"Signing Secret",placeholder:""},bot_user_token:{label:"Bot User Token",placeholder:""}}},U=new Set(["app_secret","client_secret","secret","bot_user_token","signing_secret"]),E=x(()=>({wechat:e("views.application.applicationAccess.wechatSetting.title"),dingtalk:e("views.application.applicationAccess.dingtalkSetting.title"),wecom:e("views.application.applicationAccess.wecomSetting.title"),lark:e("views.application.applicationAccess.larkSetting.title"),slack:e("views.application.applicationAccess.slackSetting.title")})[t.value]),F=x(()=>({wechat:e("views.applicationOverview.appInfo.header"),dingtalk:e("views.applicationOverview.appInfo.header"),wecom:e("views.applicationOverview.appInfo.header"),lark:e("views.applicationOverview.appInfo.header"),slack:e("views.applicationOverview.appInfo.header")})[t.value]),N=B(Object.keys(y[t.value]).reduce((a,s)=>(U.has(s)&&(a[s]=!1),a),{})),q=a=>U.has(a),M=()=>{b.value=!1},u=async()=>{var a;h.value||(a=v.value)==null||a.validate(async s=>{if(s)try{z({type:"application",systemType:$.value}).updatePlatformConfig(I,t.value,l[t.value],h).then(()=>{Q(e("common.saveSuccess")),M(),L("refresh")})}catch{K(e("views.application.tip.saveErrorMessage"))}})};return T({open:async(a,s)=>{var P;b.value=!0,t.value=s,h.value=!0,A.value=!1,(P=v.value)==null||P.resetFields();try{const V=await z({type:"application",systemType:$.value}).getPlatformConfig(a,s);V.data&&(l[t.value]=V.data),A.value=!0}catch{K(e("views.application.tip.loadingErrorMessage"))}finally{h.value=!1,l[t.value].callback_url=`${window.location.origin}${window.MaxKB.prefix}/api/chat/${s}/${a}`}}}),(a,s)=>{const P=p("el-input"),V=p("el-form-item"),Y=p("el-switch"),ee=p("AppIcon"),O=p("el-button"),R=p("el-text"),ae=p("el-form"),te=p("el-drawer");return n(),g(te,{modelValue:b.value,"onUpdate:modelValue":s[3]||(s[3]=w=>b.value=w),size:"60%","append-to-body":!0},{header:c(()=>[o("div",oe,[o("h4",null,i(E.value),1)])]),footer:c(()=>[o("div",null,[d(O,{onClick:M},{default:c(()=>[r(i(a.$t("common.cancel")),1)]),_:1}),d(O,{type:"primary",onClick:u,disabled:h.value},{default:c(()=>[r(i(a.$t("common.save")),1)]),_:1},8,["disabled"])])]),default:c(()=>[A.value?(n(),g(ae,{key:0,ref_key:"formRef",ref:v,model:l[t.value],"label-width":"120px",rules:m[t.value],"label-position":"top","require-asterisk-position":"right"},{default:c(()=>[o("h4",ne,i(F.value),1),(n(!0),D(X,null,J(y[t.value],(w,f)=>(n(),g(V,{key:f,label:w.label,prop:f},{default:c(()=>[d(P,{modelValue:l[t.value][f],"onUpdate:modelValue":ie=>l[t.value][f]=ie,type:q(f)?N[f]?"text":"password":"text",placeholder:w.placeholder,"show-password":q(f)},null,8,["modelValue","onUpdate:modelValue","type","placeholder","show-password"])]),_:2},1032,["label","prop"]))),128)),t.value==="wechat"?(n(),D("div",pe,[o("span",re,i(a.$t("views.application.applicationAccess.wecomSetting.authenticationSuccessful")),1),t.value==="wechat"?(n(),g(Y,{key:0,modelValue:l[t.value].is_certification,"onUpdate:modelValue":s[0]||(s[0]=w=>l[t.value].is_certification=w)},null,8,["modelValue"])):_("",!0)])):_("",!0),o("h4",de,i(a.$t("views.application.applicationAccess.callback")),1),d(V,{label:"URL",prop:"callback_url"},{default:c(()=>[d(P,{modelValue:l[t.value].callback_url,"onUpdate:modelValue":s[2]||(s[2]=w=>l[t.value].callback_url=w),placeholder:a.$t("views.application.applicationAccess.callbackTip"),readonly:""},{append:c(()=>[d(O,{onClick:s[1]||(s[1]=w=>Z(le)(l[t.value].callback_url))},{default:c(()=>[d(ee,{iconName:"app-copy"})]),_:1})]),_:1},8,["modelValue","placeholder"]),t.value==="wechat"?(n(),g(R,{key:0,type:"info"},{default:c(()=>[r(i(a.$t("views.application.applicationAccess.copyUrl"))+" ",1),o("a",ue,i(a.$t("views.application.applicationAccess.wechatPlatform")),1),r(i(a.$t("views.application.applicationAccess.wechatSetting.urlInfo")),1)]),_:1})):_("",!0),t.value==="dingtalk"?(n(),g(R,{key:1,type:"info"},{default:c(()=>[r(i(a.$t("views.application.applicationAccess.copyUrl"))+" ",1),o("a",ge,i(a.$t("views.application.applicationAccess.dingtalkPlatform")),1),r(i(a.$t("views.application.applicationAccess.dingtalkSetting.urlInfo")),1)]),_:1})):_("",!0),t.value==="wecom"?(n(),g(R,{key:2,type:"info"},{default:c(()=>[r(i(a.$t("views.application.applicationAccess.copyUrl"))+" ",1),o("a",ve,i(a.$t("views.application.applicationAccess.wecomPlatform")),1),r(i(a.$t("views.application.applicationAccess.wecomSetting.urlInfo")),1)]),_:1})):_("",!0),t.value==="lark"?(n(),g(R,{key:3,type:"info"},{default:c(()=>[r(i(a.$t("views.application.applicationAccess.copyUrl"))+" ",1),o("a",me,i(a.$t("views.application.applicationAccess.larkPlatform")),1),r(i(a.$t("views.application.applicationAccess.larkSetting.urlInfo")),1)]),_:1})):_("",!0)]),_:1})]),_:1},8,["model","rules"])):_("",!0)]),_:1},8,["modelValue"])}}}),_e={class:"p-16-24"},he={class:"mb-16"},fe={class:"flex-between"},ke={class:"flex align-center ml-8 mr-8"},be=["src"],Ae={class:"ml-12"},ye={class:"mb-4"},Se=j({__name:"ApplicationAccess",setup(W){const T=G(),C=x(()=>T.path.includes("resource-management")?"systemManage":"workspace"),S=x(()=>ce.application[C.value]),I=B([{key:"wecom",logoSrc:new URL(""+new URL("logo_wechat-work-B6gndCCA.svg",import.meta.url).href,import.meta.url).href,name:e("views.application.applicationAccess.wecom"),description:e("views.application.applicationAccess.wecomTip"),isActive:!1,exists:!1},{key:"dingtalk",logoSrc:new URL("data:image/svg+xml,%3csvg%20width='40'%20height='40'%20viewBox='0%200%2040%2040'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M32.7371%2016.6285C32.6394%2016.9833%2032.5125%2017.3284%2032.3563%2017.6604H32.3595L32.34%2017.7027C31.23%2020.1961%2028.3297%2025.0917%2028.3297%2025.0917L28.3167%2025.0591L27.4704%2026.6085H31.5523L23.7531%2037.5L25.5239%2030.0915H22.3079L23.4244%2025.1926C22.5195%2025.4205%2021.455%2025.7362%2020.1888%2026.1626C20.1888%2026.1626%2018.4799%2027.214%2015.2607%2024.138C15.2607%2024.138%2013.0895%2022.1328%2014.3492%2021.6283C14.8831%2021.4167%2016.9468%2021.1466%2018.5711%2020.9122C20.7617%2020.5997%2022.1126%2020.4337%2022.1126%2020.4337C22.1126%2020.4337%2015.3518%2020.5411%2013.7471%2020.2742C12.1423%2020.0105%2010.1112%2017.1982%209.67497%2014.7276C9.67497%2014.7276%209.00443%2013.3702%2011.1137%2014.0115C13.2262%2014.6527%2021.9661%2016.5113%2021.9661%2016.5113C21.9661%2016.5113%2010.6027%2012.8559%209.84749%2011.964C9.09232%2011.0721%207.62103%207.08794%207.81308%204.64339C7.81308%204.64339%207.89771%204.03144%208.49339%204.19419C8.49339%204.19419%2016.898%208.23047%2022.6431%2010.4341C28.3883%2012.6443%2033.3816%2013.7706%2032.7371%2016.6285Z'%20fill='%233296FA'/%3e%3c/svg%3e",import.meta.url).href,name:e("views.application.applicationAccess.dingtalk"),description:e("views.application.applicationAccess.dingtalkTip"),isActive:!1,exists:!1},{key:"wechat",logoSrc:new URL("data:image/svg+xml,%3csvg%20width='40'%20height='40'%20viewBox='0%200%2040%2040'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M26.4855%2013.974C26.9025%2013.974%2027.3196%2014.0125%2027.7345%2014.0489C26.6184%208.86961%2021.0198%205%2014.6421%205C7.51045%205.02502%201.66672%209.84509%201.66672%2015.9656C1.66672%2019.4941%203.61468%2022.4043%206.85045%2024.6575L5.54437%2028.5227L10.0863%2026.2719C11.7134%2026.5901%2013.0196%2026.9084%2014.6261%2026.9084C15.0432%2026.9084%2015.4397%2026.8902%2015.8361%2026.8538C15.5785%2025.9748%2015.4451%2025.0642%2015.4397%2024.1483C15.4581%2018.537%2020.3208%2013.9762%2026.4878%2013.9762L26.4855%2013.974H26.4855ZM19.5051%2010.4862C20.4905%2010.4862%2021.1321%2011.1228%2021.1321%2012.1004C21.1321%2013.0553%2020.4905%2013.7147%2019.5051%2013.7147C18.5402%2013.7147%2017.5571%2013.0759%2017.5571%2012.1003C17.5571%2011.1228%2018.5402%2010.4862%2019.5051%2010.4862ZM10.4231%2013.7147C9.46072%2013.7147%208.47535%2013.0759%208.47535%2012.1003C8.47535%2011.1228%209.46072%2010.4862%2010.4231%2010.4862C11.388%2010.4862%2012.0503%2011.1228%2012.0503%2012.1004C12.0503%2013.0553%2011.4086%2013.7147%2010.4231%2013.7147ZM38.3334%2024.0141C38.3334%2018.8712%2033.1497%2014.6674%2027.3012%2014.6674C21.1343%2014.6674%2016.2714%2018.8712%2016.2714%2024.0141C16.2714%2029.1752%2021.1343%2033.3631%2027.3012%2033.3631C28.5892%2033.3631%2029.8953%2033.0448%2031.1994%2032.7243L34.756%2034.6568L33.7729%2031.4464C36.3854%2029.4776%2038.3334%2026.9038%2038.3334%2024.0141ZM23.7262%2022.3997C23.0846%2022.3997%2022.42%2021.7632%2022.42%2021.1039C22.42%2020.4673%2023.0846%2019.808%2023.7262%2019.808C24.7116%2019.808%2025.3534%2020.4469%2025.3534%2021.1039C25.3534%2021.7632%2024.7116%2022.3997%2023.7262%2022.3997ZM30.8602%2022.3997C30.2163%2022.3997%2029.5722%2021.7632%2029.5722%2021.1039C29.5722%2020.4673%2030.214%2019.808%2030.8602%2019.808C31.8433%2019.808%2032.4872%2020.4469%2032.4872%2021.1039C32.4872%2021.7632%2031.8433%2022.3997%2030.8602%2022.3997Z'%20fill='%2309BB07'/%3e%3c/svg%3e",import.meta.url).href,name:e("views.application.applicationAccess.wechat"),description:e("views.application.applicationAccess.wechatTip"),isActive:!1,exists:!1},{key:"lark",logoSrc:new URL(""+new URL("logo_lark-ClwkcAp-.svg",import.meta.url).href,import.meta.url).href,name:e("views.application.applicationAccess.lark"),description:e("views.application.applicationAccess.larkTip"),isActive:!1,exists:!1},{key:"slack",logoSrc:new URL("data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='40'%20height='40'%20viewBox='0%200%20128%20128'%3e%3cpath%20fill='%23de1c59'%20d='M27.255%2080.719c0%207.33-5.978%2013.317-13.309%2013.317S.63%2088.049.63%2080.719s5.987-13.317%2013.317-13.317h13.309zm6.709%200c0-7.33%205.987-13.317%2013.317-13.317s13.317%205.986%2013.317%2013.317v33.335c0%207.33-5.986%2013.317-13.317%2013.317c-7.33%200-13.317-5.987-13.317-13.317zm0%200'/%3e%3cpath%20fill='%2335c5f0'%20d='M47.281%2027.255c-7.33%200-13.317-5.978-13.317-13.309S39.951.63%2047.281.63s13.317%205.987%2013.317%2013.317v13.309zm0%206.709c7.33%200%2013.317%205.987%2013.317%2013.317s-5.986%2013.317-13.317%2013.317H13.946C6.616%2060.598.63%2054.612.63%2047.281c0-7.33%205.987-13.317%2013.317-13.317zm0%200'/%3e%3cpath%20fill='%232eb57d'%20d='M100.745%2047.281c0-7.33%205.978-13.317%2013.309-13.317s13.317%205.987%2013.317%2013.317s-5.987%2013.317-13.317%2013.317h-13.309zm-6.709%200c0%207.33-5.987%2013.317-13.317%2013.317s-13.317-5.986-13.317-13.317V13.946C67.402%206.616%2073.388.63%2080.719.63c7.33%200%2013.317%205.987%2013.317%2013.317zm0%200'/%3e%3cpath%20fill='%23ebb02e'%20d='M80.719%20100.745c7.33%200%2013.317%205.978%2013.317%2013.309s-5.987%2013.317-13.317%2013.317s-13.317-5.987-13.317-13.317v-13.309zm0-6.709c-7.33%200-13.317-5.987-13.317-13.317s5.986-13.317%2013.317-13.317h33.335c7.33%200%2013.317%205.986%2013.317%2013.317c0%207.33-5.987%2013.317-13.317%2013.317zm0%200'/%3e%3c/svg%3e",import.meta.url).href,name:e("views.application.applicationAccess.slack"),description:e("views.application.applicationAccess.slackTip"),isActive:!1,exists:!1}]),$=k(),L=k(!1),{params:{id:v}}=T;function b(l){$.value.open(v,l)}function h(){A()}function A(){L.value=!0,z({type:"application",systemType:C.value}).getPlatformStatus(v).then(l=>{I.forEach(m=>{m.isActive=l.data[m.key][1],m.exists=l.data[m.key][0]}),L.value=!1})}function t(l,m){const y={type:l,status:m};z({type:"application",systemType:C.value}).updatePlatformStatus(v,y).then(()=>{Q(e("common.saveSuccess"))})}return se(()=>{A()}),(l,m)=>{const y=p("el-text"),U=p("el-switch"),E=p("el-divider"),F=p("el-button"),N=p("el-card"),q=p("el-col"),M=p("el-row");return n(),D("div",_e,[o("h4",he,i(l.$t("views.application.applicationAccess.title")),1),d(M,{gutter:16},{default:c(()=>[(n(!0),D(X,null,J(I,(u,H)=>(n(),g(q,{xs:24,sm:24,md:12,lg:12,xl:12,class:"mb-16",key:H},{default:c(()=>[d(N,{shadow:"hover",class:"border-none cursor"},{default:c(()=>[o("div",fe,[o("div",ke,[o("img",{src:u.logoSrc,alt:"",class:"icon"},null,8,be),o("div",Ae,[o("h5",ye,i(u.name),1),d(y,{type:"info",style:{"font-size":"12px"}},{default:c(()=>[r(i(u.description),1)]),_:2},1024)])]),o("div",null,[S.value.access_edit(Z(v))?(n(),g(U,{key:0,size:"small",modelValue:u.isActive,"onUpdate:modelValue":a=>u.isActive=a,onChange:a=>t(u.key,u.isActive),disabled:!u.exists},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"])):_("",!0),d(E,{direction:"vertical"}),S.value.access_edit(Z(v))?(n(),g(F,{key:1,class:"mr-4",onClick:a=>b(u.key)},{default:c(()=>[r(i(l.$t("views.application.applicationAccess.setting")),1)]),_:2},1032,["onClick"])):_("",!0)])])]),_:2},1024)]),_:2},1024))),128))]),_:1}),d(we,{ref_key:"AccessSettingDrawerRef",ref:$,onRefresh:h},null,512)])}}});export{Se as default};
