import{aJ as se,aP as ie,aQ as ue,aR as O,cE as r,cF as re,df as ce,aS as n,d0 as me,aT as d,aM as s,cI as o,aN as C,cU as de,aX as t,cN as b,aO as g,aU as j,aL as F,cG as I,cH as D,c_ as E,dx as pe,d4 as ve}from"./admin-CylDRYrg.js";import{g as ge}from"./constant-DGIcxMTF.js";const fe={class:"flex-between mb-16"},_e={class:"flex-between complex-search"},be={class:"color-text-primary lighter"},he={class:"dialog-footer mt-24"},Ve=se({__name:"index",props:{type:{}},setup(W,{expose:G}){const J=ie(),{user:x}=ue(),M=W,N=O(()=>J.path.includes("resource-management")?"systemManage":"workspace"),S=O(()=>ge()),h=r(!1),$=r();re(h,e=>{var l;e||(y.value="",c.value="nickname",i.value={nickname:"",username:"",permission:void 0},U.value=[],p.current_page=1,p.total=0,v.value=[],(l=$.value)==null||l.clearSelection())});const z=r(!1),y=r(""),U=r([]),c=r("nickname"),i=r({nickname:"",username:"",permission:void 0}),Q=()=>{i.value={nickname:"",username:"",permission:void 0}},p=ce({current_page:1,page_size:20,total:0});function X(){p.current_page=1,_()}function T(){p.current_page=1,_()}const v=r([]),q=e=>{v.value=e},k=r(!1),f=r("");function K(){v.value.length!==0&&(k.value=!0)}function Y(){if(v.value.length===0||!f.value)return;const e=v.value.map(l=>({userId:l.id,permission:f.value}));P(e),A()}function A(){var e;k.value=!1,f.value="",v.value=[],(e=$.value)==null||e.clearSelection()}function Z(e,l){const m=[{userId:l.id,permission:e}];P(m)}function P(e){const l=x.getWorkspaceId()||"default";E({type:"resourceAuthorization",systemType:N.value}).putResourceAuthorization(l,y.value,M.type,e,z).then(()=>{pe(ve("common.submitSuccess")),_()})}const _=()=>{const e=x.getWorkspaceId()||"default",l={};i.value[c.value]&&(l[c.value]=i.value[c.value]),E({type:"resourceAuthorization",systemType:N.value}).getResourceAuthorization(e,y.value,M.type,p,l,z).then(m=>{U.value=m.data.records||[],p.total=m.data.total||0})};return G({open:e=>{y.value=e,h.value=!0,_()}}),(e,l)=>{const m=n("el-button"),w=n("el-option"),R=n("el-select"),B=n("el-input"),V=n("el-table-column"),H=n("el-radio"),L=n("el-radio-group"),ee=n("app-table"),le=n("el-text"),ae=n("el-dialog"),oe=n("el-drawer"),te=me("loading");return s(),d(oe,{modelValue:h.value,"onUpdate:modelValue":l[6]||(l[6]=a=>h.value=a),title:e.$t("views.system.resourceAuthorization.title"),size:"60%","append-to-body":!0},{default:o(()=>[C("div",fe,[t(m,{type:"primary",disabled:v.value.length===0,onClick:K},{default:o(()=>[b(g(e.$t("views.system.resourceAuthorization.setting.configure")),1)]),_:1},8,["disabled"]),C("div",_e,[t(R,{class:"complex-search__left",modelValue:c.value,"onUpdate:modelValue":l[0]||(l[0]=a=>c.value=a),style:{width:"100px"},onChange:Q},{default:o(()=>[t(w,{label:e.$t("views.userManage.userForm.nickname.label"),value:"nickname"},null,8,["label"]),t(w,{label:e.$t("views.login.loginForm.username.label"),value:"username"},null,8,["label"]),t(w,{label:e.$t("views.model.modelForm.permissionType.label"),value:"permission"},null,8,["label"])]),_:1},8,["modelValue"]),c.value==="nickname"?(s(),d(B,{key:0,modelValue:i.value.nickname,"onUpdate:modelValue":l[1]||(l[1]=a=>i.value.nickname=a),onChange:T,placeholder:e.$t("common.search"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):j("",!0),c.value==="username"?(s(),d(B,{key:1,modelValue:i.value.username,"onUpdate:modelValue":l[2]||(l[2]=a=>i.value.username=a),onChange:T,placeholder:e.$t("common.search"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):c.value==="permission"?(s(),d(R,{key:2,modelValue:i.value.permission,"onUpdate:modelValue":l[3]||(l[3]=a=>i.value.permission=a),onChange:T,filterable:"",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"",style:{width:"220px"}},{default:o(()=>[(s(!0),F(I,null,D(S.value,(a,u)=>(s(),d(w,{key:u,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):j("",!0)])]),de((s(),d(ee,{ref_key:"multipleTableRef",ref:$,class:"mt-16",data:U.value,"pagination-config":p,onSizeChange:X,onChangePage:_,onSelectionChange:q,maxTableHeight:200,"row-key":a=>a.id},{default:o(()=>[t(V,{type:"selection",width:"55","reserve-selection":!0}),t(V,{prop:"nickname",label:e.$t("views.userManage.userForm.nickname.label"),"min-width":"120","show-overflow-tooltip":""},null,8,["label"]),t(V,{prop:"username","min-width":"120","show-overflow-tooltip":"",label:e.$t("views.login.loginForm.username.label")},null,8,["label"]),t(V,{label:e.$t("common.operation"),align:"left",width:"340"},{default:o(({row:a})=>[t(L,{modelValue:a.permission,"onUpdate:modelValue":u=>a.permission=u,onChange:u=>Z(u,a)},{default:o(()=>[(s(!0),F(I,null,D(S.value,(u,ne)=>(s(),d(H,{key:ne,value:u.value,class:"mr-16"},{default:o(()=>[b(g(u.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["label"])]),_:1},8,["data","pagination-config","row-key"])),[[te,z.value]]),t(ae,{modelValue:k.value,"onUpdate:modelValue":l[5]||(l[5]=a=>k.value=a),title:e.$t("views.system.resourceAuthorization.setting.configure"),"destroy-on-close":"",onClose:A},{footer:o(()=>[C("div",he,[t(m,{onClick:A},{default:o(()=>[b(g(e.$t("common.cancel")),1)]),_:1}),t(m,{type:"primary",onClick:Y},{default:o(()=>[b(g(e.$t("common.confirm")),1)]),_:1})])]),default:o(()=>[t(L,{modelValue:f.value,"onUpdate:modelValue":l[4]||(l[4]=a=>f.value=a),class:"radio-block"},{default:o(()=>[(s(!0),F(I,null,D(S.value,(a,u)=>(s(),d(H,{key:u,value:a.value,class:"mr-16"},{default:o(()=>[C("p",be,g(a.label),1),t(le,{class:"color-secondary lighter"},{default:o(()=>[b(g(a.desc),1)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"])]),_:1},8,["modelValue","title"])}}});export{Ve as _};
