import{aJ as Qe,aQ as rl,cE as d,aR as le,aP as Xe,ep as pl,cF as cl,aT as f,cI as o,aS as c,aN as s,aX as t,aL as V,aO as u,cN as v,d8 as te,aU as A,dq as ml,cU as re,cW as Ie,eF as vl,eG as fl,aM as r,dr as Ae,eH as gl,eI as _l,db as Ye,d5 as yl,d4 as L,cP as Ze,cS as bl,e2 as hl,aK as wl,cT as kl,aV as k,c_ as N,dt as We,dH as Sl,c$ as Le,dI as Fe,d0 as Tl,d7 as Oe,d9 as je,cO as xe,cG as Ge,cH as He,dV as Il,da as E,cK as Je,dx as Ml}from"./admin-DcRor5Hd.js";import{_ as $l,c as Pl,e as Vl,d as Dl,a as Rl,b as Cl}from"./ToolDialog.vue_vue_type_style_index_0_lang-BiV_7Hwu.js";const El={class:"generate-prompt-dialog-bg border-r-8"},Al={class:"scrollbar-height"},Ll={class:"p-16 pb-0 lighter"},Ol={key:1,shadow:"always",style:{margin:"0.5rem 0"}},xl={key:2,class:"flex align-center"},ql={key:0,class:"mt-8"},Nl={key:1,class:"mt-8"},Ul={class:"generate-prompt-operate p-16"},Kl={key:0,class:"text-center mb-8"},Bl={class:"operate-textarea"},zl={class:"operate"},Wl={class:"text-right"},Fl={src:vl,alt:""},jl=Qe({__name:"GeneratePromptDialog",emits:["replace"],setup(el,{expose:z,emit:pe}){const S=pe,{user:b}=rl(),ce=Xe(),T=d([]),me=le(()=>ce.path.includes("resource-management")?"systemManage":"workspace"),U=d(""),ae=d(""),W=d(""),J=d(!1),h=d(""),w=d(!1),g={INIT_TEMPLATE:`
è¯·æ ¹æ®ç”¨æˆ·æè¿°ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„AIè§’è‰²äººè®¾æ¨¡æ¿:

åº”ç”¨åç§°ï¼š{application_name}
åº”ç”¨æè¿°ï¼š{detail}
ç”¨æˆ·éœ€æ±‚ï¼š{userInput}

é‡è¦è¯´æ˜ï¼š
1. è§’è‰²è®¾å®šå¿…é¡»æœåŠ¡äº"{application_name}"åº”ç”¨çš„æ ¸å¿ƒåŠŸèƒ½
2. å…è®¸ç”¨æˆ·å¯¹è§’è‰²è®¾å®šçš„å…·ä½“å†…å®¹è¿›è¡Œè°ƒæ•´å’Œä¼˜åŒ–
3. å¦‚æœç”¨æˆ·è¦æ±‚ä¿®æ”¹æŸä¸ªæŠ€èƒ½æˆ–éƒ¨åˆ†ï¼Œåœ¨ä¿æŒåº”ç”¨ä¸»é¢˜çš„å‰æä¸‹è¿›è¡Œç›¸åº”è°ƒæ•´

è¯·æŒ‰ä»¥ä¸‹æ ¼å¼ç”Ÿæˆï¼š

å¿…é¡»ä¸¥æ ¼éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š
1. **ä¸¥æ ¼ç¦æ­¢è¾“å‡ºè§£é‡Šã€å‰è¨€ã€é¢å¤–è¯´æ˜**ï¼Œåªè¾“å‡ºæœ€ç»ˆç»“æœã€‚
2. **ä¸¥æ ¼ä½¿ç”¨ä»¥ä¸‹æ ¼å¼**ï¼Œä¸èƒ½ç¼ºå°‘æ ‡é¢˜ã€ä¸èƒ½å¤šå‡ºå…¶ä»–æ®µè½ã€‚
3. **å¦‚æœç”¨æˆ·è¦æ±‚ä¿®æ”¹è§’è‰²è®¾å®šçš„æŸä¸ªéƒ¨åˆ†ï¼Œåœ¨ä¿æŒåº”ç”¨æ ¸å¿ƒåŠŸèƒ½çš„å‰æä¸‹è¿›è¡Œè°ƒæ•´**ã€‚
4. **å¦‚æœç”¨æˆ·éœ€æ±‚ä¸è§’è‰²è®¾å®šç”Ÿæˆå®Œå…¨æ— å…³ï¼ˆå¦‚é—²èŠã€å…¶ä»–è¯é¢˜ï¼‰ï¼Œåˆ™å¿½ç•¥ç”¨æˆ·éœ€æ±‚ï¼ŒåŸºäºåº”ç”¨ä¿¡æ¯ç”Ÿæˆæ ‡å‡†è§’è‰²è®¾å®š**ã€‚

# è§’è‰²:
è§’è‰²æ¦‚è¿°å’Œä¸»è¦èŒè´£çš„ä¸€å¥è¯æè¿°

## ç›®æ ‡ï¼š
è§’è‰²çš„å·¥ä½œç›®æ ‡,å¦‚æœæœ‰å¤šç›®æ ‡å¯ä»¥åˆ†ç‚¹åˆ—å‡º,ä½†å»ºè®®æ›´èšç„¦1-2ä¸ªç›®æ ‡

## æ ¸å¿ƒæŠ€èƒ½ï¼š
### æŠ€èƒ½ 1: [æŠ€èƒ½åç§°ï¼Œå¦‚ä½œå“æ¨è/ä¿¡æ¯æŸ¥è¯¢/ä¸“ä¸šåˆ†æç­‰]
1. [æ‰§è¡Œæ­¥éª¤1 - æè¿°è¯¥æŠ€èƒ½çš„ç¬¬ä¸€ä¸ªå…·ä½“æ“ä½œæ­¥éª¤ï¼ŒåŒ…æ‹¬æ¡ä»¶åˆ¤æ–­å’Œå¤„ç†æ–¹å¼]
2. [æ‰§è¡Œæ­¥éª¤2 - æè¿°è¯¥æŠ€èƒ½çš„ç¬¬äºŒä¸ªå…·ä½“æ“ä½œæ­¥éª¤ï¼ŒåŒ…æ‹¬å¦‚ä½•è·å–æˆ–å¤„ç†ä¿¡æ¯]
3. [æ‰§è¡Œæ­¥éª¤3 - æè¿°è¯¥æŠ€èƒ½çš„æœ€ç»ˆè¾“å‡ºæ­¥éª¤ï¼Œè¯´æ˜å¦‚ä½•å‘ˆç°ç»“æœ]

===å›å¤ç¤ºä¾‹===
- ğŸ“‹ [æ ‡è¯†ç¬¦]: <å…·ä½“å†…å®¹æ ¼å¼è¯´æ˜>
- ğŸ¯ [æ ‡è¯†ç¬¦]: <å…·ä½“å†…å®¹æ ¼å¼è¯´æ˜>
- ğŸ’¡ [æ ‡è¯†ç¬¦]: <å…·ä½“å†…å®¹æ ¼å¼è¯´æ˜>
===ç¤ºä¾‹ç»“æŸ===

### æŠ€èƒ½ 2: [æŠ€èƒ½åç§°]
1. [æ‰§è¡Œæ­¥éª¤1 - æè¿°è§¦å‘æ¡ä»¶å’Œåˆå§‹å¤„ç†æ–¹å¼]
2. [æ‰§è¡Œæ­¥éª¤2 - æè¿°ä¿¡æ¯è·å–å’Œæ·±åŒ–å¤„ç†çš„å…·ä½“æ–¹æ³•]
3. [æ‰§è¡Œæ­¥éª¤3 - æè¿°æœ€ç»ˆè¾“å‡ºçš„å…·ä½“è¦æ±‚å’Œæ ¼å¼]

### æŠ€èƒ½ 3: [æŠ€èƒ½åç§°]
- [æ ¸å¿ƒèƒ½åŠ›æè¿° - è¯´æ˜è¯¥æŠ€èƒ½çš„ä¸»è¦ä½œç”¨å’ŒçŸ¥è¯†åŸºç¡€]
- [åº”ç”¨æ–¹æ³• - æè¿°å¦‚ä½•è¿ç”¨è¯¥æŠ€èƒ½ä¸ºç”¨æˆ·æä¾›æœåŠ¡ï¼ŒåŒ…æ‹¬å…·ä½“çš„å®æ–½æ–¹å¼]

## å·¥ä½œæµï¼š
1. æè¿°è§’è‰²å·¥ä½œæµç¨‹çš„ç¬¬ä¸€æ­¥
2. æè¿°è§’è‰²å·¥ä½œæµç¨‹çš„ç¬¬äºŒæ­¥
3. æè¿°è§’è‰²å·¥ä½œæµç¨‹çš„ç¬¬ä¸‰æ­¥

## è¾“å‡ºæ ¼å¼ï¼š
å¦‚æœå¯¹è§’è‰²çš„è¾“å‡ºæ ¼å¼æœ‰ç‰¹å®šè¦æ±‚ï¼Œå¯ä»¥åœ¨è¿™é‡Œå¼ºè°ƒå¹¶ä¸¾ä¾‹è¯´æ˜æƒ³è¦çš„è¾“å‡ºæ ¼å¼


## é™åˆ¶ï¼š
1. **ä¸¥æ ¼é™åˆ¶å›ç­”èŒƒå›´**ï¼šä»…å›ç­”ä¸è§’è‰²è®¾å®šç›¸å…³çš„é—®é¢˜ã€‚
   - å¦‚æœç”¨æˆ·æé—®ä¸è§’è‰²æ— å…³ï¼Œå¿…é¡»ä½¿ç”¨ä»¥ä¸‹å›ºå®šæ ¼å¼å›å¤ï¼š
     â€œå¯¹ä¸èµ·ï¼Œæˆ‘åªèƒ½å›ç­”ä¸[è§’è‰²è®¾å®š]ç›¸å…³çš„é—®é¢˜ï¼Œæ‚¨çš„é—®é¢˜ä¸åœ¨æœåŠ¡èŒƒå›´å†…ã€‚â€
   - ä¸å¾—æä¾›ä»»ä½•ä¸è§’è‰²è®¾å®šæ— å…³çš„å›ç­”ã€‚
2. æè¿°è§’è‰²åœ¨äº’åŠ¨è¿‡ç¨‹ä¸­éœ€è¦éµå¾ªçš„é™åˆ¶æ¡ä»¶2
3. æè¿°è§’è‰²åœ¨äº’åŠ¨è¿‡ç¨‹ä¸­éœ€è¦éµå¾ªçš„é™åˆ¶æ¡ä»¶3

è¾“å‡ºæ—¶ä¸å¾—åŒ…å«ä»»ä½•è§£é‡Šæˆ–é™„åŠ è¯´æ˜ï¼Œåªèƒ½è¿”å›ç¬¦åˆä»¥ä¸Šæ ¼å¼çš„å†…å®¹ã€‚
  `},I=d(!1),e=d(!1),M=d(""),O=d(0);let K=null;const Q=d(!1),ve=()=>{K&&clearInterval(K),I.value=!0,e.value=!1,K=setInterval(()=>{if(X.value&&!e.value){const n=T.value[T.value.length-1];n&&n.role==="ai"&&(n.content=M.value),F();return}if(!e.value&&O.value<M.value.length){const n=Math.min(3,M.value.length-O.value);O.value+=n;const p=T.value[T.value.length-1];p&&p.role==="ai"&&(p.content=M.value.substring(0,O.value))}else w.value===!1&&O.value>=M.value.length&&F()},50)},F=()=>{K&&(clearInterval(K),K=null),I.value=!1,e.value=!1,w.value=!1,Q.value=!0},Me=le(()=>I.value),$e=()=>{e.value=!0,I.value=!1},fe=()=>{O.value<M.value.length&&ve()},D=n=>{let p="";const R=Ye({content:"",role:"ai"});T.value.push(R),M.value="",O.value=0,Q.value=!1;let _=!1;const $=({done:q,value:Y})=>{try{if(q){w.value=!1,X.value=!0;return}let P=new TextDecoder("utf-8").decode(Y,{stream:!0});p+=P;const G=p.match(/data:.*}\n\n/g);if(G)P=G.join(""),p=p.replace(P,"");else return n.read().then($);if(P&&P.startsWith("data:")&&G)for(const Re in G){const ee=JSON==null?void 0:JSON.parse(G[Re].replace("data:",""));if(ee.isEnd||(M.value+=ee.content,_||(_=!0,ve())),ee.isEnd)return Promise.resolve()}}catch(Z){return w.value=!1,F(),Promise.reject(Z)}return n.read().then($)};return $},X=d(!1),x=le(()=>{const n=T.value[T.value.length-1];return n&&n.role=="ai"?n.content:""}),ge=le(()=>!I.value&&e.value&&O.value<M.value.length);function _e(n){X.value=!1,w.value=!0;const p=b.getWorkspaceId()||"default";T.value.push({content:n,role:"user"});const R={messages:T.value,prompt:g.INIT_TEMPLATE};me.value==="workspace"?gl.generate_prompt(p,ae.value,W.value,R).then(_=>{Ae(()=>{j.value&&B.value.setScrollTop(oe())});const $=_.body.getReader();$.read().then(D($))}):me.value==="systemManage"&&_l.generate_prompt(W.value,ae.value,R).then(_=>{Ae(()=>{j.value&&B.value.setScrollTop(oe())});const $=_.body.getReader();$.read().then(D($))})}const Pe=()=>{U.value&&_e("ç»“æœä¸æ»¡æ„,è¯·æŒ‰ç…§æ ¼å¼,é‡æ–°ç”Ÿæˆ")},ye=d(),be=n=>{if(!(n!=null&&n.ctrlKey)&&!(n!=null&&n.shiftKey)&&!(n!=null&&n.altKey)&&!(n!=null&&n.metaKey)){if(n==null||n.preventDefault(),!h.value.trim()||w.value||I.value||(U.value||(U.value=h.value),e.value||I.value))return;h.value&&(_e(h.value),h.value="")}else Ve(n)},Ve=n=>{const p=ye.value.$el.querySelector(".el-textarea__inner"),R=p.selectionStart,_=p.selectionEnd;n.preventDefault(),h.value=h.value.slice(0,R)+`
`+h.value.slice(_),Ae(()=>{p.setSelectionRange(R+1,R+1)})},De=(n,p)=>{ae.value=n,W.value=p,J.value=!0,U.value="",T.value=[]},B=d(),j=d(),oe=()=>j.value.scrollHeight,he=()=>{var n;B.value&&B.value.wrapRef.offsetHeight<((n=j.value)==null?void 0:n.scrollHeight)&&B.value.setScrollTop(oe())},we=n=>{x.value?yl(L("common.tip"),L("views.application.generateDialog.exit"),{confirmButtonText:L("common.confirm"),cancelButtonText:L("common.cancel"),distinguishCancelAndClose:!0}).then(()=>{F(),T.value=[],M.value="",O.value=0,Q.value=!1,n()}).catch(()=>{}):n()};return pl(()=>{F()}),cl(x,()=>{he()},{deep:!0,immediate:!0}),z({open:De}),(n,p)=>{const R=c("Loading"),_=c("el-icon"),$=c("el-scrollbar"),q=c("el-button"),Y=c("el-input"),Z=c("el-dialog");return r(),f(Z,{"align-center":"",title:n.$t("views.application.generateDialog.generatePrompt"),modelValue:J.value,"onUpdate:modelValue":p[3]||(p[3]=P=>J.value=P),style:{width:"600px"},"append-to-body":"","close-on-click-modal":!0,"close-on-press-escape":!0,"before-close":we},{default:o(()=>[s("div",El,[s("div",Al,[s("div",Ll,[t($,{ref_key:"scrollDiv",ref:B},{default:o(()=>[x.value?(r(),V("div",{key:0,ref_key:"dialogScrollbar",ref:j,class:"pre-wrap lighter",style:{"max-height":"calc(100vh - 400px)"}},u(x.value),513)):w.value?(r(),V("p",Ol,[t(_,{class:"is-loading color-primary mr-4"},{default:o(()=>[t(R)]),_:1}),v(" "+u(n.$t("views.application.generateDialog.loading"))+" ",1),p[4]||(p[4]=s("span",{class:"dotting"},null,-1))])):(r(),V("p",xl,[t(te,{iconName:"app-generate-star",class:"color-primary mr-4"}),v(" "+u(n.$t("views.application.generateDialog.title")),1)]))]),_:1},512),x.value&&!w.value&&!I.value&&!ge.value?(r(),V("div",ql,[t(q,{type:"primary",onClick:p[0]||(p[0]=()=>S("replace",x.value))},{default:o(()=>[v(u(n.$t("views.application.generateDialog.replace")),1)]),_:1}),t(q,{onClick:Pe,disabled:!x.value||w.value,loading:w.value},{default:o(()=>[v(u(n.$t("views.application.generateDialog.remake")),1)]),_:1},8,["disabled","loading"])])):(r(),V("div",Nl,[ge.value?(r(),f(q,{key:0,type:"primary",onClick:fe,link:""},{default:o(()=>[v(u(n.$t("views.application.generateDialog.continue")),1)]),_:1})):A("",!0)]))]),s("div",Ul,[Me.value?(r(),V("div",Kl,[t(q,{class:"border-primary video-stop-button",onClick:$e},{default:o(()=>[t(te,{iconName:"app-video-stop",class:"mr-8"}),v(" "+u(n.$t("views.application.generateDialog.stop")),1)]),_:1})])):A("",!0),s("div",Bl,[t(Y,{ref_key:"quickInputRef",ref:ye,modelValue:h.value,"onUpdate:modelValue":p[1]||(p[1]=P=>h.value=P),autosize:{minRows:1,maxRows:10},type:"textarea",placeholder:n.$t("views.application.generateDialog.placeholder"),maxlength:1e5,class:"chat-operate-textarea",onKeydown:p[2]||(p[2]=ml(P=>be(P),["enter"]))},null,8,["modelValue","placeholder"]),s("div",zl,[s("div",Wl,[t(q,{text:"",class:"sent-button",disabled:!h.value.trim()||w.value||I.value,onClick:be},{default:o(()=>[re(s("img",Fl,null,512),[[Ie,!h.value.trim()||w.value||I.value]]),re(t(fl,null,null,512),[[Ie,h.value.trim()&&!w.value&&!I.value]])]),_:1},8,["disabled"])])])])])])])]),_:1},8,["title","modelValue"])}}}),Gl=Ze(jl,[["__scopeId","data-v-2168fa76"]]),Hl={class:"p-16-24 application-setting"},Jl={class:"flex-between w-full mb-16"},Ql={class:"p-24 mb-16",style:{"padding-bottom":"0"}},Xl={class:"title-decoration-1"},Yl={class:"scrollbar-height-left"},Zl={class:"flex-between"},et={class:"flex-between"},lt={class:"flex-between"},tt={class:"flex align-center"},at={class:"flex-between"},ot={class:"w-full"},st={key:0,class:"flex-between border border-r-6 white-bg mb-4",style:{padding:"5px 8px"}},nt={class:"flex align-center",style:{"line-height":"20px"}},it=["src"],ut=["title"],dt={class:"flex-between"},rt={class:"w-full"},pt={key:0,class:"flex-between border border-r-6 white-bg mb-4",style:{padding:"5px 8px"}},ct={class:"flex align-center",style:{"line-height":"20px"}},mt=["src"],vt=["title"],ft={class:"flex-between"},gt={class:"mr-4"},_t={class:"flex"},yt={class:"flex-between"},bt={class:"mr-4"},ht={class:"flex"},wt={class:"flex-between"},kt={class:"mr-4"},St={key:0,class:"color-danger"},Tt={class:"flex"},It={class:"flex-between"},Mt={class:"mr-4"},$t={key:0,class:"color-danger"},Pt={class:"flex"},Vt={class:"w-full"},Dt={class:"flex-between w-full"},Rt={class:"title-decoration-1 mb-16"},Ct={class:"dialog-bg"},Et={class:"scrollbar-height"},At=Qe({__name:"ApplicationSetting",setup(el){const z=Xe(),pe=wl(),{params:{id:S}}=z,b=le(()=>z.path.includes("resource-management")?"systemManage":"workspace"),ce=le(()=>bl.application[b.value]),T=L("views.application.form.prompt.defaultPrompt",{data:"{data}",question:"{question}"}),me=L("views.application.dialog.defaultPrompt1",{question:"{question}"})+"<data></data>"+L("views.application.dialog.defaultPrompt2"),U=d(),ae=d(),W=d(),J=d(),h=d(),w=d(),g=d(!1),I=d(!1),e=d({name:"",desc:"",modelId:"",dialogueNumber:1,prologue:L("views.application.form.defaultPrologue"),knowledgeIdList:[],knowledgeSetting:{topN:3,similarity:.6,maxParagraphCharNumber:5e3,searchMode:"embedding",noReferencesSetting:{status:"ai_questioning",value:"{question}"}},toolIds:[],toolOutputEnable:!1,modelSetting:{prompt:T,system:L("views.application.form.roleSettings.placeholder"),noReferencesPrompt:"{question}",reasoningContentEnable:!1},modelParamsSetting:{},problemOptimization:!1,problemOptimizationPrompt:me,sttModelId:"",ttsModelId:"",sttModelEnable:!1,ttsModelEnable:!1,ttsType:"BROWSER",type:"SIMPLE"}),M=d();function O(){M.value.open(e.value.toolIds)}function K(l){e.value.toolIds&&(e.value.toolIds=e.value.toolIds.filter(a=>a!==l))}const Q=d(),ve=()=>{var l;e.value.modelId&&((l=Q.value)==null||l.open(e.value.modelId,S))};function F(l){e.value.toolIds=l.toolIds}d({});const Me=l=>{e.value.modelSetting.system=l},$e=Ye({name:[{required:!0,message:L("views.application.form.appName.placeholder"),trigger:"blur"}]}),fe=d(null),D=d([]),X=d(null),x=d(null);function ge(l){e.value.prologue=l}function _e(l){e.value.modelSetting.system=l}function Pe(l){e.value.modelSetting={...e.value.modelSetting,...l}}const ye=l=>{l&&l.validate().then(()=>N({type:"application",systemType:b.value}).putApplication(S,e.value,g).then(()=>N({type:"application",systemType:b.value}).publish(S,{},g)).then(()=>{We(L("views.application.tip.publishSuccess"))}))},be=async l=>{l&&await l.validate((a,m)=>{a&&N({type:"application",systemType:b.value}).putApplication(S,e.value,g).then(()=>{We(L("common.saveSuccess"))})})},Ve=l=>{var a;e.value.modelId=l,l?(a=U.value)==null||a.reset_default(l,S):he({})},De=()=>{var l;e.value.modelId&&((l=U.value)==null||l.open(e.value.modelId,S,e.value.modelParamsSetting))},B=()=>{var l;e.value.ttsModelId&&((l=W.value)==null||l.open(e.value.ttsModelId,S,e.value.ttsModelParamsSetting))},j=()=>{var l;(l=J.value)==null||l.open(e.value)};function oe(l){e.value={...e.value,...l}}function he(l){e.value.modelParamsSetting=l}function we(l){e.value.ttsModelParamsSetting=l}function n(l){e.value.knowledgeIdList&&e.value.knowledgeIdList.splice(e.value.knowledgeIdList.indexOf(l),1)}function p(l){D.value=l,e.value.knowledgeIdList=l.map(a=>a.id)}function R(){w.value.open(e.value.knowledgeIdList)}const _=d([]);function $(){var a;const l=b.value==="systemManage"?{scope:"WORKSPACE",workspaceId:(a=e.value)==null?void 0:a.workspaceId}:{scope:"WORKSPACE"};N({type:"tool",systemType:b.value}).getAllToolList(l).then(m=>{_.value=[...m.data.shared_tools,...m.data.tools].filter(ke=>ke.isActive)})}function q(){N({type:"application",systemType:b.value}).getApplicationDetail(S,g).then(l=>{e.value=l.data,e.value.modelId=l.data.modelId,e.value.sttModelId=l.data.sttModelId,e.value.ttsModelId=l.data.ttsModelId,e.value.ttsType=l.data.ttsType,D.value=l.data.knowledgeList,e.value.modelSetting.noReferencesPrompt=l.data.modelSetting.noReferencesPrompt||"{question}",Sl([Fe.IS_EE,Fe.IS_PE],"OR")&&N({type:"application",systemType:b.value}).getApplicationSetting(S).then(a=>{e.value={...e.value,...a.data}})})}function Y(){var a;g.value=!0;const l=b.value==="systemManage"?{modelType:"LLM",workspaceId:(a=e.value)==null?void 0:a.workspaceId}:{modelType:"LLM"};N({type:"model",systemType:b.value}).getSelectModelList(l).then(m=>{fe.value=Le.groupBy(m==null?void 0:m.data,"provider"),g.value=!1}).catch(()=>{g.value=!1})}function Z(){var a;g.value=!0;const l=b.value==="systemManage"?{modelType:"STT",workspaceId:(a=e.value)==null?void 0:a.workspaceId}:{modelType:"STT"};N({type:"model",systemType:b.value}).getSelectModelList(l).then(m=>{X.value=Le.groupBy(m==null?void 0:m.data,"provider"),g.value=!1}).catch(()=>{g.value=!1})}function P(){var a;g.value=!0;const l=b.value==="systemManage"?{modelType:"TTS",workspaceId:(a=e.value)==null?void 0:a.workspaceId}:{modelType:"TTS"};N({type:"model",systemType:b.value}).getSelectModelList(l).then(m=>{x.value=Le.groupBy(m==null?void 0:m.data,"provider"),g.value=!1}).catch(()=>{g.value=!1})}const G=l=>{var a;e.value.ttsModelId=l,l?(a=W.value)==null||a.reset_default(l,S):we({})};function Re(){e.value.ttsModelEnable||(e.value.ttsModelId=void 0,e.value.ttsType="BROWSER")}function ee(){e.value.sttModelEnable||(e.value.sttModelId=void 0)}return hl(()=>{z.path.includes("WORK_FLOW")&&(b.value=="workspace"?pe.push(`/application/workspace/${z.params.id}/workflow`):pe.push(`/application/resource-management/${z.params.id}/workflow`))}),kl(()=>{Y(),q(),Z(),P(),$()}),(l,a)=>{const m=c("el-button"),ke=c("el-input"),C=c("el-form-item"),ll=c("el-tooltip"),tl=c("el-input-number"),qe=c("Plus"),se=c("el-icon"),Ne=c("el-text"),Ue=c("el-avatar"),Ke=c("Close"),Se=c("el-col"),Ce=c("el-row"),al=c("ToolIcon"),Te=c("el-switch"),Be=c("el-checkbox"),ze=c("el-radio"),ol=c("el-radio-group"),sl=c("Operation"),nl=c("el-form"),il=c("el-scrollbar"),ul=c("el-card"),dl=Tl("loading");return r(),V("div",Hl,[s("div",Jl,[s("h3",null,u(l.$t("common.setting")),1),s("div",null,[ce.value.edit(k(S))?(r(),f(m,{key:0,type:"primary",onClick:a[0]||(a[0]=i=>be(h.value)),disabled:g.value},{default:o(()=>[v(u(l.$t("common.save")),1)]),_:1},8,["disabled"])):A("",!0),ce.value.edit(k(S))?(r(),f(m,{key:1,type:"primary",onClick:a[1]||(a[1]=i=>ye(h.value)),disabled:g.value},{default:o(()=>[v(u(l.$t("views.application.operation.publish")),1)]),_:1},8,["disabled"])):A("",!0)])]),t(ul,{style:{"--el-card-padding":"0"}},{default:o(()=>[re((r(),f(Ce,null,{default:o(()=>[t(Se,{span:10},{default:o(()=>[s("div",Ql,[s("h4",Xl,u(l.$t("views.applicationOverview.appInfo.header")),1)]),s("div",Yl,[t(il,null,{default:o(()=>[t(nl,{"hide-required-asterisk":"",ref_key:"applicationFormRef",ref:h,model:e.value,rules:$e,"label-position":"top","require-asterisk-position":"right",class:"p-24",style:{"padding-top":"0"}},{default:o(()=>[t(C,{prop:"name"},{label:o(()=>[s("div",Zl,[s("span",null,[v(u(l.$t("views.application.form.appName.label"))+" ",1),a[21]||(a[21]=s("span",{class:"color-danger"},"*",-1))])])]),default:o(()=>[t(ke,{modelValue:e.value.name,"onUpdate:modelValue":a[2]||(a[2]=i=>e.value.name=i),maxlength:"64",placeholder:l.$t("views.application.form.appName.placeholder"),"show-word-limit":"",onBlur:a[3]||(a[3]=i=>{var y;return e.value.name=(y=e.value.name)==null?void 0:y.trim()})},null,8,["modelValue","placeholder"])]),_:1}),t(C,{label:l.$t("views.application.form.appDescription.label")},{default:o(()=>[t(ke,{modelValue:e.value.desc,"onUpdate:modelValue":a[4]||(a[4]=i=>e.value.desc=i),type:"textarea",placeholder:l.$t("views.application.form.appDescription.placeholder"),rows:3,maxlength:"256","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(C,{label:l.$t("views.application.form.aiModel.label")},{label:o(()=>[s("div",et,[s("span",null,u(l.$t("views.application.form.aiModel.label")),1),t(m,{type:"primary",link:"",onClick:De,disabled:!e.value.modelId},{default:o(()=>[t(te,{iconName:"app-setting",class:"mr-4"}),v(" "+u(l.$t("common.paramSetting")),1)]),_:1},8,["disabled"])])]),default:o(()=>[t(Oe,{modelValue:e.value.modelId,"onUpdate:modelValue":a[5]||(a[5]=i=>e.value.modelId=i),placeholder:l.$t("views.application.form.aiModel.placeholder"),options:fe.value,onChange:Ve,onSubmitModel:Y,showFooter:!1,"model-type":"LLM"},null,8,["modelValue","placeholder","options"])]),_:1},8,["label"]),t(C,null,{label:o(()=>[s("div",lt,[s("div",tt,[s("span",null,u(l.$t("views.application.form.roleSettings.label")),1),t(ll,{effect:"dark",content:l.$t("views.application.form.roleSettings.tooltip"),placement:"right"},{default:o(()=>[t(te,{iconName:"app-warning",class:"app-warning-icon ml-4"})]),_:1},8,["content"])]),t(m,{type:"primary",link:"",onClick:ve,disabled:!e.value.modelId},{default:o(()=>[t(te,{iconName:"app-generate-star",class:"mr-4"}),v(" "+u(l.$t("views.application.generateDialog.label")),1)]),_:1},8,["disabled"])])]),default:o(()=>[t(je,{title:l.$t("views.application.form.roleSettings.label"),modelValue:e.value.modelSetting.system,"onUpdate:modelValue":a[6]||(a[6]=i=>e.value.modelSetting.system=i),style:{height:"120px"},onSubmitDialog:_e,placeholder:l.$t("views.application.form.roleSettings.placeholder",{data:"{data}",question:"{question}"})},null,8,["title","modelValue","placeholder"])]),_:1}),t(C,{label:l.$t("views.application.form.historyRecord.label"),onClick:a[8]||(a[8]=xe(()=>{},["prevent"]))},{default:o(()=>[t(tl,{modelValue:e.value.dialogueNumber,"onUpdate:modelValue":a[7]||(a[7]=i=>e.value.dialogueNumber=i),min:0,"value-on-clear":0,"controls-position":"right",class:"w-full",step:1,"step-strictly":!0},null,8,["modelValue"])]),_:1},8,["label"]),t(C,{label:"$t('views.application.form.relatedKnowledgeBase')"},{label:o(()=>[s("div",at,[s("span",null,u(l.$t("views.application.form.relatedKnowledge.label")),1),s("div",null,[t(m,{type:"primary",link:"",onClick:j},{default:o(()=>[t(te,{iconName:"app-operation",class:"mr-4"}),v(" "+u(l.$t("common.paramSetting")),1)]),_:1}),t(m,{type:"primary",link:"",onClick:R},{default:o(()=>[t(se,{class:"mr-4"},{default:o(()=>[t(qe)]),_:1}),v(" "+u(l.$t("common.add")),1)]),_:1})])])]),default:o(()=>{var i;return[s("div",ot,[((i=e.value.knowledgeIdList)==null?void 0:i.length)===0?(r(),f(Ne,{key:0,type:"info"},{default:o(()=>[v(u(l.$t("views.application.form.relatedKnowledge.placeholder")),1)]),_:1})):(r(),f(Ce,{key:1,gutter:12},{default:o(()=>[(r(!0),V(Ge,null,He(e.value.knowledgeIdList,(y,Ee)=>(r(),f(Se,{xs:24,sm:24,md:24,lg:12,xl:12,class:"mb-8",key:Ee},{default:o(()=>{var ne,ie,ue,de;return[k(E)(D.value,y,"id")?(r(),V("div",st,[s("div",nt,[(ne=k(E)(D.value,y,"id"))!=null&&ne.icon?(r(),f(Ue,{key:0,shape:"square",size:20,style:{background:"none"},class:"mr-8"},{default:o(()=>{var H;return[s("img",{src:k(Je)((H=k(E)(D.value,y,"id"))==null?void 0:H.icon),alt:""},null,8,it)]}),_:2},1024)):(r(),f(Ml,{key:1,type:(ie=k(E)(D.value,y,"id"))==null?void 0:ie.type,class:"mr-12"},null,8,["type"])),s("div",{class:"ellipsis",title:(ue=k(E)(D.value,y,"id"))==null?void 0:ue.name},u((de=k(E)(D.value,y,"id"))==null?void 0:de.name),9,ut)]),t(m,{text:"",onClick:H=>n(y)},{default:o(()=>[t(se,null,{default:o(()=>[t(Ke)]),_:1})]),_:2},1032,["onClick"])])):A("",!0)]}),_:2},1024))),128))]),_:1}))])]}),_:1}),t(C,{label:"$t('views.tool.title')"},{label:o(()=>[s("div",dt,[s("span",null,u(l.$t("views.tool.title")),1),s("div",null,[t(m,{type:"primary",link:"",onClick:O},{default:o(()=>[t(se,{class:"mr-4"},{default:o(()=>[t(qe)]),_:1}),v(" "+u(l.$t("common.add")),1)]),_:1})])])]),default:o(()=>{var i;return[s("div",rt,[((i=e.value.toolIds)==null?void 0:i.length)===0?(r(),f(Ne,{key:0,type:"info"},{default:o(()=>[v(u(l.$t("views.application.form.relatedKnowledge.placeholder")),1)]),_:1})):(r(),f(Ce,{key:1,gutter:12},{default:o(()=>[(r(!0),V(Ge,null,He(e.value.toolIds,(y,Ee)=>(r(),f(Se,{xs:24,sm:24,md:24,lg:12,xl:12,class:"mb-8",key:Ee},{default:o(()=>{var ne,ie,ue,de;return[k(E)(_.value,y,"id")?(r(),V("div",pt,[s("div",ct,[(ne=k(E)(_.value,y,"id"))!=null&&ne.icon?(r(),f(Ue,{key:0,shape:"square",size:20,style:{background:"none"},class:"mr-8"},{default:o(()=>{var H;return[s("img",{src:k(Je)((H=k(E)(_.value,y,"id"))==null?void 0:H.icon),alt:""},null,8,mt)]}),_:2},1024)):(r(),f(al,{key:1,type:(ie=k(E)(_.value,y,"id"))==null?void 0:ie.toolType,class:"mr-8",size:20},null,8,["type"])),s("div",{class:"ellipsis",title:(ue=k(E)(_.value,y,"id"))==null?void 0:ue.name},u((de=k(E)(_.value,y,"id"))==null?void 0:de.name),9,vt)]),t(m,{text:"",onClick:H=>K(y)},{default:o(()=>[t(se,null,{default:o(()=>[t(Ke)]),_:1})]),_:2},1032,["onClick"])])):A("",!0)]}),_:2},1024))),128))]),_:1}))])]}),_:1}),t(C,{label:l.$t("views.application.form.prologue")},{default:o(()=>[t(je,{title:l.$t("views.application.form.prologue"),modelValue:e.value.prologue,"onUpdate:modelValue":a[9]||(a[9]=i=>e.value.prologue=i),style:{height:"150px"},onSubmitDialog:ge},null,8,["title","modelValue"])]),_:1},8,["label"]),t(C,{onClick:a[11]||(a[11]=xe(()=>{},["prevent"]))},{label:o(()=>[s("div",ft,[s("span",gt,u(l.$t("views.application.form.reasoningContent.label")),1),s("div",_t,[t(Te,{class:"ml-8",size:"small",modelValue:e.value.modelSetting.reasoningContentEnable,"onUpdate:modelValue":a[10]||(a[10]=i=>e.value.modelSetting.reasoningContentEnable=i),onChange:ee},null,8,["modelValue"])])])]),_:1}),t(C,{onClick:a[13]||(a[13]=xe(()=>{},["prevent"]))},{label:o(()=>[s("div",yt,[s("span",bt,u(l.$t("views.application.form.toolOutputEnable")),1),s("div",ht,[t(Te,{class:"ml-8",size:"small",modelValue:e.value.toolOutputEnable,"onUpdate:modelValue":a[12]||(a[12]=i=>e.value.toolOutputEnable=i)},null,8,["modelValue"])])])]),_:1}),t(C,{prop:"sttModelId",rules:{required:e.value.sttModelEnable,message:l.$t("views.application.form.voiceInput.requiredMessage"),trigger:"change"}},{label:o(()=>[s("div",wt,[s("span",kt,[v(u(l.$t("views.application.form.voiceInput.label"))+" ",1),e.value.sttModelEnable?(r(),V("span",St,"*")):A("",!0)]),s("div",Tt,[e.value.sttModelEnable?(r(),f(Be,{key:0,modelValue:e.value.sttAutoSend,"onUpdate:modelValue":a[14]||(a[14]=i=>e.value.sttAutoSend=i)},{default:o(()=>[v(u(l.$t("views.application.form.voiceInput.autoSend")),1)]),_:1},8,["modelValue"])):A("",!0),t(Te,{class:"ml-8",size:"small",modelValue:e.value.sttModelEnable,"onUpdate:modelValue":a[15]||(a[15]=i=>e.value.sttModelEnable=i),onChange:ee},null,8,["modelValue"])])])]),default:o(()=>[re(t(Oe,{modelValue:e.value.sttModelId,"onUpdate:modelValue":a[16]||(a[16]=i=>e.value.sttModelId=i),placeholder:l.$t("views.application.form.voiceInput.placeholder"),options:X.value,"model-type":"STT"},null,8,["modelValue","placeholder","options"]),[[Ie,e.value.sttModelEnable]])]),_:1},8,["rules"]),t(C,{prop:"ttsModelId",rules:{required:e.value.ttsType==="TTS"&&e.value.ttsModelEnable,message:l.$t("views.application.form.voicePlay.requiredMessage"),trigger:"change"}},{label:o(()=>[s("div",It,[s("span",Mt,[v(u(l.$t("views.application.form.voicePlay.label"))+" ",1),e.value.ttsType==="TTS"&&e.value.ttsModelEnable?(r(),V("span",$t,"*")):A("",!0)]),s("div",Pt,[e.value.ttsModelEnable?(r(),f(Be,{key:0,modelValue:e.value.ttsAutoplay,"onUpdate:modelValue":a[17]||(a[17]=i=>e.value.ttsAutoplay=i)},{default:o(()=>[v(u(l.$t("views.application.form.voicePlay.autoPlay")),1)]),_:1},8,["modelValue"])):A("",!0),t(Te,{class:"ml-8",size:"small",modelValue:e.value.ttsModelEnable,"onUpdate:modelValue":a[18]||(a[18]=i=>e.value.ttsModelEnable=i),onChange:Re},null,8,["modelValue"])])])]),default:o(()=>[s("div",Vt,[re(t(ol,{modelValue:e.value.ttsType,"onUpdate:modelValue":a[19]||(a[19]=i=>e.value.ttsType=i),class:"mb-8"},{default:o(()=>[t(ze,{value:"BROWSER"},{default:o(()=>[v(u(l.$t("views.application.form.voicePlay.browser")),1)]),_:1}),t(ze,{value:"TTS"},{default:o(()=>[v(u(l.$t("views.application.form.voicePlay.tts")),1)]),_:1})]),_:1},8,["modelValue"]),[[Ie,e.value.ttsModelEnable]])]),s("div",Dt,[e.value.ttsType==="TTS"&&e.value.ttsModelEnable?(r(),f(Oe,{key:0,modelValue:e.value.ttsModelId,"onUpdate:modelValue":a[20]||(a[20]=i=>e.value.ttsModelId=i),placeholder:l.$t("views.application.form.voicePlay.placeholder"),options:x.value,onChange:G,"model-type":"TTS"},null,8,["modelValue","placeholder","options"])):A("",!0),e.value.ttsType==="TTS"?(r(),f(m,{key:1,onClick:B,disabled:!e.value.ttsModelId,class:"ml-8"},{default:o(()=>[t(se,null,{default:o(()=>[t(sl)]),_:1})]),_:1},8,["disabled"])):A("",!0)])]),_:1},8,["rules"])]),_:1},8,["model","rules"])]),_:1})])]),_:1}),t(Se,{span:14,class:"p-24 border-l"},{default:o(()=>[s("h4",Rt,u(l.$t("views.application.appTest")),1),s("div",Ct,[s("div",Et,[t(Il,{applicationDetails:e.value,type:"debug-ai-chat"},null,8,["applicationDetails"])])])]),_:1})]),_:1})),[[dl,g.value]])]),_:1}),t($l,{ref_key:"AIModeParamSettingDialogRef",ref:U,onRefresh:he},null,512),t(Gl,{onReplace:Me,ref_key:"GeneratePromptDialogRef",ref:Q},null,512),t(Pl,{ref_key:"TTSModeParamSettingDialogRef",ref:W,onRefresh:we},null,512),t(Vl,{ref_key:"ParamSettingDialogRef",ref:J,onRefresh:oe},null,512),t(Dl,{ref_key:"AddKnowledgeDialogRef",ref:w,onAddData:p,data:D.value,loading:I.value},null,8,["data","loading"]),t(Rl,{ref_key:"ReasoningParamSettingDialogRef",ref:ae,onRefresh:Pe},null,512),t(Cl,{ref_key:"toolDialogRef",ref:M,onRefresh:F},null,512)])}}}),xt=Ze(At,[["__scopeId","data-v-eb817a18"]]);export{xt as default};
