import{aJ as We,aP as je,aR as ne,cS as Ge,d4 as _,cE as m,df as He,e4 as Je,aK as Xe,cT as Qe,aL as M,aN as s,aX as t,aO as i,aT as b,aU as w,aV as k,cI as o,aS as p,c_ as y,dx as se,dL as Ye,c$ as C,dM as ie,cN as v,cU as L,d0 as Ze,db as q,dd as $,dc as N,cO as de,cG as xe,cH as el,cW as pe,eF as ll,aM as r,dB as al,de as O,cP as tl}from"./admin-CylDRYrg.js";import{_ as ol,b as nl,d as sl,c as il,a as dl}from"./ReasoningParamSettingDialog.vue_vue_type_script_setup_true_lang-VfQ1h4QV.js";const pl={class:"p-16-24 application-setting"},ul={class:"flex-between w-full mb-16"},rl={class:"p-24 mb-16",style:{"padding-bottom":"0"}},ml={class:"title-decoration-1"},cl={class:"scrollbar-height-left"},vl={class:"flex-between"},fl={class:"flex-between"},gl={class:"flex align-center"},bl={class:"mr-4"},wl={key:0,class:"color-danger ml-4"},_l={class:"flex-between"},yl={class:"w-full"},hl={class:"flex-between"},Sl={class:"flex align-center",style:{width:"80%"}},Ml=["title"],kl={class:"flex align-center"},Tl={class:"mr-4"},$l={key:0,class:"color-danger ml-4"},Il={class:"flex-between"},Vl={class:"mr-4"},Pl={class:"flex"},Rl={class:"flex-between"},Dl={class:"mr-4"},El={key:0,class:"color-danger"},Cl={class:"flex"},Ll={class:"flex-between"},ql={class:"mr-4"},Nl={key:0,class:"color-danger"},Ol={class:"flex"},Ul={class:"w-full"},Al={class:"flex-between w-full"},Bl={class:"title-decoration-1 mb-16"},Kl={class:"dialog-bg"},Fl={class:"scrollbar-height"},zl=We({__name:"ApplicationSetting",setup(Wl){const T=je(),U=Xe(),{params:{id:g}}=T,c=ne(()=>T.path.includes("resource-management")?"systemManage":"workspace"),A=ne(()=>Ge.application[c.value]),B=_("views.application.form.prompt.defaultPrompt",{data:"{data}",question:"{question}"}),ue=_("views.application.dialog.defaultPrompt1",{question:"{question}"})+"<data></data>"+_("views.application.dialog.defaultPrompt2"),I=m(),re=m(),V=m(),K=m(),P=m(),F=m(),u=m(!1),me=m(!1),l=m({name:"",desc:"",modelId:"",dialogueNumber:1,prologue:_("views.application.form.defaultPrologue"),knowledgeIdList:[],knowledgeSetting:{topN:3,similarity:.6,maxParagraphCharNumber:5e3,searchMode:"embedding",noReferencesSetting:{status:"ai_questioning",value:"{question}"}},modelSetting:{prompt:B,system:_("views.application.form.roleSettings.placeholder"),noReferencesPrompt:"{question}",reasoningContentEnable:!1},modelParamsSetting:{},problemOptimization:!1,problemOptimizationPrompt:ue,sttModelId:"",ttsModelId:"",sttModelEnable:!1,ttsModelEnable:!1,ttsType:"BROWSER",type:"SIMPLE"});m({});const ce=He({name:[{required:!0,message:_("views.application.form.appName.placeholder"),trigger:"blur"}]}),z=m(null),S=m([]),W=m(null),j=m(null);function ve(e){l.value.prologue=e}function fe(e){l.value.modelSetting.prompt=e}function ge(e){l.value.modelSetting.noReferencesPrompt=e}function be(e){l.value.modelSetting.system=e}function we(e){l.value.modelSetting={...l.value.modelSetting,...e}}const _e=e=>{e&&e.validate().then(()=>y({type:"application",systemType:c.value}).putApplication(g,l.value,u).then(()=>y({type:"application",systemType:c.value}).publish(g,{},u)).then(()=>{se(_("views.application.tip.publishSuccess"))}))},ye=async e=>{e&&await e.validate((a,d)=>{a&&y({type:"application",systemType:c.value}).putApplication(g,l.value,u).then(()=>{se(_("common.saveSuccess"))})})},he=e=>{var a;l.value.modelId=e,e?(a=I.value)==null||a.reset_default(e,g):G({})},Se=()=>{var e;l.value.modelId&&((e=I.value)==null||e.open(l.value.modelId,g,l.value.modelParamsSetting))},Me=()=>{var e;l.value.ttsModelId&&((e=V.value)==null||e.open(l.value.ttsModelId,g,l.value.ttsModelParamsSetting))},ke=()=>{var e;(e=K.value)==null||e.open(l.value)};function Te(e){l.value={...l.value,...e}}function G(e){l.value.modelParamsSetting=e}function H(e){l.value.ttsModelParamsSetting=e}function $e(e){l.value.knowledgeIdList&&l.value.knowledgeIdList.splice(l.value.knowledgeIdList.indexOf(e),1)}function Ie(e){S.value=e,l.value.knowledgeIdList=e.map(a=>a.id)}function Ve(){F.value.open(l.value.knowledgeIdList)}function Pe(){y({type:"application",systemType:c.value}).getApplicationDetail(g,u).then(e=>{l.value=e.data,l.value.modelId=e.data.modelId,l.value.sttModelId=e.data.sttModelId,l.value.ttsModelId=e.data.ttsModelId,l.value.ttsType=e.data.ttsType,S.value=e.data.knowledgeList,l.value.modelSetting.noReferencesPrompt=e.data.modelSetting.noReferencesPrompt||"{question}",Ye([ie.IS_EE,ie.IS_PE],"OR")&&y({type:"application",systemType:c.value}).getApplicationSetting(g).then(a=>{l.value={...l.value,...a.data}})})}function J(){var a;u.value=!0;const e=c.value==="systemManage"?{modelType:"LLM",workspaceId:(a=l.value)==null?void 0:a.workspaceId}:{modelType:"LLM"};y({type:"model",systemType:c.value}).getSelectModelList(e).then(d=>{z.value=C.groupBy(d==null?void 0:d.data,"provider"),u.value=!1}).catch(()=>{u.value=!1})}function Re(){var a;u.value=!0;const e=c.value==="systemManage"?{modelType:"STT",workspaceId:(a=l.value)==null?void 0:a.workspaceId}:{modelType:"STT"};y({type:"model",systemType:c.value}).getSelectModelList(e).then(d=>{W.value=C.groupBy(d==null?void 0:d.data,"provider"),u.value=!1}).catch(()=>{u.value=!1})}function De(){var a;u.value=!0;const e=c.value==="systemManage"?{modelType:"TTS",workspaceId:(a=l.value)==null?void 0:a.workspaceId}:{modelType:"TTS"};y({type:"model",systemType:c.value}).getSelectModelList(e).then(d=>{j.value=C.groupBy(d==null?void 0:d.data,"provider"),u.value=!1}).catch(()=>{u.value=!1})}const Ee=e=>{var a;l.value.ttsModelId=e,e?(a=V.value)==null||a.reset_default(e,g):H({})};function Ce(){l.value.ttsModelEnable||(l.value.ttsModelId=void 0,l.value.ttsType="BROWSER")}function X(){l.value.sttModelEnable||(l.value.sttModelId=void 0)}return Je(()=>{T.path.includes("WORK_FLOW")&&(c.value=="workspace"?U.push(`/application/workspace/${T.params.id}/workflow`):U.push(`/application/resource-management/${T.params.id}/workflow`))}),Qe(()=>{J(),Pe(),Re(),De()}),(e,a)=>{const d=p("el-button"),Q=p("el-input"),f=p("el-form-item"),Y=p("el-tooltip"),Le=p("el-input-number"),qe=p("Plus"),R=p("el-icon"),Ne=p("el-text"),Oe=p("Close"),Z=p("el-card"),D=p("el-col"),x=p("el-row"),E=p("el-switch"),ee=p("el-checkbox"),le=p("el-radio"),Ue=p("el-radio-group"),Ae=p("Operation"),Be=p("el-form"),Ke=p("el-scrollbar"),Fe=Ze("loading");return r(),M("div",pl,[s("div",ul,[s("h3",null,i(e.$t("common.setting")),1),s("div",null,[A.value.edit(k(g))?(r(),b(d,{key:0,type:"primary",onClick:a[0]||(a[0]=n=>ye(P.value)),disabled:u.value},{default:o(()=>[v(i(e.$t("common.save")),1)]),_:1},8,["disabled"])):w("",!0),A.value.edit(k(g))?(r(),b(d,{key:1,type:"primary",onClick:a[1]||(a[1]=n=>_e(P.value)),disabled:u.value},{default:o(()=>[v(i(e.$t("views.application.operation.publish")),1)]),_:1},8,["disabled"])):w("",!0)])]),t(Z,{style:{"--el-card-padding":"0"}},{default:o(()=>[L((r(),b(x,null,{default:o(()=>[t(D,{span:10},{default:o(()=>[s("div",rl,[s("h4",ml,i(e.$t("views.applicationOverview.appInfo.header")),1)]),s("div",cl,[t(Ke,null,{default:o(()=>[t(Be,{"hide-required-asterisk":"",ref_key:"applicationFormRef",ref:P,model:l.value,rules:ce,"label-position":"top","require-asterisk-position":"right",class:"p-24",style:{"padding-top":"0"}},{default:o(()=>[t(f,{prop:"name"},{label:o(()=>[s("div",vl,[s("span",null,[v(i(e.$t("views.application.form.appName.label"))+" ",1),a[21]||(a[21]=s("span",{class:"color-danger"},"*",-1))])])]),default:o(()=>[t(Q,{modelValue:l.value.name,"onUpdate:modelValue":a[2]||(a[2]=n=>l.value.name=n),maxlength:"64",placeholder:e.$t("views.application.form.appName.placeholder"),"show-word-limit":"",onBlur:a[3]||(a[3]=n=>{var h;return l.value.name=(h=l.value.name)==null?void 0:h.trim()})},null,8,["modelValue","placeholder"])]),_:1}),t(f,{label:e.$t("views.application.form.appDescription.label")},{default:o(()=>[t(Q,{modelValue:l.value.desc,"onUpdate:modelValue":a[4]||(a[4]=n=>l.value.desc=n),type:"textarea",placeholder:e.$t("views.application.form.appDescription.placeholder"),rows:3,maxlength:"256","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(f,{label:e.$t("views.application.form.aiModel.label")},{label:o(()=>[s("div",fl,[s("span",null,i(e.$t("views.application.form.aiModel.label")),1),t(d,{type:"primary",link:"",onClick:Se,disabled:!l.value.modelId},{default:o(()=>[v(i(e.$t("common.paramSetting")),1)]),_:1},8,["disabled"])])]),default:o(()=>[t(q,{modelValue:l.value.modelId,"onUpdate:modelValue":a[5]||(a[5]=n=>l.value.modelId=n),placeholder:e.$t("views.application.form.aiModel.placeholder"),options:z.value,onChange:he,onSubmitModel:J,showFooter:!1,"model-type":"LLM"},null,8,["modelValue","placeholder","options"])]),_:1},8,["label"]),t(f,{label:e.$t("views.application.form.roleSettings.label")},{default:o(()=>[t($,{title:e.$t("views.application.form.roleSettings.label"),modelValue:l.value.modelSetting.system,"onUpdate:modelValue":a[6]||(a[6]=n=>l.value.modelSetting.system=n),style:{height:"120px"},onSubmitDialog:be,placeholder:e.$t("views.application.form.roleSettings.placeholder")},null,8,["title","modelValue","placeholder"])]),_:1},8,["label"]),t(f,{prop:"modelSetting.noReferencesPrompt",rules:{required:l.value.modelId,message:e.$t("views.application.form.prompt.requiredMessage"),trigger:"blur"}},{label:o(()=>[s("div",gl,[s("span",bl,i(e.$t("views.application.form.prompt.label")+e.$t("views.application.form.prompt.noReferences")),1),t(Y,{effect:"dark",content:e.$t("views.application.form.prompt.noReferencesTooltip",{question:"{question}"}),placement:"right","popper-class":"max-w-350"},{default:o(()=>[t(N,{iconName:"app-warning",class:"app-warning-icon"})]),_:1},8,["content"]),l.value.modelId?(r(),M("span",wl,"*")):w("",!0)])]),default:o(()=>[t($,{title:e.$t("views.application.form.prompt.label")+e.$t("views.application.form.prompt.noReferences"),modelValue:l.value.modelSetting.noReferencesPrompt,"onUpdate:modelValue":a[7]||(a[7]=n=>l.value.modelSetting.noReferencesPrompt=n),style:{height:"120px"},onSubmitDialog:ge,placeholder:"{question}"},null,8,["title","modelValue"])]),_:1},8,["rules"]),t(f,{label:e.$t("views.application.form.historyRecord.label"),onClick:a[9]||(a[9]=de(()=>{},["prevent"]))},{default:o(()=>[t(Le,{modelValue:l.value.dialogueNumber,"onUpdate:modelValue":a[8]||(a[8]=n=>l.value.dialogueNumber=n),min:0,"value-on-clear":0,"controls-position":"right",class:"w-full",step:1,"step-strictly":!0},null,8,["modelValue"])]),_:1},8,["label"]),t(f,{label:"$t('views.application.form.relatedKnowledgeBase')"},{label:o(()=>[s("div",_l,[s("span",null,i(e.$t("views.application.form.relatedKnowledge.label")),1),s("div",null,[t(d,{type:"primary",link:"",onClick:ke},{default:o(()=>[t(N,{iconName:"app-operation",class:"mr-4"}),v(" "+i(e.$t("common.paramSetting")),1)]),_:1}),t(d,{type:"primary",link:"",onClick:Ve},{default:o(()=>[t(R,{class:"mr-4"},{default:o(()=>[t(qe)]),_:1}),v(" "+i(e.$t("common.add")),1)]),_:1})])])]),default:o(()=>{var n;return[s("div",yl,[((n=l.value.knowledgeIdList)==null?void 0:n.length)===0?(r(),b(Ne,{key:0,type:"info"},{default:o(()=>[v(i(e.$t("views.application.form.relatedKnowledge.placeholder")),1)]),_:1})):(r(),b(x,{key:1,gutter:12},{default:o(()=>[(r(!0),M(xe,null,el(l.value.knowledgeIdList,(h,ze)=>(r(),b(D,{xs:24,sm:24,md:24,lg:12,xl:12,class:"mb-8",key:ze},{default:o(()=>[t(Z,{class:"relate-knowledge-card border-r-6",shadow:"never"},{default:o(()=>{var ae,te,oe;return[s("div",hl,[s("div",Sl,[t(al,{type:(ae=k(O)(S.value,h,"id"))==null?void 0:ae.type,class:"mr-12"},null,8,["type"]),s("span",{class:"ellipsis cursor",title:(te=k(O)(S.value,h,"id"))==null?void 0:te.name},i((oe=k(O)(S.value,h,"id"))==null?void 0:oe.name),9,Ml)]),t(d,{text:"",onClick:jl=>$e(h)},{default:o(()=>[t(R,null,{default:o(()=>[t(Oe)]),_:1})]),_:2},1032,["onClick"])])]}),_:2},1024)]),_:2},1024))),128))]),_:1}))])]}),_:1}),t(f,{label:e.$t("views.application.form.prompt.label"),prop:"modelSetting.prompt",rules:{required:l.value.modelId,message:e.$t("views.application.form.prompt.requiredMessage"),trigger:"blur"}},{label:o(()=>[s("div",kl,[s("span",Tl,i(e.$t("views.application.form.prompt.label"))+" "+i(e.$t("views.application.form.prompt.references")),1),t(Y,{effect:"dark",content:e.$t("views.application.form.prompt.referencesTooltip",{data:"{data}",question:"{question}"}),"popper-class":"max-w-350",placement:"right"},{default:o(()=>[t(N,{iconName:"app-warning",class:"app-warning-icon"})]),_:1},8,["content"]),l.value.modelId?(r(),M("span",$l,"*")):w("",!0)])]),default:o(()=>[t($,{title:e.$t("views.application.form.prompt.label")+e.$t("views.application.form.prompt.references"),modelValue:l.value.modelSetting.prompt,"onUpdate:modelValue":a[10]||(a[10]=n=>l.value.modelSetting.prompt=n),style:{height:"150px"},onSubmitDialog:fe,placeholder:k(B)},null,8,["title","modelValue","placeholder"])]),_:1},8,["label","rules"]),t(f,{label:e.$t("views.application.form.prologue")},{default:o(()=>[t($,{title:e.$t("views.application.form.prologue"),modelValue:l.value.prologue,"onUpdate:modelValue":a[11]||(a[11]=n=>l.value.prologue=n),style:{height:"150px"},onSubmitDialog:ve},null,8,["title","modelValue"])]),_:1},8,["label"]),t(f,{onClick:a[13]||(a[13]=de(()=>{},["prevent"]))},{label:o(()=>[s("div",Il,[s("span",Vl,i(e.$t("views.application.form.reasoningContent.label")),1),s("div",Pl,[t(E,{class:"ml-8",size:"small",modelValue:l.value.modelSetting.reasoningContentEnable,"onUpdate:modelValue":a[12]||(a[12]=n=>l.value.modelSetting.reasoningContentEnable=n),onChange:X},null,8,["modelValue"])])])]),_:1}),t(f,{prop:"sttModelId",rules:{required:l.value.sttModelEnable,message:e.$t("views.application.form.voiceInput.requiredMessage"),trigger:"change"}},{label:o(()=>[s("div",Rl,[s("span",Dl,[v(i(e.$t("views.application.form.voiceInput.label"))+" ",1),l.value.sttModelEnable?(r(),M("span",El,"*")):w("",!0)]),s("div",Cl,[l.value.sttModelEnable?(r(),b(ee,{key:0,modelValue:l.value.sttAutoSend,"onUpdate:modelValue":a[14]||(a[14]=n=>l.value.sttAutoSend=n)},{default:o(()=>[v(i(e.$t("views.application.form.voiceInput.autoSend")),1)]),_:1},8,["modelValue"])):w("",!0),t(E,{class:"ml-8",size:"small",modelValue:l.value.sttModelEnable,"onUpdate:modelValue":a[15]||(a[15]=n=>l.value.sttModelEnable=n),onChange:X},null,8,["modelValue"])])])]),default:o(()=>[L(t(q,{modelValue:l.value.sttModelId,"onUpdate:modelValue":a[16]||(a[16]=n=>l.value.sttModelId=n),placeholder:e.$t("views.application.form.voiceInput.placeholder"),options:W.value,"model-type":"STT"},null,8,["modelValue","placeholder","options"]),[[pe,l.value.sttModelEnable]])]),_:1},8,["rules"]),t(f,{prop:"ttsModelId",rules:{required:l.value.ttsType==="TTS"&&l.value.ttsModelEnable,message:e.$t("views.application.form.voicePlay.requiredMessage"),trigger:"change"}},{label:o(()=>[s("div",Ll,[s("span",ql,[v(i(e.$t("views.application.form.voicePlay.label"))+" ",1),l.value.ttsType==="TTS"&&l.value.ttsModelEnable?(r(),M("span",Nl,"*")):w("",!0)]),s("div",Ol,[l.value.ttsModelEnable?(r(),b(ee,{key:0,modelValue:l.value.ttsAutoplay,"onUpdate:modelValue":a[17]||(a[17]=n=>l.value.ttsAutoplay=n)},{default:o(()=>[v(i(e.$t("views.application.form.voicePlay.autoPlay")),1)]),_:1},8,["modelValue"])):w("",!0),t(E,{class:"ml-8",size:"small",modelValue:l.value.ttsModelEnable,"onUpdate:modelValue":a[18]||(a[18]=n=>l.value.ttsModelEnable=n),onChange:Ce},null,8,["modelValue"])])])]),default:o(()=>[s("div",Ul,[L(t(Ue,{modelValue:l.value.ttsType,"onUpdate:modelValue":a[19]||(a[19]=n=>l.value.ttsType=n),class:"mb-8"},{default:o(()=>[t(le,{value:"BROWSER"},{default:o(()=>[v(i(e.$t("views.application.form.voicePlay.browser")),1)]),_:1}),t(le,{value:"TTS"},{default:o(()=>[v(i(e.$t("views.application.form.voicePlay.tts")),1)]),_:1})]),_:1},8,["modelValue"]),[[pe,l.value.ttsModelEnable]])]),s("div",Al,[l.value.ttsType==="TTS"&&l.value.ttsModelEnable?(r(),b(q,{key:0,modelValue:l.value.ttsModelId,"onUpdate:modelValue":a[20]||(a[20]=n=>l.value.ttsModelId=n),placeholder:e.$t("views.application.form.voicePlay.placeholder"),options:j.value,onChange:Ee,"model-type":"TTS"},null,8,["modelValue","placeholder","options"])):w("",!0),l.value.ttsType==="TTS"?(r(),b(d,{key:1,onClick:Me,disabled:!l.value.ttsModelId,class:"ml-8"},{default:o(()=>[t(R,null,{default:o(()=>[t(Ae)]),_:1})]),_:1},8,["disabled"])):w("",!0)])]),_:1},8,["rules"])]),_:1},8,["model","rules"])]),_:1})])]),_:1}),t(D,{span:14,class:"p-24 border-l"},{default:o(()=>[s("h4",Bl,i(e.$t("views.application.appTest")),1),s("div",Kl,[s("div",Fl,[t(ll,{applicationDetails:l.value,type:"debug-ai-chat"},null,8,["applicationDetails"])])])]),_:1})]),_:1})),[[Fe,u.value]])]),_:1}),t(ol,{ref_key:"AIModeParamSettingDialogRef",ref:I,onRefresh:G},null,512),t(nl,{ref_key:"TTSModeParamSettingDialogRef",ref:V,onRefresh:H},null,512),t(sl,{ref_key:"ParamSettingDialogRef",ref:K,onRefresh:Te},null,512),t(il,{ref_key:"AddKnowledgeDialogRef",ref:F,onAddData:Ie,data:S.value,loading:me.value},null,8,["data","loading"]),t(dl,{ref_key:"ReasoningParamSettingDialogRef",ref:re,onRefresh:we},null,512)])}}}),Jl=tl(zl,[["__scopeId","data-v-2d04a33c"]]);export{Jl as default};
