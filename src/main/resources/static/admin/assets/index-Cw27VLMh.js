import{ay as be,aB as v,aQ as fo,aD as s,aR as D,aF as p,aS as ge,aH as e,aI as l,aE as $,aT as Oe,aG as o,b1 as de,b6 as b,bZ as Ee,b_ as ke,b$ as qe,aJ as _,c0 as so,aK as g,aU as fe,co as Fe,e6 as mo,aZ as Me,aA as no,a_ as ae,bU as lo,b7 as xe,b0 as _e,bf as vo,cr as Pe,cj as Je,ck as Ze,aN as wo,bX as Qe,b2 as J,a$ as Se,ci as Le,c1 as Te,cp as te,b3 as De,aC as V,c4 as oe,az as ko,e7 as Xe,dt as go,cN as ho,bE as Ye,b4 as ee,b5 as x,c3 as yo,bH as B,bJ as L,bI as re,cm as bo}from"./admin-BOU8h_tu.js";import{_ as Co,W as eo}from"./validate-DqBR6sql.js";import{g as Ao,t as oo,a as to}from"./data-DzIfGPow.js";import"./GeneratePromptDialog-Bvq-fe0w.js";import"./reduce-CFxiYU-r.js";import"./uniqBy-nYQPFyOR.js";import"./min-hetjePR5.js";import"./zipObject-oGo6QN0g.js";import"./vue-draggable-plus-Dng2Mvn3.js";import"./FieldFormDialog.vue_vue_type_script_setup_true_lang-lPLqgbgK.js";import"./defineProperty-DbXIQDXj.js";import"./typeof-QjJsDpFa.js";const $o={class:"list flex-wrap"},Ro=["onClick","onMousedown"],Io=["src"],Wo=["title"],No={class:"flex-between"},Oo={class:"flex align-center"},Eo=["src"],Po=["title"],So={key:0,class:"status-tag",style:{"margin-left":"auto"}},Lo=be({__name:"NodeContent",props:{list:{}},emits:["clickNodes","onmousedown"],setup(me,{emit:ce}){const j=me,H=ce,c=v(""),w=v([]);function O(W,C){return C.length?W.filter(U=>U.name.toLowerCase().includes(C.toLowerCase())):W}return fo([()=>c.value,()=>j.list],()=>{w.value=O(j.list,c.value)}),(W,C)=>{const U=s("el-input"),A=s("el-avatar"),Z=s("el-tag"),T=s("el-text"),d=s("el-popover"),F=s("el-empty");return p(),D(ge,null,[e(U,{modelValue:c.value,"onUpdate:modelValue":C[0]||(C[0]=i=>c.value=i),modelModifiers:{trim:!0},placeholder:W.$t("common.search"),"prefix-icon":"Search",clearable:"",style:{padding:"12px 12px 0 12px"}},null,8,["modelValue","placeholder"]),l("div",$o,[w.value.length?(p(!0),D(ge,{key:0},Oe(w.value,i=>(p(),$(d,{key:i.id,placement:"right",width:280,"show-after":500},{reference:o(()=>[l("div",{class:"list-item flex align-center border border-r-6 p-8-12 cursor",style:{width:"calc(50% - 6px)"},onClick:fe(f=>H("clickNodes",i),["stop"]),onMousedown:fe(f=>H("onmousedown",i),["stop"])},[b(Ee)(i==null?void 0:i.icon)?(p(),$(A,{key:0,shape:"square",size:20,style:{background:"none"}},{default:o(()=>[l("img",{src:b(ke)(i==null?void 0:i.icon,b(ke)("./favicon.ico")),alt:""},null,8,Io)]),_:2},1024)):(p(),$(A,{key:1,class:"avatar-green",shape:"square",size:20},{default:o(()=>C[1]||(C[1]=[l("img",{src:qe,style:{width:"58%"},alt:""},null,-1)])),_:1,__:[1]})),l("span",{class:"ml-8 ellipsis",title:i.name},_(i.name),9,Wo)],40,Ro)]),default:o(()=>[l("div",No,[l("div",Oo,[b(Ee)(i==null?void 0:i.icon)?(p(),$(A,{key:0,shape:"square",size:20,style:{background:"none"}},{default:o(()=>[l("img",{src:b(ke)(i==null?void 0:i.icon,b(ke)("./favicon.ico")),alt:""},null,8,Eo)]),_:2},1024)):(p(),$(A,{key:1,class:"avatar-green",shape:"square",size:20},{default:o(()=>C[2]||(C[2]=[l("img",{src:qe,style:{width:"58%"},alt:""},null,-1)])),_:1,__:[2]})),l("span",{class:"font-medium ml-8 break-all",title:i.name},_(i.name),9,Po)]),i.type?(p(),D("div",So,[b(so)(i.type)?(p(),$(Z,{key:0,class:"warning-tag"},{default:o(()=>[g(_(W.$t("views.application.workflow")),1)]),_:1})):(p(),$(Z,{key:1,class:"blue-tag"},{default:o(()=>[g(_(W.$t("views.application.simple")),1)]),_:1}))])):de("",!0)]),e(T,{type:"info",size:"small",class:"mt-4"},{default:o(()=>[g(_(i.desc),1)]),_:2},1024)]),_:2},1024))),128)):(p(),$(F,{key:1,description:W.$t("common.noData")},null,8,["description"]))])],64)}}}),ao=Fe(Lo,[["__scopeId","data-v-deb1c287"]]),To={style:{display:"flex",width:"100%","justify-content":"center"},class:"mb-12 mt-12"},Do={key:0},Fo={class:"flex-wrap",style:{gap:"12px",padding:"12px"}},Mo=["onClick","onMousedown"],xo={class:"lighter"},Vo={class:"flex align-center mb-8"},Uo={class:"lighter color-text-primary"},Ho={key:1,class:"ml-16 mt-8"},zo=be({__name:"DropdownMenu",props:{show:{type:Boolean,default:!1},id:{type:String,default:""},workflowRef:Object},emits:["clickNodes","onmousedown"],setup(me,{emit:ce}){const j=mo("workflowMode"),H=Me(),{user:c,folder:w}=no(),O=Ao(j||wo.Application),W=v(""),C=me,U=ce,A=ae(()=>H.path.includes("resource-management")?"systemManage":"workspace");ae(()=>lo.tool[A.value]);const Z=v(!1),T=v("base"),d=ae(()=>{if(!W.value)return O||[];const n=W.value.toLowerCase();return(O||[]).reduce((a,h)=>{const I=h.list.filter(N=>N.label.toLowerCase().includes(n));return I.length&&a.push({...h,list:I}),a},[])});function F(n,a,h){var I;a&&(n.properties.nodeName=a.name,h=="tool"&&(n.properties.nodeData={...a,toolLibId:a.id,inputFieldList:a.inputFieldList.map(N=>({...N,value:N.source=="reference"?[]:""}))}),h=="application"&&(n.properties.nodeData={name:a.name,icon:a.icon,applicationId:a.id})),(I=C.workflowRef)==null||I.addNode(n),U("clickNodes",n)}function i(n,a,h){var I;a&&(n.properties.nodeName=a.name,h=="tool"&&(n.properties.nodeData={...a,toolLibId:a.id,inputFieldList:a.inputFieldList.map(N=>({...N,value:N.source=="reference"?[]:""}))}),h=="application"&&(so(a.type)?(a.workFlow.nodes[0].properties.nodeData.file_upload_setting,n.properties.nodeData={name:a.name,icon:a.icon,applicationId:a.id}):n.properties.nodeData={name:a.name,icon:a.icon,applicationId:a.id})),(I=C.workflowRef)==null||I.onmousedown(n),U("onmousedown",n)}const f=v([]),R=v([]);async function z(){var a;const n=await w.asyncGetFolder(Qe.TOOL,{},Z);f.value=n.data,w.setCurrentFolder(((a=n.data)==null?void 0:a[0])||{})}async function G(){var a,h,I,N;const n=await J({type:"tool",isShared:((a=w.currentFolder)==null?void 0:a.id)==="share",systemType:"workspace"}).getToolList({folderId:((h=w.currentFolder)==null?void 0:h.id)||c.getWorkspaceId(),toolType:"CUSTOM"});R.value=((I=n.data)==null?void 0:I.tools)||n.data||[],R.value=(N=R.value)==null?void 0:N.filter(q=>q.isActive)}const K=v([]),Q=v([]);function pe(){w.asyncGetFolder(Qe.APPLICATION,{},Z).then(n=>{var a;K.value=n.data,w.setCurrentFolder(((a=n.data)==null?void 0:a[0])||{})})}async function se(){var a;const n=await J({type:"application",systemType:"workspace"}).getAllApplication({folderId:((a=w.currentFolder)==null?void 0:a.id)||c.getWorkspaceId()});Q.value=n.data.filter(h=>h.id!==C.id&&h.isPublish)}async function ve(n){n==="tool"?(await z(),G()):n==="application"&&(pe(),se())}return xe(()=>{}),(n,a)=>{const h=s("search"),I=s("el-icon"),N=s("el-input"),q=s("el-text"),we=s("el-popover"),E=s("el-scrollbar"),ne=s("el-tab-pane"),le=s("el-tabs");return _e((p(),D("div",{class:"workflow-dropdown-menu border border-r-6 white-bg",style:vo({width:(T.value==="base","400px")})},[e(le,{modelValue:T.value,"onUpdate:modelValue":a[5]||(a[5]=P=>T.value=P),class:"workflow-dropdown-tabs",onTabChange:ve},{default:o(()=>[_e(l("div",To,[e(N,{modelValue:W.value,"onUpdate:modelValue":a[0]||(a[0]=P=>W.value=P),class:"mr-12 ml-12",placeholder:n.$t("views.applicationWorkflow.searchBar.placeholder")},{suffix:o(()=>[e(I,{class:"el-input__icon"},{default:o(()=>[e(h)]),_:1})]),_:1},8,["modelValue","placeholder"])],512),[[Pe,T.value==="base"]]),e(ne,{label:n.$t("views.applicationWorkflow.baseComponent"),name:"base"},{default:o(()=>[e(E,{height:"400"},{default:o(()=>[d.value.length>0?(p(),D("div",Do,[(p(!0),D(ge,null,Oe(d.value,(P,Ce)=>(p(),D(ge,{key:Ce},[e(q,{type:"info",size:"small",class:"color-secondary ml-12"},{default:o(()=>[g(_(P.label),1)]),_:2},1024),l("div",Fo,[(p(!0),D(ge,null,Oe(P.list,(X,Ae)=>(p(),$(we,{key:Ae,placement:"right",width:280,"show-after":500},{reference:o(()=>[l("div",{class:"list-item flex align-center border border-r-6 p-8-12 cursor",style:{width:"calc(50% - 6px)"},onClick:fe(Y=>F(X),["stop"]),onMousedown:fe(Y=>i(X),["stop"])},[(p(),$(Je(b(Ze)(`${X.type}-icon`)),{class:"mr-8",size:20})),l("div",xo,_(X.label),1)],40,Mo)]),default:o(()=>[l("div",Vo,[(p(),$(Je(b(Ze)(`${X.type}-icon`)),{class:"mr-8",size:32})),l("div",Uo,_(X.label),1)]),e(q,{type:"info",size:"small",class:"color-secondary lighter"},{default:o(()=>[g(_(X.text),1)]),_:2},1024)]),_:2},1024))),128))])],64))),128))])):(p(),D("div",Ho,[e(q,{type:"info"},{default:o(()=>[g(_(n.$t("views.applicationWorkflow.tip.noData")),1)]),_:1})]))]),_:1})]),_:1},8,["label"]),e(ne,{label:n.$t("views.tool.title"),name:"tool"},{default:o(()=>[e(E,{height:"450"},{default:o(()=>[e(ao,{list:R.value,onClickNodes:a[1]||(a[1]=P=>F(b(oo),P,"tool")),onOnmousedown:a[2]||(a[2]=P=>i(b(oo),P,"tool"))},null,8,["list"])]),_:1})]),_:1},8,["label"]),e(ne,{label:n.$t("views.application.title"),name:"application"},{default:o(()=>[e(E,{height:"450"},{default:o(()=>[e(ao,{list:Q.value,onClickNodes:a[3]||(a[3]=P=>F(b(to),P,"application")),onOnmousedown:a[4]||(a[4]=P=>i(b(to),P,"application"))},null,8,["list"])]),_:1})]),_:1},8,["label"])]),_:1},8,["modelValue"])],4)),[[Pe,me.show]])}}}),Go=Fe(zo,[["__scopeId","data-v-10b5ffa5"]]),Ko={class:"workflow-publish-history border-l white-bg"},Bo={class:"border-b p-16-24"},jo={class:"list-height pt-0"},qo={class:"p-8 pt-0"},Jo={class:"flex-between"},Zo={style:{"max-width":"80%"}},Qo={class:"text-center"},Xo=be({__name:"PublishHistory",emits:["click","refreshVersion"],setup(me,{emit:ce}){const j=Me(),{params:{id:H}}=j,c=ae(()=>j.path.includes("resource-management")?"systemManage":"workspace"),w=ce,O=v(!1),W=v([]),C=v("");function U(f){C.value=f.id}function A(f){w("click",f)}function Z(f){w("refreshVersion",f)}function T(f){f.writeStatus=!0}function d(f){f.writeStatus=!1}function F(f,R){if(f){const z={name:f};J({type:"workflowVersion",systemType:c.value}).putWorkFlowVersion(H,R.id,z,O).then(()=>{De(V("common.modifySuccess")),R.writeStatus=!1,i()})}else oe(V("views.applicationWorkflow.tip.nameMessage"))}function i(){J({type:"workflowVersion",systemType:c.value}).getWorkFlowVersion(H,O).then(f=>{W.value=f.data})}return xe(()=>{i()}),(f,R)=>{const z=s("ReadWrite"),G=s("el-tag"),K=s("UserFilled"),Q=s("el-icon"),pe=s("el-avatar"),se=s("el-text"),ve=s("el-button"),n=s("el-dropdown-item"),a=s("RefreshLeft"),h=s("el-dropdown-menu"),I=s("el-dropdown"),N=s("common-list"),q=s("el-scrollbar"),we=Se("loading");return p(),D("div",Ko,[l("h4",Bo,_(f.$t("views.applicationWorkflow.setting.releaseHistory")),1),l("div",jo,[e(q,null,{default:o(()=>[l("div",qo,[_e((p(),$(N,{data:W.value,class:"mt-8",onClick:A,onMouseenter:U,onMouseleave:R[1]||(R[1]=E=>C.value="")},{default:o(({row:E,index:ne})=>[l("div",Jo,[l("div",Zo,[l("h5",{class:Le([ne===0?"primary":"","flex align-center"])},[e(z,{onChange:le=>F(le,E),data:E.name||b(Te)(E.update_time),trigger:"manual",write:E.writeStatus,onClose:le=>d(E)},null,8,["onChange","data","write","onClose"]),ne===0?(p(),$(G,{key:0,class:"default-tag ml-4"},{default:o(()=>[g(_(f.$t("views.applicationWorkflow.setting.latestRelease")),1)]),_:1})):de("",!0)],2),e(se,{type:"info",class:"color-secondary flex align-center mt-8"},{default:o(()=>[e(pe,{size:20,class:"avatar-grey mr-4"},{default:o(()=>[e(Q,null,{default:o(()=>[e(K)]),_:1})]),_:1}),g(" "+_(E.publishUserName),1)]),_:2},1024)]),_e(l("div",{onClick:R[0]||(R[0]=fe(()=>{},["stop"]))},[e(I,{trigger:"click",teleported:!1},{dropdown:o(()=>[e(h,null,{default:o(()=>[e(n,{onClick:fe(le=>T(E),["stop"])},{default:o(()=>[e(te,{iconName:"app-edit",class:"color-secondary"}),g(" "+_(f.$t("common.edit")),1)]),_:2},1032,["onClick"]),e(n,{onClick:le=>Z(E)},{default:o(()=>[e(Q,{class:"color-secondary"},{default:o(()=>[e(a)]),_:1}),g(" "+_(f.$t("views.applicationWorkflow.setting.restoreCurrentVersion")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:o(()=>[e(ve,{text:""},{default:o(()=>[e(te,{iconName:"app-more"})]),_:1})]),_:2},1024)],512),[[Pe,C.value===E.id]])])]),empty:o(()=>[l("div",Qo,[e(se,{type:"info"},{default:o(()=>[g(_(f.$t("chat.noHistory")),1)]),_:1})])]),_:1},8,["data"])),[[we,O.value]])])]),_:1})])])}}}),Yo=Fe(Xo,[["__scopeId","data-v-4943e548"]]),et={class:"application-workflow"},ot={class:"header border-b flex-between p-12-24 white-bg"},tt={class:"flex align-center"},at=["title"],st={key:0},nt={key:0},lt={key:1},it=["href"],rt={class:"ml-4"},ct={class:"flex-between"},pt={class:"flex align-center"},ut={class:"mr-12 ml-24 flex"},dt=["src"],_t=["title"],ft={class:"mr-16"},mt={class:"scrollbar-height"},Wt=be({__name:"index",setup(me){bo("getResourceDetail",()=>d);const{theme:ce}=no(),j=ko(),H=Me(),{params:{id:c,from:w}}=H,O=ae(()=>H.path.includes("resource-management")?"systemManage":"workspace"),W=ae(()=>lo.application[O.value]),C=ae(()=>ce.isDefaultTheme());let U;const A=v(),Z=v(),T=v(!1),d=v(null),F=v(!1),i=v(!1),f=v(!1),R=v(""),z=v(!1),G=v(!1),K=v(!1),Q=v({}),pe=v(null),se=v([]),ve=ae(()=>Xe(se.value)?"?"+Xe(se.value):""),n=ae(()=>{var t;return`${window.location.origin}/chat/`+((t=d.value)==null?void 0:t.accessToken)+ve.value});function a(){JSON.stringify(pe.value)!==JSON.stringify(Y())?yo(V("common.tip"),V("views.applicationWorkflow.tip.saveMessage"),{confirmButtonText:V("views.applicationWorkflow.setting.exitSave"),cancelButtonText:V("views.applicationWorkflow.setting.exit"),type:"warning",distinguishCancelAndClose:!0}).then(()=>{$e(!0,!0)}).catch(t=>{t==="cancel"&&Re()}):Re()}function h(){K.value||(G.value=!1,K.value=!1)}function I(t){t&&q(t),G.value=!1,K.value=!1}function N(t){K.value=!0,Q.value=t,q(t),We()}function q(t){var r;t.workFlow.nodes.map(k=>{k.properties.noRender=!0}),d.value.workFlow=t.workFlow,R.value=t==null?void 0:t.update_time,(r=A.value)==null||r.clearGraphData(),Ye(()=>{var k;(k=A.value)==null||k.render(t.workFlow)})}function we(){Ve(),z.value&&Ie(),G.value=!1,K.value=!1}function E(){G.value=!0}function ne(t){t?Ie():We(),localStorage.setItem("workflowAutoSave",t.toString())}function le(t){F.value=!1}function P(t){F.value=!1}function Ce(){F.value=!1}const X=()=>{var t;(t=A.value)==null||t.validate().then(()=>{const r=Y(),k=new eo(r);try{k.is_valid()}catch(u){oe(u.toString());return}J({type:"application",systemType:O.value}).putApplication(c,{workFlow:r},T).then(()=>J({type:"application",systemType:O.value}).publish(c,{},T)).then(u=>{d.value.name=u.data.name,De(V("views.application.tip.publishSuccess"))}).catch(u=>{var m,y,ie,he;const M=u.node,S=u.errMessage;if(typeof S=="string")oe(((m=u.node.properties)==null?void 0:m.nodeName)+` ${V("views.applicationWorkflow.node").toLowerCase()} `+S.toLowerCase());else{const Ne=Object.keys(S);oe(((y=M.properties)==null?void 0:y.nodeName)+` ${V("views.applicationWorkflow.node").toLowerCase()} `+((he=(ie=S[Ne[0]])==null?void 0:ie[0])==null?void 0:he.message.toLowerCase()))}})}).catch(r=>{var M,S,m,y;const k=r.node,u=r.errMessage;if(typeof u=="string")oe(((M=r.node.properties)==null?void 0:M.nodeName)+` ${V("views.applicationWorkflow.node")}，`+u);else{const ie=Object.keys(u);oe(((S=k.properties)==null?void 0:S.nodeName)+` ${V("views.applicationWorkflow.node")}，`+((y=(m=u[ie[0]])==null?void 0:m[0])==null?void 0:y.message))}})},Ae=()=>{var t;(t=A.value)==null||t.validate().then(()=>{var u;const r=Y(),k=new eo(r);try{k.is_valid(),d.value={...d.value,type:"WORK_FLOW",...(u=k.get_base_node())==null?void 0:u.properties.nodeData,workFlow:Y()},i.value=!0}catch(M){oe(M.toString())}}).catch(r=>{var M,S,m,y;const k=r.node,u=r.errMessage;if(typeof u=="string")oe(((M=r.node.properties)==null?void 0:M.nodeName)+` ${V("views.applicationWorkflow.node")}，`+u);else{const ie=Object.keys(u);oe(((S=k.properties)==null?void 0:S.nodeName)+` ${V("views.applicationWorkflow.node")}，`+((y=(m=u[ie[0]])==null?void 0:m[0])==null?void 0:y.message))}})};function Y(){var t;return(t=A.value)==null?void 0:t.getGraphData()}function Ve(){J({type:"application",systemType:O.value}).getApplicationDetail(c).then(t=>{var r,k,u,M,S;(r=t.data)==null||r.workFlow.nodes.map(m=>{m.properties.noRender=!0}),d.value=t.data,d.value.stt_model_id=t.data.stt_model,d.value.ttsModelId=t.data.tts_model,d.value.ttsType=t.data.ttsType,R.value=(k=t.data)==null?void 0:k.update_time,(M=(u=d.value.workFlow)==null?void 0:u.nodes)==null||M.filter(m=>m.id==="base-node").map(m=>{se.value=m.properties.api_input_field_list?m.properties.api_input_field_list.map(y=>({name:y.variable,value:y.default_value})):m.properties.inputFieldList?m.properties.inputFieldList.filter(y=>y.assignment_method==="api_input").map(y=>({name:y.variable,value:y.default_value})):[]}),J({type:"application",systemType:O.value}).getAccessToken(c,T).then(m=>{d.value={...d.value,...m.data}}),(S=A.value)==null||S.clearGraphData(),Ye(()=>{var m;(m=A.value)==null||m.render(d.value.workFlow),pe.value=Y()}),ee([x.IS_EE,x.IS_PE],"OR")&&J({type:"application",systemType:O.value}).getApplicationSetting(c).then(m=>{d.value={...d.value,...m.data}})})}function $e(t,r){const k={workFlow:Y()};T.value=r||!1,J({type:"application",systemType:O.value}).putApplication(c,k).then(()=>{R.value=new Date,t&&(pe.value=Y(),De(V("common.saveSuccess")),r&&Re())}).catch(()=>{T.value=!1})}const Re=()=>H.path.includes("workspace")?j.push({path:ro()}):j.push({path:io()}),io=()=>ee([B.ADMIN,L.RESOURCE_APPLICATION_OVERVIEW_READ],"OR")?`/application/${w}/${c}/WORK_FLOW/overview`:ee([B.ADMIN,L.RESOURCE_APPLICATION_ACCESS_READ],"OR")?`/application/${w}/${c}/WORK_FLOW/access`:ee([B.ADMIN,L.RESOURCE_APPLICATION_CHAT_USER_READ],"OR")?`/application/${w}/${c}/WORK_FLOW/chat-user`:ee([B.ADMIN,L.RESOURCE_APPLICATION_CHAT_LOG_READ],"OR")?`/application/${w}/${c}/WORK_FLOW/chat-log`:"/system/resource-management/application",ro=()=>ee([new re([B.USER],[L.APPLICATION.getApplicationWorkspaceResourcePermission(c)],[],"AND"),B.WORKSPACE_MANAGE.getWorkspaceRole,L.APPLICATION_OVERVIEW_READ.getWorkspacePermissionWorkspaceManageRole,L.APPLICATION_OVERVIEW_READ.getApplicationWorkspaceResourcePermission(c)],"OR")?`/application/${w}/${c}/WORK_FLOW/overview`:ee([new re([B.USER],[L.APPLICATION.getApplicationWorkspaceResourcePermission(c)],[x.IS_EE,x.IS_PE],"AND"),new re([B.WORKSPACE_MANAGE.getWorkspaceRole],[L.APPLICATION_ACCESS_READ.getWorkspacePermissionWorkspaceManageRole],[x.IS_EE,x.IS_PE],"OR"),new re([],[L.APPLICATION_ACCESS_READ.getApplicationWorkspaceResourcePermission(c)],[x.IS_EE,x.IS_PE],"OR")],"OR")?`/application/${w}/${c}/WORK_FLOW/access`:ee([new re([B.USER],[L.APPLICATION.getApplicationWorkspaceResourcePermission(c)],[x.IS_EE,x.IS_PE],"AND"),new re([B.WORKSPACE_MANAGE.getWorkspaceRole],[L.APPLICATION_CHAT_USER_READ.getWorkspacePermissionWorkspaceManageRole],[x.IS_EE,x.IS_PE],"OR"),new re([],[L.APPLICATION_CHAT_USER_READ.getApplicationWorkspaceResourcePermission(c)],[x.IS_EE,x.IS_PE],"OR")],"OR")?`/application/${w}/${c}/WORK_FLOW/chat-user`:ee([new re([B.USER],[L.APPLICATION.getApplicationWorkspaceResourcePermission(c)],[],"AND"),L.APPLICATION_CHAT_LOG_READ.getWorkspacePermissionWorkspaceManageRole,L.APPLICATION_CHAT_LOG_READ.getApplicationWorkspaceResourcePermission(c)],"OR")?`/application/${w}/${c}/WORK_FLOW/chat-log`:"/application",Ie=()=>{U=setInterval(()=>{$e()},6e4)},We=()=>{U&&clearInterval(U)};return xe(()=>{Ve();const t=localStorage.getItem("workflowAutoSave");z.value=t==="true",z.value&&Ie()}),go(()=>{var t;We(),(t=A.value)==null||t.clearGraphData()}),(t,r)=>{var ze,Ge,Ke;const k=s("el-text"),u=s("el-button"),M=s("el-divider"),S=s("Close"),m=s("el-icon"),y=s("el-dropdown-item"),ie=s("el-switch"),he=s("el-dropdown-menu"),Ne=s("el-dropdown"),Ue=s("el-collapse-transition"),co=s("el-avatar"),po=s("LogoIcon"),uo=s("AiChat"),He=Se("click-outside"),_o=Se("loading");return _e((p(),D("div",et,[l("div",ot,[l("div",tt,[e(ho,{onClick:a}),l("h4",{class:"ellipsis",style:{"max-width":"300px"},title:(ze=d.value)==null?void 0:ze.name},_((Ge=d.value)==null?void 0:Ge.name),9,at),G.value&&K.value?(p(),D("div",st,[e(k,{type:"info",class:"ml-16 color-secondary"},{default:o(()=>[g(_(t.$t("views.applicationWorkflow.info.previewVersion"))+" "+_(Q.value.name||b(Te)(Q.value.update_time)),1)]),_:1})])):R.value?(p(),$(k,{key:1,type:"info",class:"ml-16 color-secondary"},{default:o(()=>[g(_(t.$t("views.applicationWorkflow.info.saveTime"))+_(b(Te)(R.value)),1)]),_:1})):de("",!0)]),G.value&&K.value?(p(),D("div",nt,[e(u,{type:"primary",class:"mr-8",onClick:r[0]||(r[0]=ue=>I())},{default:o(()=>[g(_(t.$t("views.applicationWorkflow.setting.restoreVersion")),1)]),_:1}),e(M,{direction:"vertical"}),e(u,{text:"",onClick:we},{default:o(()=>[e(m,null,{default:o(()=>[e(S)]),_:1})]),_:1})])):(p(),D("div",lt,[e(u,{icon:"Plus",onClick:r[1]||(r[1]=ue=>F.value=!F.value)},{default:o(()=>[g(_(t.$t("views.applicationWorkflow.setting.addComponent")),1)]),_:1}),W.value.debug(b(c))?(p(),$(u,{key:0,onClick:Ae,disabled:i.value},{default:o(()=>[e(te,{iconName:"app-debug-outlined",class:"mr-4"}),g(" "+_(t.$t("views.applicationWorkflow.setting.debug")),1)]),_:1},8,["disabled"])):de("",!0),e(u,{onClick:r[2]||(r[2]=ue=>$e(!0))},{default:o(()=>[e(te,{iconName:"app-save-outlined",class:"mr-4"}),g(" "+_(t.$t("common.save")),1)]),_:1}),e(u,{type:"primary",onClick:X},{default:o(()=>[g(_(t.$t("views.application.operation.publish")),1)]),_:1}),e(Ne,{trigger:"click"},{dropdown:o(()=>[e(he,null,{default:o(()=>[l("a",{href:n.value,target:"_blank"},[e(y,null,{default:o(()=>[e(te,{iconName:"app-create-chat",class:"color-secondary"}),g(" "+_(t.$t("views.application.operation.toChat")),1)]),_:1})],8,it),e(y,{onClick:E},{default:o(()=>[e(te,{iconName:"app-history-outlined",class:"color-secondary"}),g(" "+_(t.$t("views.applicationWorkflow.setting.releaseHistory")),1)]),_:1}),e(y,null,{default:o(()=>[e(te,{iconName:"app-save-outlined",class:"color-secondary"}),g(" "+_(t.$t("views.applicationWorkflow.setting.autoSave"))+" ",1),l("div",rt,[e(ie,{size:"small",modelValue:z.value,"onUpdate:modelValue":r[4]||(r[4]=ue=>z.value=ue),onChange:ne},null,8,["modelValue"])])]),_:1})]),_:1})]),default:o(()=>[e(u,{text:"",onClick:r[3]||(r[3]=fe(()=>{},["stop"])),class:"ml-8 mt-4"},{default:o(()=>[e(te,{iconName:"app-more",class:"rotate-90"})]),_:1})]),_:1})]))]),e(Ue,null,{default:o(()=>[_e(e(Go,{show:F.value,id:b(c),onClickNodes:le,onOnmousedown:P,workflowRef:A.value},null,8,["show","id","workflowRef"]),[[He,Ce]])]),_:1}),l("div",{class:"workflow-main",ref_key:"workflowMainRef",ref:Z},[d.value?(p(),$(Co,{key:0,ref_key:"workflowRef",ref:A,data:(Ke=d.value)==null?void 0:Ke.workFlow},null,8,["data"])):de("",!0)],512),e(Ue,null,{default:o(()=>{var ue,Be,je;return[i.value?(p(),D("div",{key:0,class:Le(["workflow-debug-container",f.value?"enlarge":""])},[l("div",{class:Le(["workflow-debug-header",C.value?"":"custom-header"])},[l("div",ct,[l("div",pt,[l("div",ut,[b(Ee)((ue=d.value)==null?void 0:ue.icon)?(p(),$(co,{key:0,shape:"square",size:32,style:{background:"none"}},{default:o(()=>{var ye;return[l("img",{src:b(ke)((ye=d.value)==null?void 0:ye.icon),alt:""},null,8,dt)]}),_:1})):(p(),$(po,{key:1,height:"32px"}))]),l("h4",{class:"ellipsis",style:{"max-width":"270px"},title:(Be=d.value)==null?void 0:Be.name},_(((je=d.value)==null?void 0:je.name)||t.$t("views.application.form.appName.label")),9,_t)]),l("div",ft,[e(u,{link:"",onClick:r[5]||(r[5]=ye=>f.value=!f.value)},{default:o(()=>[e(te,{iconName:f.value?"app-minify":"app-magnify",class:"color-secondary",style:{"font-size":"20px"}},null,8,["iconName"])]),_:1}),e(u,{link:"",onClick:r[6]||(r[6]=ye=>i.value=!1)},{default:o(()=>[e(m,{size:20,class:"color-secondary"},{default:o(()=>[e(S)]),_:1})]),_:1})])])],2),l("div",mt,[e(uo,{"application-details":d.value,type:"debug-ai-chat"},null,8,["application-details"])])],2)):de("",!0)]}),_:1}),G.value?_e((p(),$(Yo,{key:0,onClick:N,onRefreshVersion:I},null,512)),[[He,h]]):de("",!0)])),[[_o,T.value]])}}});export{Wt as default};
