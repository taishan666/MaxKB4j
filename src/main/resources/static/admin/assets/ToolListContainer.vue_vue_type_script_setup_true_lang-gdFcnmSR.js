import{ay as fe,aP as Ue,aA as De,aQ as de,b_ as Ne,aB as d,aR as Te,aX as Pe,aC as v,aD as s,b3 as Se,aE as r,aF as a,aG as o,aI as i,aH as l,b4 as be,aJ as m,a_ as B,aT as H,aU as w,b8 as j,c2 as Ae,c4 as Ce,aK as $,aW as N,b5 as me,a$ as ae,c8 as we,c3 as Ee,cS as qe,cn as He,bM as io,aY as se,b$ as ro,aZ as pe,cu as co,co as Q,cq as uo,dc as po,b9 as mo,di as fo,de as vo,dw as _o,d_ as yo,da as go,dj as ho,c0 as Fe,c9 as ko}from"./admin-DTQ9awQz.js";import{T as wo,_ as To}from"./store-Dp69Lk4V.js";import{c as bo,b as Oe,_ as $o,a as Co}from"./ToolFormDrawer.vue_vue_type_script_setup_true_lang-FcgLX447.js";import{_ as Do}from"./AuthorizedWorkspaceDialog.vue_vue_type_script_setup_true_lang-CGU3G6wN.js";import{_ as So}from"./index.vue_vue_type_script_setup_true_lang-C7sxf910.js";import{M as Ao}from"./MoveToDialog-BSZV46PZ.js";const Vo={class:"title-decoration-1 mb-16"},Lo={class:"flex w-full"},Io=["src"],Ro=`{
  "math": {
    "url": "your_server",
    "type": "sse"
  }
}`,Mo=fe({__name:"McpToolFormDrawer",props:{title:String},emits:["refresh"],setup(oe,{expose:Z,emit:T}){const z=Ue(),{folder:S,user:p}=De(),C=de(()=>z.path.includes("shared")?"systemShare":z.path.includes("resource-management")?"systemManage":"workspace"),_=de(()=>Ne.tool[C.value]),g=T,V=d(),c=d(),b=d(!1),D=d(!1),A=d(!1),F=d(!1),E=d(null),U=d(!1),y=d({name:"",desc:"",code:"",icon:"",inputFieldList:[],initFieldList:[],toolType:"MCP"});Te(A,k=>{var u;k||(b.value=!1,F.value=!1,E.value=null,y.value={name:"",desc:"",code:"",icon:"",inputFieldList:[],initFieldList:[],toolType:"MCP"},(u=c.value)==null||u.clearValidate())});const L=Pe({name:[{required:!0,message:v("views.tool.form.toolName.requiredMessage"),trigger:"blur"}]});function O(){b.value||!R(y.value)?A.value=!1:we(v("common.tip"),v("views.tool.tip.saveMessage"),{confirmButtonText:v("common.confirm"),type:"warning"}).then(()=>{A.value=!1}).catch(()=>{})}function R(k){return Object.values(k).some(u=>Array.isArray(u)?u.length!==0:u!=null&&u!=="")}function le(k){y.value.icon=k}function h(){V.value.open(y.value)}const I=async k=>{k&&await k.validate(u=>{var J,X;if(u)if(b.value)N({type:"tool",systemType:C.value}).putTool((J=y.value)==null?void 0:J.id,y.value,D).then(G=>(me(v("common.editSuccess")),g("refresh",G.data),p.profile())).then(()=>{A.value=!1});else{const G={folderId:(X=S.currentFolder)==null?void 0:X.id,...y.value};N({type:"tool",systemType:C.value}).postTool(G,D).then(ee=>(me(v("common.createSuccess")),g("refresh"),p.profile())).then(()=>{A.value=!1})}})};function q(){y.value.code&&(D.value=!0,N({type:"tool",systemType:C.value}).postToolTestConnection({code:y.value.code},D).then(()=>{me(v("views.system.testSuccess"))}).finally(()=>{D.value=!1}))}return Z({open:k=>{k&&(b.value=!!(k!=null&&k.id),y.value=ae.cloneDeep(k)),A.value=!0,setTimeout(()=>{F.value=!0},100)}}),(k,u)=>{const J=s("el-Avatar"),X=s("el-avatar"),G=s("AppIcon"),ee=s("el-input"),re=s("el-form-item"),ve=s("el-text"),M=s("el-form"),W=s("el-button"),_e=s("el-drawer"),he=Se("loading");return a(),r(_e,{modelValue:A.value,"onUpdate:modelValue":u[10]||(u[10]=P=>A.value=P),size:"60%","before-close":O},{header:o(()=>[i("h4",null,m(oe.title),1)]),footer:o(()=>{var P;return[i("div",null,[l(W,{loading:D.value,onClick:q},{default:o(()=>[$(m(k.$t("views.system.test")),1)]),_:1},8,["loading"]),l(W,{loading:D.value,onClick:u[8]||(u[8]=Y=>A.value=!1)},{default:o(()=>[$(m(k.$t("common.cancel")),1)]),_:1},8,["loading"]),(b.value?_.value.edit((P=y.value)==null?void 0:P.id):_.value.create())?(a(),r(W,{key:0,type:"primary",onClick:u[9]||(u[9]=Y=>I(c.value)),loading:D.value},{default:o(()=>[$(m(b.value?k.$t("common.save"):k.$t("common.create")),1)]),_:1},8,["loading"])):w("",!0)])]}),default:o(()=>[i("div",null,[i("h4",Vo,m(k.$t("views.model.modelForm.title.baseInfo")),1),be((a(),r(M,{ref_key:"FormRef",ref:c,model:y.value,rules:L,"label-position":"top","require-asterisk-position":"right",onSubmit:u[7]||(u[7]=B(()=>{},["prevent"]))},{default:o(()=>[l(re,{label:k.$t("views.tool.form.toolName.label"),prop:"name"},{default:o(()=>[i("div",Lo,[y.value.id?(a(),H("div",{key:0,class:"edit-avatar mr-12",onMouseenter:u[0]||(u[0]=P=>U.value=!0),onMouseleave:u[1]||(u[1]=P=>U.value=!1)},[j(Ae)(y.value.icon)?(a(),r(J,{key:0,id:y.value.id,shape:"square",size:32,style:{background:"none"}},{default:o(()=>[i("img",{src:String(y.value.icon),alt:""},null,8,Io)]),_:1},8,["id"])):(a(),r(X,{key:1,class:"avatar-green",shape:"square",size:32},{default:o(()=>u[11]||(u[11]=[i("img",{src:Ce,style:{width:"58%"},alt:""},null,-1)])),_:1,__:[11]})),U.value?(a(),r(J,{key:2,id:y.value.id,shape:"square",class:"edit-mask",size:32,onClick:h},{default:o(()=>[l(G,{iconName:"app-edit"})]),_:1},8,["id"])):w("",!0)],32)):(a(),r(X,{key:1,class:"avatar-green mr-12",shape:"square",size:32},{default:o(()=>u[12]||(u[12]=[i("img",{src:Ce,style:{width:"58%"},alt:""},null,-1)])),_:1,__:[12]})),l(ee,{modelValue:y.value.name,"onUpdate:modelValue":u[2]||(u[2]=P=>y.value.name=P),placeholder:k.$t("views.tool.form.toolName.placeholder"),maxlength:"64","show-word-limit":"",onBlur:u[3]||(u[3]=P=>{var Y;return y.value.name=(Y=y.value.name)==null?void 0:Y.trim()})},null,8,["modelValue","placeholder"])])]),_:1},8,["label"]),l(re,{label:k.$t("views.tool.form.toolDescription.label")},{default:o(()=>[l(ee,{modelValue:y.value.desc,"onUpdate:modelValue":u[4]||(u[4]=P=>y.value.desc=P),type:"textarea",placeholder:k.$t("views.tool.form.toolDescription.placeholder"),maxlength:"128","show-word-limit":"",autosize:{minRows:3},onBlur:u[5]||(u[5]=P=>{var Y;return y.value.desc=(Y=y.value.desc)==null?void 0:Y.trim()})},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(re,{prop:"code"},{label:o(()=>[$(m(k.$t("views.tool.form.mcp.label"))+" ",1),u[13]||(u[13]=i("span",{class:"color-danger"},"*",-1)),l(ve,{type:"info",class:"color-secondary"},{default:o(()=>[$(" （"+m(k.$t("views.tool.form.mcp.tip"))+"） ",1)]),_:1})]),default:o(()=>[l(ee,{modelValue:y.value.code,"onUpdate:modelValue":u[6]||(u[6]=P=>y.value.code=P),placeholder:Ro,type:"textarea",autosize:{minRows:5}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[he,D.value]])]),l(bo,{ref_key:"EditAvatarDialogRef",ref:V,onRefresh:le},null,512)]),_:1},8,["modelValue"])}}}),xo=["src"],zo={class:"flex align-center"},Fo=["title"],Bo={class:"card-footer-left color-secondary"},Uo=fe({__name:"ToolCard",props:{tool:{},getSubTitle:{type:Function},addLoading:{type:Boolean}},emits:["handleAdd","handleDetail"],setup(oe,{emit:Z}){const T=oe,z=Z;return(S,p)=>{const C=s("el-avatar"),_=s("el-tag"),g=s("el-text"),V=s("el-button");return a(),r(qe,{title:T.tool.name,description:T.tool.desc,class:"cursor"},{icon:o(()=>{var c,b,D;return[j(Ae)((c=T.tool)==null?void 0:c.icon)?(a(),r(C,{key:0,shape:"square",size:32,style:{background:"none"}},{default:o(()=>{var A;return[i("img",{src:j(Ee)((A=T.tool)==null?void 0:A.icon),alt:""},null,8,xo)]}),_:1})):(b=T.tool)!=null&&b.name?(a(),r(C,{key:1,name:(D=T.tool)==null?void 0:D.name,pinyinColor:"",shape:"square",size:32},null,8,["name"])):w("",!0)]}),title:o(()=>{var c,b,D;return[i("div",zo,[i("span",{title:(c=T.tool)==null?void 0:c.name,class:"ellipsis"},m((b=T.tool)==null?void 0:b.name),9,Fo),(D=T.tool)!=null&&D.version?(a(),r(_,{key:0,class:"ml-4",type:"info",effect:"plain"},{default:o(()=>{var A;return[$(m((A=T.tool)==null?void 0:A.version),1)]}),_:1})):w("",!0)])]}),subTitle:o(()=>[l(g,{class:"color-secondary",size:"small"},{default:o(()=>[$(m(S.getSubTitle(T.tool)),1)]),_:1})]),footer:o(()=>[i("span",Bo,m(`${S.$t("common.author")}: MaxKB4J`),1),i("div",{class:"card-footer-operation",onClick:p[2]||(p[2]=B(()=>{},["stop"]))},[l(V,{onClick:p[0]||(p[0]=c=>z("handleDetail"))},{default:o(()=>[$(m(S.$t("common.detail")),1)]),_:1}),l(V,{type:"primary",loading:T.addLoading,onClick:p[1]||(p[1]=c=>z("handleAdd"))},{default:o(()=>[$(m(S.$t("common.add")),1)]),_:1},8,["loading"])])]),_:1},8,["title","description"])}}}),Be=He(Uo,[["__scopeId","data-v-aa5011e1"]]),No={class:"flex align-center",style:{"margin-left":"-8px"}},Po={class:"card-header"},Eo={class:"flex-between"},qo={class:"title flex align-center"},Ho=["src"],Oo={class:"ml-16"},Wo={class:"mb-8"},jo={class:"mt-16"},Jo=fe({__name:"InternalDescDrawer",emits:["refresh","addTool"],setup(oe,{expose:Z,emit:T}){const z=T,S=d(!1),p=d(""),C=d({});Te(S,V=>{V||(p.value="")});const _=(V,c)=>{C.value=c,V&&(p.value=ae.cloneDeep(V)),S.value=!0},g=V=>{z("addTool",V),S.value=!1};return Z({open:_}),(V,c)=>{const b=s("Back"),D=s("el-icon"),A=s("el-button"),F=s("el-avatar"),E=s("el-text"),U=s("MdPreview"),y=s("el-drawer");return a(),r(y,{modelValue:S.value,"onUpdate:modelValue":c[3]||(c[3]=L=>S.value=L),size:"60%","append-to-body":!0},{header:o(()=>[i("div",No,[l(A,{class:"cursor mr-4",link:"",onClick:c[0]||(c[0]=B(L=>S.value=!1,["prevent"]))},{default:o(()=>[l(D,{size:20},{default:o(()=>[l(b)]),_:1})]),_:1}),c[4]||(c[4]=i("h4",null,"详情",-1))])]),default:o(()=>{var L,O,R,le;return[i("div",null,[i("div",Po,[i("div",Eo,[i("div",qo,[j(Ae)((L=C.value)==null?void 0:L.icon)?(a(),r(F,{key:0,shape:"square",size:64,style:{background:"none"},class:"mr-8"},{default:o(()=>{var h;return[i("img",{src:(h=C.value)==null?void 0:h.icon,alt:""},null,8,Ho)]}),_:1})):(O=C.value)!=null&&O.name?(a(),r(F,{key:1,name:(R=C.value)==null?void 0:R.name,pinyinColor:"",shape:"square",size:64,class:"mr-8"},null,8,["name"])):w("",!0),i("div",Oo,[i("h3",Wo,m(C.value.name),1),(le=C.value)!=null&&le.desc?(a(),r(E,{key:0,type:"info"},{default:o(()=>[$(m(C.value.desc),1)]),_:1})):w("",!0)])]),i("div",{onClick:c[2]||(c[2]=B(()=>{},["stop"]))},[l(A,{type:"primary",onClick:c[1]||(c[1]=h=>g(C.value))},{default:o(()=>[$(m(V.$t("common.add")),1)]),_:1})])]),i("div",jo,[l(E,{type:"info"},{default:o(()=>[i("div",null,m(V.$t("common.author"))+": MaxKB4J",1)]),_:1})])]),l(U,{ref:"editorRef",editorId:"preview-only",modelValue:p.value,style:{background:"none"},noImgZoomIn:""},null,8,["modelValue"])])]}),_:1},8,["modelValue"])}}}),Ko={class:"dialog-header flex-between mb-8"},Qo=["id"],Zo={class:"flex align-center",style:{"margin-right":"28px"}},Go=["id"],Xo={key:1},Yo={class:"color-text-primary medium mb-16"},el={class:"color-primary"},ol=fe({__name:"ToolStoreDialog",props:{apiType:{type:String,default:"workspace"}},emits:["refresh"],setup(oe,{expose:Z,emit:T}){const{user:z}=De(),S=oe,p=T,C=d(!1),_=d(!1),g=d(""),V=d(""),c=d([{id:"web_search",title:v("views.tool.toolStore.webSearch"),tools:[]},{id:"database_search",title:v("views.tool.toolStore.databaseQuery"),tools:[]},{id:"content_handle",title:v("views.tool.toolStore.contentHandle"),tools:[]},{id:"developer",title:v("views.tool.toolStore.developer"),tools:[]},{id:"send_message",title:v("views.tool.toolStore.sendMessage"),tools:[]},{id:"translate",title:v("views.tool.toolStore.translate"),tools:[]},{id:"other",title:v("views.tool.toolStore.otherTool"),tools:[]}]),b=d(null);function D(h){var I;return((I=c.value.find(q=>q.id===h.label))==null?void 0:I.title)??""}function A(h){V.value=h,b.value=null,C.value=!0}io(()=>{F()});async function F(){try{const h=await wo.getInternalToolList({name:g.value},_);g.value.length?b.value=h.data:(b.value=null,c.value.forEach(I=>{I.tools=h.data.filter(q=>q.label===I.id)}))}catch(h){console.error(h)}}const E=h=>{h.preventDefault()},U=d();async function y(h){var k;const I=h.icon.replace("icon.png","detail.md"),ie=await(await fetch(I)).text();(k=U.value)==null||k.open(ie,h)}const L=d();function O(h,I){var q;(q=L.value)==null||q.open(h,I)}const R=d(!1);async function le(h){try{await N({type:"tool",systemType:S.apiType}).addInternalTool(h.id,h,R).then(()=>z.profile()),p("refresh"),me(v("common.addSuccess")),C.value=!1}catch(I){console.error(I)}}return Z({open:A}),(h,I)=>{const q=s("el-input"),ie=s("el-divider"),k=s("el-anchor-link"),u=s("el-anchor"),J=s("el-col"),X=s("el-row"),G=s("el-empty"),ee=s("el-scrollbar"),re=s("el-dialog"),ve=Se("loading");return a(),H(se,null,[l(re,{modelValue:C.value,"onUpdate:modelValue":I[1]||(I[1]=M=>C.value=M),width:"1200","append-to-body":"",class:"tool-store-dialog","align-center":"","close-on-click-modal":!1,"close-on-press-escape":!1},{header:o(({titleId:M})=>[i("div",Ko,[i("h4",{id:M,class:"medium"},m(h.$t("views.tool.toolStore.title")),9,Qo),i("div",Zo,[l(q,{modelValue:g.value,"onUpdate:modelValue":I[0]||(I[0]=W=>g.value=W),placeholder:h.$t("common.search"),"prefix-icon":"Search",class:"w-240 mr-8",clearable:"",onChange:F},null,8,["modelValue","placeholder"]),l(ie,{direction:"vertical"})])])]),default:o(()=>[be((a(),r(ro,{minLeftWidth:204},{left:o(()=>[l(u,{direction:"vertical",offset:130,type:"default",container:".category-scrollbar",onClick:E},{default:o(()=>[(a(!0),H(se,null,pe(c.value,M=>(a(),r(k,{key:M.id,href:`#category-${M.id}`,title:M.title},null,8,["href","title"]))),128))]),_:1})]),default:o(()=>[l(ee,{class:"layout-bg","wrap-class":"p-16-24 category-scrollbar"},{default:o(()=>[b.value===null?(a(!0),H(se,{key:0},pe(c.value,M=>(a(),H("div",{key:M.id},[i("h4",{class:"title-decoration-1 mb-16 mt-8 color-text-primary",id:`category-${M.id}`},m(M.title),9,Go),l(X,{gutter:16},{default:o(()=>[(a(!0),H(se,null,pe(M.tools,W=>(a(),r(J,{key:W.id,span:8,class:"mb-16"},{default:o(()=>[l(Be,{tool:W,addLoading:R.value,"get-sub-title":D,onHandleAdd:_e=>O(W),onHandleDetail:_e=>y(W)},null,8,["tool","addLoading","onHandleAdd","onHandleDetail"])]),_:2},1024))),128))]),_:2},1024)]))),128)):(a(),H("div",Xo,[i("h4",Yo,[i("span",el,m(g.value),1),$(" "+m(j(v)("views.tool.toolStore.searchResult",{count:b.value.length})),1)]),b.value.length?(a(),r(X,{key:0,gutter:16},{default:o(()=>[(a(!0),H(se,null,pe(b.value,M=>(a(),r(J,{key:M.id,span:8,class:"mb-16"},{default:o(()=>[l(Be,{tool:M,addLoading:R.value,"get-sub-title":D,onHandleAdd:W=>O(M),onHandleDetail:W=>y(M)},null,8,["tool","addLoading","onHandleAdd","onHandleDetail"])]),_:2},1024))),128))]),_:1})):(a(),r(G,{key:1,description:h.$t("common.noData")},null,8,["description"]))]))]),_:1})]),_:1})),[[ve,_.value]])]),_:1},8,["modelValue"]),l(Jo,{ref_key:"internalDescDrawerRef",ref:U,onAddTool:O},null,512),l(Oe,{ref_key:"addInternalToolDialogRef",ref:L,onRefresh:le},null,512)],64)}}}),ll=fe({__name:"McpToolConfigDialog",setup(oe,{expose:Z}){const T=d(""),z=d(!1),S=d(!1),p=()=>{z.value=!1};return Z({open:_=>{T.value=_.code,z.value=!0}}),(_,g)=>{const V=s("el-input"),c=s("el-button"),b=s("el-form-item"),D=s("el-form"),A=s("el-dialog");return a(),r(A,{title:_.$t("views.tool.mcpConfig"),width:"600",modelValue:z.value,"onUpdate:modelValue":g[4]||(g[4]=F=>z.value=F),"close-on-click-modal":!1,"close-on-press-escape":!1,"destroy-on-close":!0,"before-close":p,"append-to-body":"",class:"mcp-config-dialog"},{default:o(()=>[l(D,{"label-width":"auto","label-position":"top"},{default:o(()=>[l(b,{onMouseenter:g[2]||(g[2]=B(F=>S.value=!0,["stop"])),onMouseleave:g[3]||(g[3]=B(F=>S.value=!1,["stop"]))},{default:o(()=>[l(V,{type:"textarea",modelValue:T.value,"onUpdate:modelValue":g[0]||(g[0]=F=>T.value=F),rows:"8",disabled:"",class:"config-textarea"},null,8,["modelValue"]),be(l(c,{circle:"",class:"copy-icon",onClick:g[1]||(g[1]=B(F=>j(co)(T.value),["stop"]))},{default:o(()=>[l(Q,{iconName:"app-copy",class:"color-secondary"})]),_:1},512),[[uo,S.value]])]),_:1})]),_:1})]),_:1},8,["title","modelValue"])}}}),tl=He(ll,[["__scopeId","data-v-9cad61b5"]]),nl={class:"flex"},al={class:"flex-between complex-search"},sl={class:"flex align-center"},il={class:"flex align-center"},rl={class:"flex align-center w-full"},cl={class:"pre-wrap ml-8"},ul={class:"lighter"},dl={style:{"max-height":"calc(100vh - 120px)"}},pl=["src"],ml={class:"flex align-center"},fl=["title"],vl={key:0,class:"flex align-center"},_l={class:"color-secondary"},yl={key:1,class:"flex align-center"},gl={class:"color-secondary"},Cl=fe({__name:"ToolListContainer",emits:["refreshFolder"],setup(oe,{emit:Z}){const T=Ue(),{folder:z,user:S,tool:p}=De();po((e,t)=>{p.setToolList([])});const C=Z,_=de(()=>T.path.includes("shared")?"systemShare":T.path.includes("resource-management")?"systemManage":"workspace"),g=de(()=>z.currentFolder.id==="share"),V=de(()=>_.value==="systemShare"),c=de(()=>Ne.tool[_.value]),b=e=>c.value.edit(e)||c.value.export(e)||c.value.delete(e)||c.value.auth(e)||V.value,D=d();function A(e){D.value.open(e.id)}const F=d(),E=d("name"),U=d({name:"",createUser:"",isActive:null}),y=d([]),L=d(!1),O=d(!1),R=Pe({current_page:1,page_size:30,total:0}),le=()=>{U.value={name:"",createUser:""}},h=d(),I=d(),q=d(""),ie=d(""),k=d();function u(e){const t=ae.cloneDeep(p.toolList),f=t.findIndex(x=>x.id===e.id);t.splice(f,1),p.setToolList(t)}const J=d();function X(e){J.value&&J.value.open(e,"Tool")}function G(e){if((e==null?void 0:e.toolType)==="MCP"){ee(e);return}e!=null&&e.templateId||g.value||(q.value=e?v("views.tool.editTool"):v("views.tool.createTool"),e?N({type:"tool",systemType:_.value}).getToolById(e==null?void 0:e.id,L).then(t=>{h.value.open(t.data)}):h.value.open(e))}function ee(e){e!=null&&e.templateId||g.value||(ie.value=e?v("views.tool.editMcpTool"):v("views.tool.createMcpTool"),e?N({type:"tool",systemType:_.value}).getToolById(e==null?void 0:e.id,L).then(t=>{I.value.open(t.data)}):I.value.open(e))}async function re(e){if(e.isActive)we(`${v("views.tool.disabled.confirmTitle")}${e.name} ?`,v("views.tool.disabled.confirmMessage"),{confirmButtonText:v("common.status.disable"),confirmButtonClass:"danger"}).then(()=>{const t={isActive:!e.isActive};N({type:"tool",systemType:_.value}).putTool(e.id,t,O).then(()=>{const f=ae.cloneDeep(p.toolList),x=f.findIndex(te=>te.id===e.id);return f[x].isActive=!e.isActive,p.setToolList(f),!0}).catch(()=>!1)});else{const t=await N({type:"tool",systemType:_.value}).getToolById(e.id,O);if((!t.data.initParams||Object.keys(t.data.initParams).length===0)&&t.data.initFieldList&&t.data.initFieldList.length>0&&t.data.initFieldList.filter(x=>x.defaultValue&&x.show_default_value).length!==t.data.initFieldList.length)return F.value.open(t.data,!e.isActive),!1;const f={isActive:!e.isActive};N({type:"tool",systemType:_.value}).putTool(e.id,f,O).then(()=>{const x=ae.cloneDeep(p.toolList),te=x.findIndex(ye=>ye.id===e.id);return x[te].isActive=!e.isActive,p.setToolList(x),!0}).catch(()=>!1)}}async function ve(e){q.value=v("views.tool.copyTool");const t=await N({type:"tool",systemType:_.value}).getToolById(e.id,O),f=ae.cloneDeep(t.data);delete f.id,f.name=f.name+`  ${v("common.copyTitle")}`,h.value.open(f)}function M(e){N({type:"tool",systemType:_.value}).exportTool(e.id,e.name,L).catch(t=>{t.response.status!==403&&t.response.data.text().then(f=>{ko(`${v("views.application.tip.ExportError")}:${JSON.parse(f).message}`)})})}function W(e){we(`${v("views.tool.delete.confirmTitle")}：${e.name} ?`,v("views.tool.delete.confirmMessage"),{confirmButtonText:v("common.confirm"),cancelButtonText:v("common.cancel"),confirmButtonClass:"danger"}).then(()=>{N({type:"tool",systemType:_.value}).delTool(e.id,L).then(()=>{const t=ae.cloneDeep(p.toolList),f=t.findIndex(x=>x.id===e.id);t.splice(f,1),p.setToolList(t),me(v("common.deleteSuccess"))})}).catch(()=>{})}function _e(e){N({type:"tool",systemType:_.value}).getToolById(e==null?void 0:e.id,O).then(t=>{F.value.open(t.data)})}const he=d();function P(){var e;(e=he.value)==null||e.open(z.currentFolder.id)}const Y=d();function We(e,t){var f;(f=Y.value)==null||f.open(e,t)}function je(e,t){t&&N({type:"tool",systemType:_.value}).putTool(e==null?void 0:e.id,{name:e.name},L).then(f=>{me(v("common.saveSuccess")),ue()})}const Ve=d();function Je(e){const t=new FormData;t.append("file",e.raw,e.name),t.append("folderId",z.currentFolder.id||S.getWorkspaceId()),Ve.value.clearFiles(),N({type:"tool",systemType:_.value}).postImportTool(t,L).then(async f=>{if(f!=null&&f.data)return p.setToolList([]),S.profile()}).then(()=>{ce()}).catch(f=>{f.code===400&&we(v("common.tip"),v("views.application.tip.professionalMessage"),{cancelButtonText:v("common.confirm"),confirmButtonText:v("common.professional")}).then(()=>{window.open("https://tarzan.blog.csdn.net","_blank")})})}const Le=d();function Ke(e){N({type:"tool",systemType:_.value}).getToolById(e==null?void 0:e.id,L).then(t=>{Le.value.open(t.data)})}function ue(e){if(e){const t=ae.cloneDeep(p.toolList),f=t.findIndex(x=>x.id===e.id);t.splice(f,1,e),p.setToolList(t)}else R.total=0,R.current_page=1,p.setToolList([]),ce()}const Qe=d();Te(()=>z.currentFolder,e=>{e&&e.id&&(R.current_page=1,p.setToolList([]),ce())},{deep:!0,immediate:!0}),Te(()=>p.toolType,()=>{R.current_page=1,p.setToolList([]),ce()});function ce(){var t;const e={folderId:((t=z.currentFolder)==null?void 0:t.id)||S.getWorkspaceId(),scope:_.value==="systemShare"?"SHARED":"WORKSPACE",toolType:p.toolType||""};U.value[E.value]&&(e[E.value]=U.value[E.value]),N({type:"tool",isShared:g.value,systemType:_.value}).getToolListPage(R,e,L).then(f=>{var x,te;R.total=(x=f.data)==null?void 0:x.total,p.setToolList([...p.toolList,...(te=f.data)==null?void 0:te.records])})}function Ze(){C("refreshFolder")}function $e(){R.current_page=1,p.setToolList([]),ce()}return mo(()=>{_.value!=="workspace"&&ce(),N({type:"workspace",isShared:g.value,systemType:_.value}).getAllMemberList(S.getWorkspaceId(),L).then(e=>{y.value=e.data})}),(e,t)=>{const f=s("el-option"),x=s("el-select"),te=s("el-input"),ye=s("el-button"),Ge=s("arrow-down"),Ie=s("el-icon"),ke=s("el-avatar"),K=s("el-dropdown-item"),Xe=s("el-upload"),Re=s("el-dropdown-menu"),Me=s("el-dropdown"),xe=s("el-tag"),Ye=s("el-text"),eo=s("SuccessFilled"),oo=s("el-switch"),lo=s("el-divider"),to=s("el-col"),no=s("el-row"),ao=s("el-empty"),so=Se("loading");return a(),H(se,null,[l(fo,null,{header:o(()=>[go(e.$slots,"header")]),search:o(()=>[i("div",nl,[i("div",al,[l(x,{class:"complex-search__left",modelValue:E.value,"onUpdate:modelValue":t[0]||(t[0]=n=>E.value=n),style:{width:"120px"},onChange:le},{default:o(()=>[l(f,{label:e.$t("common.creator"),value:"createUser"},null,8,["label"]),l(f,{label:e.$t("views.tool.form.toolName.label"),value:"name"},null,8,["label"]),l(f,{label:e.$t("views.document.enableStatus.label"),value:"isActive"},null,8,["label"])]),_:1},8,["modelValue"]),E.value==="name"?(a(),r(te,{key:0,modelValue:U.value.name,"onUpdate:modelValue":t[1]||(t[1]=n=>U.value.name=n),onChange:$e,placeholder:e.$t("common.searchBar.placeholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):E.value==="isActive"?(a(),r(x,{key:1,modelValue:U.value.isActive,"onUpdate:modelValue":t[2]||(t[2]=n=>U.value.isActive=n),onChange:$e,filterable:"",clearable:"",style:{width:"220px"}},{default:o(()=>[l(f,{label:e.$t("views.document.enableStatus.enable"),value:"true"},null,8,["label"]),l(f,{label:e.$t("views.document.enableStatus.close"),value:"false"},null,8,["label"])]),_:1},8,["modelValue"])):E.value==="createUser"?(a(),r(x,{key:2,modelValue:U.value.createUser,"onUpdate:modelValue":t[3]||(t[3]=n=>U.value.createUser=n),onChange:$e,filterable:"",clearable:"",style:{width:"220px"}},{default:o(()=>[(a(!0),H(se,null,pe(y.value,n=>(a(),r(f,{key:n.id,value:n.id,label:n.nickname},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):w("",!0)]),!g.value&&c.value.create()?(a(),r(ye,{key:0,class:"ml-8",onClick:t[4]||(t[4]=n=>P())},{default:o(()=>[$(m(e.$t("views.tool.toolStore.title")),1)]),_:1})):w("",!0),!g.value&&c.value.create()?(a(),r(Me,{key:1,trigger:"click"},{dropdown:o(()=>[l(Re,{class:"create-dropdown"},{default:o(()=>[l(K,{onClick:t[5]||(t[5]=n=>G())},{default:o(()=>[i("div",sl,[l(ke,{class:"avatar-green",shape:"square",size:32},{default:o(()=>t[10]||(t[10]=[i("img",{src:Ce,style:{width:"58%"},alt:""},null,-1)])),_:1,__:[10]}),t[11]||(t[11]=i("div",{class:"pre-wrap ml-8"},[i("div",{class:"lighter"},"创建工具")],-1))])]),_:1}),l(K,{onClick:t[6]||(t[6]=n=>ee())},{default:o(()=>[i("div",il,[l(ke,{shape:"square",size:32},{default:o(()=>t[12]||(t[12]=[i("img",{src:yo,style:{width:"58%"},alt:""},null,-1)])),_:1,__:[12]}),t[13]||(t[13]=i("div",{class:"pre-wrap ml-8"},[i("div",{class:"lighter"},"创建MCP")],-1))])]),_:1}),l(Xe,{ref_key:"elUploadRef",ref:Ve,"file-list":[],action:"#",multiple:"","auto-upload":!1,"show-file-list":!1,limit:1,"on-change":(n,ze)=>Je(n),class:"import-button"},{default:o(()=>[c.value.import()?(a(),r(K,{key:0},{default:o(()=>[i("div",rl,[l(ke,{shape:"square",class:"mt-4",size:36,style:{background:"none"}},{default:o(()=>t[14]||(t[14]=[i("img",{src:To,alt:""},null,-1)])),_:1,__:[14]}),i("div",cl,[i("div",ul,m(e.$t("common.importCreate")),1)])])]),_:1})):w("",!0)]),_:1},8,["on-change"])]),_:1})]),default:o(()=>[l(ye,{type:"primary",class:"ml-8"},{default:o(()=>[$(m(e.$t("common.create"))+" ",1),l(Ie,{class:"el-icon--right"},{default:o(()=>[l(Ge)]),_:1})]),_:1})]),_:1})):w("",!0)])]),default:o(()=>[be((a(),H("div",dl,[l(vo,{size:j(p).toolList.length,total:R.total,page_size:R.page_size,current_page:R.current_page,"onUpdate:current_page":t[9]||(t[9]=n=>R.current_page=n),onLoad:ce,loading:L.value},{default:o(()=>[j(p).toolList.length>0?(a(),r(no,{key:0,gutter:15,class:"w-full"},{default:o(()=>[(a(!0),H(se,null,pe(j(p).toolList,(n,ze)=>(a(),r(to,{key:ze,xs:24,sm:12,md:12,lg:6,xl:6,class:"mb-16"},{default:o(()=>[l(qe,{title:n.name,description:n.desc,class:"cursor",onClick:B(ge=>G(n),["stop"]),disabled:c.value.edit(n.id)},{icon:o(()=>[n!=null&&n.icon?(a(),r(ke,{key:0,shape:"square",size:32,style:{background:"none"},class:"mr-8"},{default:o(()=>[i("img",{src:j(Ee)(n==null?void 0:n.icon),alt:""},null,8,pl)]),_:2},1024)):(a(),r(_o,{key:1,size:32,type:n==null?void 0:n.toolType},null,8,["type"]))]),title:o(()=>[i("div",ml,[i("span",{class:"ellipsis-1",title:n.name},m(n.name),9,fl),n.version?(a(),r(xe,{key:0,class:"ml-4",type:"info",effect:"plain"},{default:o(()=>[$(m(n.version),1)]),_:2},1024)):w("",!0)])]),subTitle:o(()=>[l(Ye,{class:"color-secondary lighter",size:"small"},{default:o(()=>[$(m(e.$t("common.creator"))+": "+m(n==null?void 0:n.nickname),1)]),_:2},1024)]),tag:o(()=>[g.value?(a(),r(xe,{key:0,type:"info",class:"info-tag"},{default:o(()=>[$(m(j(v)("views.shared.title")),1)]),_:1})):w("",!0)]),footer:o(()=>[n.isActive?(a(),H("div",vl,[l(Ie,{class:"color-success mr-8",style:{"font-size":"16px"}},{default:o(()=>[l(eo)]),_:1}),i("span",_l,m(e.$t("common.status.enabled")),1)])):(a(),H("div",yl,[l(Q,{iconName:"app-disabled",class:"color-secondary mr-8"}),i("span",gl,m(e.$t("common.status.disabled")),1)]))]),mouseEnter:o(()=>[!g.value&&b(n.id)?(a(),H("div",{key:0,onClick:t[8]||(t[8]=B(()=>{},["stop"]))},[c.value.switch(n.id)?(a(),r(oo,{key:0,modelValue:n.isActive,"onUpdate:modelValue":ge=>n.isActive=ge,"before-change":()=>re(n),size:"small",class:"mr-4"},null,8,["modelValue","onUpdate:modelValue","before-change"])):w("",!0),l(lo,{direction:"vertical"}),l(Me,{trigger:"click"},{dropdown:o(()=>[l(Re,null,{default:o(()=>{var ge;return[n.toolType==="MCP"?(a(),r(K,{key:0,onClick:B(ne=>Ke(n),["stop"])},{default:o(()=>[l(Q,{iconName:"app-operate-log",class:"color-secondary"}),$(" "+m(e.$t("views.tool.mcpConfig")),1)]),_:2},1032,["onClick"])):w("",!0),n.templateId&&c.value.edit(n.id)?(a(),r(K,{key:1,onClick:B(ne=>We(n,!0),["stop"])},{default:o(()=>[l(Q,{iconName:"app-edit",class:"color-secondary"}),$(" "+m(e.$t("common.edit")),1)]),_:2},1032,["onClick"])):w("",!0),!n.templateId&&c.value.edit(n.id)?(a(),r(K,{key:2,onClick:B(ne=>G(n),["stop"])},{default:o(()=>[l(Q,{iconName:"app-edit",class:"color-secondary"}),$(" "+m(e.$t("common.edit")),1)]),_:2},1032,["onClick"])):w("",!0),!n.templateId&&c.value.copy(n.id)&&n.toolType!=="MCP"?(a(),r(K,{key:3,onClick:B(ne=>ve(n),["stop"])},{default:o(()=>[l(Q,{iconName:"app-copy",class:"color-secondary"}),$(" "+m(e.$t("common.copy")),1)]),_:2},1032,["onClick"])):w("",!0),((ge=n.initFieldList)==null?void 0:ge.length)>0&&c.value.edit(n.id)?(a(),r(K,{key:4,onClick:B(ne=>_e(n),["stop"])},{default:o(()=>[l(Q,{iconName:"app-operation",class:"color-secondary"}),$(" "+m(e.$t("common.param.initParam")),1)]),_:2},1032,["onClick"])):w("",!0),_.value==="workspace"&&c.value.auth(n.id)?(a(),r(K,{key:5,onClick:B(ne=>A(n),["stop"])},{default:o(()=>[l(Q,{iconName:"app-resource-authorization",class:"color-secondary"}),$(" "+m(e.$t("views.system.resourceAuthorization.title")),1)]),_:2},1032,["onClick"])):w("",!0),V.value?(a(),r(K,{key:6,onClick:B(ne=>X(n),["stop"])},{default:o(()=>[l(Q,{iconName:"app-lock",class:"color-secondary"}),$(" "+m(e.$t("views.shared.authorized_workspace")),1)]),_:2},1032,["onClick"])):w("",!0),!n.templateId&&c.value.export(n.id)&&n.toolType!=="MCP"?(a(),r(K,{key:7,onClick:B(ne=>M(n),["stop"])},{default:o(()=>[l(Q,{iconName:"app-export",class:"color-secondary"}),$(" "+m(e.$t("common.export")),1)]),_:2},1032,["onClick"])):w("",!0),c.value.delete(n.id)?(a(),r(K,{key:8,divided:"",onClick:B(ne=>W(n),["stop"])},{default:o(()=>[l(Q,{iconName:"app-delete",class:"color-secondary"}),$(" "+m(e.$t("common.delete")),1)]),_:2},1032,["onClick"])):w("",!0)]}),_:2},1024)]),default:o(()=>[l(ye,{text:"",onClick:t[7]||(t[7]=B(()=>{},["stop"]))},{default:o(()=>[l(Q,{iconName:"app-more"})]),_:1})]),_:2},1024)])):w("",!0)]),_:2},1032,["title","description","onClick","disabled"])]),_:2},1024))),128))]),_:1})):(a(),r(ao,{key:1,description:e.$t("common.noData")},null,8,["description"]))]),_:1},8,["size","total","page_size","current_page","loading"])])),[[so,R.current_page===1&&L.value,void 0,{fullscreen:!0,lock:!0}]])]),_:3}),l($o,{ref_key:"InitParamDrawerRef",ref:F,onRefresh:ue},null,512),l(Co,{ref_key:"ToolFormDrawerRef",ref:h,onRefresh:ue,title:q.value},null,8,["title"]),l(Mo,{ref_key:"McpToolFormDrawerRef",ref:I,onRefresh:ue,title:ie.value},null,8,["title"]),g.value?w("",!0):(a(),r(ho,{key:0,ref_key:"CreateFolderDialogRef",ref:Qe,onRefresh:Ze},null,512)),l(ol,{ref_key:"toolStoreDialogRef",ref:he,"api-type":_.value,onRefresh:ue},null,8,["api-type"]),l(Oe,{ref_key:"AddInternalToolDialogRef",ref:Y,onRefresh:je},null,512),l(tl,{ref_key:"McpToolConfigDialogRef",ref:Le,onRefresh:ue},null,512),V.value?(a(),r(Do,{key:1,ref_key:"AuthorizedWorkspaceDialogRef",ref:J},null,512)):w("",!0),_.value==="workspace"?(a(),r(Ao,{key:2,ref_key:"MoveToDialogRef",ref:k,source:j(Fe).TOOL,onRefresh:u},null,8,["source"])):w("",!0),_.value==="workspace"?(a(),r(So,{key:3,type:j(Fe).TOOL,ref_key:"ResourceAuthorizationDrawerRef",ref:D},null,8,["type"])):w("",!0)],64)}}});export{Cl as _};
