import{aX as Se,du as ke,aY as ae,ay as _e,aA as ve,aZ as ge,a_ as D,aB as c,bI as Y,bH as T,bJ as $,bX as W,aP as fe,b7 as he,aD as l,aR as G,aF as n,aI as u,aH as s,aJ as f,aE as v,b1 as F,b6 as E,b4 as te,aG as o,aK as U,aS as re,aT as ce,d4 as Ce,bZ as Ae,b_ as Te,dv as $e,dw as De,co as be,aC as w,aQ as We,a$ as Le,b5 as ee,b0 as Me,b3 as Ne}from"./admin-BOU8h_tu.js";import{g as Ue}from"./constant-KsRKGOWa.js";import{l as Ve}from"./permission-api-CXg_tVy4.js";import"./system-CkhRQyt6.js";import"./workspace-DF77vO75.js";const X="/workspace",xe=(h,d,g,b,C,i)=>ae(`${X}/${h}/user_resource_permission/user/${d}/resource/${g}/${b.current_page}/${b.page_size}`,C,i),ze=(h,d,g,b,C)=>Se(`${X}/${h}/user_resource_permission/user/${d}/resource/${g}`,b,{},C),Ke=(h,d)=>ae(`${X}/${h}/user_list`,void 0,d),we=(h,d)=>ae(`${X}/${h}/user_member`,void 0,d),Ge=(h,d,g,b)=>d=="MODEL"?Promise.resolve(ke.success([{id:"default",name:"根目录",desc:null,parent_id:null,children:[]}])):ae(`${X}/${h}/${d}/folder`,g,b),ue={getResourceAuthorization:xe,putResourceAuthorization:ze,getUserList:Ke,getUserMember:we,getSystemFolder:Ge},Fe={class:"permission-setting p-24 flex"},He={class:"resource-authorization__table"},Be={class:"mb-16"},je={class:"flex-between mb-16"},Je={class:"flex-between complex-search"},Xe=["src"],Ze=["innerHTML"],qe=["title"],Qe={class:"color-text-primary lighter"},Ye={class:"dialog-footer mt-24"},et=_e({__name:"PermissionTable",props:{data:{},type:{},getData:{type:Function}},emits:["submitPermissions"],setup(h,{expose:d,emit:g}){const{model:b}=ve(),C=ge(),i=h,L=g,R=D(()=>Ue()),Z=c({APPLICATION:new Y([T.ADMIN,T.WORKSPACE_MANAGE],[$.APPLICATION_WORKSPACE_USER_RESOURCE_PERMISSION_EDIT,$.APPLICATION_WORKSPACE_USER_RESOURCE_PERMISSION_EDIT.getWorkspacePermissionWorkspaceManageRole],[],"OR"),KNOWLEDGE:new Y([T.ADMIN,T.WORKSPACE_MANAGE],[$.KNOWLEDGE_WORKSPACE_USER_RESOURCE_PERMISSION_EDIT,$.KNOWLEDGE_WORKSPACE_USER_RESOURCE_PERMISSION_EDIT.getWorkspacePermissionWorkspaceManageRole],[],"OR"),TOOL:new Y([T.ADMIN,T.WORKSPACE_MANAGE],[$.TOOL_WORKSPACE_USER_RESOURCE_PERMISSION_EDIT,$.TOOL_WORKSPACE_USER_RESOURCE_PERMISSION_EDIT.getWorkspacePermissionWorkspaceManageRole],[],"OR"),MODEL:new Y([T.ADMIN,T.WORKSPACE_MANAGE],[$.MODEL_WORKSPACE_USER_RESOURCE_PERMISSION_EDIT,$.MODEL_WORKSPACE_USER_RESOURCE_PERMISSION_EDIT.getWorkspacePermissionWorkspaceManageRole],[],"OR")}),H=D(()=>i.type===W.KNOWLEDGE),B=D(()=>i.type===W.APPLICATION),oe=D(()=>i.type===W.TOOL),V=D(()=>i.type===W.MODEL),q=c(),_=c("name"),y=c({name:"",permission:void 0}),se=()=>{y.value={name:"",permission:void 0}},M=fe({current_page:1,page_size:20,total:0});function j(){M.current_page=1,i.getData&&i.getData()}function P(){M.current_page=1,i.getData&&i.getData()}const A=c([]),le=a=>{A.value=a},x=c(!1),t=c("");function p(){A.value.length!==0&&(x.value=!0)}function m(){if(A.value.length===0||!t.value)return;const a=A.value.map(r=>({targetId:r.id,permission:t.value}));L("submitPermissions",a),I()}function I(){var a;x.value=!1,t.value="",A.value=[],(a=q.value)==null||a.clearSelection()}function z(a,r){const S=[{targetId:r.id,permission:a}];L("submitPermissions",S)}const N=c([]);function K(){b.asyncGetProvider().then(a=>{N.value=a==null?void 0:a.data})}const ne=D(()=>a=>{var r;return(r=N.value.find(S=>S.provider===a.icon))==null?void 0:r.icon});return he(()=>{V.value&&K()}),d({paginationConfig:M,searchForm:y,searchType:_}),(a,r)=>{var me;const S=l("el-button"),J=l("el-option"),k=l("el-select"),Q=l("el-input"),ie=l("el-table-column"),Ee=l("KnowledgeIcon"),ye=l("el-avatar"),Ie=l("el-space"),de=l("el-radio"),pe=l("el-radio-group"),Oe=l("el-text"),Re=l("el-dialog");return n(),G("div",Fe,[u("div",He,[u("h4",Be,f(a.$t("views.system.resourceAuthorization.permissionSetting")),1),u("div",je,[E(te)(Z.value[((me=E(C).meta)==null?void 0:me.resource)||"APPLICATION"],"OR")?(n(),v(S,{key:0,type:"primary",disabled:A.value.length===0,onClick:p},{default:o(()=>[U(f(a.$t("views.system.resourceAuthorization.setting.configure")),1)]),_:1},8,["disabled"])):F("",!0),u("div",Je,[s(k,{class:"complex-search__left",modelValue:_.value,"onUpdate:modelValue":r[0]||(r[0]=e=>_.value=e),style:{width:"80px"},onChange:se},{default:o(()=>[s(J,{label:a.$t("common.name"),value:"name"},null,8,["label"]),s(J,{label:a.$t("views.model.modelForm.permissionType.label"),value:"permission"},null,8,["label"])]),_:1},8,["modelValue"]),_.value==="name"?(n(),v(Q,{key:0,modelValue:y.value.name,"onUpdate:modelValue":r[1]||(r[1]=e=>y.value.name=e),onChange:P,placeholder:a.$t("common.searchBar.placeholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):_.value==="permission"?(n(),v(k,{key:1,modelValue:y.value.permission,"onUpdate:modelValue":r[2]||(r[2]=e=>y.value.permission=e),onChange:P,filterable:"",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"",style:{width:"220px"}},{default:o(()=>[(n(!0),G(re,null,ce(R.value,(e,O)=>(n(),v(J,{key:O,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):F("",!0)])]),s(Ce,{ref_key:"multipleTableRef",ref:q,class:"mt-16",data:i.data,"pagination-config":M,onSizeChange:j,onChangePage:i.getData,onSelectionChange:le,maxTableHeight:320,"row-key":e=>e.id},{default:o(()=>[s(ie,{type:"selection",width:"55","reserve-selection":!0}),s(ie,{prop:"name",label:a.$t("common.name")},{default:o(({row:e})=>[s(Ie,{size:8},{default:o(()=>[H.value?(n(),v(Ee,{key:0,size:20,type:e.icon},null,8,["type"])):E(Ae)(e==null?void 0:e.icon)&&!V.value?(n(),v(ye,{key:1,style:{background:"none"},shape:"square",size:20},{default:o(()=>[u("img",{src:E(Te)(e==null?void 0:e.icon),alt:""},null,8,Xe)]),_:2},1024)):B.value?(n(),v($e,{key:2,height:"20px"})):oe.value?(n(),v(De,{key:3,size:20,type:e==null?void 0:e.toolType},null,8,["type"])):V.value?(n(),G("span",{key:4,style:{width:"20px",height:"20px",display:"inline-block"},innerHTML:ne.value(e)},null,8,Ze)):F("",!0),u("span",{title:e==null?void 0:e.name,class:"ellipsis-1"},f(e==null?void 0:e.name),9,qe)]),_:2},1024)]),_:1},8,["label"]),s(ie,{label:a.$t("common.operation"),align:"left"},{default:o(({row:e})=>[s(pe,{modelValue:e.permission,"onUpdate:modelValue":O=>e.permission=O,onChange:O=>z(O,e)},{default:o(()=>[(n(!0),G(re,null,ce(R.value,(O,Pe)=>(n(),v(de,{key:Pe,value:O.value,class:"mr-16"},{default:o(()=>[U(f(O.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["label"])]),_:1},8,["data","pagination-config","onChangePage","row-key"])]),s(Re,{modelValue:x.value,"onUpdate:modelValue":r[4]||(r[4]=e=>x.value=e),title:a.$t("views.system.resourceAuthorization.setting.configure"),"destroy-on-close":"",onClose:I},{footer:o(()=>[u("div",Ye,[s(S,{onClick:I},{default:o(()=>[U(f(a.$t("common.cancel")),1)]),_:1}),s(S,{type:"primary",onClick:m},{default:o(()=>[U(f(a.$t("common.confirm")),1)]),_:1})])]),default:o(()=>[s(pe,{modelValue:t.value,"onUpdate:modelValue":r[3]||(r[3]=e=>t.value=e),class:"radio-block"},{default:o(()=>[(n(!0),G(re,null,ce(R.value,(e,O)=>(n(),v(de,{key:O,value:e.value,class:"mr-16"},{default:o(()=>[u("p",Qe,f(e.label),1),s(Oe,{class:"color-secondary lighter"},{default:o(()=>[U(f(e.desc),1)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"])])}}}),tt=be(et,[["__scopeId","data-v-3ee70972"]]),at={class:"resource-authorization p-16-24"},ot={class:"flex align-center mb-16"},st={class:"ml-4 color-text-primary"},lt={class:"flex"},nt={class:"resource-authorization__left border-r"},it={class:"p-24 pb-0"},rt={class:"mb-12"},ct={class:"list-height-left"},ut={class:"p-8-16"},dt={class:"flex-between"},pt={class:"flex"},mt=["title"],_t=_e({__name:"index",setup(h){const d=ge(),{user:g}=ve(),b=c(!1),C=c(!1),i=c([]),L=c([]),R=c(""),Z=c(""),H=c(""),B=c([]),oe=fe([{label:w("views.knowledge.title"),type:W.KNOWLEDGE},{label:w("views.application.title"),type:W.APPLICATION},{label:w("views.tool.title"),type:W.TOOL},{label:w("views.model.title"),type:W.MODEL}]),V=D(()=>{const t=d.path.lastIndexOf("/"),p=d.path.substring(t+1).toUpperCase();return oe.filter(m=>m.type===p)[0]});We(H,t=>{t?L.value=i.value.filter(p=>p.nickname.toLowerCase().includes(t.toLowerCase())):L.value=i.value});function q(t){var m;const p=P.value||g.getWorkspaceId()||"default";ue.putResourceAuthorization(p,R.value,((m=d.meta)==null?void 0:m.resource)||"APPLICATION",t,C).then(()=>{Ne(w("common.submitSuccess")),y()})}const _=c(),y=()=>{var m;const t=P.value||g.getWorkspaceId()||"default",p={};_.value.searchForm[_.value.searchType]&&(p[_.value.searchType]=_.value.searchForm[_.value.searchType]),ue.getResourceAuthorization(t,R.value,((m=d.meta)==null?void 0:m.resource)||"APPLICATION",_.value.paginationConfig,p,C).then(I=>{B.value=I.data.records||[],_.value.paginationConfig.total=I.data.total||0})};function se(t){R.value=t.id,Z.value=t.type,y()}function M(t){const p=P.value||g.getWorkspaceId()||"default";ue.getUserMember(p,b).then(m=>{var I,z,N,K;i.value=m.data,L.value=m.data,i.value.length>0?(R.value=(z=(I=i.value)==null?void 0:I[0])==null?void 0:z.id,Z.value=(K=(N=i.value)==null?void 0:N[0])==null?void 0:K.type,y()):B.value=[]})}const j=c([]),P=c(""),A=D(()=>j.value.find(t=>t.id==P.value));async function le(){const t=await Ve("workspace").getSystemWorkspaceList(b);j.value=t.data,P.value=g.getWorkspaceId()||"default"}function x(t){P.value=t.id,M()}return he(()=>{g.isEE()&&le(),M()}),(t,p)=>{const m=l("el-breadcrumb-item"),I=l("el-breadcrumb"),z=l("el-divider"),N=l("WorkspaceDropdown"),K=l("el-input"),ne=l("el-text"),a=l("common-list"),r=l("el-scrollbar"),S=l("el-card"),J=Le("loading");return n(),G("div",at,[u("div",ot,[s(I,{"separator-icon":"ArrowRight"},{default:o(()=>[s(m,null,{default:o(()=>[U(f(E(w)("views.system.resourceAuthorization.title")),1)]),_:1}),s(m,null,{default:o(()=>[u("h5",st,f(V.value.label),1)]),_:1})]),_:1}),E(te)(E(ee).IS_EE,"OR")?(n(),v(z,{key:0,class:"ml-24",direction:"vertical"})):F("",!0),E(te)(E(ee).IS_EE,"OR")?(n(),v(N,{key:1,data:j.value,currentWorkspace:A.value,onChangeWorkspace:x},null,8,["data","currentWorkspace"])):F("",!0)]),s(S,{style:{"--el-card-padding":"0",height:"calc(100vh - 140px)"}},{default:o(()=>[u("div",lt,[u("div",nt,[u("div",it,[u("h4",rt,f(t.$t("views.system.resourceAuthorization.member")),1),s(K,{modelValue:H.value,"onUpdate:modelValue":p[0]||(p[0]=k=>H.value=k),placeholder:t.$t("common.search"),"prefix-icon":"Search",clearable:""},null,8,["modelValue","placeholder"])]),u("div",ct,[s(r,null,{default:o(()=>[u("div",ut,[Me((n(),v(a,{data:L.value,onClick:se,"default-active":R.value},{default:o(({row:k})=>[u("div",dt,[u("div",pt,[u("span",{class:"mr-8 ellipsis-1",title:k.nickname},f(k.nickname),9,mt),E(te)([E(ee).IS_EE,E(ee).IS_PE],"OR")?(n(),v(ne,{key:0,class:"color-input-placeholder ellipsis-1",title:k.roles.join("，")},{default:o(()=>{var Q;return[U("("+f((Q=k.roles)==null?void 0:Q.join("，"))+")",1)]}),_:2},1032,["title"])):F("",!0)])])]),_:1},8,["data","default-active"])),[[J,b.value]])])]),_:1})])]),s(tt,{data:B.value,type:V.value.type,ref_key:"PermissionTableRef",ref:_,getData:y,onSubmitPermissions:q},null,8,["data","type"])])]),_:1})])}}}),Et=be(_t,[["__scopeId","data-v-957fbede"]]);export{Et as default};
