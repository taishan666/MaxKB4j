import{f6 as K,f7 as pr,ay as B,aB as O,b9 as vr,aD as h,b4 as Le,b8 as Be,aE as P,aF as $,bf as mr,aG as p,da as gr,aP as Ue,aQ as L,aR as ve,aI as x,aH as f,aU as _r,aJ as I,aK as V,a_ as He,aX as hr,b3 as br,c6 as yr,co as Sr,aW as Er}from"./admin-BcWypnGv.js";import{r as Me,a as We,b as ze,c as Ke,d as Cr,e as de,f as U,g as Ge,h as fe,i as Xe,j as Je,k as Qe,l as Ir,m as Ze,n as qr,o as H,p as Ye,q as wr,s as Tr,t as Rr,u as xr,v as Ar,w as er,x as kr,y as rr,z as Or,A as Fr,B as Pr,C as $r,D as Dr,E as Nr,F as Vr}from"./array-method-is-strict-V8OB7vxf.js";import{_ as jr}from"./Result.vue_vue_type_script_setup_true_lang-Da8XZxjF.js";var me={},G,ge;function Lr(){if(ge)return G;ge=1;var o=TypeError,t=9007199254740991;return G=function(e){if(e>t)throw o("Maximum allowed index exceeded");return e},G}var X,_e;function Br(){if(_e)return X;_e=1;var o=Me(),t=We(),e=ze();return X=function(r,i,u){o?t.f(r,i,e(0,u)):r[i]=u},X}var J,he;function Ur(){if(he)return J;he=1;var o=Ke(),t=Cr(),e=U(),r=de(),i=r("species"),u=Array;return J=function(a){var n;return o(a)&&(n=a.constructor,t(n)&&(n===u||o(n.prototype))?n=void 0:e(n)&&(n=n[i],n===null&&(n=void 0))),n===void 0?u:n},J}var Q,be;function tr(){if(be)return Q;be=1;var o=Ur();return Q=function(t,e){return new(o(t))(e===0?0:e)},Q}var Z,ye;function Hr(){if(ye)return Z;ye=1;var o=fe(),t=de(),e=Ge(),r=t("species");return Z=function(i){return e>=51||!o(function(){var u=[],a=u.constructor={};return a[r]=function(){return{foo:1}},u[i](Boolean).foo!==1})},Z}var Se;function Mr(){if(Se)return me;Se=1;var o=Xe(),t=fe(),e=Ke(),r=U(),i=Je(),u=Qe(),a=Lr(),n=Br(),g=tr(),c=Hr(),s=de(),m=Ge(),F=s("isConcatSpreadable"),b=m>=51||!t(function(){var E=[];return E[F]=!1,E.concat()[0]!==E}),T=function(E){if(!r(E))return!1;var A=E[F];return A!==void 0?!!A:e(E)},D=!b||!c("concat");return o({target:"Array",proto:!0,arity:1,forced:D},{concat:function(A){var R=i(this),k=g(R,0),w=0,y,C,N,d,S;for(y=-1,N=arguments.length;y<N;y++)if(S=y===-1?R:arguments[y],T(S))for(d=u(S),a(w+d),C=0;C<d;C++,w++)C in S&&n(k,w,S[C]);else a(w+1),n(k,w++,S);return k.length=w,k}}),me}Mr();var Ee={},Y,Ce;function Wr(){if(Ce)return Y;Ce=1;var o=We().f;return Y=function(t,e,r){r in t||o(t,r,{configurable:!0,get:function(){return e[r]},set:function(i){e[r]=i}})},Y}var ee,Ie;function zr(){if(Ie)return ee;Ie=1;var o=Ir(),t=U(),e=Ze();return ee=function(r,i,u){var a,n;return e&&o(a=i.constructor)&&a!==u&&t(n=a.prototype)&&n!==u.prototype&&e(r,n),r},ee}var re,qe;function Kr(){if(qe)return re;qe=1;var o=qr();return re=function(t,e){return t===void 0?arguments.length<2?"":e:o(t)},re}var te,we;function Gr(){if(we)return te;we=1;var o=U(),t=H();return te=function(e,r){o(r)&&"cause"in r&&t(e,"cause",r.cause)},te}var ae,Te;function Xr(){if(Te)return ae;Te=1;var o=Ye(),t=Error,e=o("".replace),r=function(a){return String(new t(a).stack)}("zxcasd"),i=/\n\s*at [^:]*:[^\n]*/,u=i.test(r);return ae=function(a,n){if(u&&typeof a=="string"&&!t.prepareStackTrace)for(;n--;)a=e(a,i,"");return a},ae}var ne,Re;function Jr(){if(Re)return ne;Re=1;var o=fe(),t=ze();return ne=!o(function(){var e=new Error("a");return"stack"in e?(Object.defineProperty(e,"stack",t(1,7)),e.stack!==7):!0}),ne}var oe,xe;function Qr(){if(xe)return oe;xe=1;var o=H(),t=Xr(),e=Jr(),r=Error.captureStackTrace;return oe=function(i,u,a,n){e&&(r?r(i,u):o(i,"stack",t(a,n)))},oe}var le,Ae;function Zr(){if(Ae)return le;Ae=1;var o=wr(),t=Tr(),e=H(),r=Rr(),i=Ze(),u=xr(),a=Wr(),n=zr(),g=Kr(),c=Gr(),s=Qr(),m=Me(),F=Ar();return le=function(b,T,D,E){var A="stackTraceLimit",R=E?2:1,k=b.split("."),w=k[k.length-1],y=o.apply(null,k);if(y){var C=y.prototype;if(!F&&t(C,"cause")&&delete C.cause,!D)return y;var N=o("Error"),d=T(function(S,l){var v=g(E?l:S,void 0),q=E?new y(S):new y;return v!==void 0&&e(q,"message",v),s(q,d,q.stack,2),this&&r(C,this)&&n(q,this,d),arguments.length>R&&c(q,arguments[R]),q});if(d.prototype=C,w!=="Error"?i?i(d,N):u(d,N,{name:!0}):m&&A in y&&(a(d,y,A),a(d,y,"prepareStackTrace")),u(d,y),!F)try{C.name!==w&&e(C,"name",w),C.constructor=d}catch{}return d}},le}var ke;function Yr(){if(ke)return Ee;ke=1;var o=Xe(),t=er(),e=kr(),r=Zr(),i="WebAssembly",u=t[i],a=new Error("e",{cause:7}).cause!==7,n=function(c,s){var m={};m[c]=r(c,s,a),o({global:!0,constructor:!0,arity:1,forced:a},m)},g=function(c,s){if(u&&u[c]){var m={};m[c]=r(i+"."+c,s,a),o({target:i,stat:!0,constructor:!0,arity:1,forced:a},m)}};return n("Error",function(c){return function(m){return e(c,this,arguments)}}),n("EvalError",function(c){return function(m){return e(c,this,arguments)}}),n("RangeError",function(c){return function(m){return e(c,this,arguments)}}),n("ReferenceError",function(c){return function(m){return e(c,this,arguments)}}),n("SyntaxError",function(c){return function(m){return e(c,this,arguments)}}),n("TypeError",function(c){return function(m){return e(c,this,arguments)}}),n("URIError",function(c){return function(m){return e(c,this,arguments)}}),g("CompileError",function(c){return function(m){return e(c,this,arguments)}}),g("LinkError",function(c){return function(m){return e(c,this,arguments)}}),g("RuntimeError",function(c){return function(m){return e(c,this,arguments)}}),Ee}Yr();var Oe={},se,Fe;function et(){if(Fe)return se;Fe=1;var o=rr(),t=Or();return se=o?{}.toString:function(){return"[object "+t(this)+"]"},se}var Pe;function rt(){if(Pe)return Oe;Pe=1;var o=rr(),t=Fr(),e=et();return o||t(Object.prototype,"toString",e,{unsafe:!0}),Oe}rt();var $e={},ie,De;function tt(){if(De)return ie;De=1;var o=Pr(),t=Ye(),e=$r(),r=Je(),i=Qe(),u=tr(),a=t([].push),n=function(g){var c=g===1,s=g===2,m=g===3,F=g===4,b=g===6,T=g===7,D=g===5||b;return function(E,A,R,k){for(var w=r(E),y=e(w),C=i(y),N=o(A,R),d=0,S=k||u,l=c?S(E,C):s||T?S(E,0):void 0,v,q;C>d;d++)if((D||d in y)&&(v=y[d],q=N(v,d,w),g))if(c)l[d]=q;else if(q)switch(g){case 3:return!0;case 5:return v;case 6:return d;case 2:a(l,v)}else switch(g){case 4:return!1;case 7:a(l,v)}return b?-1:m||F?F:l}};return ie={forEach:n(0),map:n(1),filter:n(2),some:n(3),every:n(4),find:n(5),findIndex:n(6),filterReject:n(7)},ie}var ue,Ne;function at(){if(Ne)return ue;Ne=1;var o=tt().forEach,t=Dr(),e=t("forEach");return ue=e?[].forEach:function(i){return o(this,i,arguments.length>1?arguments[1]:void 0)},ue}var Ve;function nt(){if(Ve)return $e;Ve=1;var o=er(),t=Vr(),e=Nr(),r=at(),i=H(),u=function(n){if(n&&n.forEach!==r)try{i(n,"forEach",r)}catch{n.forEach=r}};for(var a in t)t[a]&&u(o[a]&&o[a].prototype);return u(e),$e}nt();/*!
 * el-table-infinite-scroll v3.0.8
 * (c) 2019-2025 yujinpan
 */function ot(o,t,e){var r;e.forEach(function(i){r=o.getAttribute(i),r!==null?t.setAttribute(i,r):t.removeAttribute(i)})}/*!
 * el-table-infinite-scroll v3.0.8
 * (c) 2019-2025 yujinpan
 */var ar="[el-table-infinite-scroll]: ",lt={mounted:function(t,e,r,i){var u=ce(t),a=u.scrollElem;a.style.overflowY="auto",setTimeout(function(){t.style.height||(a.style.height="400px",console.warn("".concat(ar,"el-table height required, otherwise will set scrollbar default height: 400px"))),je(t,a),K.mounted(a,e,r,i)},0)},updated:function(t){var e=ce(t),r=e.scrollElem;je(t,r)},unmounted:function(t){for(var e=ce(t),r=e.scrollElem,i=arguments.length,u=new Array(i>1?i-1:0),a=1;a<i;a++)u[a-1]=arguments[a];K.unmounted.apply(K,[r].concat(u))}};function ce(o){var t,e=pr(),r=".".concat(((t=e.value)===null||t===void 0?void 0:t.namespace)||"el","-scrollbar__wrap"),i=o.querySelector(r);if(!i)throw new Error("".concat(ar).concat(r," element not found."));return{scrollElem:i}}function je(o,t){ot(o,t,["infinite-scroll-disabled","infinite-scroll-delay","infinite-scroll-immediate","infinite-scroll-distance"]);var e="infinite-scroll-distance",r=+(o.getAttribute(e)||0);t.setAttribute(e,(r<1?1:r)+"")}/*!
 * el-table-infinite-scroll v3.0.8
 * (c) 2019-2025 yujinpan
 */var nr=Object.assign(lt,{install:function(t){t.directive("el-table-infinite-scroll",nr)}});const st=B({name:"AppTableInfiniteScroll"}),it=B({...st,props:{paginationConfig:{type:Object,required:!0,default:()=>({current_page:1,page_size:50,total:0})},maxTableHeight:{type:Number,default:300}},emits:["changePage"],setup(o,{expose:t,emit:e}){const r=o,i=e,u=O(),a=O(""),n=O(!1),g=()=>{n.value||(r.paginationConfig.current_page*r.paginationConfig.page_size<=r.paginationConfig.total&&i("changePage"),r.paginationConfig.current_page*r.paginationConfig.page_size===r.paginationConfig.total&&(n.value=!0))};return t({}),vr(()=>{a.value=window.innerHeight-r.maxTableHeight,window.onresize=()=>(()=>{a.value=window.innerHeight-r.maxTableHeight})()}),(c,s)=>{const m=h("el-table");return Le(($(),P(m,mr({"max-height":a.value},c.$attrs,{ref_key:"appTableRef",ref:u,height:a.value+"px","infinite-scroll-disabled":n.value}),{default:p(()=>[gr(c.$slots,"default")]),_:3},16,["max-height","height","infinite-scroll-disabled"])),[[Be(nr),g]])}}}),ut={class:"flex align-center",style:{"margin-left":"-8px"}},ct={class:"title-decoration-1 mb-16 mt-4"},dt={class:"color-secondary mb-4"},ft={class:"color-secondary mb-4"},pt={class:"color-secondary mb-4"},vt={class:"color-secondary mb-4"},mt=B({__name:"ExecutionDetailDrawer",props:{currentId:{},currentContent:{},next:{},pre:{},pre_disable:{type:Boolean},next_disable:{type:Boolean}},emits:["update:currentId","update:currentContent"],setup(o,{expose:t,emit:e}){const r=o,i=e,u=Ue();L(()=>u.path.includes("shared")?"systemShare":u.path.includes("resource-management")?"systemManage":"workspace");const a=O(!1),n=O(!1);function g(){}return ve(()=>r.currentId,()=>{}),ve(n,s=>{s||(i("update:currentId",""),i("update:currentContent",null))}),t({open:()=>{n.value=!0}}),(s,m)=>{const F=h("Back"),b=h("el-icon"),T=h("el-button"),D=h("el-col"),E=h("SuccessFilled"),A=h("el-text"),R=h("CircleCloseFilled"),k=h("Loading"),w=h("el-row"),y=h("el-card"),C=h("el-scrollbar"),N=h("el-drawer");return $(),P(N,{modelValue:n.value,"onUpdate:modelValue":m[1]||(m[1]=d=>n.value=d),size:"800px",modal:!1,"destroy-on-close":"","before-close":g,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},{header:p(()=>[x("div",ut,[f(T,{class:"cursor mr-4",link:"",onClick:m[0]||(m[0]=He(d=>n.value=!1,["prevent"]))},{default:p(()=>[f(b,{size:20},{default:p(()=>[f(F)]),_:1})]),_:1}),x("h4",null,I(s.$t("chat.executionDetails.title")),1)])]),footer:p(()=>[x("div",null,[f(T,{onClick:s.pre,disabled:s.pre_disable||a.value},{default:p(()=>[V(I(s.$t("common.pages.prev")),1)]),_:1},8,["onClick","disabled"]),f(T,{onClick:s.next,disabled:s.next_disable||a.value},{default:p(()=>[V(I(s.$t("common.pages.next")),1)]),_:1},8,["onClick","disabled"])])]),default:p(()=>[x("div",null,[f(C,null,{default:p(()=>[x("h4",ct,I(s.$t("workflow.ExecutionRecord")),1),f(y,{class:"mb-24",shadow:"never",style:{"--el-card-padding":"12px 16px"}},{default:p(()=>[f(w,{gutter:16,class:"lighter"},{default:p(()=>[f(D,{span:6},{default:p(()=>{var d;return[x("p",dt,I(s.$t("workflow.initiator")),1),x("p",null,I(((d=r.currentContent)==null?void 0:d.meta.username)||"-"),1)]}),_:1}),f(D,{span:6},{default:p(()=>{var d,S;return[x("p",ft,I(s.$t("common.status.label")),1),x("p",null,[((d=r.currentContent)==null?void 0:d.state)==="SUCCESS"?($(),P(A,{key:0,class:"color-text-primary"},{default:p(()=>[f(b,{class:"color-success"},{default:p(()=>[f(E)]),_:1}),V(" "+I(s.$t("common.status.success")),1)]),_:1})):((S=r.currentContent)==null?void 0:S.state)==="FAILURE"?($(),P(A,{key:1,class:"color-text-primary"},{default:p(()=>[f(b,{class:"color-danger"},{default:p(()=>[f(R)]),_:1}),V(" "+I(s.$t("common.status.fail")),1)]),_:1})):($(),P(A,{key:2,class:"color-text-primary"},{default:p(()=>[f(b,{class:"is-loading color-primary"},{default:p(()=>[f(k)]),_:1}),V(" "+I(s.$t("common.status.padding")),1)]),_:1}))])]}),_:1}),f(D,{span:6},{default:p(()=>{var d,S,l;return[x("p",pt,I(s.$t("chat.KnowledgeSource.consumeTime")),1),x("p",null,I(((d=r.currentContent)==null?void 0:d.runTime)!=null?((l=(S=r.currentContent)==null?void 0:S.runTime)==null?void 0:l.toFixed(2))+"s":"-"),1)]}),_:1}),f(D,{span:6},{default:p(()=>{var d;return[x("p",vt,I(s.$t("chat.executionDetails.createTime")),1),x("p",null,I((d=r.currentContent)==null?void 0:d.createTime),1)]}),_:1})]),_:1})]),_:1}),r.currentContent?($(),P(jr,{key:0,knowledgeId:r.currentContent.knowledgeId,id:s.currentId,"is-record":""},null,8,["knowledgeId","id"])):_r("",!0)]),_:1})])]),_:1},8,["modelValue"])}}}),gt={class:"flex mb-16"},_t={class:"flex-between complex-search"},St=B({__name:"ExecutionRecordDrawer",setup(o,{expose:t}){const e=O(!1),r=Ue(),i=L(()=>r.path.includes("shared")?"systemShare":r.path.includes("resource-management")?"systemManage":"workspace"),u=hr({current_page:1,page_size:50,total:0}),a=O({username:"",state:""}),n=O(!1),g=O("username"),c=O(""),s=O([]),m=L(()=>s.value.map((l,v)=>({[l.id]:v})).reduce((l,v)=>({...l,...v}),{})),F=O(),b=O(""),T=O(""),D=l=>{var v;T.value=l,b.value=l.id,(v=F.value)==null||v.open()},E=()=>{a.value={username:"",status:""}},A=()=>{u.current_page+=1,R()},R=l=>(l&&(u.current_page=1,s.value=[]),Er({type:"knowledge",systemType:i.value}).getWorkflowActionPage(c.value,u,a.value,n).then(v=>{var q;u.total=(q=v.data)==null?void 0:q.total,s.value=s.value.concat(v.data.records)})),k=L(()=>m.value[b.value]-1<0),w=L(()=>{const l=m.value[b.value]+1;return l>=s.value.length&&l>=u.total-1}),y=({row:l})=>b.value===(l==null?void 0:l.id)?"highlight":"",C=()=>{const l=m.value[b.value]+1;if(l>=s.value.length){if(l>=u.total-1)return;u.current_page=u.current_page+1,R().then(()=>{b.value=s.value[l].id,T.value=s.value[l]})}else b.value=s.value[l].id,T.value=s.value[l]},N=()=>{const l=m.value[b.value]-1;console.log("index",l),l>=0&&(b.value=s.value[l].id,T.value=s.value[l])},d=l=>{c.value=l,R(),e.value=!0},S=()=>{u.current_page=1,u.total=0,s.value=[],e.value=!1};return t({open:d,close:S}),(l,v)=>{const q=h("el-option"),pe=h("el-select"),or=h("el-input"),j=h("el-table-column"),lr=h("SuccessFilled"),M=h("el-icon"),W=h("el-text"),sr=h("CircleCloseFilled"),ir=h("Loading"),ur=h("el-button"),cr=h("el-tooltip"),dr=h("el-drawer"),fr=br("loading");return $(),P(dr,{modelValue:e.value,"onUpdate:modelValue":v[7]||(v[7]=_=>e.value=_),title:l.$t("workflow.ExecutionRecord"),direction:"rtl",size:"800px","before-close":S},{default:p(()=>[x("div",gt,[x("div",_t,[f(pe,{modelValue:g.value,"onUpdate:modelValue":v[0]||(v[0]=_=>g.value=_),class:"complex-search__left",onChange:E,style:{width:"120px"}},{default:p(()=>[f(q,{label:l.$t("workflow.initiator"),value:"username"},null,8,["label"]),f(q,{label:l.$t("common.status.label"),value:"state"},null,8,["label"])]),_:1},8,["modelValue"]),g.value==="state"?($(),P(pe,{key:0,modelValue:a.value.state,"onUpdate:modelValue":v[1]||(v[1]=_=>a.value.state=_),onChange:v[2]||(v[2]=_=>R(!0)),style:{width:"220px"},clearable:""},{default:p(()=>[f(q,{label:l.$t("common.status.success"),value:"SUCCESS"},null,8,["label"]),f(q,{label:l.$t("common.status.fail"),value:"FAILURE"},null,8,["label"]),f(q,{label:l.$t("common.status.padding"),value:"PADDING"},null,8,["label"])]),_:1},8,["modelValue"])):($(),P(or,{key:1,modelValue:a.value.username,"onUpdate:modelValue":v[3]||(v[3]=_=>a.value.username=_),onChange:v[4]||(v[4]=_=>R(!0)),placeholder:l.$t("common.search"),"prefix-icon":"Search",style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"]))])]),Le(($(),P(it,{data:s.value,class:"w-full",onChangePage:A,maxTableHeight:150,paginationConfig:u,"row-class-name":y},{default:p(()=>[f(j,{prop:"username",label:l.$t("workflow.initiator")},{default:p(({row:_})=>[V(I(_.meta.username),1)]),_:1},8,["label"]),f(j,{prop:"state",label:l.$t("common.status.label"),width:"180"},{default:p(({row:_})=>[_.state==="SUCCESS"?($(),P(W,{key:0,class:"color-text-primary"},{default:p(()=>[f(M,{class:"color-success"},{default:p(()=>[f(lr)]),_:1}),V(" "+I(l.$t("common.status.success")),1)]),_:1})):_.state==="FAILURE"?($(),P(W,{key:1,class:"color-text-primary"},{default:p(()=>[f(M,{class:"color-danger"},{default:p(()=>[f(sr)]),_:1}),V(" "+I(l.$t("common.status.fail")),1)]),_:1})):($(),P(W,{key:2,class:"color-text-primary"},{default:p(()=>[f(M,{class:"is-loading color-primary"},{default:p(()=>[f(ir)]),_:1}),V(" "+I(l.$t("common.status.padding")),1)]),_:1}))]),_:1},8,["label"]),f(j,{prop:"runTime",label:l.$t("chat.KnowledgeSource.consumeTime")},{default:p(({row:_})=>{var z;return[V(I(_.runTime!=null?((z=_.runTime)==null?void 0:z.toFixed(2))+"s":"-"),1)]}),_:1},8,["label"]),f(j,{prop:"createTime",label:l.$t("chat.executionDetails.createTime"),width:"180"},{default:p(({row:_})=>[V(I(Be(yr)(_.createTime)),1)]),_:1},8,["label"]),f(j,{label:l.$t("common.operation"),width:"80"},{default:p(({row:_})=>[f(cr,{effect:"dark",content:l.$t("chat.executionDetails.title"),placement:"top"},{default:p(()=>[f(ur,{type:"primary",text:"",onClick:He(z=>D(_),["stop"])},{default:p(()=>[f(Sr,{iconName:"app-operate-log"})]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1},8,["label"])]),_:1},8,["data","paginationConfig"])),[[fr,n.value]]),f(mt,{ref_key:"ExecutionDetailDrawerRef",ref:F,currentId:b.value,"onUpdate:currentId":v[5]||(v[5]=_=>b.value=_),currentContent:T.value,"onUpdate:currentContent":v[6]||(v[6]=_=>T.value=_),next:C,pre:N,pre_disable:k.value,next_disable:w.value},null,8,["currentId","currentContent","pre_disable","next_disable"])]),_:1},8,["modelValue","title"])}}});export{St as _};
