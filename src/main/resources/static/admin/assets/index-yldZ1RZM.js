import{cn as X,aT as S,aF as a,aI as s,ay as se,aP as de,aQ as C,b_ as re,aB as v,aC as z,b9 as ie,d7 as ve,aD as _,aE as r,cS as _e,c1 as ye,aG as o,aU as p,aH as t,a_ as A,co as I,aK as w,aJ as u,b8 as L,cc as fe,c0 as he,c8 as ge,aW as H,b5 as ke,aR as we,b3 as me,b4 as ce,b6 as $e,b7 as be,bC as ne,dX as te,dt as Se,aA as Te,dY as Ce,dj as Me,aY as W,aZ as Q,cb as De,dZ as Le,d_ as Ne,b$ as Re}from"./admin-D1QwKL-A.js";import{E as Be,_ as Ie}from"./ParamSettingDialog.vue_vue_type_script_setup_true_lang-c8YilDEk.js";import{_ as Ve}from"./AuthorizedWorkspaceDialog.vue_vue_type_script_setup_true_lang-t1Tip7rX.js";import{_ as Ee}from"./index.vue_vue_type_script_setup_true_lang-BYX52Sn9.js";import"./permission-api-DO0YHChN.js";import"./workspace-m2Aw7qWC.js";import"./constant-YCTRzvsf.js";import"./system-CkhRQyt6.js";const Ae={},ze={class:"loading-container loader"};function Ue(U,M){return a(),S("div",ze,M[0]||(M[0]=[s("div",{class:"download-loading"},[s("div"),s("div"),s("div"),s("div"),s("div"),s("div"),s("div"),s("div")],-1)]))}const Fe=X(Ae,[["render",Ue],["__scopeId","data-v-91938551"]]),Pe=["innerHTML"],Oe={class:"flex",style:{height:"22px"}},We=["title"],He={key:0},xe={key:1},je={class:"flex mb-4"},Ge={class:"ellipsis ml-16"},Ye={class:"flex"},Ze={class:"ellipsis-1 ml-16",style:{height:"20px",width:"70%"}},Je={key:0,class:"progress-mask"},Ke={class:"percentage-label flex-center"},Qe=se({__name:"ModelCard",props:{model:{},provider_list:{},updateModelById:{type:Function},isShared:{type:Boolean},isSystemShare:{type:Boolean},apiType:{}},emits:["change","update:model"],setup(U,{emit:M}){de();const i=U,N=i.apiType,f=C(()=>N==="systemShare"),h=C(()=>re.model[i.apiType]),R=e=>h.value.modify(e)||h.value.delete(e)||h.value.auth(e)||f.value,y=v();function $(e){y.value.open(e.id)}const n=v(),m=C(()=>n.value?n.value:i.model),g=C(()=>m.value.meta&&m.value.meta.message?m.value.meta.message==="pull model manifest: file does not exist"?`${m.value.modelName} ${z("views.model.tip.noModel")}`:m.value.meta.message:""),D=M,T=v();let V;const F=()=>{ge(`${z("views.model.delete.confirmTitle")}${i.model.name} ?`,z("views.model.delete.confirmMessage"),{confirmButtonText:z("common.confirm"),confirmButtonClass:"danger"}).then(()=>{H({type:"model",systemType:i.apiType}).deleteModel(i.model.id).then(()=>{D("change"),ke(z("common.deleteSuccess"))})}).catch(()=>{})},B=()=>{H({type:"model",systemType:i.apiType}).pauseDownload(i.model.id).then(()=>{n.value=void 0,D("change")})},q=()=>{var l;const e=i.provider_list.find(c=>c.provider===i.model.provider);e&&((l=T.value)==null||l.open(e,i.model))},x=C(()=>{var e;return(e=i.provider_list.find(l=>l.provider===i.model.provider))==null?void 0:e.icon}),j=()=>{V=setInterval(()=>{m.value.status==="DOWNLOAD"?H({type:"model",systemType:i.apiType}).getModelMetaById(i.model.id).then(e=>{n.value=e.data}):n.value&&(i.updateModelById(i.model.id,n.value),n.value=void 0)},6e3)},G=()=>{V&&clearInterval(V)},Y=v(),P=()=>{var e;(e=Y.value)==null||e.open(i.model)},b=v();function ee(e){b.value&&b.value.open(e,"Model")}return ie(()=>{j()}),ve(()=>{G()}),(e,l)=>{const c=_("WarningFilled"),k=_("el-icon"),Z=_("el-tooltip"),O=_("el-text"),le=_("el-tag"),J=_("el-button"),E=_("el-dropdown-item"),oe=_("el-dropdown-menu"),K=_("el-dropdown");return a(),r(_e,{title:e.model.name,shadow:"hover",class:"model-card"},ye({icon:o(()=>[s("span",{style:{height:"32px",width:"32px"},innerHTML:x.value},null,8,Pe)]),title:o(()=>[s("div",Oe,[s("span",{class:"ellipsis-1 mb-4",title:e.model.name,style:{"max-width":"80%"}},u(e.model.name),9,We),m.value.status==="ERROR"?(a(),S("span",He,[t(Z,{effect:"dark",content:g.value,placement:"top"},{default:o(()=>[t(k,{class:"color-danger ml-4",size:"18"},{default:o(()=>[t(c)]),_:1})]),_:1},8,["content"])])):p("",!0),m.value.status==="PAUSE_DOWNLOAD"?(a(),S("span",xe,[t(Z,{effect:"dark",content:`${e.$t("views.model.modelForm.base_model.label")}: ${i.model.modelName} ${e.$t("views.model.tip.downloadError")}`,placement:"top"},{default:o(()=>[t(k,{class:"color-danger ml-4",size:"18"},{default:o(()=>[t(c)]),_:1})]),_:1},8,["content"])])):p("",!0)])]),subTitle:o(()=>[t(O,{class:"color-secondary lighter",size:"small"},{default:o(()=>[w(u(e.$t("common.creator"))+": "+u(e.model.nickname),1)]),_:1})]),tag:o(()=>[e.isShared||f.value?(a(),r(le,{key:0,type:"info",class:"info-tag"},{default:o(()=>[w(u(L(z)("views.shared.title")),1)]),_:1})):p("",!0)]),default:o(()=>[s("ul",null,[s("li",je,[t(O,{type:"info",class:"color-secondary"},{default:o(()=>[w(u(e.$t("views.model.modelForm.modelType.label")),1)]),_:1}),s("span",Ge,u(e.$t(L(fe)[e.model.modelType])),1)]),s("li",Ye,[t(O,{type:"info",class:"color-secondary"},{default:o(()=>[w(u(e.$t("views.model.modelForm.base_model.label")),1)]),_:1}),s("span",Ze,u(e.model.modelName),1)])]),m.value.status==="DOWNLOAD"?(a(),S("div",Je,[t(Fe,{class:"percentage"}),s("div",Ke,[w(u(e.$t("views.model.download.downloading"))+" ",1),l[4]||(l[4]=s("span",{class:"dotting"},null,-1)),t(J,{link:"",type:"primary",class:"ml-16",onClick:A(B,["stop"])},{default:o(()=>[w(u(e.$t("views.model.download.cancelDownload")),1)]),_:1})])])):p("",!0),t(Be,{ref_key:"editModelRef",ref:T,onSubmit:l[3]||(l[3]=d=>D("change"))},null,512),t(Ie,{ref_key:"paramSettingRef",ref:Y},null,512),f.value?(a(),r(Ve,{key:1,ref_key:"AuthorizedWorkspaceDialogRef",ref:b},null,512)):p("",!0),L(N)==="workspace"?(a(),r(Ee,{key:2,type:L(he).MODEL,ref_key:"ResourceAuthorizationDrawerRef",ref:y},null,8,["type"])):p("",!0)]),_:2},[R(e.model.id)?{name:"mouseEnter",fn:o(()=>[e.isShared?p("",!0):(a(),r(K,{key:0,trigger:"click"},{dropdown:o(()=>[t(oe,null,{default:o(()=>[h.value.modify(e.model.id)?(a(),r(E,{key:0,text:"",onClick:A(q,["stop"])},{default:o(()=>[t(I,{iconName:"app-edit",class:"color-secondary"}),w(" "+u(e.$t("common.edit")),1)]),_:1})):p("",!0),f.value?(a(),r(E,{key:1,onClick:l[1]||(l[1]=A(d=>ee(e.model),["stop"]))},{default:o(()=>[t(I,{iconName:"app-lock",class:"color-secondary"}),w(" "+u(e.$t("views.shared.authorized_workspace")),1)]),_:1})):p("",!0),(m.value.modelType==="TTS"||m.value.modelType==="LLM"||m.value.modelType==="VISION"||m.value.modelType==="TTI")&&h.value.paramSetting(e.model.id)?(a(),r(E,{key:2,onClick:A(P,["stop"])},{default:o(()=>[t(I,{iconName:"app-setting",class:"color-secondary"}),w(" "+u(e.$t("views.model.modelForm.title.paramSetting")),1)]),_:1})):p("",!0),L(N)==="workspace"&&h.value.auth(e.model.id)?(a(),r(E,{key:3,onClick:l[2]||(l[2]=A(d=>$(e.model),["stop"]))},{default:o(()=>[t(I,{iconName:"app-resource-authorization",class:"color-secondary"}),w(" "+u(e.$t("views.system.resourceAuthorization.title")),1)]),_:1})):p("",!0),h.value.delete(e.model.id)?(a(),r(E,{key:4,divided:"",text:"",onClick:A(F,["stop"])},{default:o(()=>[t(I,{iconName:"app-delete",class:"color-secondary"}),w(" "+u(e.$t("common.delete")),1)]),_:1})):p("",!0)]),_:1})]),default:o(()=>[t(J,{text:"",onClick:l[0]||(l[0]=A(()=>{},["stop"]))},{default:o(()=>[t(I,{iconName:"app-more"})]),_:1})]),_:1}))]),key:"0"}:void 0]),1032,["title"])}}}),Xe=X(Qe,[["__scopeId","data-v-6e860460"]]),qe={class:"provider-list"},el={class:"p-8"},ll={class:"ml-8 lighter"},ol={class:"flex align-center"},al=["innerHTML"],tl=["title"],sl=se({__name:"Provider",props:{data:{},loading:{type:Boolean},showShared:{type:Boolean},active:{}},emits:["click"],setup(U,{emit:M}){const i=U,N=M,f=v([]);we(()=>i.data,y=>{var $;($=y.filter(n=>n.provider))==null||$.forEach(n=>{f.value.push(n)})},{immediate:!0});const h=y=>{N("click",y)},R=()=>{N("click",{provider:"share",name:z("views.shared.shared_model")})};return(y,$)=>{const n=_("el-scrollbar"),m=me("loading");return a(),S("div",qe,[t(n,null,{default:o(()=>{var g,D;return[s("div",el,[y.showShared&&L($e)(L(be).IS_EE,"OR")?(a(),S("div",{key:0,onClick:R,class:ne(["shared-button flex cursor border-b",((g=y.active)==null?void 0:g.provider)==="share"&&"active"])},[t(I,{iconName:"app-shared-active",style:{"font-size":"18px"},class:"color-primary"}),s("span",ll,u(y.$t("views.shared.shared_model")),1)],2)):p("",!0),s("div",{class:ne(["all-mode flex cursor",(D=y.active)!=null&&D.provider?"":"all-mode-active color-primary-1"]),onClick:$[0]||($[0]=T=>h(L(te)))},[t(I,{class:"mr-8 color-primary",style:{height:"20px",width:"20px"},iconName:"app-all-menu-active"}),s("span",null,u(y.$t("views.model.modelType.allModel")),1)],2),ce((a(),r(Se,{data:f.value,onClick:h,"value-key":"provider","default-active":"",ref:"commonList"},{default:o(({row:T})=>[s("div",ol,[s("span",{innerHTML:T.icon,alt:"",style:{height:"20px",width:"20px"},class:"mr-8"},null,8,al),s("span",{class:"ellipsis-1",title:T.name},u(T.name),9,tl)])]),_:1},8,["data"])),[[m,y.loading]])])]}),_:1})])}}}),nl=X(sl,[["__scopeId","data-v-a3aa88ad"]]),dl={class:"p-12-16 pb-0 mt-12"},rl={class:"flex"},il={class:"complex-search"},ml={class:"model-list-height"},cl=se({__name:"index",setup(U){const M=de(),{model:i,user:N}=Te(),f=C(()=>M.path.includes("shared")?"systemShare":M.path.includes("resource-management")?"systemManage":"workspace"),h=C(()=>re.model[f.value]),R=C(()=>f.value==="systemShare"),y=v(),$=v(!1),n=v(),m=v("name"),g=v({name:"",createUser:"",modelType:""}),D=v([]),T=v(!1),V=v([]),F=v([]),B=C(()=>n.value&&n.value.provider==="share"),q=(e,l)=>{F.value.filter(c=>c.id==e).forEach(c=>{c.status=l.status})},x=C(()=>Ce(F.value,2)),j=v(),G=v(),Y=e=>{var l;n.value=e,b(),n.value.provider===""&&((l=y.value)==null||l.clearCurrent())},P=(e,l)=>{var c,k;e&&e.provider?(c=j.value)==null||c.open(e,l):(k=G.value)==null||k.open()},b=()=>{var l,c;const e=(l=n.value)!=null&&l.provider&&((c=n.value)==null?void 0:c.provider)!=="share"?{provider:n.value.provider}:{};H({type:"model",isShared:B.value,systemType:f.value}).getModelList({...g.value,...e},T).then(k=>{F.value=k.data}),H({type:"workspace",isShared:B.value,systemType:f.value}).getAllMemberList(N.getWorkspaceId(),$).then(k=>{D.value=k.data})},ee=()=>{g.value={name:"",createUser:"",modelType:""}};return ie(()=>{i.asyncGetProvider($).then(e=>{n.value=te,V.value=[te,...e.data],b()})}),(e,l)=>{const c=_("el-option"),k=_("el-select"),Z=_("el-input"),O=_("el-button"),le=_("el-col"),J=_("el-row"),E=_("el-empty"),oe=me("loading");return a(),r(Re,{class:"model-manage"},{left:o(()=>[s("h4",dl,u(e.$t("views.model.provider")),1),t(nl,{data:V.value,onClick:Y,loading:$.value,showShared:h.value.is_share(),active:n.value},null,8,["data","loading","showShared","active"])]),default:o(()=>{var K;return[ce((a(),r(Me,{header:(K=n.value)==null?void 0:K.name,style:{padding:"0"}},{search:o(()=>[s("div",rl,[s("div",il,[t(k,{class:"complex-search__left",modelValue:m.value,"onUpdate:modelValue":l[0]||(l[0]=d=>m.value=d),style:{width:"120px"},onChange:ee},{default:o(()=>[t(c,{label:e.$t("common.creator"),value:"createUser"},null,8,["label"]),t(c,{label:e.$t("views.model.modelForm.modelType.label"),value:"modelType"},null,8,["label"]),t(c,{label:e.$t("views.model.modelForm.modelName.label"),value:"name"},null,8,["label"])]),_:1},8,["modelValue"]),m.value==="name"?(a(),r(Z,{key:0,modelValue:g.value.name,"onUpdate:modelValue":l[1]||(l[1]=d=>g.value.name=d),onChange:b,placeholder:e.$t("common.searchBar.placeholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):m.value==="createUser"?(a(),r(k,{key:1,modelValue:g.value.createUser,"onUpdate:modelValue":l[2]||(l[2]=d=>g.value.createUser=d),onChange:b,filterable:"",clearable:"",style:{width:"220px"}},{default:o(()=>[(a(!0),S(W,null,Q(D.value,d=>(a(),r(c,{key:d.id,value:d.id,label:d.nickname},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):m.value==="modelType"?(a(),r(k,{key:2,modelValue:g.value.modelType,"onUpdate:modelValue":l[3]||(l[3]=d=>g.value.modelType=d),clearable:"",onChange:b,style:{width:"220px"}},{default:o(()=>[(a(!0),S(W,null,Q(L(De),d=>(a(),r(c,{key:d.value,label:d.text,value:d.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):p("",!0)]),!B.value&&h.value.create()?(a(),r(O,{key:0,class:"ml-16",type:"primary",onClick:l[4]||(l[4]=d=>P(n.value))},{default:o(()=>[w(u(e.$t("views.model.addModel")),1)]),_:1})):p("",!0)])]),default:o(()=>[s("div",ml,[x.value.length>0?(a(),r(J,{key:0,gutter:15,class:"w-full"},{default:o(()=>[(a(!0),S(W,null,Q(x.value,(d,ae)=>(a(),S(W,{key:ae},[(a(!0),S(W,null,Q(d,(ue,pe)=>(a(),r(le,{xs:24,sm:12,md:R.value?24:12,lg:R.value?12:8,xl:R.value?12:8,class:"mb-16",key:pe},{default:o(()=>[t(Xe,{onChange:b,updateModelById:q,model:ue,provider_list:V.value,isShared:B.value,isSystemShare:R.value,apiType:f.value},null,8,["model","provider_list","isShared","isSystemShare","apiType"])]),_:2},1032,["md","lg","xl"]))),128))],64))),128))]),_:1})):(a(),r(E,{key:1,description:e.$t("common.noData")},null,8,["description"]))])]),_:1},8,["header"])),[[oe,T.value]]),B.value?p("",!0):(a(),r(Le,{key:0,ref_key:"createModelRef",ref:j,onSubmit:b,onChange:l[5]||(l[5]=d=>P(d))},null,512)),B.value?p("",!0):(a(),r(Ne,{key:1,ref_key:"selectProviderRef",ref:G,onChange:l[6]||(l[6]=(d,ae)=>P(d,ae))},null,512))]}),_:1})}}}),kl=X(cl,[["__scopeId","data-v-9ac86ef2"]]);export{kl as default};
