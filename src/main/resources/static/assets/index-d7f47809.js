import{cp as H,cq as m,d6 as I,cZ as r,di as Y,cu as i,cx as N,cF as S,cA as o,cB as _,cz as l,cE as U,cK as C,cJ as y,cN as Q,eJ as F,dm as D,d1 as W,ct as X,cU as x,cv as ee,es as le,cH as ae,dy as oe,eK as se,ej as te,dY as ne,dZ as re,c_ as E,cR as ue}from"./index-938a5085.js";const ie={class:"dialog-footer"},me=H({__name:"UserDialog",props:{title:String},emits:["refresh"],setup(L,{expose:A,emit:O}){const h=O,w=m(),s=m({username:"",email:"",password:"",phone:"",nickName:""}),v=I({username:[{required:!0,message:r("views.user.userForm.form.username.requiredMessage"),trigger:"blur"},{min:6,max:20,message:r("views.user.userForm.form.username.lengthMessage"),trigger:"blur"}],email:[{required:!0,message:r("views.user.userForm.form.email.requiredMessage"),trigger:"blur"}],password:[{required:!0,message:r("views.user.userForm.form.password.requiredMessage"),trigger:"blur"},{min:6,max:20,message:r("views.user.userForm.form.password.lengthMessage"),trigger:"blur"}]}),u=m(!1),b=m(!1),d=m(!1);Y(u,a=>{var t;a||(s.value={username:"",email:"",password:"",phone:"",nickName:""},d.value=!1,(t=w.value)==null||t.clearValidate())});const T=a=>{a&&(s.value.id=a.id,s.value.username=a.username,s.value.email=a.email,s.value.password=a.password,s.value.phone=a.phone,s.value.nickName=a.nickName,d.value=!0),u.value=!0},R=async a=>{a&&await a.validate((t,g)=>{t&&(d.value?F.putUserManage(s.value.id,s.value,b).then(p=>{h("refresh"),D(r("common.editSuccess")),u.value=!1}):F.postUserManage(s.value,b).then(p=>{h("refresh"),D(r("common.createSuccess")),u.value=!1}))})};return A({open:T}),(a,t)=>{const g=i("el-input"),p=i("el-form-item"),q=i("el-form"),c=i("el-button"),M=i("el-dialog");return N(),S(M,{title:L.title,modelValue:u.value,"onUpdate:modelValue":t[8]||(t[8]=e=>u.value=e),"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:o(()=>[_("span",ie,[l(c,{onClick:t[6]||(t[6]=U(e=>u.value=!1,["prevent"]))},{default:o(()=>[C(y(a.$t("common.cancel")),1)]),_:1}),l(c,{type:"primary",onClick:t[7]||(t[7]=e=>R(w.value)),loading:b.value},{default:o(()=>[C(y(a.$t("common.save")),1)]),_:1},8,["loading"])])]),default:o(()=>[l(q,{ref_key:"userFormRef",ref:w,model:s.value,rules:v,"label-position":"top","require-asterisk-position":"right",onSubmit:t[5]||(t[5]=U(()=>{},["prevent"])),"close-on-click-modal":!1,"close-on-press-escape":!1},{default:o(()=>[l(p,{prop:d.value?"":"username",label:a.$t("views.user.userForm.form.username.label")},{default:o(()=>[l(g,{modelValue:s.value.username,"onUpdate:modelValue":t[0]||(t[0]=e=>s.value.username=e),placeholder:a.$t("views.user.userForm.form.username.placeholder"),maxlength:"20","show-word-limit":"",disabled:d.value},null,8,["modelValue","placeholder","disabled"])]),_:1},8,["prop","label"]),l(p,{label:a.$t("views.user.userForm.form.nickName.label")},{default:o(()=>[l(g,{modelValue:s.value.nickName,"onUpdate:modelValue":t[1]||(t[1]=e=>s.value.nickName=e),placeholder:a.$t("views.user.userForm.form.nickName.placeholder"),maxlength:"64","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(p,{label:a.$t("views.user.userForm.form.email.label"),prop:"email"},{default:o(()=>[l(g,{type:"email",modelValue:s.value.email,"onUpdate:modelValue":t[2]||(t[2]=e=>s.value.email=e),placeholder:a.$t("views.user.userForm.form.email.placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(p,{label:a.$t("views.user.userForm.form.phone.label")},{default:o(()=>[l(g,{modelValue:s.value.phone,"onUpdate:modelValue":t[3]||(t[3]=e=>s.value.phone=e),placeholder:a.$t("views.user.userForm.form.phone.placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),d.value?Q("",!0):(N(),S(p,{key:0,label:a.$t("views.user.userForm.form.password.label"),prop:"password"},{default:o(()=>[l(g,{type:"password",modelValue:s.value.password,"onUpdate:modelValue":t[4]||(t[4]=e=>s.value.password=e),placeholder:a.$t("views.user.userForm.form.password.placeholder"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]))]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}}),de={class:"p-24"},ce={class:"flex-between"},pe={class:"mr-4"},fe={class:"mr-4"},ve={class:"mr-4"},ge=H({__name:"index",setup(L){const{common:A,user:O}=W(),h=m(),w=m(),s=m(""),v=m(!1),u=I({current_page:1,page_size:20,total:0}),b=m([]),d=m("");function T(){u.total=0,u.current_page=1,b.value=[],c()}function R(e,$){const k={isActive:e},B=e?r("common.status.enableSuccess"):r("common.status.disableSuccess");F.putUserManage($.id,k,v).then(f=>{c(),D(B)})}function a(e){w.value.open(e)}function t(e){s.value=r("views.user.editUser"),h.value.open(e)}function g(){A.asyncGetValid(ne.User,re.User,v).then(async e=>{console.log("res",e),e!=null&&e.data?(s.value=r("views.user.createUser"),h.value.open()):(e==null?void 0:e.code)===400&&E(r("common.tip"),r("views.user.tip.professionalMessage"),{cancelButtonText:r("common.confirm"),confirmButtonText:r("common.professional")}).then(()=>{window.open("https://maxkb.cn/pricing.html","_blank")}).catch(()=>{})})}function p(e){E(`${r("views.user.delete.confirmTitle")}${e.username} ?`,r("views.user.delete.confirmMessage"),{confirmButtonText:r("common.confirm"),confirmButtonClass:"danger"}).then(()=>{v.value=!0,F.delUserManage(e.id,v).then(()=>{D(r("common.deleteSuccess")),c()})}).catch(()=>{})}function q(){u.current_page=1,c()}function c(){return F.getUserManage(u,d.value,v).then(e=>{b.value=e.data.records,u.total=e.data.total})}function M(){c()}return X(()=>{c()}),(e,$)=>{const k=i("el-button"),B=i("el-input"),f=i("el-table-column"),j=i("el-switch"),J=i("EditPen"),P=i("el-icon"),z=i("el-tooltip"),K=i("Lock"),Z=i("Delete"),G=x("loading");return N(),S(te,{header:e.$t("views.user.title")},{default:o(()=>[_("div",de,[_("div",ce,[l(k,{type:"primary",onClick:g},{default:o(()=>[C(y(e.$t("views.user.createUser")),1)]),_:1}),l(B,{modelValue:d.value,"onUpdate:modelValue":$[0]||($[0]=n=>d.value=n),onChange:T,placeholder:e.$t("views.user.search"),"prefix-icon":"Search",class:"w-240",clearable:""},null,8,["modelValue","placeholder"])]),ee((N(),S(le,{class:"mt-16",data:b.value,"pagination-config":u,onSizeChange:q,onChangePage:c},{default:o(()=>[l(f,{prop:"username",label:e.$t("views.user.userForm.form.username.label")},null,8,["label"]),l(f,{prop:"nickName",label:e.$t("views.user.userForm.form.nickName.label")},null,8,["label"]),l(f,{prop:"email",label:e.$t("views.user.userForm.form.email.label"),"show-overflow-tooltip":""},null,8,["label"]),l(f,{prop:"phone",label:e.$t("views.user.userForm.form.phone.label")},null,8,["label"]),l(f,{prop:"source",label:e.$t("views.user.source.label")},{default:o(({row:n})=>[C(y(n.source==="LOCAL"?e.$t("views.user.source.local"):n.source==="wecom"?e.$t("views.user.source.wecom"):n.source==="lark"?e.$t("views.user.source.lark"):n.source==="dingtalk"?e.$t("views.user.source.dingtalk"):n.source==="OAUTH2"||n.source==="OAuth2"?"OAuth2":n.source),1)]),_:1},8,["label"]),l(f,{label:e.$t("common.status.label"),width:"80"},{default:o(({row:n})=>[_("div",{onClick:$[1]||($[1]=U(()=>{},["stop"]))},[l(j,{disabled:n.role==="ADMIN",size:"small",modelValue:n.isActive,"onUpdate:modelValue":V=>n.isActive=V,onChange:V=>R(V,n)},null,8,["disabled","modelValue","onUpdate:modelValue","onChange"])])]),_:1},8,["label"]),l(f,{label:e.$t("common.createTime"),width:"180"},{default:o(({row:n})=>[C(y(ae(oe)(n.createTime)),1)]),_:1},8,["label"]),l(f,{label:e.$t("common.operation"),width:"110",align:"left",fixed:"right"},{default:o(({row:n})=>[_("span",pe,[l(z,{effect:"dark",content:e.$t("common.edit"),placement:"top"},{default:o(()=>[l(k,{type:"primary",text:"",onClick:U(V=>t(n),["stop"])},{default:o(()=>[l(P,null,{default:o(()=>[l(J)]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_("span",fe,[l(z,{effect:"dark",content:e.$t("views.user.setting.updatePwd"),placement:"top"},{default:o(()=>[l(k,{type:"primary",text:"",onClick:U(V=>a(n),["stop"])},{default:o(()=>[l(P,null,{default:o(()=>[l(K)]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_("span",ve,[l(z,{effect:"dark",content:e.$t("common.delete"),placement:"top"},{default:o(()=>[l(k,{disabled:n.role==="ADMIN",type:"primary",text:"",onClick:U(V=>p(n),["stop"])},{default:o(()=>[l(P,null,{default:o(()=>[l(Z)]),_:1})]),_:2},1032,["disabled","onClick"])]),_:2},1032,["content"])])]),_:1},8,["label"])]),_:1},8,["data","pagination-config"])),[[G,v.value]])]),l(me,{title:s.value,ref_key:"UserDialogRef",ref:h,onRefresh:M},null,8,["title"]),l(se,{ref_key:"UserPwdDialogRef",ref:w,onRefresh:M},null,512)]),_:1},8,["header"])}}});const _e=ue(ge,[["__scopeId","data-v-80d4b1c5"]]);export{_e as default};
