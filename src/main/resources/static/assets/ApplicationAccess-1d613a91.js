import{cp as j,cq as h,dx as H,d6 as R,cZ as e,cr as M,cu as n,cx as r,cF as w,cA as l,cB as o,cJ as i,cz as p,cK as u,cy as D,cC as J,cD as Q,cN as m,cH as te,cX as ie,cQ as F,dm as X,cY as z,ct as le,cR as ce}from"./index-6a81634c.js";const se={class:"flex align-center",style:{"margin-left":"-8px"}},oe={class:"title-decoration-1 mb-16"},ne={key:0,class:"flex align-center mb-16"},pe={class:"lighter mr-8"},re={class:"title-decoration-1 mb-16"},de={class:"primary",href:"https://mp.weixin.qq.com/advanced/advanced?action=dev&t=advanced/dev",target:"_blank"},ue={class:"primary",href:"https://open-dev.dingtalk.com/fe/app?hash=%23%2Fcorp%2Fapp#/corp/app",target:"_blank"},ge={class:"primary",href:"https://work.weixin.qq.com/wework_admin/frame#apps",target:"_blank"},_e={class:"primary",href:"https://open.feishu.cn/app/",target:"_blank"},ve=j({__name:"AccessSettingDrawer",emits:["refresh"],setup(Y,{expose:P,emit:V}){const k=h(),b=h(!1),_=h(!1),A=h(!1),t=h("wechat"),q=H(),L=V,{params:{id:g}}=q,c=R({wechat:{app_id:"",app_secret:"",token:"",encoding_aes_key:"",is_certification:!1,callback_url:""},dingtalk:{client_id:"",client_secret:"",callback_url:""},wecom:{app_id:"",agent_id:"",secret:"",token:"",encoding_aes_key:"",callback_url:""},feishu:{app_id:"",app_secret:"",verification_token:"",callback_url:""},slack:{signing_secret:"",bot_user_token:"",callback_url:""}}),S=R({wechat:{app_id:[{required:!0,message:e("views.application.applicationAccess.wechatSetting.appIdPlaceholder"),trigger:"blur"}],app_secret:[{required:!0,message:e("views.application.applicationAccess.wechatSetting.appSecretPlaceholder"),trigger:"blur"}],token:[{required:!0,message:e("views.application.applicationAccess.wechatSetting.tokenPlaceholder"),trigger:"blur"}],encoding_aes_key:[{required:!0,message:e("views.application.applicationAccess.wechatSetting.aesKeyPlaceholder"),trigger:"blur"}]},dingtalk:{client_id:[{required:!0,message:e("views.application.applicationAccess.dingtalkSetting.clientIdPlaceholder"),trigger:"blur"}],client_secret:[{required:!0,message:e("views.application.applicationAccess.dingtalkSetting.clientSecretPlaceholder"),trigger:"blur"}]},wecom:{app_id:[{required:!0,message:e("views.application.applicationAccess.wecomSetting.cropIdPlaceholder"),trigger:"blur"}],agent_id:[{required:!0,message:e("views.application.applicationAccess.wecomSetting.agentIdPlaceholder"),trigger:"blur"}],secret:[{required:!0,message:e("views.application.applicationAccess.wecomSetting.secretPlaceholder"),trigger:"blur"}],token:[{required:!0,message:e("views.application.applicationAccess.wecomSetting.tokenPlaceholder"),trigger:"blur"}],encoding_aes_key:[{required:!0,message:e("views.application.applicationAccess.wecomSetting.encodingAesKeyPlaceholder"),trigger:"blur"}]},feishu:{app_id:[{required:!0,message:e("views.application.applicationAccess.larkSetting.appIdPlaceholder"),trigger:"blur"}],app_secret:[{required:!0,message:e("views.application.applicationAccess.larkSetting.appSecretPlaceholder"),trigger:"blur"}],verification_token:[{required:!1,message:e("views.application.applicationAccess.larkSetting.verificationTokenPlaceholder"),trigger:"blur"}]},slack:{signing_secret:[{required:!0,message:e("views.application.applicationAccess.slackSetting.signingSecretPlaceholder"),trigger:"blur"}],bot_user_token:[{required:!0,message:e("views.application.applicationAccess.slackSetting.botUserTokenPlaceholder"),trigger:"blur"}]}}),I={wechat:{app_id:{label:e("views.application.applicationAccess.wechatSetting.appId"),placeholder:""},app_secret:{label:e("views.application.applicationAccess.wechatSetting.appSecret"),placeholder:""},token:{label:e("views.application.applicationAccess.wechatSetting.token"),placeholder:""},encoding_aes_key:{label:e("views.application.applicationAccess.wechatSetting.aesKey"),placeholder:""}},dingtalk:{client_id:{label:"Client ID",placeholder:""},client_secret:{label:"Client Secret",placeholder:""}},wecom:{app_id:{label:e("views.application.applicationAccess.wecomSetting.cropId"),placeholder:""},agent_id:{label:"Agent ID",placeholder:""},secret:{label:"Secret",placeholder:""},token:{label:"Token",placeholder:""},encoding_aes_key:{label:"EncodingAESKey",placeholder:""}},feishu:{app_id:{label:"App ID",placeholder:""},app_secret:{label:"App Secret",placeholder:""},verification_token:{label:"Verification Token",placeholder:""}},slack:{signing_secret:{label:"Signing Secret",placeholder:""},bot_user_token:{label:"Bot User Token",placeholder:""}}},U=new Set(["app_secret","client_secret","secret","bot_user_token","signing_secret"]),E=M(()=>({wechat:e("views.application.applicationAccess.wechatSetting.title"),dingtalk:e("views.application.applicationAccess.dingtalkSetting.title"),wecom:e("views.application.applicationAccess.wecomSetting.title"),feishu:e("views.application.applicationAccess.larkSetting.title"),slack:e("views.application.applicationAccess.slackSetting.title")})[t.value]),B=M(()=>({wechat:e("views.applicationOverview.appInfo.header"),dingtalk:e("views.applicationOverview.appInfo.header"),wecom:e("views.applicationOverview.appInfo.header"),feishu:e("views.applicationOverview.appInfo.header"),slack:e("views.applicationOverview.appInfo.header")})[t.value]),N=R(Object.keys(I[t.value]).reduce((a,s)=>(U.has(s)&&(a[s]=!1),a),{})),C=a=>U.has(a),d=()=>{b.value=!1},O=async()=>{var a;_.value||(a=k.value)==null||a.validate(async s=>{if(s)try{F.updatePlatformConfig(g,t.value,c[t.value],_).then(()=>{X(e("common.saveSuccess")),d(),L("refresh")})}catch{z(e("views.application.tip.saveErrorMessage"))}})};return P({open:async(a,s)=>{var y;b.value=!0,t.value=s,_.value=!0,A.value=!1,(y=k.value)==null||y.resetFields();try{const $=await F.getPlatformConfig(a,s);$.data&&(c[t.value]=$.data),A.value=!0}catch{z(e("views.application.tip.loadingErrorMessage"))}finally{_.value=!1,c[t.value].callback_url=`${window.location.origin}/api/${s}/${a}`}}}),(a,s)=>{const y=n("el-input"),$=n("el-form-item"),Z=n("el-switch"),G=n("AppIcon"),K=n("el-button"),T=n("el-text"),W=n("el-form"),ee=n("el-drawer");return r(),w(ee,{modelValue:b.value,"onUpdate:modelValue":s[3]||(s[3]=v=>b.value=v),size:"60%","append-to-body":!0},{header:l(()=>[o("div",se,[o("h4",null,i(E.value),1)])]),footer:l(()=>[o("div",null,[p(K,{onClick:d},{default:l(()=>[u(i(a.$t("common.cancel")),1)]),_:1}),p(K,{type:"primary",onClick:O,disabled:_.value},{default:l(()=>[u(i(a.$t("common.save")),1)]),_:1},8,["disabled"])])]),default:l(()=>[A.value?(r(),w(W,{key:0,ref_key:"formRef",ref:k,model:c[t.value],"label-width":"120px",rules:S[t.value],"label-position":"top","require-asterisk-position":"right"},{default:l(()=>[o("h4",oe,i(B.value),1),(r(!0),D(J,null,Q(I[t.value],(v,f)=>(r(),w($,{key:f,label:v.label,prop:f},{default:l(()=>[p(y,{modelValue:c[t.value][f],"onUpdate:modelValue":ae=>c[t.value][f]=ae,type:C(f)?N[f]?"text":"password":"text",placeholder:v.placeholder,"show-password":C(f)},null,8,["modelValue","onUpdate:modelValue","type","placeholder","show-password"])]),_:2},1032,["label","prop"]))),128)),t.value==="wechat"?(r(),D("div",ne,[o("span",pe,i(a.$t("views.application.applicationAccess.wecomSetting.authenticationSuccessful")),1),t.value==="wechat"?(r(),w(Z,{key:0,modelValue:c[t.value].is_certification,"onUpdate:modelValue":s[0]||(s[0]=v=>c[t.value].is_certification=v)},null,8,["modelValue"])):m("",!0)])):m("",!0),o("h4",re,i(a.$t("views.application.applicationAccess.callback")),1),p($,{label:"URL",prop:"callback_url"},{default:l(()=>[p(y,{modelValue:c[t.value].callback_url,"onUpdate:modelValue":s[2]||(s[2]=v=>c[t.value].callback_url=v),placeholder:a.$t("views.application.applicationAccess.callbackTip"),readonly:""},{append:l(()=>[p(K,{onClick:s[1]||(s[1]=v=>te(ie)(c[t.value].callback_url))},{default:l(()=>[p(G,{iconName:"app-copy"})]),_:1})]),_:1},8,["modelValue","placeholder"]),t.value==="wechat"?(r(),w(T,{key:0,type:"info"},{default:l(()=>[u(i(a.$t("views.application.applicationAccess.copyUrl"))+" ",1),o("a",de,i(a.$t("views.application.applicationAccess.wechatPlatform")),1),u(i(a.$t("views.application.applicationAccess.wechatSetting.urlInfo")),1)]),_:1})):m("",!0),t.value==="dingtalk"?(r(),w(T,{key:1,type:"info"},{default:l(()=>[u(i(a.$t("views.application.applicationAccess.copyUrl"))+" ",1),o("a",ue,i(a.$t("views.application.applicationAccess.dingtalkPlatform")),1),u(i(a.$t("views.application.applicationAccess.dingtalkSetting.urlInfo")),1)]),_:1})):m("",!0),t.value==="wecom"?(r(),w(T,{key:2,type:"info"},{default:l(()=>[u(i(a.$t("views.application.applicationAccess.copyUrl"))+" ",1),o("a",ge,i(a.$t("views.application.applicationAccess.wecomPlatform")),1),u(i(a.$t("views.application.applicationAccess.wecomSetting.urlInfo")),1)]),_:1})):m("",!0),t.value==="feishu"?(r(),w(T,{key:3,type:"info"},{default:l(()=>[u(i(a.$t("views.application.applicationAccess.copyUrl"))+" ",1),o("a",_e,i(a.$t("views.application.applicationAccess.larkPlatform")),1),u(i(a.$t("views.application.applicationAccess.larkSetting.urlInfo")),1)]),_:1})):m("",!0)]),_:1})]),_:1},8,["model","rules"])):m("",!0)]),_:1},8,["modelValue"])}}}),we={class:"p-16-24"},fe={class:"mb-16"},me={class:"flex-between"},he={class:"flex align-center ml-8 mr-8"},ke=["src"],be={class:"ml-12"},Ae={class:"mb-4"},Se=j({__name:"ApplicationAccess",setup(Y){const P=R([{key:"wecom",logoSrc:new URL("/assets/logo_wechat-work-86526549.svg",self.location).href,name:e("views.application.applicationAccess.wecom"),description:e("views.application.applicationAccess.wecomTip"),isActive:!1,exists:!1},{key:"dingtalk",logoSrc:new URL("/assets/logo_dingtalk-e26abd13.svg",self.location).href,name:e("views.application.applicationAccess.dingtalk"),description:e("views.application.applicationAccess.dingtalkTip"),isActive:!1,exists:!1},{key:"wechat",logoSrc:new URL("/assets/logo_wechat-7ff324bf.svg",self.location).href,name:e("views.application.applicationAccess.wechat"),description:e("views.application.applicationAccess.wechatTip"),isActive:!1,exists:!1},{key:"feishu",logoSrc:new URL("/assets/logo_lark-695145de.svg",self.location).href,name:e("views.application.applicationAccess.lark"),description:e("views.application.applicationAccess.larkTip"),isActive:!1,exists:!1},{key:"slack",logoSrc:new URL("/assets/logo_slack-b00a59ed.svg",self.location).href,name:e("views.application.applicationAccess.slack"),description:e("views.application.applicationAccess.slackTip"),isActive:!1,exists:!1}]),V=h(),k=h(!1),b=H(),{params:{id:_}}=b;function A(g){V.value.open(_,g)}function t(){q()}function q(){k.value=!0,F.getPlatformStatus(_).then(g=>{P.forEach(c=>{c.isActive=g.data[c.key],c.exists=!0}),k.value=!1})}function L(g,c){const S={type:g,status:c};F.updatePlatformStatus(_,S).then(()=>{X(e("common.saveSuccess"))})}return le(()=>{q()}),(g,c)=>{const S=n("el-text"),I=n("el-switch"),U=n("el-divider"),E=n("el-button"),B=n("el-card"),N=n("el-col"),C=n("el-row");return r(),D("div",we,[o("h4",fe,i(g.$t("views.application.applicationAccess.title")),1),p(C,{gutter:16},{default:l(()=>[(r(!0),D(J,null,Q(P,(d,O)=>(r(),w(N,{xs:24,sm:24,md:12,lg:12,xl:12,class:"mb-16",key:O},{default:l(()=>[p(B,{shadow:"hover",class:"border-none cursor",style:{"--el-card-padding":"24px"}},{default:l(()=>[o("div",me,[o("div",he,[o("img",{src:d.logoSrc,alt:"",class:"icon"},null,8,ke),o("div",be,[o("h5",Ae,i(d.name),1),p(S,{type:"info",style:{"font-size":"12px"}},{default:l(()=>[u(i(d.description),1)]),_:2},1024)])]),o("div",null,[p(I,{size:"small",modelValue:d.isActive,"onUpdate:modelValue":x=>d.isActive=x,onChange:x=>L(d.key,d.isActive),disabled:!d.exists},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"]),p(U,{direction:"vertical"}),p(E,{class:"mr-4",onClick:x=>A(d.key)},{default:l(()=>[u(i(g.$t("views.application.applicationAccess.setting")),1)]),_:2},1032,["onClick"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1}),p(ve,{ref_key:"AccessSettingDrawerRef",ref:V,onRefresh:t},null,512)])}}});const $e=ce(Se,[["__scopeId","data-v-3b0bb071"]]);export{$e as default};
