import{aJ as ve,bp as Ue,aY as be,aK as pe,e8 as Ne,aP as d,bq as we,be as Pe,bf as f,aQ as s,aZ as Le,aL as r,aM as a,aR as o,aT as i,aS as l,b0 as Te,aW as v,aU as F,a_ as O,b1 as C,aO as K,b2 as Se,e4 as De,aV as D,cH as N,bk as fe,bv as ae,bm as ke,cu as co,cG as uo,e3 as qe,f8 as Ee,ba as He,bx as po,b8 as se,eL as mo,b9 as me,cx as fo,b6 as G,b5 as vo,f0 as _o,bg as yo,fn as go,fo as ho,fO as ko,a$ as wo,fs as bo,ea as Fe,eb as To}from"./chat-ESISKCvw.js";import{_ as $o}from"./icon_import-D9IDqZyN.js";import{c as Co,b as Oe,_ as Do,a as Lo}from"./ToolFormDrawer.vue_vue_type_script_setup_true_lang-Bx-EqtNF.js";import{_ as So}from"./AuthorizedWorkspaceDialog.vue_vue_type_script_setup_true_lang-BmnPB69j.js";import{_ as Vo}from"./index.vue_vue_type_script_setup_true_lang-IdubcmMD.js";import{M as Io}from"./MoveToDialog-BhGgPs13.js";const xo="data:image/svg+xml,%3csvg%20width='32'%20height='32'%20viewBox='0%200%2032%2032'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M26.1563%202.66699L26.3594%202.68262C26.8258%202.75455%2027.2257%203.06988%2027.3994%203.51953L29.4004%208.7002C30.2431%2010.8818%2029.5573%2013.1583%2028.0215%2014.5771C28.0235%2014.6068%2028.0264%2014.6369%2028.0264%2014.667V28C28.0264%2028.7364%2027.4288%2029.333%2026.6924%2029.333H5.35941C4.62303%2029.333%204.0264%2028.7364%204.0264%2028V14.667C4.0264%2014.6372%204.02838%2014.6074%204.0303%2014.5781C2.49502%2013.1601%201.80856%2010.8847%202.65042%208.7041L4.65335%203.51953L4.74026%203.33594C4.97526%202.92651%205.41431%202.66712%205.89651%202.66699H26.1563ZM20.3653%2014.1885C19.388%2015.2979%2017.959%2015.9999%2016.3643%2016H15.6846C14.0896%2015.9999%2012.6589%2015.2983%2011.6817%2014.1885C10.7002%2015.2988%209.26596%2016%207.67288%2016C7.33622%2016%207.00883%2015.9688%206.69241%2015.9111V26.667H25.3594V15.9102C25.0425%2015.968%2024.7142%2016%2024.377%2016C22.7837%2015.9999%2021.347%2015.2993%2020.3653%2014.1885Z'%20fill='%23FF8800'/%3e%3c/svg%3e",Ao={class:"title-decoration-1 mb-16"},Ro={class:"flex w-full"},Mo=["src"],zo={class:"title-decoration-1 mb-16"},Fo={class:"mb-8"},Bo=`{
  "math": {
    "url": "your_server",
    "type": "sse"
  }
}`,Uo=ve({__name:"McpToolFormDrawer",props:{title:String},emits:["refresh"],setup(W,{expose:q,emit:T}){const M=Ue(),{folder:$,user:p}=be(),b=pe(()=>M.path.includes("shared")?"systemShare":M.path.includes("resource-management")?"systemManage":"workspace"),_=pe(()=>Ne.tool[b.value]),g=T,w=d(),u=d(),L=d(!1),V=d(!1),B=d(!1),z=d(!1),E=d(null),U=d(!1),y=d({name:"",desc:"",code:"",icon:"",inputFieldList:[],initFieldList:[],toolType:"MCP"});we(B,k=>{var c;k||(L.value=!1,z.value=!1,E.value=null,y.value={name:"",desc:"",code:"",icon:"",inputFieldList:[],initFieldList:[],toolType:"MCP"},(c=u.value)==null||c.clearValidate())});const I=Pe({name:[{required:!0,message:f("views.tool.form.toolName.requiredMessage"),trigger:"blur"}]});function j(){L.value||!A(y.value)?B.value=!1:ke(f("common.tip"),f("views.tool.tip.saveMessage"),{confirmButtonText:f("common.confirm"),type:"warning"}).then(()=>{B.value=!1}).catch(()=>{})}function A(k){return Object.values(k).some(c=>Array.isArray(c)?c.length!==0:c!=null&&c!=="")}function le(k){y.value.icon=k}function h(){w.value.open(y.value)}const x=async k=>{k&&await k.validate(c=>{var Y,X;if(c)if(L.value)N({type:"tool",systemType:b.value}).putTool((Y=y.value)==null?void 0:Y.id,y.value,V).then(J=>(fe(f("common.editSuccess")),g("refresh",J.data),p.profile())).then(()=>{B.value=!1});else{const J={folderId:(X=$.currentFolder)==null?void 0:X.id,...y.value};N({type:"tool",systemType:b.value}).postTool(J,V).then(oe=>(fe(f("common.createSuccess")),g("refresh"),p.profile())).then(()=>{B.value=!1})}})};function H(){y.value.code&&(V.value=!0,N({type:"tool",systemType:b.value}).postToolTestConnection({code:y.value.code},V).then(()=>{fe(f("views.system.testSuccess"))}).finally(()=>{V.value=!1}))}return q({open:k=>{k&&(L.value=!!(k!=null&&k.id),y.value=ae.cloneDeep(k)),B.value=!0,setTimeout(()=>{z.value=!0},100)}}),(k,c)=>{const Y=s("el-Avatar"),X=s("el-avatar"),J=s("AppIcon"),oe=s("el-input"),ce=s("el-form-item"),_e=s("el-form"),ye=s("el-text"),S=s("el-button"),Q=s("el-drawer"),ue=Le("loading");return a(),r(Q,{modelValue:B.value,"onUpdate:modelValue":c[10]||(c[10]=P=>B.value=P),size:"60%","before-close":j},{header:o(()=>[i("h4",null,v(W.title),1)]),footer:o(()=>{var P;return[i("div",null,[l(S,{loading:V.value,onClick:H},{default:o(()=>[D(v(k.$t("views.system.test")),1)]),_:1},8,["loading"]),l(S,{loading:V.value,onClick:c[8]||(c[8]=ee=>B.value=!1)},{default:o(()=>[D(v(k.$t("common.cancel")),1)]),_:1},8,["loading"]),(L.value?_.value.edit((P=y.value)==null?void 0:P.id):_.value.create())?(a(),r(S,{key:0,type:"primary",onClick:c[9]||(c[9]=ee=>x(u.value)),loading:V.value},{default:o(()=>[D(v(L.value?k.$t("common.save"):k.$t("common.create")),1)]),_:1},8,["loading"])):C("",!0)])]}),default:o(()=>[i("div",null,[i("h4",Ao,v(k.$t("views.model.modelForm.title.baseInfo")),1),Te((a(),r(_e,{ref_key:"FormRef",ref:u,model:y.value,rules:I,"label-position":"top","require-asterisk-position":"right",onSubmit:c[6]||(c[6]=F(()=>{},["prevent"]))},{default:o(()=>[l(ce,{label:k.$t("views.tool.form.toolName.label"),prop:"name"},{default:o(()=>[i("div",Ro,[y.value.id?(a(),O("div",{key:0,class:"edit-avatar mr-12",onMouseenter:c[0]||(c[0]=P=>U.value=!0),onMouseleave:c[1]||(c[1]=P=>U.value=!1)},[K(Se)(y.value.icon)?(a(),r(Y,{key:0,id:y.value.id,shape:"square",size:32,style:{background:"none"}},{default:o(()=>[i("img",{src:String(y.value.icon),alt:""},null,8,Mo)]),_:1},8,["id"])):(a(),r(X,{key:1,class:"avatar-green",shape:"square",size:32},{default:o(()=>c[11]||(c[11]=[i("img",{src:De,style:{width:"58%"},alt:""},null,-1)])),_:1,__:[11]})),U.value?(a(),r(Y,{key:2,id:y.value.id,shape:"square",class:"edit-mask",size:32,onClick:h},{default:o(()=>[l(J,{iconName:"app-edit"})]),_:1},8,["id"])):C("",!0)],32)):(a(),r(X,{key:1,class:"avatar-green mr-12",shape:"square",size:32},{default:o(()=>c[12]||(c[12]=[i("img",{src:De,style:{width:"58%"},alt:""},null,-1)])),_:1,__:[12]})),l(oe,{modelValue:y.value.name,"onUpdate:modelValue":c[2]||(c[2]=P=>y.value.name=P),placeholder:k.$t("views.tool.form.toolName.placeholder"),maxlength:"64","show-word-limit":"",onBlur:c[3]||(c[3]=P=>{var ee;return y.value.name=(ee=y.value.name)==null?void 0:ee.trim()})},null,8,["modelValue","placeholder"])])]),_:1},8,["label"]),l(ce,{label:k.$t("views.tool.form.toolDescription.label")},{default:o(()=>[l(oe,{modelValue:y.value.desc,"onUpdate:modelValue":c[4]||(c[4]=P=>y.value.desc=P),type:"textarea",placeholder:k.$t("views.tool.form.toolDescription.placeholder"),maxlength:"128","show-word-limit":"",autosize:{minRows:3},onBlur:c[5]||(c[5]=P=>{var ee;return y.value.desc=(ee=y.value.desc)==null?void 0:ee.trim()})},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])),[[ue,V.value]]),i("h4",zo,[D(v(k.$t("views.tool.form.mcp.label"))+" ",1),c[13]||(c[13]=i("span",{style:{color:"red","margin-left":"-10px"}},"*",-1)),l(ye,{type:"info",class:"color-secondary"},{default:o(()=>[D(v(k.$t("views.tool.form.mcp.tip")),1)]),_:1})]),i("div",Fo,[l(oe,{modelValue:y.value.code,"onUpdate:modelValue":c[7]||(c[7]=P=>y.value.code=P),placeholder:Bo,type:"textarea",autosize:{minRows:5}},null,8,["modelValue"])])]),l(Co,{ref_key:"EditAvatarDialogRef",ref:w,onRefresh:le},null,512)]),_:1},8,["modelValue"])}}}),We={_value:"/workspace/"};Object.defineProperty(We,"value",{get:function(){const{user:W}=be();return this._value+W.getWorkspaceId()+"/tool"}});const No=(W,q)=>co("/workspace/internal/tool",W,q),Po=(W,q,T)=>uo(`${We.value}/${W}/add_internal_tool`,q,void 0,T),qo={getInternalToolList:No,addInternalTool:Po},Eo=["src"],Ho={class:"card-footer-left color-secondary"},Oo=ve({__name:"ToolCard",props:{tool:{},getSubTitle:{type:Function},addLoading:{type:Boolean}},emits:["handleAdd","handleDetail"],setup(W,{emit:q}){const T=W,M=q;return($,p)=>{const b=s("el-avatar"),_=s("el-text"),g=s("el-button");return a(),r(Ee,{title:T.tool.name,description:T.tool.desc,class:"cursor"},{icon:o(()=>{var w,u,L;return[K(Se)((w=T.tool)==null?void 0:w.icon)?(a(),r(b,{key:0,shape:"square",size:32,style:{background:"none"}},{default:o(()=>{var V;return[i("img",{src:K(qe)((V=T.tool)==null?void 0:V.icon),alt:""},null,8,Eo)]}),_:1})):(u=T.tool)!=null&&u.name?(a(),r(b,{key:1,name:(L=T.tool)==null?void 0:L.name,pinyinColor:"",shape:"square",size:32},null,8,["name"])):C("",!0)]}),subTitle:o(()=>[l(_,{class:"color-secondary",size:"small"},{default:o(()=>[D(v($.getSubTitle(T.tool)),1)]),_:1})]),footer:o(()=>[i("span",Ho,v(`${$.$t("common.author")}: MaxKB`),1),i("div",{class:"card-footer-operation",onClick:p[2]||(p[2]=F(()=>{},["stop"]))},[l(g,{onClick:p[0]||(p[0]=w=>M("handleDetail"))},{default:o(()=>[D(v($.$t("common.detail")),1)]),_:1}),l(g,{type:"primary",loading:T.addLoading,onClick:p[1]||(p[1]=w=>M("handleAdd"))},{default:o(()=>[D(v($.$t("common.add")),1)]),_:1},8,["loading"])])]),_:1},8,["title","description"])}}}),Be=He(Oo,[["__scopeId","data-v-7ac3eeac"]]),Wo={class:"flex align-center",style:{"margin-left":"-8px"}},jo={class:"card-header"},Ko={class:"flex-between"},Zo={class:"title flex align-center"},Jo=["src"],Qo={class:"ml-16"},Go={class:"mb-8"},Yo={class:"mt-16"},Xo=ve({__name:"InternalDescDrawer",emits:["refresh","addTool"],setup(W,{expose:q,emit:T}){const M=T,$=d(!1),p=d(""),b=d({});we($,w=>{w||(p.value="")});const _=(w,u)=>{b.value=u,w&&(p.value=ae.cloneDeep(w)),$.value=!0},g=w=>{M("addTool",w),$.value=!1};return q({open:_}),(w,u)=>{const L=s("Back"),V=s("el-icon"),B=s("el-button"),z=s("el-avatar"),E=s("el-text"),U=s("MdPreview"),y=s("el-drawer");return a(),r(y,{modelValue:$.value,"onUpdate:modelValue":u[3]||(u[3]=I=>$.value=I),size:"60%","append-to-body":!0},{header:o(()=>[i("div",Wo,[l(B,{class:"cursor mr-4",link:"",onClick:u[0]||(u[0]=F(I=>$.value=!1,["prevent"]))},{default:o(()=>[l(V,{size:20},{default:o(()=>[l(L)]),_:1})]),_:1}),u[4]||(u[4]=i("h4",null,"详情",-1))])]),default:o(()=>{var I,j,A,le;return[i("div",null,[i("div",jo,[i("div",Ko,[i("div",Zo,[K(Se)((I=b.value)==null?void 0:I.icon)?(a(),r(z,{key:0,shape:"square",size:64,style:{background:"none"},class:"mr-8"},{default:o(()=>{var h;return[i("img",{src:(h=b.value)==null?void 0:h.icon,alt:""},null,8,Jo)]}),_:1})):(j=b.value)!=null&&j.name?(a(),r(z,{key:1,name:(A=b.value)==null?void 0:A.name,pinyinColor:"",shape:"square",size:64,class:"mr-8"},null,8,["name"])):C("",!0),i("div",Qo,[i("h3",Go,v(b.value.name),1),(le=b.value)!=null&&le.desc?(a(),r(E,{key:0,type:"info"},{default:o(()=>[D(v(b.value.desc),1)]),_:1})):C("",!0)])]),i("div",{onClick:u[2]||(u[2]=F(()=>{},["stop"]))},[l(B,{type:"primary",onClick:u[1]||(u[1]=h=>g(b.value))},{default:o(()=>[D(v(w.$t("common.add")),1)]),_:1})])]),i("div",Yo,[l(E,{type:"info"},{default:o(()=>[i("div",null,v(w.$t("common.author"))+": MaxKB",1)]),_:1})])]),l(U,{ref:"editorRef",editorId:"preview-only",modelValue:p.value,style:{background:"none"},noImgZoomIn:""},null,8,["modelValue"])])]}),_:1},8,["modelValue"])}}}),el={class:"dialog-header flex-between mb-8"},ol=["id"],ll={class:"flex align-center",style:{"margin-right":"28px"}},tl=["id"],nl={key:1},al={class:"color-text-primary medium mb-16"},sl={class:"color-primary"},il=ve({__name:"ToolStoreDialog",props:{apiType:{type:String,default:"workspace"}},emits:["refresh"],setup(W,{expose:q,emit:T}){const{user:M}=be(),$=W,p=T,b=d(!1),_=d(!1),g=d(""),w=d(""),u=d([{id:"recommend",title:f("views.tool.toolStore.recommend"),tools:[]},{id:"web_search",title:f("views.tool.toolStore.webSearch"),tools:[]},{id:"database_search",title:f("views.tool.toolStore.databaseQuery"),tools:[]},{id:"image",title:f("views.tool.toolStore.image"),tools:[]},{id:"developer",title:f("views.tool.toolStore.developer"),tools:[]},{id:"send_message",title:f("views.tool.toolStore.sendMessage"),tools:[]}]),L=d(null);function V(h){var x;return((x=u.value.find(H=>H.id===h.label))==null?void 0:x.title)??""}function B(h){w.value=h,L.value=null,b.value=!0}po(()=>{z()});async function z(){try{const h=await qo.getInternalToolList({name:g.value},_);g.value.length?L.value=h.data:(L.value=null,u.value.forEach(x=>{x.tools=h.data.filter(H=>H.label===x.id)}))}catch(h){console.error(h)}}const E=h=>{h.preventDefault()},U=d();async function y(h){var k;const x=h.icon.replace("icon.png","detail.md"),ie=await(await fetch(x)).text();(k=U.value)==null||k.open(ie,h)}const I=d();function j(h,x){var H;(H=I.value)==null||H.open(h,x)}const A=d(!1);async function le(h){try{await N({type:"tool",systemType:$.apiType}).addInternalTool(h.id,{name:h.name,folderId:w.value},A).then(()=>M.profile()),p("refresh"),fe(f("common.addSuccess")),b.value=!1}catch(x){console.error(x)}}return q({open:B}),(h,x)=>{const H=s("el-tag"),ie=s("el-input"),k=s("el-divider"),c=s("el-anchor-link"),Y=s("el-anchor"),X=s("el-col"),J=s("el-row"),oe=s("el-empty"),ce=s("el-scrollbar"),_e=s("el-dialog"),ye=Le("loading");return a(),O(se,null,[l(_e,{modelValue:b.value,"onUpdate:modelValue":x[1]||(x[1]=S=>b.value=S),width:"1000","append-to-body":"",class:"tool-store-dialog","align-center":"","close-on-click-modal":!1,"close-on-press-escape":!1},{header:o(({titleId:S})=>[i("div",el,[i("h4",{id:S,class:"medium"},v(h.$t("views.tool.toolStore.title")),9,ol),l(H,{class:"store-type default-tag"},{default:o(()=>[D(v(K(f)("views.tool.toolStore.internal")),1)]),_:1}),i("div",ll,[l(ie,{modelValue:g.value,"onUpdate:modelValue":x[0]||(x[0]=Q=>g.value=Q),placeholder:h.$t("common.search"),"prefix-icon":"Search",class:"w-240 mr-8",clearable:"",onChange:z},null,8,["modelValue","placeholder"]),l(k,{direction:"vertical"})])])]),default:o(()=>[Te((a(),r(mo,null,{left:o(()=>[l(Y,{direction:"vertical",offset:130,type:"default",container:".category-scrollbar",onClick:E},{default:o(()=>[(a(!0),O(se,null,me(u.value,S=>(a(),r(c,{key:S.id,href:`#category-${S.id}`,title:S.title},null,8,["href","title"]))),128))]),_:1})]),default:o(()=>[l(ce,{class:"layout-bg","wrap-class":"p-16-24 category-scrollbar"},{default:o(()=>[L.value===null?(a(!0),O(se,{key:0},me(u.value,S=>(a(),O("div",{key:S.id},[i("h4",{class:"title-decoration-1 mb-16 mt-8 color-text-primary",id:`category-${S.id}`},v(S.title),9,tl),l(J,{gutter:16},{default:o(()=>[(a(!0),O(se,null,me(S.tools,Q=>(a(),r(X,{key:Q.id,span:8,class:"mb-16"},{default:o(()=>[l(Be,{tool:Q,addLoading:A.value,"get-sub-title":V,onHandleAdd:ue=>j(Q),onHandleDetail:ue=>y(Q)},null,8,["tool","addLoading","onHandleAdd","onHandleDetail"])]),_:2},1024))),128))]),_:2},1024)]))),128)):(a(),O("div",nl,[i("h4",al,[i("span",sl,v(g.value),1),D(" "+v(K(f)("views.tool.toolStore.searchResult",{count:L.value.length})),1)]),L.value.length?(a(),r(J,{key:0,gutter:16},{default:o(()=>[(a(!0),O(se,null,me(L.value,S=>(a(),r(X,{key:S.id,span:8,class:"mb-16"},{default:o(()=>[l(Be,{tool:S,addLoading:A.value,"get-sub-title":V,onHandleAdd:Q=>j(S),onHandleDetail:Q=>y(S)},null,8,["tool","addLoading","onHandleAdd","onHandleDetail"])]),_:2},1024))),128))]),_:1})):(a(),r(oe,{key:1,description:h.$t("common.noData")},null,8,["description"]))]))]),_:1})]),_:1})),[[ye,_.value]])]),_:1},8,["modelValue"]),l(Xo,{ref_key:"internalDescDrawerRef",ref:U,onAddTool:j},null,512),l(Oe,{ref_key:"addInternalToolDialogRef",ref:I,onRefresh:le},null,512)],64)}}}),rl=ve({__name:"McpToolConfigDialog",setup(W,{expose:q}){const T=d(""),M=d(!1),$=d(!1),p=()=>{M.value=!1};return q({open:_=>{T.value=_.code,M.value=!0}}),(_,g)=>{const w=s("el-input"),u=s("el-button"),L=s("el-form-item"),V=s("el-form"),B=s("el-dialog");return a(),r(B,{title:_.$t("views.tool.mcpConfig"),width:"600",modelValue:M.value,"onUpdate:modelValue":g[4]||(g[4]=z=>M.value=z),"close-on-click-modal":!1,"close-on-press-escape":!1,"destroy-on-close":!0,"before-close":p,"append-to-body":"",class:"mcp-config-dialog"},{default:o(()=>[l(V,{"label-width":"auto","label-position":"top"},{default:o(()=>[l(L,{onMouseenter:g[2]||(g[2]=F(z=>$.value=!0,["stop"])),onMouseleave:g[3]||(g[3]=F(z=>$.value=!1,["stop"]))},{default:o(()=>[l(w,{type:"textarea",modelValue:T.value,"onUpdate:modelValue":g[0]||(g[0]=z=>T.value=z),rows:"8",disabled:"",class:"config-textarea"},null,8,["modelValue"]),Te(l(u,{circle:"",class:"copy-icon",onClick:g[1]||(g[1]=F(z=>K(fo)(T.value),["stop"]))},{default:o(()=>[l(G,{iconName:"app-copy",class:"color-secondary"})]),_:1},512),[[vo,$.value]])]),_:1})]),_:1})]),_:1},8,["title","modelValue"])}}}),cl=He(rl,[["__scopeId","data-v-9cad61b5"]]),ul={class:"flex"},dl={class:"flex-between complex-search"},pl={class:"flex align-center"},ml={class:"flex align-center"},fl={class:"flex align-center w-full"},vl={class:"pre-wrap ml-8"},_l={class:"lighter"},yl={class:"flex align-center"},gl={class:"pre-wrap ml-8"},hl={class:"lighter"},kl={style:{"max-height":"calc(100vh - 120px)"}},wl=["src"],bl={key:0,class:"flex align-center"},Tl={class:"color-secondary"},$l={key:1,class:"flex align-center"},Cl={class:"color-secondary"},Al=ve({__name:"ToolListContainer",emits:["refreshFolder"],setup(W,{emit:q}){const T=Ue(),{folder:M,user:$,tool:p}=be();_o((e,t)=>{p.setToolList([])});const b=q,_=pe(()=>T.path.includes("shared")?"systemShare":T.path.includes("resource-management")?"systemManage":"workspace"),g=pe(()=>M.currentFolder.id==="share"),w=pe(()=>_.value==="systemShare"),u=pe(()=>Ne.tool[_.value]),L=e=>u.value.edit(e)||u.value.export(e)||u.value.delete(e)||u.value.auth(e)||w.value,V=d();function B(e){V.value.open(e.id)}const z=d(),E=d("name"),U=d({name:"",createUser:"",isActive:null}),y=d([]),I=d(!1),j=d(!1),A=Pe({current_page:1,page_size:30,total:0}),le=()=>{U.value={name:"",createUser:""}},h=d(),x=d(),H=d(""),ie=d(""),k=d();function c(e){const t=ae.cloneDeep(p.toolList),m=t.findIndex(R=>R.id===e.id);t.splice(m,1),p.setToolList(t)}const Y=d();function X(e){Y.value&&Y.value.open(e,"Tool")}function J(e){if((e==null?void 0:e.toolType)==="MCP"){oe(e);return}e!=null&&e.template_id||g.value||(H.value=e?f("views.tool.editTool"):f("views.tool.createTool"),e?N({type:"tool",systemType:_.value}).getToolById(e==null?void 0:e.id,I).then(t=>{h.value.open(t.data)}):h.value.open(e))}function oe(e){e!=null&&e.template_id||g.value||(ie.value=e?f("views.tool.editMcpTool"):f("views.tool.createMcpTool"),e?N({type:"tool",systemType:_.value}).getToolById(e==null?void 0:e.id,I).then(t=>{x.value.open(t.data)}):x.value.open(e))}async function ce(e){if(e.isActive)ke(`${f("views.tool.disabled.confirmTitle")}${e.name} ?`,f("views.tool.disabled.confirmMessage"),{confirmButtonText:f("common.status.disable"),confirmButtonClass:"danger"}).then(()=>{const t={isActive:!e.isActive};N({type:"tool",systemType:_.value}).putTool(e.id,t,j).then(()=>{const m=ae.cloneDeep(p.toolList),R=m.findIndex(te=>te.id===e.id);return m[R].isActive=!e.isActive,p.setToolList(m),!0}).catch(()=>!1)});else{const t=await N({type:"tool",systemType:_.value}).getToolById(e.id,j);if((!t.data.initParams||Object.keys(t.data.initParams).length===0)&&t.data.initFieldList&&t.data.initFieldList.length>0&&t.data.initFieldList.filter(R=>R.default_value&&R.show_default_value).length!==t.data.initFieldList.length)return z.value.open(t.data,!e.isActive),!1;const m={isActive:!e.isActive};N({type:"tool",systemType:_.value}).putTool(e.id,m,j).then(()=>{const R=ae.cloneDeep(p.toolList),te=R.findIndex(Ce=>Ce.id===e.id);return R[te].isActive=!e.isActive,p.setToolList(R),!0}).catch(()=>!1)}}async function _e(e){H.value=f("views.tool.copyTool");const t=await N({type:"tool",systemType:_.value}).getToolById(e.id,j),m=ae.cloneDeep(t.data);delete m.id,m.name=m.name+`  ${f("common.copyTitle")}`,h.value.open(m)}function ye(e){N({type:"tool",systemType:_.value}).exportTool(e.id,e.name,I).catch(t=>{t.response.status!==403&&t.response.data.text().then(m=>{To(`${f("views.application.tip.ExportError")}:${JSON.parse(m).message}`)})})}function S(e){ke(`${f("views.tool.delete.confirmTitle")}：${e.name} ?`,f("views.tool.delete.confirmMessage"),{confirmButtonText:f("common.confirm"),cancelButtonText:f("common.cancel"),confirmButtonClass:"danger"}).then(()=>{N({type:"tool",systemType:_.value}).delTool(e.id,I).then(()=>{const t=ae.cloneDeep(p.toolList),m=t.findIndex(R=>R.id===e.id);t.splice(m,1),p.setToolList(t),fe(f("common.deleteSuccess"))})}).catch(()=>{})}function Q(e){N({type:"tool",systemType:_.value}).getToolById(e==null?void 0:e.id,j).then(t=>{z.value.open(t.data)})}const ue=d();function P(){var e;(e=ue.value)==null||e.open(M.currentFolder.id)}const ee=d();function je(e,t){var m;(m=ee.value)==null||m.open(e,t)}function Ke(e,t){t&&N({type:"tool",systemType:_.value}).putTool(e==null?void 0:e.id,{name:e.name},I).then(m=>{fe(f("common.saveSuccess")),de()})}const Ve=d();function Ze(e){const t=new FormData;t.append("file",e.raw,e.name),t.append("folderId",M.currentFolder.id||$.getWorkspaceId()),Ve.value.clearFiles(),N({type:"tool",systemType:_.value}).postImportTool(t,I).then(async m=>{if(m!=null&&m.data)return p.setToolList([]),$.profile()}).then(()=>{re()}).catch(m=>{m.code===400&&ke(f("common.tip"),f("views.application.tip.professionalMessage"),{cancelButtonText:f("common.confirm"),confirmButtonText:f("common.professional")}).then(()=>{window.open("https://tarzan.blog.csdn.net","_blank")})})}const Ie=d();function Je(e){N({type:"tool",systemType:_.value}).getToolById(e==null?void 0:e.id,I).then(t=>{Ie.value.open(t.data)})}function de(e){if(e){const t=ae.cloneDeep(p.toolList),m=t.findIndex(R=>R.id===e.id);t.splice(m,1,e),p.setToolList(t)}else A.total=0,A.current_page=1,p.setToolList([]),re()}const Qe=d();we(()=>M.currentFolder,e=>{e&&e.id&&(A.current_page=1,p.setToolList([]),re())},{deep:!0,immediate:!0}),we(()=>p.toolType,()=>{A.current_page=1,p.setToolList([]),re()});function re(){var t;const e={folderId:((t=M.currentFolder)==null?void 0:t.id)||$.getWorkspaceId(),scope:_.value==="systemShare"?"SHARED":"WORKSPACE",toolType:p.toolType||""};U.value[E.value]&&(e[E.value]=U.value[E.value]),N({type:"tool",isShared:g.value,systemType:_.value}).getToolListPage(A,e,I).then(m=>{var R,te;A.total=(R=m.data)==null?void 0:R.total,p.setToolList([...p.toolList,...(te=m.data)==null?void 0:te.records])})}function Ge(){b("refreshFolder")}function $e(){A.current_page=1,p.setToolList([]),re()}return yo(()=>{_.value!=="workspace"&&re(),N({type:"workspace",isShared:g.value,systemType:_.value}).getAllMemberList($.getWorkspaceId(),I).then(e=>{y.value=e.data})}),(e,t)=>{const m=s("el-option"),R=s("el-select"),te=s("el-input"),Ce=s("arrow-down"),xe=s("el-icon"),Ae=s("el-button"),ge=s("el-avatar"),Z=s("el-dropdown-item"),Ye=s("el-upload"),Re=s("el-dropdown-menu"),Me=s("el-dropdown"),Xe=s("ToolIcon"),eo=s("el-text"),oo=s("el-tag"),lo=s("SuccessFilled"),to=s("el-switch"),no=s("el-divider"),ao=s("el-col"),so=s("el-row"),io=s("el-empty"),ro=Le("loading");return a(),O(se,null,[l(go,null,{header:o(()=>[wo(e.$slots,"header")]),search:o(()=>[i("div",ul,[i("div",dl,[l(R,{class:"complex-search__left",modelValue:E.value,"onUpdate:modelValue":t[0]||(t[0]=n=>E.value=n),style:{width:"120px"},onChange:le},{default:o(()=>[l(m,{label:e.$t("common.creator"),value:"createUser"},null,8,["label"]),l(m,{label:e.$t("views.tool.form.toolName.label"),value:"name"},null,8,["label"]),l(m,{label:e.$t("views.document.enableStatus.label"),value:"isActive"},null,8,["label"])]),_:1},8,["modelValue"]),E.value==="name"?(a(),r(te,{key:0,modelValue:U.value.name,"onUpdate:modelValue":t[1]||(t[1]=n=>U.value.name=n),onChange:$e,placeholder:e.$t("common.searchBar.placeholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):E.value==="isActive"?(a(),r(R,{key:1,modelValue:U.value.isActive,"onUpdate:modelValue":t[2]||(t[2]=n=>U.value.isActive=n),onChange:$e,filterable:"",clearable:"",style:{width:"220px"}},{default:o(()=>[l(m,{label:e.$t("views.document.enableStatus.enable"),value:"true"},null,8,["label"]),l(m,{label:e.$t("views.document.enableStatus.close"),value:"false"},null,8,["label"])]),_:1},8,["modelValue"])):E.value==="createUser"?(a(),r(R,{key:2,modelValue:U.value.createUser,"onUpdate:modelValue":t[3]||(t[3]=n=>U.value.createUser=n),onChange:$e,filterable:"",clearable:"",style:{width:"220px"}},{default:o(()=>[(a(!0),O(se,null,me(y.value,n=>(a(),r(m,{key:n.id,value:n.id,label:n.nickname},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):C("",!0)]),!g.value&&u.value.create()?(a(),r(Me,{key:0,trigger:"click"},{dropdown:o(()=>[l(Re,{class:"create-dropdown"},{default:o(()=>[l(Z,{onClick:t[4]||(t[4]=n=>J())},{default:o(()=>[i("div",pl,[l(ge,{class:"avatar-green",shape:"square",size:32},{default:o(()=>t[10]||(t[10]=[i("img",{src:De,style:{width:"58%"},alt:""},null,-1)])),_:1,__:[10]}),t[11]||(t[11]=i("div",{class:"pre-wrap ml-8"},[i("div",{class:"lighter"},"空白创建")],-1))])]),_:1}),l(Z,{onClick:t[5]||(t[5]=n=>oe())},{default:o(()=>[i("div",ml,[l(ge,{shape:"square",size:32},{default:o(()=>t[12]||(t[12]=[i("img",{src:ko,style:{width:"58%"},alt:""},null,-1)])),_:1,__:[12]}),t[13]||(t[13]=i("div",{class:"pre-wrap ml-8"},[i("div",{class:"lighter"},"创建MCP")],-1))])]),_:1}),l(Ye,{ref_key:"elUploadRef",ref:Ve,"file-list":[],action:"#",multiple:"","auto-upload":!1,"show-file-list":!1,limit:1,"on-change":(n,ze)=>Ze(n),class:"import-button"},{default:o(()=>[u.value.import()?(a(),r(Z,{key:0},{default:o(()=>[i("div",fl,[l(ge,{shape:"square",class:"mt-4",size:36,style:{background:"none"}},{default:o(()=>t[14]||(t[14]=[i("img",{src:$o,alt:""},null,-1)])),_:1,__:[14]}),i("div",vl,[i("div",_l,v(e.$t("common.importCreate")),1)])])]),_:1})):C("",!0)]),_:1},8,["on-change"]),l(Z,{onClick:t[6]||(t[6]=n=>P())},{default:o(()=>[i("div",yl,[l(ge,{shape:"square",size:32,style:{background:"none"}},{default:o(()=>t[15]||(t[15]=[i("img",{src:xo,alt:""},null,-1)])),_:1,__:[15]}),i("div",gl,[i("div",hl,v(e.$t("views.tool.toolStore.createFromToolStore")),1)])])]),_:1})]),_:1})]),default:o(()=>[l(Ae,{type:"primary",class:"ml-8"},{default:o(()=>[D(v(e.$t("common.create"))+" ",1),l(xe,{class:"el-icon--right"},{default:o(()=>[l(Ce)]),_:1})]),_:1})]),_:1})):C("",!0)])]),default:o(()=>[Te((a(),O("div",kl,[l(ho,{size:K(p).toolList.length,total:A.total,page_size:A.page_size,current_page:A.current_page,"onUpdate:current_page":t[9]||(t[9]=n=>A.current_page=n),onLoad:re,loading:I.value},{default:o(()=>[K(p).toolList.length>0?(a(),r(so,{key:0,gutter:15,class:"w-full"},{default:o(()=>[(a(!0),O(se,null,me(K(p).toolList,(n,ze)=>(a(),r(ao,{key:ze,xs:24,sm:12,md:12,lg:6,xl:6,class:"mb-16"},{default:o(()=>[l(Ee,{title:n.name,description:n.desc,class:"cursor",onClick:F(he=>J(n),["stop"]),disabled:u.value.edit(n.id)},{icon:o(()=>[n!=null&&n.icon?(a(),r(ge,{key:0,shape:"square",size:32,style:{background:"none"},class:"mr-8"},{default:o(()=>[i("img",{src:K(qe)(n==null?void 0:n.icon),alt:""},null,8,wl)]),_:2},1024)):(a(),r(Xe,{key:1,size:32,type:n==null?void 0:n.toolType},null,8,["type"]))]),subTitle:o(()=>[l(eo,{class:"color-secondary lighter",size:"small"},{default:o(()=>[D(v(e.$t("common.creator"))+": "+v(n==null?void 0:n.nickname),1)]),_:2},1024)]),tag:o(()=>[g.value?(a(),r(oo,{key:0,type:"info",class:"info-tag"},{default:o(()=>[D(v(K(f)("views.shared.title")),1)]),_:1})):C("",!0)]),footer:o(()=>[n.isActive?(a(),O("div",bl,[l(xe,{class:"color-success mr-8",style:{"font-size":"16px"}},{default:o(()=>[l(lo)]),_:1}),i("span",Tl,v(e.$t("common.status.enabled")),1)])):(a(),O("div",$l,[l(G,{iconName:"app-disabled",class:"color-secondary mr-8"}),i("span",Cl,v(e.$t("common.status.disabled")),1)]))]),mouseEnter:o(()=>[!g.value&&L(n.id)?(a(),O("div",{key:0,onClick:t[8]||(t[8]=F(()=>{},["stop"]))},[u.value.switch(n.id)?(a(),r(to,{key:0,modelValue:n.isActive,"onUpdate:modelValue":he=>n.isActive=he,"before-change":()=>ce(n),size:"small",class:"mr-4"},null,8,["modelValue","onUpdate:modelValue","before-change"])):C("",!0),l(no,{direction:"vertical"}),l(Me,{trigger:"click"},{dropdown:o(()=>[l(Re,null,{default:o(()=>{var he;return[n.toolType==="MCP"?(a(),r(Z,{key:0,onClick:F(ne=>Je(n),["stop"])},{default:o(()=>[l(G,{iconName:"app-operate-log",class:"color-secondary"}),D(" "+v(e.$t("views.tool.mcpConfig")),1)]),_:2},1032,["onClick"])):C("",!0),n.templateId&&u.value.edit(n.id)?(a(),r(Z,{key:1,onClick:F(ne=>je(n,!0),["stop"])},{default:o(()=>[l(G,{iconName:"app-edit",class:"color-secondary"}),D(" "+v(e.$t("common.edit")),1)]),_:2},1032,["onClick"])):C("",!0),!n.templateId&&u.value.edit(n.id)?(a(),r(Z,{key:2,onClick:F(ne=>J(n),["stop"])},{default:o(()=>[l(G,{iconName:"app-edit",class:"color-secondary"}),D(" "+v(e.$t("common.edit")),1)]),_:2},1032,["onClick"])):C("",!0),!n.templateId&&u.value.copy(n.id)&&n.toolType!=="MCP"?(a(),r(Z,{key:3,onClick:F(ne=>_e(n),["stop"])},{default:o(()=>[l(G,{iconName:"app-copy",class:"color-secondary"}),D(" "+v(e.$t("common.copy")),1)]),_:2},1032,["onClick"])):C("",!0),((he=n.initFieldList)==null?void 0:he.length)>0&&u.value.edit(n.id)?(a(),r(Z,{key:4,onClick:F(ne=>Q(n),["stop"])},{default:o(()=>[l(G,{iconName:"app-operation",class:"color-secondary"}),D(" "+v(e.$t("common.param.initParam")),1)]),_:2},1032,["onClick"])):C("",!0),_.value==="workspace"&&u.value.auth(n.id)?(a(),r(Z,{key:5,onClick:F(ne=>B(n),["stop"])},{default:o(()=>[l(G,{iconName:"app-resource-authorization",class:"color-secondary"}),D(" "+v(e.$t("views.system.resourceAuthorization.title")),1)]),_:2},1032,["onClick"])):C("",!0),w.value?(a(),r(Z,{key:6,onClick:F(ne=>X(n),["stop"])},{default:o(()=>[l(G,{iconName:"app-lock",class:"color-secondary"}),D(" "+v(e.$t("views.shared.authorized_workspace")),1)]),_:2},1032,["onClick"])):C("",!0),!n.templateId&&u.value.export(n.id)&&n.toolType!=="MCP"?(a(),r(Z,{key:7,onClick:F(ne=>ye(n),["stop"])},{default:o(()=>[l(G,{iconName:"app-export",class:"color-secondary"}),D(" "+v(e.$t("common.export")),1)]),_:2},1032,["onClick"])):C("",!0),u.value.delete(n.id)?(a(),r(Z,{key:8,divided:"",onClick:F(ne=>S(n),["stop"])},{default:o(()=>[l(G,{iconName:"app-delete",class:"color-secondary"}),D(" "+v(e.$t("common.delete")),1)]),_:2},1032,["onClick"])):C("",!0)]}),_:2},1024)]),default:o(()=>[l(Ae,{text:"",onClick:t[7]||(t[7]=F(()=>{},["stop"]))},{default:o(()=>[l(G,{iconName:"app-more"})]),_:1})]),_:2},1024)])):C("",!0)]),_:2},1032,["title","description","onClick","disabled"])]),_:2},1024))),128))]),_:1})):(a(),r(io,{key:1,description:e.$t("common.noData")},null,8,["description"]))]),_:1},8,["size","total","page_size","current_page","loading"])])),[[ro,A.current_page===1&&I.value,void 0,{fullscreen:!0,lock:!0}]])]),_:3}),l(Do,{ref_key:"InitParamDrawerRef",ref:z,onRefresh:de},null,512),l(Lo,{ref_key:"ToolFormDrawerRef",ref:h,onRefresh:de,title:H.value},null,8,["title"]),l(Uo,{ref_key:"McpToolFormDrawerRef",ref:x,onRefresh:de,title:ie.value},null,8,["title"]),g.value?C("",!0):(a(),r(bo,{key:0,ref_key:"CreateFolderDialogRef",ref:Qe,onRefresh:Ge},null,512)),l(il,{ref_key:"toolStoreDialogRef",ref:ue,"api-type":_.value,onRefresh:de},null,8,["api-type"]),l(Oe,{ref_key:"AddInternalToolDialogRef",ref:ee,onRefresh:Ke},null,512),l(cl,{ref_key:"McpToolConfigDialogRef",ref:Ie,onRefresh:de},null,512),w.value?(a(),r(So,{key:1,ref_key:"AuthorizedWorkspaceDialogRef",ref:Y},null,512)):C("",!0),_.value==="workspace"?(a(),r(Io,{key:2,ref_key:"MoveToDialogRef",ref:k,source:K(Fe).TOOL,onRefresh:c},null,8,["source"])):C("",!0),_.value==="workspace"?(a(),r(Vo,{key:3,type:K(Fe).TOOL,ref_key:"ResourceAuthorizationDrawerRef",ref:V},null,8,["type"])):C("",!0)],64)}}});export{Al as _};
