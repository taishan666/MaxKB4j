import{ay as j,az as z,bi as J,aB as d,bn as C,b5 as X,bq as Y,aD as b,bo as Z,ba as W,aF as r,aI as v,aH as y,cN as Q,aJ as E,aG as i,bp as ee,aE as c,cO as te,ck as ae,bk as oe,bj as D,aK as f,bl as K,bt as s,bX as n,bZ as a,bY as ne,cn as se,bU as le,cr as re}from"./chat-BvM2GaQg.js";import{_ as ue,a as de,b as ie}from"./KnowledgeBase.vue_vue_type_script_setup_true_lang-DHqSMPf2.js";const ce={class:"upload-document p-12-24"},_e={class:"flex align-center mb-16"},me={style:{display:"inline-block"}},pe={class:"upload-document__main flex"},Ee={class:"upload-document__component main-calc-height"},ge={class:"upload-component p-24",style:{"min-width":"850px"}},ke={class:"upload-document__footer text-right border-t"},we=j({__name:"ImportWorkflowDocument",setup(ve){se("upload",(e,l)=>re.postUploadFile(e,t,"KNOWLEDGE",l));const w=z(),g=J(),$=d(0),{params:{folderId:_},query:{id:t}}=g,S=C(()=>g.path.includes("shared")?"systemShare":g.path.includes("resource-management")?"systemManage":"workspace"),T={dataSource:ie,knowledgeBase:de,result:ue},u=d(!1),m=d(),O=d(),R=d({}),o=d("dataSource"),p=d(null),A=C(()=>{var l,h;const e=(h=(l=p.value)==null?void 0:l.nodes)==null?void 0:h.find(N=>N.type===X.KnowledgeBase);return e?e.properties.user_input_field_list:[]}),I=()=>{m.value.validate().then(()=>{R.value[o.value]=m.value.get_data(),o.value="knowledgeBase"})},L=()=>{m.value.validate().then(()=>{o.value="dataSource"})},M=()=>{m.value.validate().then(()=>{R.value[o.value]=m.value.get_data(),K({type:"knowledge",systemType:S.value}).workflowUpload(t,R.value,u).then(e=>{O.value=e.data.id,o.value="result"})})};function G(){K({type:"knowledge",systemType:S.value}).getKnowledgeDetail(t,u).then(e=>{p.value=e.data.workFlow})}const U=()=>{o.value="dataSource",$.value++,O.value=void 0;const e=p.value;p.value=null,R.value={},le(()=>{p.value=e})},B=()=>{w.push({path:`/knowledge/${t}/${_}/2/document`})},H=()=>g.path.includes("resource-management")?w.push({path:x()}):g.path.includes("shared")?w.push({path:P()}):w.push({path:V()}),P=()=>s([n.ADMIN,a.SHARED_KNOWLEDGE_DOCUMENT_READ],"OR")?`/knowledge/${t}/shared/2/document`:s([n.ADMIN,a.SHARED_KNOWLEDGE_PROBLEM_READ],"OR")?`/knowledge/${t}/shared/2/problem`:s([n.ADMIN,a.SHARED_KNOWLEDGE_HIT_TEST_READ],"OR")?`/knowledge/${t}/shared/2/hit-test`:s([n.ADMIN,a.SHARED_KNOWLEDGE_CHAT_USER_READ],"OR")?`/knowledge/${t}/shared/2/chat-user`:s([n.ADMIN,a.SHARED_KNOWLEDGE_EDIT],"OR")?`/knowledge/${t}/shared/2/setting`:"/system/shared/knowledge",x=()=>s([n.ADMIN,a.RESOURCE_KNOWLEDGE_DOCUMENT_READ],"OR")?`/knowledge/${t}/resource-management/2/document`:s([n.ADMIN,a.RESOURCE_KNOWLEDGE_PROBLEM_READ],"OR")?`/knowledge/${t}/resource-management/2/problem`:s([n.ADMIN,a.RESOURCE_KNOWLEDGE_HIT_TEST],"OR")?`/knowledge/${t}/resource-management/2/hit-test`:s([n.ADMIN,a.RESOURCE_KNOWLEDGE_CHAT_USER_READ],"OR")?`/knowledge/${t}/resource-management/2/chat-user`:s([n.ADMIN,a.RESOURCE_KNOWLEDGE_EDIT],"OR")?`/knowledge/${t}/resource-management/2/setting`:"/system/resource-management/knowledge",V=()=>{const e=l=>s([new ne([n.USER],[a.KNOWLEDGE.getKnowledgeWorkspaceResourcePermission(t)],[],"AND"),n.WORKSPACE_MANAGE.getWorkspaceRole,l.getWorkspacePermissionWorkspaceManageRole,l.getKnowledgeWorkspaceResourcePermission(t)],"OR");return e(a.KNOWLEDGE_DOCUMENT_READ)?`/knowledge/${t}/${_}/2/document`:e(a.KNOWLEDGE_PROBLEM_READ)?`/knowledge/${t}/${_}/2/problem`:e(a.KNOWLEDGE_HIT_TEST_READ)?`/knowledge/${t}/${_}/2/hit-test`:e(a.KNOWLEDGE_CHAT_USER_READ)?`/knowledge/${t}/${_}/2/chat-user`:e(a.KNOWLEDGE_EDIT)?`/knowledge/${t}/${_}/2/setting`:"/knowledge"};return Y(()=>{G()}),(e,l)=>{const h=b("el-scrollbar"),N=b("el-card"),k=b("el-button"),F=Z("loading");return r(),W("div",ce,[v("div",_e,[y(Q,{onClick:H,style:{"margin-left":"-4px"}}),v("h3",me,E(e.$t("views.document.importDocument")),1)]),y(N,{style:{"--el-card-padding":"0"}},{default:i(()=>[ee((r(),W("div",pe,[v("div",Ee,[y(h,null,{default:i(()=>[v("div",ge,[(r(),c(te,{key:$.value,include:["dataSource","knowledgeBase"]},[(r(),c(ae(T[o.value]),{ref_key:"ActionRef",ref:m,loading:u.value,"onUpdate:loading":l[0]||(l[0]=q=>u.value=q),workflow:p.value,knowledgeId:oe(t),id:O.value},null,40,["loading","workflow","knowledgeId","id"]))],1024))])]),_:1})])])),[[F,u.value]])]),_:1}),v("div",ke,[o.value=="result"?(r(),c(k,{key:0,onClick:U},{default:i(()=>[f(E(e.$t("views.document.buttons.continueImporting")),1)]),_:1})):D("",!0),A.value.length>0&&o.value=="knowledgeBase"?(r(),c(k,{key:1,loading:u.value,onClick:L},{default:i(()=>[f(E(e.$t("common.steps.prev")),1)]),_:1},8,["loading"])):D("",!0),A.value.length>0&&o.value=="dataSource"?(r(),c(k,{key:2,disabled:u.value,onClick:I},{default:i(()=>[f(E(e.$t("common.steps.next")),1)]),_:1},8,["disabled"])):D("",!0),(A.value.length>0?o.value=="knowledgeBase":o.value=="dataSource")?(r(),c(k,{key:3,onClick:M,type:"primary",disabled:u.value},{default:i(()=>[f(E(e.$t("views.document.buttons.import")),1)]),_:1},8,["disabled"])):D("",!0),o.value=="result"?(r(),c(k,{key:4,type:"primary",onClick:B},{default:i(()=>[f(E(e.$t("views.knowledge.ResultSuccess.buttons.toDocument")),1)]),_:1})):D("",!0)])])}}});export{we as default};
