import{bn as ne,d6 as ke,ay as se,aB as i,aD as s,aE as y,aF as r,aG as t,aI as n,aH as a,aJ as u,bj as N,aK as V,aA as $e,bg as Ve,aC as v,bs as Le,bq as De,bc as h,br as Ce,bd as te,bh as M,bi as z,bo as oe,cd as xe,d2 as Oe,co as Te}from"./chat-BFw4auTk.js";import{W as Se}from"./workspace-CWPFNlmc.js";const B="/operate_log",Me=(L,b,d)=>ne(`${B}/${L.current_page}/${L.page_size}`,b,d),ze=()=>ne(`${B}/menu_operation_option/`,void 0,void 0),Ee=(L,b)=>{ke("log.xlsx",`${B}/export/`,L,void 0,b)},F={getOperateLog:Me,getMenuList:ze,exportOperateLog:Ee},Ne={class:"border border-r-6 mb-16",style:{"white-space":"pre-wrap",height:"400px"}},Ue={class:"p-16"},Ye={class:"dialog-footer mt-16"},je=se({__name:"DetailDialog",setup(L,{expose:b}){const d=i(!1),c=i();return b({open:p=>{c.value=JSON.stringify(p.details,null,4),d.value=!0}}),(p,w)=>{const D=s("el-scrollbar"),C=s("el-button"),k=s("el-dialog");return r(),y(k,{title:p.$t("views.operateLog.table.opt.label"),modelValue:d.value,"onUpdate:modelValue":w[1]||(w[1]=T=>d.value=T),"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:t(()=>[n("span",Ye,[a(C,{onClick:w[0]||(w[0]=N(T=>d.value=!1,["prevent"]))},{default:t(()=>[V(u(p.$t("views.operateLog.close")),1)]),_:1})])]),default:t(()=>[n("div",Ne,[a(D,null,{default:t(()=>[n("div",Ue,u(c.value),1)]),_:1})])]),_:1},8,["title","modelValue"])}}}),Ae={class:"operate-log p-16-24"},Fe={class:"mb-16"},Be={class:"p-24"},He={class:"flex-between"},Ie={style:{display:"flex"}},Pe={class:"flex-between complex-search"},We={class:"filter"},Je={class:"form-item mb-16"},Re={class:"text-right"},qe={class:"text-ellipsis"},Ge={class:"filter"},Ke={class:"form-item mb-16"},Qe={class:"text-right"},Xe={key:0},Ze={key:1,style:{color:"red"}},el={class:"mr-4"},ll=se({__name:"index",setup(L){const{user:b}=$e(),d=i(!1),c=i([]),O=i(!1),p=i([]),w=i(),D=i(!1),C=Ve({current_page:1,page_size:20,total:0}),k=i(""),T=i([]),E=i(7),$=i("user"),U=i(""),x=i({startTime:"",endTime:""}),H=i(""),ie=[{value:7,label:v("views.applicationOverview.monitor.pastDayOptions.past7Days")},{value:30,label:v("views.applicationOverview.monitor.pastDayOptions.past30Days")},{value:90,label:v("views.applicationOverview.monitor.pastDayOptions.past90Days")},{value:183,label:v("views.applicationOverview.monitor.pastDayOptions.past183Days")},{value:"other",label:v("common.custom")}],re=[{value:"user",label:v("views.operateLog.table.user.label")},{value:"status",label:v("views.operateLog.table.status.label")},{value:"ip_address",label:v("views.operateLog.table.ip_address.label")}],ue=[{value:"200",label:v("views.operateLog.table.status.success")},{value:"500",label:v("views.operateLog.table.status.fail")}],I=i([]),P=i([]);function W(e){e==="clear"&&(c.value=[]),m(),d.value=!1}function J(e){e==="clear"&&(p.value=[]),m(),O.value=!1}function pe(e){m()}function de(e){$.value=e,k.value&&m()}function R(e){e!=="other"&&(x.value.startTime=Oe(e),x.value.endTime="",m())}function ce(e){x.value.startTime=e[0],x.value.endTime=e[1],m()}function ve(e){w.value.open(e)}function me(){C.current_page=1,m()}function q(){let e={startTime:x.value.startTime,endTime:x.value.endTime};return k.value&&$.value!=="status"&&(e[$.value]=k.value),$.value==="status"&&(e.status=U.value),c.value.length>0&&(e.menu=JSON.stringify(c.value)),p.value.length>0&&(e.workspace_ids=JSON.stringify(p.value)),e}function m(){return F.getOperateLog(C,q(),D).then(e=>{T.value=e.data.records,C.total=e.data.total})}function be(){return F.getMenuList().then(e=>{e.data.filter((_,S,Y)=>S===Y.findIndex(j=>j.menu===_.menu)).forEach(_=>{I.value.push({label:_.menu_label,value:_.menu})})})}const _e=()=>{F.exportOperateLog(q(),D)};async function fe(){if(b.isEE()){const e=await Se.getSystemWorkspaceList(D);P.value=e.data.map(o=>({label:o.name,value:o.id}))}}return Le(()=>{be(),fe(),R(E.value)}),(e,o)=>{const _=s("el-option"),S=s("el-select"),Y=s("el-date-picker"),j=s("el-input"),f=s("el-button"),G=s("Filter"),K=s("el-icon"),Q=s("el-checkbox"),X=s("el-checkbox-group"),Z=s("el-scrollbar"),ee=s("el-popover"),g=s("el-table-column"),le=s("el-tooltip"),ge=s("AppIcon"),he=s("app-table"),ye=s("el-card"),we=De("loading");return r(),h("div",Ae,[n("h2",Fe,u(e.$t("views.operateLog.title")),1),a(ye,{style:{"--el-card-padding":"0"},class:"main-calc-height"},{default:t(()=>[n("div",Be,[n("div",He,[n("div",null,[a(S,{modelValue:E.value,"onUpdate:modelValue":o[0]||(o[0]=l=>E.value=l),class:"mr-12",onChange:R,style:{width:"180px"}},{default:t(()=>[(r(),h(M,null,z(ie,l=>a(_,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),E.value==="other"?(r(),y(Y,{key:0,modelValue:H.value,"onUpdate:modelValue":o[1]||(o[1]=l=>H.value=l),type:"daterange","start-placeholder":e.$t("views.applicationOverview.monitor.startDatePlaceholder"),"end-placeholder":e.$t("views.applicationOverview.monitor.endDatePlaceholder"),format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:ce},null,8,["modelValue","start-placeholder","end-placeholder"])):te("",!0)]),n("div",Ie,[n("div",Pe,[a(S,{modelValue:$.value,"onUpdate:modelValue":o[2]||(o[2]=l=>$.value=l),class:"complex-search__left",onChange:de,style:{width:"120px"}},{default:t(()=>[(r(),h(M,null,z(re,l=>a(_,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),$.value==="status"?(r(),y(S,{key:0,modelValue:U.value,"onUpdate:modelValue":o[3]||(o[3]=l=>U.value=l),onChange:pe,style:{width:"220px"},clearable:""},{default:t(()=>[(r(),h(M,null,z(ue,l=>a(_,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])):(r(),y(j,{key:1,modelValue:k.value,"onUpdate:modelValue":o[4]||(o[4]=l=>k.value=l),onChange:m,placeholder:e.$t("common.search"),"prefix-icon":"Search",style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"]))]),a(f,{onClick:_e,style:{"margin-left":"10px"}},{default:t(()=>[V(u(e.$t("common.export")),1)]),_:1})])]),Ce((r(),y(he,{class:"mt-16",data:T.value,"pagination-config":C,onSizeChange:me,onChangePage:m},{default:t(()=>[a(g,{prop:"menu",label:e.$t("views.operateLog.table.menu.label"),width:"160"},{header:t(()=>[n("div",null,[n("span",null,u(e.$t("views.operateLog.table.menu.label")),1),a(ee,{width:200,trigger:"click",visible:d.value},{reference:t(()=>[a(f,{style:{"margin-top":"-2px"},type:c.value&&c.value.length>0?"primary":"",link:"",onClick:o[5]||(o[5]=l=>d.value=!d.value)},{default:t(()=>[a(K,null,{default:t(()=>[a(G)]),_:1})]),_:1},8,["type"])]),default:t(()=>[n("div",We,[n("div",Je,[n("div",{onClick:o[7]||(o[7]=N(()=>{},["stop"]))},[a(Z,{height:"300",style:{margin:"0 0 0 10px"}},{default:t(()=>[a(X,{modelValue:c.value,"onUpdate:modelValue":o[6]||(o[6]=l=>c.value=l),style:{display:"flex","flex-direction":"column"}},{default:t(()=>[(r(!0),h(M,null,z(I.value,l=>(r(),y(Q,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])])]),n("div",Re,[a(f,{size:"small",onClick:o[8]||(o[8]=l=>W("clear"))},{default:t(()=>[V(u(e.$t("common.clear")),1)]),_:1}),a(f,{type:"primary",onClick:W,size:"small"},{default:t(()=>[V(u(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"])])]),_:1},8,["label"]),a(g,{prop:"operate",label:e.$t("views.operateLog.table.operate.detail")},{default:t(({row:l})=>{var A;return[a(le,{content:l.operate+((A=l.operation_object)!=null&&A.name?`【${l.operation_object.name}】`:""),effect:"dark",placement:"top"},{default:t(()=>{var ae;return[n("span",qe,u(l.operate+((ae=l.operation_object)!=null&&ae.name?`【${l.operation_object.name}】`:"")),1)]}),_:2},1032,["content"])]}),_:1},8,["label"]),a(g,{width:"120",prop:"user.username",label:e.$t("views.operateLog.table.user.label")},null,8,["label"]),oe(b).isEE()?(r(),y(g,{key:0,width:"200",prop:"workspace_name",label:e.$t("views.workspace.title")},{header:t(()=>[n("div",null,[n("span",null,u(e.$t("views.workspace.title")),1),a(ee,{width:200,trigger:"click",visible:O.value},{reference:t(()=>[a(f,{style:{"margin-top":"-2px"},type:p.value&&p.value.length>0?"primary":"",link:"",onClick:o[9]||(o[9]=l=>O.value=!O.value)},{default:t(()=>[a(K,null,{default:t(()=>[a(G)]),_:1})]),_:1},8,["type"])]),default:t(()=>[n("div",Ge,[n("div",Ke,[n("div",{onClick:o[11]||(o[11]=N(()=>{},["stop"]))},[a(Z,{height:"300",style:{margin:"0 0 0 10px"}},{default:t(()=>[a(X,{modelValue:p.value,"onUpdate:modelValue":o[10]||(o[10]=l=>p.value=l),style:{display:"flex","flex-direction":"column"}},{default:t(()=>[(r(!0),h(M,null,z(P.value,l=>(r(),y(Q,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])])]),n("div",Qe,[a(f,{size:"small",onClick:o[12]||(o[12]=l=>J("clear"))},{default:t(()=>[V(u(e.$t("common.clear")),1)]),_:1}),a(f,{type:"primary",onClick:J,size:"small"},{default:t(()=>[V(u(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"])])]),_:1},8,["label"])):te("",!0),a(g,{prop:"status",label:e.$t("views.operateLog.table.status.label"),width:"100"},{default:t(({row:l})=>[l.status===200?(r(),h("span",Xe,u(e.$t("views.operateLog.table.status.success")),1)):(r(),h("span",Ze,u(e.$t("views.operateLog.table.status.fail")),1))]),_:1},8,["label"]),a(g,{prop:"ip_address",label:e.$t("views.operateLog.table.ip_address.label"),width:"160"},null,8,["label"]),a(g,{label:e.$t("views.operateLog.table.operateTime.label"),width:"180"},{default:t(({row:l})=>[V(u(oe(xe)(l.createTime)),1)]),_:1},8,["label"]),a(g,{label:e.$t("common.operation"),width:"60",align:"left",fixed:"right"},{default:t(({row:l})=>[n("span",el,[a(le,{effect:"dark",content:e.$t("views.operateLog.table.opt.label"),placement:"top"},{default:t(()=>[a(f,{type:"primary",text:"",onClick:N(A=>ve(l),["stop"]),class:"text-button"},{default:t(()=>[a(ge,{iconName:"app-operate-log"})]),_:2},1032,["onClick"])]),_:2},1032,["content"])])]),_:1},8,["label"])]),_:1},8,["data","pagination-config"])),[[we,D.value]])]),a(je,{ref_key:"DetailDialogRef",ref:w},null,512)]),_:1})])}}}),ol=Te(ll,[["__scopeId","data-v-97b21d8d"]]);export{ol as default};
