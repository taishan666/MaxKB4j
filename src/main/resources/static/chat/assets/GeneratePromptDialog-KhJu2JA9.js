import{ay as re,bn as Q,bi as fe,aB as o,b_ as Ie,aE as x,aG as e,aD as i,aH as l,cm as Ve,aI as d,bj as G,aK as D,aJ as p,bd as ne,bl as de,aF as S,aC as ee,b8 as Se,b9 as se,c6 as Pe,be as xe,bp as ie,bo as we,cj as ve,cv as _e,aA as be,dZ as Ue,ba as Y,bc as Ce,bb as ke,cf as Te,c0 as Re,d_ as De,ca as Ae,bk as Le,c4 as Ne,br as qe,cU as Oe,cx as $e,cV as Fe,d$ as ze,bU as ye,cr as Ke,c8 as Ee,c9 as He,ci as Be}from"./chat-BvM2GaQg.js";const We={class:"dialog-footer"},zl=re({__name:"AIModeParamSettingDialog",emits:["refresh"],setup(le,{expose:E,emit:H}){const F=fe(),L=Q(()=>F.path.includes("resource-management")?"systemManage":"workspace"),I=o([]),M=H,P=o(),n=o({}),c=o(!1),u=o(!1),f=(a,s)=>de({type:"model",systemType:L.value}).getModelParamsForm(a,u),g=o(""),b=Q(()=>Ie.model[L.value]),N=(a,s,m)=>{g.value=a,n.value={},f(a).then(v=>{var V;I.value=v.data,(V=P.value)==null||V.render(I.value,m)}),c.value=!0},U=(a,s)=>{f(a).then($=>{I.value=$.data;const v=$.data.map(V=>V.show_default_value===!1?{[V.field]:void 0}:{[V.field]:V.default_value}).reduce((V,_)=>({...V,..._}),{});M("refresh",v)})},q=async()=>{var a;(a=P.value)==null||a.validate().then(()=>{M("refresh",n.value),c.value=!1})};return E({open:N,reset_default:U}),(a,s)=>{const m=i("el-button"),$=i("el-dialog");return S(),x($,{"align-center":"",title:a.$t("common.paramSetting"),modelValue:c.value,"onUpdate:modelValue":s[2]||(s[2]=v=>c.value=v),style:{width:"550px"},"append-to-body":"","destroy-on-close":"","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:e(()=>[d("span",We,[l(m,{onClick:s[1]||(s[1]=ne(v=>c.value=!1,["prevent"]))},{default:e(()=>[D(p(a.$t("common.cancel")),1)]),_:1}),b.value.paramSetting(g.value)?(S(),x(m,{key:0,type:"primary",onClick:q,loading:u.value},{default:e(()=>[D(p(a.$t("common.confirm")),1)]),_:1},8,["loading"])):G("",!0)])]),default:e(()=>[l(Ve,{modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=v=>n.value=v),model:n.value,"label-position":"top","require-asterisk-position":"right",render_data:I.value,ref_key:"dynamicsFormRef",ref:P},null,8,["modelValue","model","render_data"])]),_:1},8,["title","modelValue"])}}}),je={class:"p-8"},Ge={class:"mb-4"},Je={class:"mb-4"},Qe={class:"mb-4"},Ze={class:"flex align-center"},Xe={class:"mr-4"},Ye={class:"flex align-center"},el={class:"mr-4"},ll={class:"dialog-footer"},Kl=re({__name:"ParamSettingDialog",emits:["refresh"],setup(le,{expose:E,emit:H}){const F=H,L=o(),I=o(),M={ai_questioning:"{question}",designated_answer:ee("views.application.dialog.designated_answer")},P=ee("views.application.dialog.defaultPrompt1",{question:"{question}"})+"<data></data>"+ee("views.application.dialog.defaultPrompt2"),n=o({knowledgeSetting:{searchMode:"embedding",topN:3,similarity:.6,maxParagraphCharNumber:5e3,noReferencesSetting:{status:"ai_questioning",value:"{question}"}},problemOptimization:!1,problemOptimizationPrompt:P}),c=o({ai_questioning:M.ai_questioning,designated_answer:M.designated_answer}),u=Se({ai_questioning:[{required:!0,message:ee("views.application.form.aiModel.placeholder"),trigger:"blur"}],designated_answer:[{required:!0,message:ee("views.application.form.prompt.requiredMessage"),trigger:"blur"}]}),f=o(!1),g=o(!1),b=o(!1);se(f,a=>{var s;a||(c.value={ai_questioning:M.ai_questioning,designated_answer:M.designated_answer},(s=I.value)==null||s.clearValidate())});const N=(a,s)=>{b.value=Pe(s),n.value={knowledgeSetting:xe.cloneDeep(a.knowledgeSetting),problemOptimization:a.problemOptimization,problemOptimizationPrompt:a.problemOptimizationPrompt},b.value||(c.value[n.value.knowledgeSetting.noReferencesSetting.status]=n.value.knowledgeSetting.noReferencesSetting.value),f.value=!0},U=async a=>{if(b.value)delete n.value.noReferencesSetting,F("refresh",n.value),f.value=!1;else{if(!a)return;await a.validate((s,m)=>{s&&(n.value.knowledgeSetting.noReferencesSetting.value=c.value[n.value.knowledgeSetting.noReferencesSetting.status],F("refresh",n.value),f.value=!1)})}};function q(a){a==="keywords"?n.value.knowledgeSetting.similarity=0:n.value.knowledgeSetting.similarity=.6}return E({open:N}),(a,s)=>{const m=i("el-text"),$=i("el-radio"),v=i("el-card"),V=i("el-radio-group"),_=i("el-form-item"),B=i("el-tooltip"),O=i("el-input-number"),w=i("el-col"),k=i("el-row"),r=i("el-slider"),y=i("el-input"),C=i("el-form"),J=i("el-switch"),K=i("el-scrollbar"),W=i("el-button"),ae=i("el-dialog"),te=we("loading");return S(),x(ae,{class:"scrollbar-dialog","align-center":"",title:a.$t("common.paramSetting"),modelValue:f.value,"onUpdate:modelValue":s[11]||(s[11]=T=>f.value=T),width:"550px","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:e(()=>[d("span",ll,[l(W,{onClick:s[9]||(s[9]=ne(T=>f.value=!1,["prevent"]))},{default:e(()=>[D(p(a.$t("common.cancel")),1)]),_:1}),l(W,{type:"primary",onClick:s[10]||(s[10]=T=>U(I.value)),loading:g.value},{default:e(()=>[D(p(a.$t("common.save")),1)]),_:1},8,["loading"])])]),default:e(()=>[l(K,{"max-height":"550"},{default:e(()=>[d("div",je,[ie((S(),x(C,{"label-position":"top",ref_key:"paramFormRef",ref:L,model:n.value},{default:e(()=>[l(_,{label:a.$t("views.application.dialog.selectSearchMode")},{default:e(()=>[l(V,{modelValue:n.value.knowledgeSetting.searchMode,"onUpdate:modelValue":s[0]||(s[0]=T=>n.value.knowledgeSetting.searchMode=T),class:"card__radio",onChange:q},{default:e(()=>[l(v,{shadow:"never",class:ve(["mb-16",n.value.searchMode==="embedding"?"active":""])},{default:e(()=>[l($,{value:"embedding",size:"large"},{default:e(()=>[d("p",Ge,p(a.$t("views.application.dialog.vectorSearch")),1),l(m,{type:"info"},{default:e(()=>[D(p(a.$t("views.application.dialog.vectorSearchTooltip")),1)]),_:1})]),_:1})]),_:1},8,["class"]),l(v,{shadow:"never",class:ve(["mb-16",n.value.knowledgeSetting.searchMode==="keywords"?"active":""])},{default:e(()=>[l($,{value:"keywords",size:"large"},{default:e(()=>[d("p",Je,p(a.$t("views.application.dialog.fullTextSearch")),1),l(m,{type:"info"},{default:e(()=>[D(p(a.$t("views.application.dialog.fullTextSearchTooltip")),1)]),_:1})]),_:1})]),_:1},8,["class"]),l(v,{shadow:"never",class:ve(n.value.knowledgeSetting.searchMode==="hybrid"?"active":"")},{default:e(()=>[l($,{value:"hybrid",size:"large"},{default:e(()=>[d("p",Qe,p(a.$t("views.application.dialog.hybridSearch")),1),l(m,{type:"info"},{default:e(()=>[D(p(a.$t("views.application.dialog.hybridSearchTooltip")),1)]),_:1})]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(k,{gutter:10},{default:e(()=>[l(w,{span:12},{default:e(()=>[l(_,null,{label:e(()=>[d("div",Ze,[d("span",Xe,p(a.$t("views.application.dialog.similarityThreshold")),1),l(B,{effect:"dark",content:a.$t("views.application.dialog.similarityTooltip"),placement:"right"},{default:e(()=>[l(_e,{iconName:"app-warning",class:"app-warning-icon"})]),_:1},8,["content"])])]),default:e(()=>[l(O,{modelValue:n.value.knowledgeSetting.similarity,"onUpdate:modelValue":s[1]||(s[1]=T=>n.value.knowledgeSetting.similarity=T),min:0,max:n.value.knowledgeSetting.searchMode==="hybrid"?2:1,precision:3,step:.1,"value-on-clear":0,"controls-position":"right",class:"w-full"},null,8,["modelValue","max"])]),_:1})]),_:1}),l(w,{span:12},{default:e(()=>[l(_,{label:a.$t("views.application.dialog.topReferences")},{default:e(()=>[l(O,{modelValue:n.value.knowledgeSetting.topN,"onUpdate:modelValue":s[2]||(s[2]=T=>n.value.knowledgeSetting.topN=T),min:1,max:1e4,"value-on-clear":1,"controls-position":"right",class:"w-full"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),l(_,{label:a.$t("views.application.dialog.maxCharacters")},{default:e(()=>[l(r,{modelValue:n.value.knowledgeSetting.maxParagraphCharNumber,"onUpdate:modelValue":s[3]||(s[3]=T=>n.value.knowledgeSetting.maxParagraphCharNumber=T),"show-input":"","show-input-controls":!1,min:500,max:1e5,class:"custom-slider"},null,8,["modelValue"])]),_:1},8,["label"]),b.value?G("",!0):(S(),x(_,{key:0,label:a.$t("views.application.dialog.noReferencesAction")},{default:e(()=>[l(C,{"label-position":"top",ref_key:"noReferencesFormRef",ref:I,model:c.value,rules:u,"hide-required-asterisk":!0,class:"w-full"},{default:e(()=>[l(V,{modelValue:n.value.knowledgeSetting.noReferencesSetting.status,"onUpdate:modelValue":s[5]||(s[5]=T=>n.value.knowledgeSetting.noReferencesSetting.status=T),class:"radio-block-avatar"},{default:e(()=>[l($,{value:"ai_questioning"},{default:e(()=>[d("p",null,p(a.$t("views.application.dialog.continueQuestioning")),1)]),_:1}),l($,{value:"designated_answer"},{default:e(()=>[d("p",null,p(a.$t("views.application.dialog.provideAnswer")),1),n.value.knowledgeSetting.noReferencesSetting.status==="designated_answer"?(S(),x(_,{key:0,prop:"designated_answer"},{default:e(()=>[l(y,{modelValue:c.value.designated_answer,"onUpdate:modelValue":s[4]||(s[4]=T=>c.value.designated_answer=T),rows:2,type:"textarea",maxlength:"2048",placeholder:M.designated_answer},null,8,["modelValue","placeholder"])]),_:1})):G("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["model","rules"])]),_:1},8,["label"])),b.value?G("",!0):(S(),x(_,{key:1,onClick:s[7]||(s[7]=ne(()=>{},["prevent"]))},{label:e(()=>[d("div",Ye,[d("span",el,p(a.$t("views.application.form.problemOptimization.label")),1)])]),default:e(()=>[l(J,{size:"small",modelValue:n.value.problemOptimization,"onUpdate:modelValue":s[6]||(s[6]=T=>n.value.problemOptimization=T)},null,8,["modelValue"])]),_:1})),n.value.problemOptimization?(S(),x(_,{key:2,label:a.$t("views.application.form.prompt.label")},{default:e(()=>[l(y,{modelValue:n.value.problemOptimizationPrompt,"onUpdate:modelValue":s[8]||(s[8]=T=>n.value.problemOptimizationPrompt=T),rows:6,type:"textarea",maxlength:"2048",placeholder:P},null,8,["modelValue"])]),_:1},8,["label"])):G("",!0)]),_:1},8,["model"])),[[te,g.value]])])]),_:1})]),_:1},8,["title","modelValue"])}}}),al={class:"flex-between mb-8"},tl={class:"flex"},ol=["id"],nl={class:"p-8"},sl={class:"layout-bg"},il={class:"flex-between p-16 ml-8"},rl={class:"p-16-24 pt-0",style:{height:"calc(100vh - 200px)"}},ul=["title"],dl={class:"flex-between"},cl={class:"flex"},El=re({__name:"AddKnowledgeDialog",props:{data:{type:Array,default:()=>[]},loading:Boolean},emits:["addData"],setup(le,{expose:E,emit:H}){const F=fe(),L=le,I=H,{folder:M,user:P}=be(),n=Q(()=>F.path.includes("shared")?"systemShare":F.path.includes("resource-management")?"systemManage":"workspace"),c=o(!1),u=o([]),f=o(""),g=o(""),b=o([]),N=o([]),U=o(!1),q=Q(()=>f.value?b.value.filter(r=>r.embeddingModelId===f.value):b.value);se(c,r=>{r||(u.value=[],f.value="",g.value="",b.value=[],N.value=[])}),se(g,r=>{r?b.value=N.value.filter(y=>{var C;return y.name.includes(r)&&y.folderId===((C=_.value)==null?void 0:C.id)}):b.value=N.value.filter(y=>{var C;return y.folderId===((C=_.value)==null?void 0:C.id)})});function a(){var r,y;u.value.length>0?f.value=(y=(r=N.value)==null?void 0:r.find(C=>C.id===u.value[0]))==null?void 0:y.embeddingModelId:u.value.length===0&&(f.value="")}function s(){u.value=[],f.value=""}const m=r=>{u.value=r,w(),u.value.length>0&&(f.value=L.data.filter(y=>y.id===u.value[0])[0].embeddingModelId),c.value=!0},$=()=>{I("addData",N.value.filter(r=>u.value.includes(r.id))),c.value=!1},v=()=>{g.value="",N.value=[],k()},V=o([]),_=o({}),B=o(!1);function O(r){var y;r.id!==((y=_.value)==null?void 0:y.id)&&(_.value=r,k())}function w(){const r={};M.asyncGetFolder("KNOWLEDGE",r,B).then(y=>{var C;V.value=y.data,_.value=((C=y.data)==null?void 0:C[0])||{},k()})}function k(){var y;const r=((y=_.value)==null?void 0:y.id)||P.getWorkspaceId();de({type:"knowledge",isShared:r==="share",systemType:n.value}).getKnowledgeList({folderId:r},U).then(C=>{N.value=Ue([...N.value,...C.data],"id"),b.value=C.data})}return E({open:m}),(r,y)=>{const C=i("el-text"),J=i("Refresh"),K=i("el-icon"),W=i("el-button"),ae=i("el-input"),te=i("el-col"),T=i("el-row"),Z=i("el-empty"),oe=i("el-scrollbar"),ce=i("el-dialog"),ue=we("loading");return S(),x(ce,{title:r.$t("views.application.dialog.addKnowledge"),modelValue:c.value,"onUpdate:modelValue":y[3]||(y[3]=t=>c.value=t),width:"1000","append-to-body":"",class:"addKnowledge-dialog","align-center":"","close-on-click-modal":!1,"close-on-press-escape":!1},{header:e(({titleId:t,titleClass:h})=>[d("div",al,[d("div",tl,[d("h4",{id:t,class:ve([h,"mr-8"])},p(r.$t("views.application.dialog.addKnowledge")),11,ol),l(C,{type:"info"},{default:e(()=>[D(p(r.$t("views.application.dialog.addKnowledgePlaceholder")),1)]),_:1})]),l(W,{link:"",class:"mr-24",onClick:v},{default:e(()=>[l(K,{size:18},{default:e(()=>[l(J)]),_:1})]),_:1})])]),footer:e(()=>[d("div",dl,[d("div",cl,[u.value.length>0?(S(),x(C,{key:0,type:"info",class:"color-secondary mr-8"},{default:e(()=>[D(p(r.$t("common.selected"))+" "+p(u.value.length),1)]),_:1})):G("",!0),u.value.length>0?(S(),x(W,{key:1,link:"",type:"primary",onClick:s},{default:e(()=>[D(p(r.$t("common.clear")),1)]),_:1})):G("",!0)]),d("span",null,[l(W,{onClick:y[2]||(y[2]=ne(t=>c.value=!1,["prevent"]))},{default:e(()=>[D(p(r.$t("common.cancel")),1)]),_:1}),l(W,{type:"primary",onClick:$},{default:e(()=>[D(p(r.$t("common.add")),1)]),_:1})])])]),default:e(()=>[l(Re,{showCollapse:"",class:"application-manage"},{left:e(()=>{var t;return[d("div",nl,[ie(l(Te,{data:V.value,currentNodeKey:(t=_.value)==null?void 0:t.id,onHandleNodeClick:O,canOperation:!1,showShared:"",shareTitle:r.$t("views.shared.shared_knowledge"),treeStyle:{height:"calc(100vh - 240px)"}},null,8,["data","currentNodeKey","shareTitle"]),[[ue,B.value]])])]}),default:e(()=>{var t;return[d("div",sl,[d("div",il,[d("h4",null,p((t=_.value)==null?void 0:t.name),1),l(ae,{modelValue:g.value,"onUpdate:modelValue":y[0]||(y[0]=h=>g.value=h),placeholder:r.$t("common.search"),"prefix-icon":"Search",class:"w-240 mr-8",clearable:""},null,8,["modelValue","placeholder"])]),l(oe,null,{default:e(()=>[d("div",rl,[q.value.length?ie((S(),x(T,{key:0,gutter:12},{default:e(()=>[(S(!0),Y(ke,null,Ce(q.value.filter(h=>h.resourceType!=="folder"),(h,z)=>(S(),x(te,{span:8,key:z,class:"mb-16"},{default:e(()=>[l(De,{"value-field":"id",data:h,modelValue:u.value,"onUpdate:modelValue":y[1]||(y[1]=A=>u.value=A),onChange:a},{default:e(()=>[d("span",{class:"ellipsis cursor ml-12",title:h.name},p(h.name),9,ul)]),_:2},1032,["data","modelValue"])]),_:2},1024))),128))]),_:1})),[[ue,U.value]]):(S(),x(Z,{key:1,description:r.$t("common.noData")},null,8,["description"]))])]),_:1})])]}),_:1})]),_:1},8,["title","modelValue"])}}}),pl={class:"flex-between"},ml={class:"dialog-footer"},Hl=re({__name:"TTSModeParamSettingDialog",emits:["refresh"],setup(le,{expose:E,emit:H}){const F=fe(),{params:{id:L}}=F,I=Q(()=>F.path.includes("resource-management")?"systemManage":"workspace"),M=o(""),P=o([]),n=H,c=o(),u=o({}),f=o(!1),g=o(!1),b=o(!1),N=(m,$,v)=>{u.value={},M.value=m,de({type:"model",systemType:I.value}).getModelParamsForm(m,g).then(V=>{var B;P.value=V.data;const _=V.data.map(O=>({[O.field]:O.show_default_value!==!1?O.default_value:void 0})).reduce((O,w)=>({...O,...w}),{});v&&Object.keys(v).forEach(O=>{O in _||delete v[O]}),v={..._,...v},(B=c.value)==null||B.render(P.value,v)}),f.value=!0},U=(m,$)=>{de({type:"model",systemType:I.value}).getModelParamsForm(m,g).then(v=>{P.value=v.data;const V=v.data.map(_=>({[_.field]:_.show_default_value!==!1?_.default_value:void 0})).reduce((_,B)=>({..._,...B}),{});console.log("model_setting_data: ",V),n("refresh",V)})},q=async()=>{var m;(m=c.value)==null||m.validate().then(()=>{n("refresh",u.value),f.value=!1})},a=o(null),s=()=>{const m={...u.value,ttsModelId:M.value};de({type:"application",systemType:I.value}).playDemoText(L,m,b).then(async $=>{if($.type==="application/json"){const _=await $.text();Ae(_);return}const v=new Blob([$],{type:"audio/mp3"}),V=URL.createObjectURL(v);a.value instanceof HTMLAudioElement?(a.value.src=V,a.value.play()):console.error("audioPlayer.value is not an instance of HTMLAudioElement")}).catch($=>{console.log("err: ",$)})};return E({open:N,reset_default:U}),(m,$)=>{const v=i("el-button"),V=i("el-dialog");return S(),Y(ke,null,[l(V,{"align-center":"",title:m.$t("common.paramSetting"),modelValue:f.value,"onUpdate:modelValue":$[2]||($[2]=_=>f.value=_),style:{width:"550px"},"append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:e(()=>[d("div",pl,[l(v,{onClick:s,loading:b.value},{default:e(()=>[l(_e,{iconName:"app-video-play",class:"mr-4"}),D(" "+p(m.$t("views.application.form.voicePlay.listeningTest")),1)]),_:1},8,["loading"]),d("span",ml,[l(v,{onClick:$[1]||($[1]=ne(_=>f.value=!1,["prevent"]))},{default:e(()=>[D(p(m.$t("common.cancel")),1)]),_:1}),l(v,{type:"primary",onClick:q,loading:g.value},{default:e(()=>[D(p(m.$t("common.confirm")),1)]),_:1},8,["loading"])])])]),default:e(()=>[l(Ve,{modelValue:u.value,"onUpdate:modelValue":$[0]||($[0]=_=>u.value=_),model:u.value,"label-position":"top","require-asterisk-position":"right",render_data:P.value,ref_key:"dynamicsFormRef",ref:c},null,8,["modelValue","model","render_data"])]),_:1},8,["title","modelValue"]),d("audio",{ref_key:"audioPlayer",ref:a,controls:"",hidden:"hidden"},null,512)],64)}}}),vl={class:"dialog-footer p-16"},Bl=re({__name:"ReasoningParamSettingDialog",emits:["refresh"],setup(le,{expose:E,emit:H}){const F=H,L=o({reasoningContent_start:"<think>",reasoningContent_end:"</think>"}),I=o(!1),M=o(!1);se(I,c=>{c||(L.value={reasoningContent_start:"<think>",reasoningContent_end:"</think>"})});const P=c=>{L.value={...L.value,...c},I.value=!0},n=()=>{F("refresh",L.value),I.value=!1};return E({open:P}),(c,u)=>{const f=i("el-text"),g=i("el-input"),b=i("el-form-item"),N=i("el-col"),U=i("el-row"),q=i("el-form"),a=i("el-button"),s=i("el-dialog");return S(),x(s,{"align-center":"",title:c.$t("common.setting"),class:"param-dialog",modelValue:I.value,"onUpdate:modelValue":u[4]||(u[4]=m=>I.value=m),style:{width:"550px"},"append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:e(()=>[d("span",vl,[l(a,{onClick:u[2]||(u[2]=ne(m=>I.value=!1,["prevent"]))},{default:e(()=>[D(p(c.$t("common.cancel")),1)]),_:1}),l(a,{type:"primary",onClick:u[3]||(u[3]=m=>n()),loading:M.value},{default:e(()=>[D(p(c.$t("common.save")),1)]),_:1},8,["loading"])])]),default:e(()=>[l(q,{"label-position":"top",ref:"paramFormRef",model:L.value},{default:e(()=>[l(f,{type:"info",class:"color-secondary"},{default:e(()=>[D(p(c.$t("views.application.form.reasoningContent.tooltip")),1)]),_:1}),l(U,{class:"mt-16",gutter:20},{default:e(()=>[l(N,{span:12},{default:e(()=>[l(b,{label:c.$t("views.application.form.reasoningContent.start")},{default:e(()=>[l(g,{type:"textarea",modelValue:L.value.reasoningContent_start,"onUpdate:modelValue":u[0]||(u[0]=m=>L.value.reasoningContent_start=m),rows:6,maxlength:"50",placeholder:"<think>"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),l(N,{span:12},{default:e(()=>[l(b,{label:c.$t("views.application.form.reasoningContent.end")},{default:e(()=>[l(g,{type:"textarea",modelValue:L.value.reasoningContent_end,"onUpdate:modelValue":u[1]||(u[1]=m=>L.value.reasoningContent_end=m),rows:6,maxlength:"50",placeholder:"</think>"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])}}}),fl={class:"flex-between mb-8"},gl={class:"flex"},_l=["id"],hl={class:"p-8"},yl={class:"layout-bg"},wl={class:"flex-between p-16 ml-8"},bl={class:"p-16-24 pt-0",style:{height:"calc(100vh - 200px)"}},kl=["src"],$l=["title"],Vl={class:"flex-between"},Sl={class:"flex"},Wl=re({__name:"ToolDialog",emits:["refresh"],setup(le,{expose:E,emit:H}){const F=fe(),L=H,{folder:I,user:M}=be();Q(()=>F.path.includes("shared")?"systemShare":F.path.includes("resource-management")?"systemManage":"workspace");const P=o(!1),n=o([]),c=o(""),u=o([]),f=o([]),g=o("CUSTOM"),b=o(!1);se(P,w=>{w||(n.value=[],c.value="",u.value=[],f.value=[])}),se(c,w=>{w?u.value=f.value.filter(k=>k.name.includes(w)&&k.toolType===g.value):u.value=f.value.filter(k=>k.toolType===g.value)});function N(){}function U(){n.value=[]}const q=w=>{n.value=w||[],B(),P.value=!0},a=()=>{L("refresh",{toolIds:n.value}),P.value=!1},s=()=>{c.value="",f.value=[],O()};function m(){u.value=f.value.filter(w=>w.name.includes(c.value)&&w.toolType===g.value)}const $=o([]),v=o({}),V=o(!1);function _(w){var k;w.id!==((k=v.value)==null?void 0:k.id)&&(v.value=w,O())}function B(){const w={};I.asyncGetFolder("TOOL",w,V).then(k=>{var r;$.value=k.data,v.value=((r=k.data)==null?void 0:r[0])||{},O()})}function O(){var k;const w=((k=v.value)==null?void 0:k.id)||M.getWorkspaceId();de({type:"tool",isShared:w==="share",systemType:"workspace"}).getToolList({folderId:w}).then(r=>{var y,C,J;f.value=((y=r.data)==null?void 0:y.tools)||r.data||[],f.value=(C=f.value)==null?void 0:C.filter(K=>K.isActive),u.value=r.data.tools||r.data,u.value=(J=u.value)==null?void 0:J.filter(K=>K.isActive&&K.toolType===g.value)})}return E({open:q}),(w,k)=>{const r=i("Refresh"),y=i("el-icon"),C=i("el-button"),J=i("el-divider"),K=i("el-radio-button"),W=i("el-radio-group"),ae=i("el-input"),te=i("el-avatar"),T=i("ToolIcon"),Z=i("el-col"),oe=i("el-row"),ce=i("el-empty"),ue=i("el-scrollbar"),t=i("el-text"),h=i("el-dialog"),z=we("loading");return S(),x(h,{modelValue:P.value,"onUpdate:modelValue":k[4]||(k[4]=A=>P.value=A),width:"1000","append-to-body":"",class:"addTool-dialog","align-center":"","close-on-click-modal":!1,"close-on-press-escape":!1},{header:e(({titleId:A,titleClass:R})=>[d("div",fl,[d("div",gl,[d("h4",{id:A,class:ve([R,"mr-8"])},p(w.$t("views.tool.settingTool")),11,_l)]),l(C,{link:"",class:"mr-24",onClick:s},{default:e(()=>[l(y,{size:18},{default:e(()=>[l(r)]),_:1})]),_:1})])]),footer:e(()=>[d("div",Vl,[d("div",Sl,[n.value.length>0?(S(),x(t,{key:0,type:"info",class:"color-secondary mr-8"},{default:e(()=>[D(p(w.$t("common.selected"))+" "+p(n.value.length),1)]),_:1})):G("",!0),n.value.length>0?(S(),x(C,{key:1,link:"",type:"primary",onClick:U},{default:e(()=>[D(p(w.$t("common.clear")),1)]),_:1})):G("",!0)]),d("span",null,[l(C,{onClick:k[3]||(k[3]=ne(A=>P.value=!1,["prevent"]))},{default:e(()=>[D(p(w.$t("common.cancel")),1)]),_:1}),l(C,{type:"primary",onClick:a},{default:e(()=>[D(p(w.$t("common.add")),1)]),_:1})])])]),default:e(()=>[l(Re,{showCollapse:"",class:"application-manage"},{left:e(()=>{var A;return[d("div",hl,[ie(l(Te,{data:$.value,currentNodeKey:(A=v.value)==null?void 0:A.id,onHandleNodeClick:_,canOperation:!1,showShared:"",shareTitle:w.$t("views.shared.shared_tool"),treeStyle:{height:"calc(100vh - 240px)"}},null,8,["data","currentNodeKey","shareTitle"]),[[z,V.value]])])]}),default:e(()=>{var A;return[d("div",yl,[d("div",wl,[d("h4",null,p((A=v.value)==null?void 0:A.name),1),l(J,{direction:"vertical"}),l(W,{modelValue:g.value,"onUpdate:modelValue":k[0]||(k[0]=R=>g.value=R),onChange:m,class:"app-radio-button-group"},{default:e(()=>[l(K,{value:"CUSTOM"},{default:e(()=>[D(p(w.$t("views.tool.title")),1)]),_:1}),l(K,{value:"MCP"},{default:e(()=>k[5]||(k[5]=[D("MCP",-1)])),_:1,__:[5]})]),_:1},8,["modelValue"]),l(ae,{modelValue:c.value,"onUpdate:modelValue":k[1]||(k[1]=R=>c.value=R),placeholder:w.$t("common.search"),"prefix-icon":"Search",class:"w-240 mr-8",clearable:""},null,8,["modelValue","placeholder"])]),l(ue,null,{default:e(()=>[d("div",bl,[u.value.length?ie((S(),x(oe,{key:0,gutter:12},{default:e(()=>[(S(!0),Y(ke,null,Ce(u.value,(R,X)=>(S(),x(Z,{span:8,key:X,class:"mb-16"},{default:e(()=>[l(De,{"value-field":"id",data:R,modelValue:n.value,"onUpdate:modelValue":k[2]||(k[2]=pe=>n.value=pe),onChange:N},{icon:e(()=>[R!=null&&R.icon?(S(),x(te,{key:0,shape:"square",size:32,style:{background:"none"},class:"mr-8"},{default:e(()=>[d("img",{src:Le(Ne)(R==null?void 0:R.icon),alt:""},null,8,kl)]),_:2},1024)):(S(),x(T,{key:1,size:32,type:R==null?void 0:R.toolType},null,8,["type"]))]),default:e(()=>[d("span",{class:"ellipsis cursor ml-12",title:R.name},p(R.name),9,$l)]),_:2},1032,["data","modelValue"])]),_:2},1024))),128))]),_:1})),[[z,b.value]]):(S(),x(ce,{key:1,description:w.$t("common.noData")},null,8,["description"]))])]),_:1})])]}),_:1})]),_:1},8,["modelValue"])}}}),Cl={class:"generate-prompt-dialog-bg border-r-8"},Tl={class:"scrollbar-height"},Rl={class:"p-16 pb-0 lighter"},Dl={key:1,shadow:"always",style:{margin:"0.5rem 0"}},Ml={key:2,class:"flex align-center"},Il={key:0,class:"mt-8"},Pl={key:1,class:"mt-8"},xl={class:"generate-prompt-operate p-16"},Ul={key:0,class:"text-center mb-8"},Al={class:"operate-textarea"},Ll={class:"operate"},Nl={class:"text-right"},ql={src:Fe,alt:""},Ol=re({__name:"GeneratePromptDialog",emits:["replace"],setup(le,{expose:E,emit:H}){const F=H,{user:L}=be(),I=fe(),M=o([]),P=Q(()=>I.path.includes("resource-management")?"systemManage":"workspace"),n=o(""),c=o(""),u=o(""),f=o(!1),g=o(""),b=o(!1),N={INIT_TEMPLATE:`
è¯·æ ¹æ®ç”¨æˆ·æè¿°ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„AIè§’è‰²äººè®¾æ¨¡æ¿:

åº”ç”¨åç§°ï¼š{application_name}
åº”ç”¨æè¿°ï¼š{detail}
ç”¨æˆ·éœ€æ±‚ï¼š{userInput}

é‡è¦è¯´æ˜ï¼š
1. è§’è‰²è®¾å®šå¿…é¡»æœåŠ¡äº"{application_name}"åº”ç”¨çš„æ ¸å¿ƒåŠŸèƒ½
2. å…è®¸ç”¨æˆ·å¯¹è§’è‰²è®¾å®šçš„å…·ä½“å†…å®¹è¿›è¡Œè°ƒæ•´å’Œä¼˜åŒ–
3. å¦‚æœç”¨æˆ·è¦æ±‚ä¿®æ”¹æŸä¸ªæŠ€èƒ½æˆ–éƒ¨åˆ†ï¼Œåœ¨ä¿æŒåº”ç”¨ä¸»é¢˜çš„å‰æä¸‹è¿›è¡Œç›¸åº”è°ƒæ•´

è¯·æŒ‰ä»¥ä¸‹æ ¼å¼ç”Ÿæˆï¼š

å¿…é¡»ä¸¥æ ¼éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š
1. **ä¸¥æ ¼ç¦æ­¢è¾“å‡ºè§£é‡Šã€å‰è¨€ã€é¢å¤–è¯´æ˜**ï¼Œåªè¾“å‡ºæœ€ç»ˆç»“æœã€‚
2. **ä¸¥æ ¼ä½¿ç”¨ä»¥ä¸‹æ ¼å¼**ï¼Œä¸èƒ½ç¼ºå°‘æ ‡é¢˜ã€ä¸èƒ½å¤šå‡ºå…¶ä»–æ®µè½ã€‚
3. **å¦‚æœç”¨æˆ·è¦æ±‚ä¿®æ”¹è§’è‰²è®¾å®šçš„æŸä¸ªéƒ¨åˆ†ï¼Œåœ¨ä¿æŒåº”ç”¨æ ¸å¿ƒåŠŸèƒ½çš„å‰æä¸‹è¿›è¡Œè°ƒæ•´**ã€‚
4. **å¦‚æœç”¨æˆ·éœ€æ±‚ä¸è§’è‰²è®¾å®šç”Ÿæˆå®Œå…¨æ— å…³ï¼ˆå¦‚é—²èŠã€å…¶ä»–è¯é¢˜ï¼‰ï¼Œåˆ™å¿½ç•¥ç”¨æˆ·éœ€æ±‚ï¼ŒåŸºäºåº”ç”¨ä¿¡æ¯ç”Ÿæˆæ ‡å‡†è§’è‰²è®¾å®š**ã€‚

# è§’è‰²:
è§’è‰²æ¦‚è¿°å’Œä¸»è¦èŒè´£çš„ä¸€å¥è¯æè¿°

## ç›®æ ‡ï¼š
è§’è‰²çš„å·¥ä½œç›®æ ‡,å¦‚æœæœ‰å¤šç›®æ ‡å¯ä»¥åˆ†ç‚¹åˆ—å‡º,ä½†å»ºè®®æ›´èšç„¦1-2ä¸ªç›®æ ‡

## æ ¸å¿ƒæŠ€èƒ½ï¼š
### æŠ€èƒ½ 1: [æŠ€èƒ½åç§°ï¼Œå¦‚ä½œå“æ¨è/ä¿¡æ¯æŸ¥è¯¢/ä¸“ä¸šåˆ†æç­‰]
1. [æ‰§è¡Œæ­¥éª¤1 - æè¿°è¯¥æŠ€èƒ½çš„ç¬¬ä¸€ä¸ªå…·ä½“æ“ä½œæ­¥éª¤ï¼ŒåŒ…æ‹¬æ¡ä»¶åˆ¤æ–­å’Œå¤„ç†æ–¹å¼]
2. [æ‰§è¡Œæ­¥éª¤2 - æè¿°è¯¥æŠ€èƒ½çš„ç¬¬äºŒä¸ªå…·ä½“æ“ä½œæ­¥éª¤ï¼ŒåŒ…æ‹¬å¦‚ä½•è·å–æˆ–å¤„ç†ä¿¡æ¯]
3. [æ‰§è¡Œæ­¥éª¤3 - æè¿°è¯¥æŠ€èƒ½çš„æœ€ç»ˆè¾“å‡ºæ­¥éª¤ï¼Œè¯´æ˜å¦‚ä½•å‘ˆç°ç»“æœ]

===å›å¤ç¤ºä¾‹===
- ğŸ“‹ [æ ‡è¯†ç¬¦]: <å…·ä½“å†…å®¹æ ¼å¼è¯´æ˜>
- ğŸ¯ [æ ‡è¯†ç¬¦]: <å…·ä½“å†…å®¹æ ¼å¼è¯´æ˜>
- ğŸ’¡ [æ ‡è¯†ç¬¦]: <å…·ä½“å†…å®¹æ ¼å¼è¯´æ˜>
===ç¤ºä¾‹ç»“æŸ===

### æŠ€èƒ½ 2: [æŠ€èƒ½åç§°]
1. [æ‰§è¡Œæ­¥éª¤1 - æè¿°è§¦å‘æ¡ä»¶å’Œåˆå§‹å¤„ç†æ–¹å¼]
2. [æ‰§è¡Œæ­¥éª¤2 - æè¿°ä¿¡æ¯è·å–å’Œæ·±åŒ–å¤„ç†çš„å…·ä½“æ–¹æ³•]
3. [æ‰§è¡Œæ­¥éª¤3 - æè¿°æœ€ç»ˆè¾“å‡ºçš„å…·ä½“è¦æ±‚å’Œæ ¼å¼]

### æŠ€èƒ½ 3: [æŠ€èƒ½åç§°]
- [æ ¸å¿ƒèƒ½åŠ›æè¿° - è¯´æ˜è¯¥æŠ€èƒ½çš„ä¸»è¦ä½œç”¨å’ŒçŸ¥è¯†åŸºç¡€]
- [åº”ç”¨æ–¹æ³• - æè¿°å¦‚ä½•è¿ç”¨è¯¥æŠ€èƒ½ä¸ºç”¨æˆ·æä¾›æœåŠ¡ï¼ŒåŒ…æ‹¬å…·ä½“çš„å®æ–½æ–¹å¼]

## å·¥ä½œæµï¼š
1. æè¿°è§’è‰²å·¥ä½œæµç¨‹çš„ç¬¬ä¸€æ­¥
2. æè¿°è§’è‰²å·¥ä½œæµç¨‹çš„ç¬¬äºŒæ­¥
3. æè¿°è§’è‰²å·¥ä½œæµç¨‹çš„ç¬¬ä¸‰æ­¥

## è¾“å‡ºæ ¼å¼ï¼š
å¦‚æœå¯¹è§’è‰²çš„è¾“å‡ºæ ¼å¼æœ‰ç‰¹å®šè¦æ±‚ï¼Œå¯ä»¥åœ¨è¿™é‡Œå¼ºè°ƒå¹¶ä¸¾ä¾‹è¯´æ˜æƒ³è¦çš„è¾“å‡ºæ ¼å¼


## é™åˆ¶ï¼š
1. **ä¸¥æ ¼é™åˆ¶å›ç­”èŒƒå›´**ï¼šä»…å›ç­”ä¸è§’è‰²è®¾å®šç›¸å…³çš„é—®é¢˜ã€‚
   - å¦‚æœç”¨æˆ·æé—®ä¸è§’è‰²æ— å…³ï¼Œå¿…é¡»ä½¿ç”¨ä»¥ä¸‹å›ºå®šæ ¼å¼å›å¤ï¼š
     â€œå¯¹ä¸èµ·ï¼Œæˆ‘åªèƒ½å›ç­”ä¸[è§’è‰²è®¾å®š]ç›¸å…³çš„é—®é¢˜ï¼Œæ‚¨çš„é—®é¢˜ä¸åœ¨æœåŠ¡èŒƒå›´å†…ã€‚â€
   - ä¸å¾—æä¾›ä»»ä½•ä¸è§’è‰²è®¾å®šæ— å…³çš„å›ç­”ã€‚
2. æè¿°è§’è‰²åœ¨äº’åŠ¨è¿‡ç¨‹ä¸­éœ€è¦éµå¾ªçš„é™åˆ¶æ¡ä»¶2
3. æè¿°è§’è‰²åœ¨äº’åŠ¨è¿‡ç¨‹ä¸­éœ€è¦éµå¾ªçš„é™åˆ¶æ¡ä»¶3

è¾“å‡ºæ—¶ä¸å¾—åŒ…å«ä»»ä½•è§£é‡Šæˆ–é™„åŠ è¯´æ˜ï¼Œåªèƒ½è¿”å›ç¬¦åˆä»¥ä¸Šæ ¼å¼çš„å†…å®¹ã€‚
  `},U=o(!1),q=o(!1),a=o(""),s=o(0);let m=null;const $=o(!1),v=()=>{m&&clearInterval(m),U.value=!0,q.value=!1,m=setInterval(()=>{if(k.value&&!q.value){const t=M.value[M.value.length-1];t&&t.role==="ai"&&(t.content=a.value),V();return}if(!q.value&&s.value<a.value.length){const t=Math.min(3,a.value.length-s.value);s.value+=t;const h=M.value[M.value.length-1];h&&h.role==="ai"&&(h.content=a.value.substring(0,s.value))}else b.value===!1&&s.value>=a.value.length&&V()},50)},V=()=>{m&&(clearInterval(m),m=null),U.value=!1,q.value=!1,b.value=!1,$.value=!0},_=Q(()=>U.value),B=()=>{q.value=!0,U.value=!1},O=()=>{s.value<a.value.length&&v()},w=t=>{let h="";const z=Se({content:"",role:"ai"});M.value.push(z),a.value="",s.value=0,$.value=!1;let A=!1;const R=({done:X,value:pe})=>{try{if(X){b.value=!1,k.value=!0;return}let j=new TextDecoder("utf-8").decode(pe,{stream:!0});h+=j;const me=h.match(/data:.*}\n\n/g);if(me)j=me.join(""),h=h.replace(j,"");else return t.read().then(R);if(j&&j.startsWith("data:")&&me)for(const Me in me){const he=JSON==null?void 0:JSON.parse(me[Me].replace("data:",""));if(he.isEnd||(a.value+=he.content,A||(A=!0,v())),he.isEnd)return Promise.resolve()}}catch(ge){return b.value=!1,V(),Promise.reject(ge)}return t.read().then(R)};return R},k=o(!1),r=Q(()=>{const t=M.value[M.value.length-1];return t&&t.role=="ai"?t.content:""}),y=Q(()=>!U.value&&q.value&&s.value<a.value.length);function C(t){k.value=!1,b.value=!0;const h=L.getWorkspaceId()||"default";M.value.push({content:t,role:"user"});const z={messages:M.value,prompt:N.INIT_TEMPLATE};P.value==="workspace"?Ke.generate_prompt(h,c.value,u.value,z).then(A=>{ye(()=>{Z.value&&T.value.setScrollTop(oe())});const R=A.body.getReader();R.read().then(w(R))}):P.value==="systemManage"&&Ee.generate_prompt(u.value,c.value,z).then(A=>{ye(()=>{Z.value&&T.value.setScrollTop(oe())});const R=A.body.getReader();R.read().then(w(R))})}const J=()=>{n.value&&C("ç»“æœä¸æ»¡æ„,è¯·æŒ‰ç…§æ ¼å¼,é‡æ–°ç”Ÿæˆ")},K=o(),W=t=>{if(!(t!=null&&t.ctrlKey)&&!(t!=null&&t.shiftKey)&&!(t!=null&&t.altKey)&&!(t!=null&&t.metaKey)){if(t==null||t.preventDefault(),!g.value.trim()||b.value||U.value||(n.value||(n.value=g.value),q.value||U.value))return;g.value&&(C(g.value),g.value="")}else ae(t)},ae=t=>{const h=K.value.$el.querySelector(".el-textarea__inner"),z=h.selectionStart,A=h.selectionEnd;t.preventDefault(),g.value=g.value.slice(0,z)+`
`+g.value.slice(A),ye(()=>{h.setSelectionRange(z+1,z+1)})},te=(t,h)=>{c.value=t,u.value=h,f.value=!0,n.value="",M.value=[]},T=o(),Z=o(),oe=()=>Z.value.scrollHeight,ce=()=>{var t;T.value&&T.value.wrapRef.offsetHeight<((t=Z.value)==null?void 0:t.scrollHeight)&&T.value.setScrollTop(oe())},ue=t=>{r.value?He(ee("common.tip"),ee("views.application.generateDialog.exit"),{confirmButtonText:ee("common.confirm"),cancelButtonText:ee("common.cancel"),distinguishCancelAndClose:!0}).then(()=>{V(),M.value=[],a.value="",s.value=0,$.value=!1,t()}).catch(()=>{}):t()};return qe(()=>{V()}),se(r,()=>{ce()},{deep:!0,immediate:!0}),E({open:te}),(t,h)=>{const z=i("Loading"),A=i("el-icon"),R=i("el-scrollbar"),X=i("el-button"),pe=i("el-input"),ge=i("el-dialog");return S(),x(ge,{"align-center":"",title:t.$t("views.application.generateDialog.generatePrompt"),modelValue:f.value,"onUpdate:modelValue":h[3]||(h[3]=j=>f.value=j),style:{width:"600px"},"append-to-body":"","close-on-click-modal":!0,"close-on-press-escape":!0,"before-close":ue},{default:e(()=>[d("div",Cl,[d("div",Tl,[d("div",Rl,[l(R,{ref_key:"scrollDiv",ref:T},{default:e(()=>[r.value?(S(),Y("div",{key:0,ref_key:"dialogScrollbar",ref:Z,class:"pre-wrap lighter",style:{"max-height":"calc(100vh - 400px)"}},p(r.value),513)):b.value?(S(),Y("p",Dl,[l(A,{class:"is-loading color-primary mr-4"},{default:e(()=>[l(z)]),_:1}),D(" "+p(t.$t("views.application.generateDialog.loading"))+" ",1),h[4]||(h[4]=d("span",{class:"dotting"},null,-1))])):(S(),Y("p",Ml,[l(_e,{iconName:"app-generate-star",class:"color-primary mr-4"}),D(" "+p(t.$t("views.application.generateDialog.title")),1)]))]),_:1},512),r.value&&!b.value&&!U.value&&!y.value?(S(),Y("div",Il,[l(X,{type:"primary",onClick:h[0]||(h[0]=()=>F("replace",r.value))},{default:e(()=>[D(p(t.$t("views.application.generateDialog.replace")),1)]),_:1}),l(X,{onClick:J,disabled:!r.value||b.value,loading:b.value},{default:e(()=>[D(p(t.$t("views.application.generateDialog.remake")),1)]),_:1},8,["disabled","loading"])])):(S(),Y("div",Pl,[y.value?(S(),x(X,{key:0,type:"primary",onClick:O,link:""},{default:e(()=>[D(p(t.$t("views.application.generateDialog.continue")),1)]),_:1})):G("",!0)]))]),d("div",xl,[_.value?(S(),Y("div",Ul,[l(X,{class:"border-primary video-stop-button",onClick:B},{default:e(()=>[l(_e,{iconName:"app-video-stop",class:"mr-8"}),D(" "+p(t.$t("views.application.generateDialog.stop")),1)]),_:1})])):G("",!0),d("div",Al,[l(pe,{ref_key:"quickInputRef",ref:K,modelValue:g.value,"onUpdate:modelValue":h[1]||(h[1]=j=>g.value=j),autosize:{minRows:1,maxRows:10},type:"textarea",placeholder:t.$t("views.application.generateDialog.placeholder"),maxlength:1e5,class:"chat-operate-textarea",onKeydown:h[2]||(h[2]=Oe(j=>W(j),["enter"]))},null,8,["modelValue","placeholder"]),d("div",Ll,[d("div",Nl,[l(X,{text:"",class:"sent-button",disabled:!g.value.trim()||b.value||U.value,onClick:W},{default:e(()=>[ie(d("img",ql,null,512),[[$e,!g.value.trim()||b.value||U.value]]),ie(l(ze,null,null,512),[[$e,g.value.trim()&&!b.value&&!U.value]])]),_:1},8,["disabled"])])])])])])])]),_:1},8,["title","modelValue"])}}}),jl=Be(Ol,[["__scopeId","data-v-2168fa76"]]);export{jl as G,zl as _,Hl as a,Kl as b,El as c,Bl as d,Wl as e};
