import{aJ as ee,bn as le,aK as C,e7 as te,aP as b,be as ae,bf as d,bg as oe,aQ as p,aZ as se,a_ as z,aM as r,aT as s,aS as o,aW as m,aR as a,b0 as ie,aL as f,b1 as c,f6 as ne,aV as L,f7 as re,f8 as ue,aO as N,bk as de,cG as k,bj as T,b9 as pe}from"./chat-DmcU5C5M.js";import{_ as me}from"./BaseForm.vue_vue_type_script_setup_true_lang-CzSOCC_A.js";const ce={class:"p-16-24"},ve={class:"mb-16"},fe={class:"knowledge-setting main-calc-height"},ge={class:"p-24"},we={class:"title-decoration-1 mb-16"},_e={class:"flex align-center"},ye={class:"flex align-center"},ke={class:"flex align-center"},he={key:5},be={class:"title-decoration-1 mb-16"},Se={class:"flex align-center"},Ve={class:"mr-4"},Le={class:"text-right"},$e=ee({__name:"KnowledgeSetting",setup(Te){const $=le(),{params:{id:g,folderId:E}}=$,v=C(()=>$.path.includes("shared")?"systemShare":$.path.includes("resource-management")?"systemManage":"workspace"),j=C(()=>te.knowledge[v.value]),G=C(()=>E==="share"),I=b(),S=b(),h=b(!1),i=b({}),K=b(""),t=b({source_url:"",selector:"",app_id:"",app_secret:"",folder_token:"",fileCountLimit:50,fileSizeLimit:100}),J=ae({source_url:[{required:!0,message:d("views.knowledge.form.source_url.requiredMessage"),trigger:"blur"}],app_id:[{required:!0,message:d("views.application.applicationAccess.larkSetting.appIdPlaceholder"),trigger:"blur"}],app_secret:[{required:!0,message:d("views.application.applicationAccess.larkSetting.appSecretPlaceholder"),trigger:"blur"}],folder_token:[{required:!0,message:d("views.application.applicationAccess.larkSetting.folderTokenPlaceholder"),trigger:"blur"}]});async function O(){var e;await((e=S.value)==null?void 0:e.validate())&&await I.value.validate(l=>{if(l){const u=i.value.type===1||i.value.type===2?{meta:t.value,fileCountLimit:t.value.fileCountLimit,fileSizeLimit:t.value.fileSizeLimit,...S.value.form}:{fileCountLimit:t.value.fileCountLimit,fileSizeLimit:t.value.fileSizeLimit,...S.value.form};K.value!==S.value.form.embeddingModelId?de(d("common.tip"),d("views.knowledge.tip.updateModeMessage"),{confirmButtonText:d("views.knowledge.setting.vectorization")}).then(()=>{i.value.type===2?k({type:"knowledge",systemType:v.value}).putLarkKnowledge(g,u,h).then(()=>{k({type:"knowledge",systemType:v.value}).putReEmbeddingKnowledge(g).then(()=>{T(d("common.saveSuccess"))})}):k({type:"knowledge",systemType:v.value}).putKnowledge(g,u,h).then(()=>{k({type:"knowledge",systemType:v.value}).putReEmbeddingKnowledge(g).then(()=>{T(d("common.saveSuccess"))})})}).catch(()=>{}):i.value.type===2?k({type:"knowledge",systemType:v.value}).putLarkKnowledge(g,u,h).then(()=>{T(d("common.saveSuccess"))}):k({type:"knowledge",systemType:v.value}).putKnowledge(g,u,h).then(()=>{T(d("common.saveSuccess"))})}})}function Q(){k({type:"knowledge",isShared:G.value,systemType:v.value}).getKnowledgeDetail(g,h).then(e=>{var l,u,_,y;i.value=e.data,K.value=(l=e.data)==null?void 0:l.embeddingModelId,((u=i.value)==null?void 0:u.type)===0&&(t.value.fileCountLimit=e.data.fileCountLimit,t.value.fileSizeLimit=e.data.fileSizeLimit),(((_=i.value)==null?void 0:_.type)===1||((y=i.value)==null?void 0:y.type)===2)&&(t.value=e.data.meta)})}return oe(()=>{Q()}),(e,l)=>{const u=p("el-avatar"),_=p("el-text"),y=p("el-card"),w=p("el-form-item"),V=p("el-input"),A=p("el-slider"),W=p("AppIcon"),Z=p("el-tooltip"),H=p("el-form"),X=p("el-button"),Y=p("el-scrollbar"),x=se("loading");return r(),z("div",ce,[s("h2",ve,m(e.$t("common.setting")),1),o(y,{style:{"--el-card-padding":"0"}},{default:a(()=>[s("div",fe,[o(Y,null,{default:a(()=>[ie((r(),z("div",ge,[s("h4",we,m(e.$t("common.info")),1),o(me,{ref_key:"BaseFormRef",ref:S,data:i.value,apiType:v.value},null,8,["data","apiType"]),o(H,{ref_key:"webFormRef",ref:I,rules:J,model:t.value,"label-position":"top","require-asterisk-position":"right"},{default:a(()=>{var M,q,B,P,R,U;return[o(w,{label:e.$t("views.knowledge.knowledgeType.label"),required:""},{default:a(()=>{var n,D,F;return[((n=i.value)==null?void 0:n.type)===0?(r(),f(y,{key:0,shadow:"never",class:"mb-8 w-full layout-bg",style:{"line-height":"22px"}},{default:a(()=>[s("div",_e,[o(u,{class:"mr-8 avatar-blue",shape:"square",size:32},{default:a(()=>l[9]||(l[9]=[s("img",{src:ne,style:{width:"58%"},alt:""},null,-1)])),_:1,__:[9]}),s("div",null,[s("div",null,m(e.$t("views.knowledge.knowledgeType.generalKnowledge")),1),o(_,{type:"info"},{default:a(()=>[L(m(e.$t("views.knowledge.knowledgeType.generalInfo")),1)]),_:1})])])]),_:1})):c("",!0),((D=i.value)==null?void 0:D.type)===1?(r(),f(y,{key:1,shadow:"never",class:"mb-8 w-full layout-bg",style:{"line-height":"22px"}},{default:a(()=>[s("div",ye,[o(u,{class:"mr-8 avatar-purple",shape:"square",size:32},{default:a(()=>l[10]||(l[10]=[s("img",{src:re,style:{width:"58%"},alt:""},null,-1)])),_:1,__:[10]}),s("div",null,[s("div",null,m(e.$t("views.knowledge.knowledgeType.webKnowledge")),1),o(_,{type:"info"},{default:a(()=>[L(m(e.$t("views.knowledge.knowledgeType.webInfo")),1)]),_:1})])])]),_:1})):c("",!0),((F=i.value)==null?void 0:F.type)===2?(r(),f(y,{key:2,shadow:"never",class:"mb-8 w-full layout-bg",style:{"line-height":"22px"}},{default:a(()=>[s("div",ke,[o(u,{shape:"square",size:32,style:{background:"none"}},{default:a(()=>l[11]||(l[11]=[s("img",{src:ue,style:{width:"100%"},alt:""},null,-1)])),_:1,__:[11]}),s("div",null,[s("p",null,[o(_,null,{default:a(()=>[L(m(e.$t("views.knowledge.knowledgeType.larkKnowledge")),1)]),_:1})]),o(_,{type:"info"},{default:a(()=>[L(m(e.$t("views.knowledge.knowledgeType.larkInfo")),1)]),_:1})])])]),_:1})):c("",!0)]}),_:1},8,["label"]),((M=i.value)==null?void 0:M.type)===1?(r(),f(w,{key:0,label:e.$t("views.knowledge.form.source_url.label"),prop:"source_url"},{default:a(()=>[o(V,{modelValue:t.value.source_url,"onUpdate:modelValue":l[0]||(l[0]=n=>t.value.source_url=n),placeholder:e.$t("views.knowledge.form.source_url.placeholder"),onBlur:l[1]||(l[1]=n=>t.value.source_url=t.value.source_url.trim())},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):c("",!0),((q=i.value)==null?void 0:q.type)===1?(r(),f(w,{key:1,label:e.$t("views.knowledge.form.selector.label")},{default:a(()=>[o(V,{modelValue:t.value.selector,"onUpdate:modelValue":l[2]||(l[2]=n=>t.value.selector=n),placeholder:e.$t("views.knowledge.form.selector.placeholder"),onBlur:l[3]||(l[3]=n=>t.value.selector=t.value.selector.trim())},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):c("",!0),((B=i.value)==null?void 0:B.type)===2?(r(),f(w,{key:2,label:"App ID",prop:"app_id"},{default:a(()=>[o(V,{modelValue:t.value.app_id,"onUpdate:modelValue":l[4]||(l[4]=n=>t.value.app_id=n),placeholder:e.$t("views.application.applicationAccess.larkSetting.appIdPlaceholder")},null,8,["modelValue","placeholder"])]),_:1})):c("",!0),((P=i.value)==null?void 0:P.type)===2?(r(),f(w,{key:3,label:"App Secret",prop:"app_id"},{default:a(()=>[o(V,{modelValue:t.value.app_secret,"onUpdate:modelValue":l[5]||(l[5]=n=>t.value.app_secret=n),type:"password","show-password":"",placeholder:e.$t("views.application.applicationAccess.larkSetting.appSecretPlaceholder")},null,8,["modelValue","placeholder"])]),_:1})):c("",!0),((R=i.value)==null?void 0:R.type)===2?(r(),f(w,{key:4,label:"Folder Token",prop:"folder_token"},{default:a(()=>[o(V,{modelValue:t.value.folder_token,"onUpdate:modelValue":l[6]||(l[6]=n=>t.value.folder_token=n),placeholder:e.$t("views.application.applicationAccess.larkSetting.folderTokenPlaceholder")},null,8,["modelValue","placeholder"])]),_:1})):c("",!0),((U=i.value)==null?void 0:U.type)===0?(r(),z("div",he,[s("h4",be,m(e.$t("common.otherSetting")),1),o(w,{label:e.$t("views.knowledge.form.fileCountLimit.label")},{default:a(()=>[o(A,{modelValue:t.value.fileCountLimit,"onUpdate:modelValue":l[7]||(l[7]=n=>t.value.fileCountLimit=n),"show-input":"","show-input-controls":!1,min:1,max:1e3,class:"custom-slider"},null,8,["modelValue"])]),_:1},8,["label"]),o(w,null,{label:a(()=>[s("div",Se,[s("span",Ve,m(e.$t("views.knowledge.form.fileSizeLimit.label")),1),o(Z,{effect:"dark",content:e.$t("views.knowledge.form.fileSizeLimit.placeholder"),placement:"right"},{default:a(()=>[o(W,{iconName:"app-warning",class:"app-warning-icon"})]),_:1},8,["content"])])]),default:a(()=>[o(A,{modelValue:t.value.fileSizeLimit,"onUpdate:modelValue":l[8]||(l[8]=n=>t.value.fileSizeLimit=n),"show-input":"","show-input-controls":!1,min:1,max:1e3,class:"custom-slider"},null,8,["modelValue"])]),_:1})])):c("",!0)]}),_:1},8,["rules","model"]),s("div",Le,[!N($).path.includes("share/")&&j.value.edit(N(g))?(r(),f(X,{key:0,onClick:O,type:"primary"},{default:a(()=>[L(m(e.$t("common.save")),1)]),_:1})):c("",!0)])])),[[x,h.value]])]),_:1})])]),_:1})])}}}),Ie=pe($e,[["__scopeId","data-v-1955d808"]]);export{Ie as default};
