import{aJ as G,aP as i,bw as fe,aQ as l,aZ as z,aL as W,aM as w,aR as n,aT as _,aS as t,aV as U,aW as y,b0 as D,ch as ve,bc as r,bi as j,bb as ae,bd as te,bp as ne,a_ as J,b5 as ke,aO as C,cz as ee,cy as I,cA as N,b1 as q,aU as L,bk as Q,b7 as le,b4 as be,cq as oe}from"./chat-ChhQLBW1.js";import{_ as we}from"./MemberFormContent.vue_vue_type_script_setup_true_lang-DV0tBCE7.js";import{R as ge}from"./system-CkhRQyt6.js";import{l as O}from"./permission-api-DneQshTw.js";import"./workspace-Bixc0Lrq.js";const he={style:{flex:"auto"}},$e=G({__name:"AddMemberDrawer",props:{currentWorkspace:{}},emits:["refresh"],setup(K,{expose:g,emit:$}){const v=K,k=$,m=i(!1),u=i(!1),f=i([]),R=i(!1),E=i([]),M=i([]),V=i([]);async function d(){var e;try{const s=await ve.getUserList(R);M.value=[{path:"user_ids",label:r("views.role.member.title"),rules:[{required:!0,message:`${r("common.selectPlaceholder")}${r("views.role.member.title")}`}],selectProps:{options:((e=s.data)==null?void 0:e.map(p=>({label:p.nickname,value:p.id})))||[],placeholder:`${r("common.selectPlaceholder")}${r("views.role.member.title")}`}}]}catch(s){console.error(s)}}async function a(){var e;try{const s=await O("workspace").getWorkspaceRoleList(R);V.value=[{path:"role_ids",label:r("views.role.member.role"),rules:[{required:!0,message:`${r("common.selectPlaceholder")}${r("views.role.member.role")}`}],selectProps:{options:((e=s.data.filter(p=>p.type!==ge.ADMIN))==null?void 0:e.map(p=>({label:p.name,value:p.id})))||[],placeholder:`${r("common.selectPlaceholder")}${r("views.role.member.role")}`}}]}catch(s){console.error(s)}}function c(){E.value=[...M.value,...V.value],f.value=[{user_ids:[],role_ids:[]}]}fe(async()=>{await d(),await a(),c()});function h(){c(),u.value=!0}function b(){u.value=!1}const P=i();function o(){var e;(e=P.value)==null||e.validate().then(async s=>{var p;s&&(await O("workspace").CreateWorkspaceMember((p=v.currentWorkspace)==null?void 0:p.id,f.value,m),j(r("common.addSuccess")),b(),k("refresh"))})}return g({open:h}),(e,s)=>{const p=l("el-button"),F=l("el-drawer"),B=z("loading");return w(),W(F,{modelValue:u.value,"onUpdate:modelValue":s[2]||(s[2]=S=>u.value=S),size:"600","destroy-on-close":!0,"before-close":b},{header:n(()=>[_("h4",null,y(e.$t("views.role.member.add")),1)]),default:n(()=>[D(t(we,{ref_key:"memberFormContentRef",ref:P,models:E.value,form:f.value,"onUpdate:form":s[0]||(s[0]=S=>f.value=S),keepOneLine:""},null,8,["models","form"]),[[B,R.value]])]),footer:n(()=>[_("div",he,[t(p,{onClick:b},{default:n(()=>[U(y(e.$t("common.cancel")),1)]),_:1}),t(p,{type:"primary",onClick:s[1]||(s[1]=S=>o()),loading:m.value},{default:n(()=>[U(y(e.$t("common.add")),1)]),_:1},8,["loading"])])]),_:1},8,["modelValue"])}}}),ye={class:"flex-between mb-16"},Ce={class:"flex complex-search"},We=G({__name:"Member",props:{currentWorkspace:{}},setup(K){const g=K,$=i(!1),v=i("username"),k=i({username:"",nickname:""}),m=ae({current_page:1,page_size:20,total:0}),u=i([]);async function f(){var a,c;if((a=g.currentWorkspace)!=null&&a.id)try{const h={[v.value]:k.value[v.value]},b=await O("workspace").getWorkspaceMemberList((c=g.currentWorkspace)==null?void 0:c.id,m,h,$);u.value=b.data.records,m.total=b.data.total}catch(h){console.error(h)}}function R(){m.current_page=1,f()}te(()=>{f()}),ne(()=>{var a;return(a=g.currentWorkspace)==null?void 0:a.id},()=>{f()});const E=({row:a,column:c,rowIndex:h,columnIndex:b})=>{if(c.property==="nickname"||c.property==="username"){const P=u.value.filter(o=>o.dialogueNumber===a.dialogueNumber);return h===u.value.findIndex(o=>o.dialogueNumber===a.dialogueNumber)?{rowspan:P.length,colspan:1}:{rowspan:0,colspan:0}}},M=i();function V(){var a;(a=M.value)==null||a.open()}function d(a){Q(`${r("views.workspace.member.delete.confirmTitle")}${a.nickname} ?`,"",{confirmButtonText:r("common.confirm"),confirmButtonClass:"danger"}).then(()=>{var c;$.value=!0,O("workspace").deleteWorkspaceMember((c=g.currentWorkspace)==null?void 0:c.id,a.user_relation_id,$).then(()=>{j(r("common.deleteSuccess")),f()})}).catch(()=>{})}return(a,c)=>{const h=l("el-button"),b=l("el-option"),P=l("el-select"),o=l("el-input"),e=l("el-table-column"),s=l("AppIcon"),p=l("el-tooltip"),F=l("app-table"),B=z("hasPermission"),S=z("loading");return w(),J(ke,null,[_("div",ye,[D((w(),W(h,{type:"primary",onClick:V},{default:n(()=>[U(y(a.$t("views.role.member.add")),1)]),_:1})),[[B,new(C(ee))([C(I).ADMIN,C(I).WORKSPACE_MANAGE.getWorkspaceRole],[C(N).WORKSPACE_ADD_MEMBER,C(N).WORKSPACE_WORKSPACE_ADD_MEMBER.getWorkspacePermissionWorkspaceManageRole],[],"OR")]]),_("div",Ce,[t(P,{class:"complex-search__left",modelValue:v.value,"onUpdate:modelValue":c[0]||(c[0]=A=>v.value=A),style:{width:"120px"}},{default:n(()=>[t(b,{label:a.$t("views.login.loginForm.username.label"),value:"username"},null,8,["label"]),t(b,{label:a.$t("views.userManage.userForm.nickname.label"),value:"nickname"},null,8,["label"])]),_:1},8,["modelValue"]),v.value==="username"?(w(),W(o,{key:0,modelValue:k.value.username,"onUpdate:modelValue":c[1]||(c[1]=A=>k.value.username=A),onChange:f,placeholder:a.$t("common.inputPlaceholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):v.value==="nickname"?(w(),W(o,{key:1,modelValue:k.value.nickname,"onUpdate:modelValue":c[2]||(c[2]=A=>k.value.nickname=A),onChange:f,placeholder:a.$t("common.inputPlaceholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):q("",!0)])]),D((w(),W(F,{data:u.value,"pagination-config":m,onSizeChange:R,onChangePage:f,class:"member-table","span-method":E,maxTableHeight:320},{default:n(()=>[t(e,{prop:"nickname",label:a.$t("views.userManage.userForm.nickname.label")},null,8,["label"]),t(e,{prop:"username",label:a.$t("views.login.loginForm.username.label")},null,8,["label"]),t(e,{prop:"role_name",label:a.$t("views.role.member.role")},null,8,["label"]),t(e,{label:a.$t("common.operation"),width:"100",fixed:"right"},{default:n(({row:A})=>[t(p,{effect:"dark",content:`${a.$t("views.role.member.delete.button")}`,placement:"top"},{default:n(()=>[D((w(),W(h,{type:"primary",text:"",onClick:L(H=>d(A),["stop"])},{default:n(()=>[t(s,{iconName:"app-delete-users"})]),_:2},1032,["onClick"])),[[B,new(C(ee))([C(I).ADMIN,C(I).WORKSPACE_MANAGE.getWorkspaceRole],[C(N).WORKSPACE_REMOVE_MEMBER,C(N).WORKSPACE_WORKSPACE_REMOVE_MEMBER.getWorkspacePermissionWorkspaceManageRole],[],"OR")]])]),_:2},1032,["content"])]),_:1},8,["label"])]),_:1},8,["data","pagination-config"])),[[S,$.value]]),t($e,{ref_key:"addMemberDrawerRef",ref:M,currentWorkspace:g.currentWorkspace,onRefresh:f},null,8,["currentWorkspace"])],64)}}}),Re=le(We,[["__scopeId","data-v-aaaa1da4"]]),Me={class:"dialog-footer"},Pe=G({__name:"CreateOrUpdateWorkspaceDialog",emits:["refresh"],setup(K,{expose:g,emit:$}){const v=$,k=i(!1),m={name:""},u=i({...m});function f(d){d?u.value={id:d.id,name:d.name}:u.value={...m},k.value=!0}const R=i(),E=ae({name:[{required:!0,message:`${r("common.inputPlaceholder")}${r("views.workspace.name")}`,trigger:"blur"}]}),M=i(!1),V=async d=>{d&&await d.validate(a=>{a&&O("workspace").CreateOrUpdateWorkspace(u.value,M).then(c=>{j(u.value.id?r("common.renameSuccess"):r("common.createSuccess")),v("refresh",c.data),k.value=!1})})};return g({open:f}),(d,a)=>{const c=l("el-input"),h=l("el-form-item"),b=l("el-form"),P=l("el-button"),o=l("el-dialog");return w(),W(o,{title:`${u.value.id?d.$t("common.rename"):d.$t("common.create")}${d.$t("views.workspace.title")}`,modelValue:k.value,"onUpdate:modelValue":a[4]||(a[4]=e=>k.value=e),"close-on-click-modal":!1,"close-on-press-escape":!1,"destroy-on-close":!0},{footer:n(()=>[_("span",Me,[t(P,{onClick:a[2]||(a[2]=L(e=>k.value=!1,["prevent"]))},{default:n(()=>[U(y(d.$t("common.cancel")),1)]),_:1}),t(P,{type:"primary",onClick:a[3]||(a[3]=e=>V(R.value)),loading:M.value},{default:n(()=>[U(y(u.value.id?d.$t("common.save"):d.$t("common.create")),1)]),_:1},8,["loading"])])]),default:n(()=>[t(b,{"label-position":"top",ref_key:"formRef",ref:R,rules:E,model:u.value,"require-asterisk-position":"right",onSubmit:a[1]||(a[1]=L(()=>{},["prevent"]))},{default:n(()=>[t(h,{label:d.$t("views.workspace.name"),prop:"name"},{default:n(()=>[t(c,{modelValue:u.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>u.value.name=e),maxlength:"64","show-word-limit":"",placeholder:`${d.$t("common.inputPlaceholder")}${d.$t("views.workspace.name")}`},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])}}}),Ae={class:"workspace-manage p-16-24"},Ee={class:"mb-16"},Ve={class:"flex main-calc-height"},Se={class:"workspace-left border-r"},De={class:"p-24 pb-0"},Oe={class:"flex-between mb-12"},Ie={class:"medium"},Ne={class:"list-height-left"},Ue={class:"p-8-16"},Fe={class:"flex-between"},Be=["title"],Te={class:"workspace-right p-24"},Le={class:"flex align-center mb-16"},Ke={class:"medium"},xe={class:"color-input-placeholder ml-4"},ze=G({__name:"index",setup(K){const g=i(""),$=i(!1),v=i([]),k=i([]),m=i();async function u(){try{const o=await O("workspace").getSystemWorkspaceList($);v.value=o.data,k.value=M(v.value,g.value)}catch(o){console.error(o)}}te(async()=>{await u(),m.value=v.value[0]});const f=()=>oe([I.ADMIN,N.WORKSPACE_EDIT],"OR"),R=()=>oe([I.ADMIN,N.WORKSPACE_DELETE],"OR");async function E(o){await u(),o?m.value=o:m.value=v.value.find(e=>{var s;return e.id===((s=m.value)==null?void 0:s.id)})}function M(o,e){return e.length?o.filter(s=>s.name.toLowerCase().includes(e.toLowerCase())):o}ne(g,o=>{k.value=M(v.value,o)});function V(o){m.value=o}const d=i();function a(o){var e;(e=d.value)==null||e.open(o)}async function c(o){try{return await O("workspace").deleteWorkspaceCheck(o)}catch(e){console.log(e)}}async function h(o){const e=await c(o.id);(e?e.data.can_delete:!0)?Q(`${r("views.workspace.delete.confirmTitle")}${o.name} ?`,r("views.workspace.delete.confirmContent"),{confirmButtonText:r("common.confirm"),confirmButtonClass:"danger"}).then(()=>{O("workspace").deleteWorkspace(o.id,$).then(async()=>{var p;j(r("common.deleteSuccess")),await u(),m.value=o.id===((p=m.value)==null?void 0:p.id)?v.value[0]:m.value})}):Q(`${r("views.workspace.delete.confirmTitle")}${o.name} ?`,e?e.data.message:r("views.workspace.delete.confirmContent"),{showConfirmButton:!1,cancelButtonText:r("common.close")})}const b=i("");function P(o){b.value=o.id}return(o,e)=>{const s=l("Plus"),p=l("el-icon"),F=l("el-button"),B=l("el-tooltip"),S=l("el-input"),A=l("AppIcon"),H=l("el-dropdown-item"),se=l("el-dropdown-menu"),re=l("el-dropdown"),ce=l("common-list"),ie=l("el-scrollbar"),me=l("el-divider"),ue=l("UserFilled"),de=l("el-card"),pe=z("hasPermission"),Z=z("loading");return w(),J("div",Ae,[_("h2",Ee,y(o.$t("views.workspace.title")),1),t(de,{style:{"--el-card-padding":"0"}},{default:n(()=>{var X,Y;return[_("div",Ve,[_("div",Se,[_("div",De,[_("div",Oe,[_("h4",Ie,y(o.$t("views.workspace.list")),1),t(B,{effect:"dark",content:`${o.$t("common.create")}${o.$t("views.workspace.title")}`,placement:"top"},{default:n(()=>[D((w(),W(F,{type:"primary",text:"",onClick:e[0]||(e[0]=x=>a())},{default:n(()=>[t(p,{size:18},{default:n(()=>[t(s)]),_:1})]),_:1})),[[pe,[C(I).ADMIN,C(N).WORKSPACE_CREATE]]])]),_:1},8,["content"])]),t(S,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=x=>g.value=x),placeholder:o.$t("common.search"),"prefix-icon":"Search",clearable:""},null,8,["modelValue","placeholder"])]),_("div",Ne,[D((w(),W(ie,null,{default:n(()=>{var x;return[_("div",Ue,[t(ce,{data:k.value,onClick:V,"default-active":(x=m.value)==null?void 0:x.id,onMouseenter:P,onMouseleave:e[3]||(e[3]=T=>b.value="")},{default:n(({row:T})=>[_("div",Fe,[_("span",{class:"ellipsis",title:T.name},y(T.name),9,Be),D(_("div",{onClick:e[2]||(e[2]=L(()=>{},["stop"]))},[f()||R()?(w(),W(re,{key:0,teleported:!1,trigger:"click"},{dropdown:n(()=>[t(se,{style:{"min-width":"80px"}},{default:n(()=>[f()?(w(),W(H,{key:0,onClick:L(_e=>a(T),["stop"]),class:"p-8"},{default:n(()=>[t(A,{iconName:"app-edit",class:"color-secondary"}),U(" "+y(o.$t("common.rename")),1)]),_:2},1032,["onClick"])):q("",!0),R()?(w(),W(H,{key:1,onClick:L(_e=>h(T),["stop"]),class:"border-t p-8"},{default:n(()=>[t(A,{iconName:"app-delete",class:"color-secondary"}),U(" "+y(o.$t("common.delete")),1)]),_:2},1032,["onClick"])):q("",!0)]),_:2},1024)]),default:n(()=>[t(F,{text:""},{default:n(()=>[t(A,{iconName:"app-more"})]),_:1})]),_:2},1024)):q("",!0)],512),[[be,b.value===T.id]])])]),empty:n(()=>e[4]||(e[4]=[_("span",null,null,-1)])),_:1},8,["data","default-active"])])]}),_:1})),[[Z,$.value]])])]),D((w(),J("div",Te,[_("div",Le,[_("h4",Ke,y((X=m.value)==null?void 0:X.name),1),t(me,{direction:"vertical",class:"mr-8 ml-8"}),t(p,{class:"color-input-placeholder"},{default:n(()=>[t(ue)]),_:1}),_("span",xe,y((Y=m.value)==null?void 0:Y.user_count),1)]),t(Re,{currentWorkspace:m.value},null,8,["currentWorkspace"])])),[[Z,$.value]])])]}),_:1}),t(Pe,{ref_key:"createOrUpdateWorkspaceDialogRef",ref:d,onRefresh:E},null,512)])}}}),Qe=le(ze,[["__scopeId","data-v-e3d7ac94"]]);export{Qe as default};
