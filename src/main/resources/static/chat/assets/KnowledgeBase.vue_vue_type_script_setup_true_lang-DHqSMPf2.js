import{ay as F,aA as z,bi as W,bn as u,aB as i,b7 as G,aC as P,b9 as x,aD as I,aE as g,aF as c,aG as b,aI as T,aH as R,aJ as V,ba as E,bb as H,bc as J,cj as Q,aK as X,ck as Y,bk as Z,cl as ee,cm as K,b5 as h,bl as A,cn as te,br as ae,bj as B,co as oe,bo as se,bp as le}from"./chat-BvM2GaQg.js";const re={class:"title-decoration-1 mb-16 mt-4"},ne={class:"flex align-center"},_e=F({__name:"DataSource",props:{workflow:{},knowledgeId:{},loading:{type:Boolean}},emits:["update:loading"],setup(D,{expose:w,emit:p}){const{user:S}=z(),l=W(),m=D,d=u(()=>l.path.includes("shared")?"systemShare":l.path.includes("resource-management")?"systemManage":"workspace"),r=i([]),f=u(()=>S.getWorkspaceId()),k=p,t=u({get:()=>m.loading,set:e=>{k("update:loading",e)}}),s=i(),a=i({nodeId:""}),_=i({}),C=u({get:()=>({..._.value,...a.value}),set:e=>{_.value=e}}),y=u(()=>{var e,o;return(o=(e=m.workflow)==null?void 0:e.nodes)==null?void 0:o.filter(v=>v.properties.kind===G.DataSource)}),L=i({current_tool_id:void 0});te("get_extra",()=>L.value);const N=e=>{a.value.nodeId=e;const o=y.value.find(v=>v.id==e);o.properties.nodeData&&o.properties.nodeData.toolLibId&&(L.value.current_tool_id=o.properties.nodeData.toolLibId),e=o?[h.DataSourceLocalNode,h.DataSourceWebNode].includes(o.type)?o.type:o.properties.nodeData.toolLibId:e,A({type:"knowledge",systemType:d.value}).getKnowledgeWorkflowFormList(m.knowledgeId,[h.DataSourceLocalNode,h.DataSourceWebNode].includes(o.type)?"local":"tool",e,o,t).then(v=>{var $;($=s.value)==null||$.render(v.data)})},U=i({nodeId:{required:!0,trigger:"blur",message:P("views.tool.dataSource.requiredMessage")}}),q=()=>{var e;return(e=s.value)==null?void 0:e.validate()},O=()=>C.value;return x(y,()=>{a.value.nodeId||y.value&&y.value.length>0&&N(y.value[0].id)},{immediate:!0}),w({validate:q,get_data:O}),(e,o)=>{const v=I("el-card"),$=I("el-col"),j=I("el-row"),M=I("el-form-item");return c(),g(K,{modelValue:C.value,"onUpdate:modelValue":o[0]||(o[0]=n=>C.value=n),render_data:r.value,model:C.value,ref_key:"dynamicsFormRef",ref:s,"label-position":"top","require-asterisk-position":"right","other-params":{current_workspace_id:f.value,current_knowledge_id:e.knowledgeId}},{default:b(()=>[T("h4",re,V(e.$t("views.tool.dataSource.selectDataSource")),1),R(M,{label:e.$t("views.tool.dataSource.title"),prop:"nodeId",rules:U.value.nodeId},{default:b(()=>[R(j,{class:"w-full",gutter:8},{default:b(()=>[(c(!0),E(H,null,J(y.value,n=>(c(),g($,{span:8,key:n.id},{default:b(()=>[R(v,{shadow:"never",class:Q(["card-checkbox cursor w-full mb-8",a.value.nodeId===n.id?"active":""]),style:{"--el-card-padding":"4px 12px"},onClick:pe=>N(n.id)},{default:b(()=>[T("div",ne,[(c(),g(Y(Z(ee)(`${n.type}-icon`)),{class:"mr-8",size:20,item:n==null?void 0:n.properties.nodeData},null,8,["item"])),X(" "+V(n.properties.nodeName),1)])]),_:2},1032,["class","onClick"])]),_:2},1024))),128))]),_:1})]),_:1},8,["label","rules"])]),_:1},8,["modelValue","render_data","model","other-params"])}}}),ie={class:"title-decoration-1 mb-16 mt-4"},ue={key:0,class:"mb-16"},fe=F({__name:"Result",props:{id:{},knowledgeId:{},isRecord:{type:Boolean}},setup(D){const w=W(),p=D,S=u(()=>d.value?Object.values(d.value.details):[]),l=u(()=>d.value?d.value.state:"PADDING"),m=u(()=>w.path.includes("shared")?"systemShare":w.path.includes("resource-management")?"systemManage":"workspace"),d=i();let r=null;const f=()=>{r!=null&&A({type:"knowledge",systemType:m.value}).getWorkflowAction(p.knowledgeId,p.id).then(t=>{d.value=t.data}).finally(()=>{["SUCCESS","FAILURE","REVOKED"].includes(l.value)?k():r=setTimeout(f,2e3)})},k=()=>{r&&(clearTimeout(r),r=null)};return r=setTimeout(f,0),x(()=>p.id,()=>{k(),r=setTimeout(f,0)}),ae(()=>{k()}),(t,s)=>{const a=I("el-alert");return c(),E("div",null,[T("h4",ie,V(t.$t("chat.executionDetails.title")),1),t.isRecord?B("",!0):(c(),E("div",ue,[l.value=="SUCCESS"?(c(),g(a,{key:0,title:t.$t("common.status.success"),type:"success","show-icon":"",closable:!1},null,8,["title"])):B("",!0),l.value=="STARTED"?(c(),g(a,{key:1,title:t.$t("common.status.padding"),type:"info","show-icon":"",closable:!1},null,8,["title"])):B("",!0),l.value=="FAILURE"?(c(),g(a,{key:2,title:t.$t("common.status.fail"),type:"error","show-icon":"",closable:!1},null,8,["title"])):B("",!0)])),R(oe,{detail:S.value,"app-type":"WORK_FLOW"},null,8,["detail"])])}}}),ce={class:"title-decoration-1 mb-16 mt-4"},ve=F({__name:"KnowledgeBase",props:{workflow:{}},setup(D,{expose:w}){const p=D,S=i(),l=i({}),m=i(),d=()=>{var t;return(t=m.value)==null?void 0:t.validate()},r=u(()=>{var s,a;return((a=(s=p.workflow)==null?void 0:s.nodes)==null?void 0:a.find(_=>_.type===h.KnowledgeBase)).properties.user_input_config.title}),f=u(()=>{var s,a;const t=(a=(s=p.workflow)==null?void 0:s.nodes)==null?void 0:a.find(_=>_.type===h.KnowledgeBase);return t?t.properties.user_input_field_list:[]});return w({validate:d,get_data:()=>l.value}),(t,s)=>{const a=se("loading");return le((c(),g(K,{modelValue:l.value,"onUpdate:modelValue":s[0]||(s[0]=_=>l.value=_),render_data:f.value,model:l.value,ref_key:"dynamicsFormRef",ref:m,"label-position":"top","require-asterisk-position":"right"},{default:b(()=>[T("h4",ce,V(r.value||t.$t("chat.userInput")),1)]),_:1},8,["modelValue","render_data","model"])),[[a,S.value]])}}});export{fe as _,ve as a,_e as b};
