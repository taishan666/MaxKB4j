import{ay as xe,aA as Se,aB as m,b8 as Ue,bn as Fe,b_ as Be,b9 as Ie,bq as Me,aL as Pe,aD as n,ba as A,aF as s,aH as o,aG as a,aK as b,aJ as u,bk as L,aC as d,aI as c,aE as r,bj as _,bb as ee,bc as te,c4 as Re,c5 as De,cv as y,bd as h,c7 as le,cP as v,ca as Ee,c9 as oe,bm as ae,be as ze}from"./chat-C--1ojLo.js";import{_ as Oe,a as je,b as qe}from"./ToolFormDrawer.vue_vue_type_script_setup_true_lang-BU813m73.js";import{l as Je}from"./permission-api-DdmE9BQ4.js";import"./FieldFormDialog.vue_vue_type_script_setup_true_lang-DWLzZUEP.js";import"./workspace-CkWwQS9B.js";var ne=(F=>(F.CUSTOM="common.custom",F.INTERNAL="views.tool.toolStore.internal",F))(ne||{});const We={class:"resource-manage_tool p-16-24"},He={class:"ml-4 color-text-primary"},Ge={class:"flex-between mb-16"},Ke={class:"complex-search"},Qe={class:"table-name flex align-center"},Xe=["src"],Ye={key:0},Ze={key:1},et={key:0,class:"flex align-center"},tt={class:"color-secondary"},lt={key:1,class:"flex align-center"},ot={class:"color-secondary"},at={class:"filter"},nt={class:"form-item mb-16 ml-4"},st={class:"text-right"},it={class:"mr-8"},ct={class:"mr-8"},rt={class:"mr-8"},_t=xe({__name:"ToolResourceIndex",setup(F){const{user:J}=Se(),k=m("name"),$=m({name:"",createUser:""}),W=m([]),N=m(!1),x=m(!1),H=m([]),S=Ue({current_page:1,page_size:20,total:0}),B=m([]),I=m(!1),C=m([]),f=Fe(()=>Be.tool.systemManage),se=e=>{var t;return f.value.export()||f.value.delete()||((t=e.initFieldList)==null?void 0:t.length)>0&&f.value.edit()};function ie(e){v.exportTool(e.id,e.name,N).catch(t=>{t.response.status!==403&&t.response.data.text().then(i=>{Ee(`${d("views.application.tip.ExportError")}:${JSON.parse(i).message}`)})})}function ce(e){oe(`${d("views.tool.delete.confirmTitle")}ï¼š${e.name} ?`,d("views.tool.delete.confirmMessage"),{confirmButtonText:d("common.confirm"),cancelButtonText:d("common.cancel"),confirmButtonClass:"danger"}).then(()=>{v.delTool(e.id,N).then(()=>{p(),ae(d("common.deleteSuccess"))})}).catch(()=>{})}function re(e){v.getToolById(e==null?void 0:e.id,x).then(t=>{D.value.open(t.data)})}async function me(e){R.value=d("views.tool.copyTool");const t=await v.getToolById(e.id,x),i=ze.cloneDeep(t.data);delete i.id,i.name=i.name+`  ${d("common.copyTitle")}`,M.value.open(i)}const M=m(),R=m("");function de(e){e!=null&&e.template_id||(R.value=d("views.tool.editTool"),e?v.getToolById(e==null?void 0:e.id,N).then(t=>{M.value.open(t.data)}):M.value.open(e))}const G=m();function ue(e,t){var i;(i=G.value)==null||i.open(e,t)}function pe(e,t){t&&v.putTool(e==null?void 0:e.id,{name:e.name},N).then(i=>{ae(d("common.saveSuccess")),E()})}const D=m();async function fe(e){if(e.isActive)oe(`${d("views.tool.disabled.confirmTitle")}${e.name} ?`,d("views.tool.disabled.confirmMessage"),{confirmButtonText:d("common.status.disable"),confirmButtonClass:"danger"}).then(()=>{const t={isActive:!e.isActive};v.putTool(e.id,t,x).then(()=>(p(),!0)).catch(()=>!1)});else{const t=await v.getToolById(e.id,x);if((!t.data.initParams||Object.keys(t.data.initParams).length===0)&&t.data.initFieldList&&t.data.initFieldList.length>0&&t.data.initFieldList.filter(T=>T.default_value&&T.show_default_value).length!==t.data.initFieldList.length)return D.value.open(t.data,!e.isActive),!1;const i={isActive:!e.isActive};v.putTool(e.id,i,x).then(()=>(p(),!0)).catch(()=>!1)}}const U=m(""),P=m([]);Ie([()=>B.value,()=>U.value],()=>{U.value.length||(P.value=B.value),P.value=B.value.filter(e=>e.label.toLowerCase().includes(U.value.toLowerCase()))},{immediate:!0});function K(e){e==="clear"&&(C.value=[]),p(),I.value=!1}async function _e(){if(J.isEE()){const e=await Je("workspace").getSystemWorkspaceList(N);B.value=e.data.map(t=>({label:t.name,value:t.id}))}}const ve=()=>{$.value={name:"",createUser:""}};function p(){const e={};$.value[k.value]&&(e[k.value]=$.value[k.value]),C.value.length>0&&(e.workspace_ids=JSON.stringify(C.value)),v.getToolListPage(S,e,N).then(t=>{var i,T;S.total=(i=t.data)==null?void 0:i.total,H.value=(T=t.data)==null?void 0:T.records})}function E(e){e||(S.total=0,S.current_page=1),p()}return Me(()=>{_e(),p(),Pe.getAllMemberList("").then(e=>{W.value=e.data})}),(e,t)=>{const i=n("el-breadcrumb-item"),T=n("el-breadcrumb"),z=n("el-option"),Q=n("el-select"),X=n("el-input"),Y=n("el-avatar"),O=n("el-icon"),g=n("el-table-column"),be=n("SuccessFilled"),he=n("Filter"),w=n("el-button"),ge=n("el-checkbox"),ye=n("el-checkbox-group"),ke=n("el-scrollbar"),$e=n("el-empty"),Ce=n("el-popover"),Te=n("el-switch"),we=n("el-divider"),j=n("el-tooltip"),q=n("el-dropdown-item"),Ve=n("el-dropdown-menu"),Ae=n("el-dropdown"),Le=n("app-table"),Ne=n("el-card");return s(),A("div",We,[o(T,{"separator-icon":"ArrowRight"},{default:a(()=>[o(i,null,{default:a(()=>[b(u(L(d)("views.system.resource_management.label")),1)]),_:1}),o(i,null,{default:a(()=>[c("h5",He,u(L(d)("views.tool.title")),1)]),_:1})]),_:1}),o(Ne,{class:"mt-16",style:{height:"calc(var(--app-main-height) + 20px)"}},{default:a(()=>[c("div",Ge,[c("div",Ke,[o(Q,{class:"complex-search__left",modelValue:k.value,"onUpdate:modelValue":t[0]||(t[0]=l=>k.value=l),style:{width:"120px"},onChange:ve},{default:a(()=>[o(z,{label:e.$t("common.creator"),value:"createUser"},null,8,["label"]),o(z,{label:e.$t("views.tool.form.toolName.label"),value:"name"},null,8,["label"])]),_:1},8,["modelValue"]),k.value==="name"?(s(),r(X,{key:0,modelValue:$.value.name,"onUpdate:modelValue":t[1]||(t[1]=l=>$.value.name=l),onChange:p,placeholder:e.$t("common.searchBar.placeholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):k.value==="createUser"?(s(),r(Q,{key:1,modelValue:$.value.createUser,"onUpdate:modelValue":t[2]||(t[2]=l=>$.value.createUser=l),onChange:p,filterable:"",clearable:"",style:{width:"220px"}},{default:a(()=>[(s(!0),A(ee,null,te(W.value,l=>(s(),r(z,{key:l.id,value:l.id,label:l.nickname},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):_("",!0)])]),o(Le,{data:H.value,"pagination-config":S,onSizeChange:p,onChangePage:p,maxTableHeight:260},{default:a(()=>[o(g,{width:"220",label:e.$t("common.name"),"show-overflow-tooltip":""},{default:a(({row:l})=>[c("div",Qe,[o(O,{size:"24",class:"mr-8"},{default:a(()=>[l!=null&&l.icon?(s(),r(Y,{key:0,shape:"square",size:24,style:{background:"none"},class:"mr-8"},{default:a(()=>[c("img",{src:L(Re)(l==null?void 0:l.icon),alt:""},null,8,Xe)]),_:2},1024)):(s(),r(Y,{key:1,class:"avatar-green",shape:"square",size:24},{default:a(()=>t[10]||(t[10]=[c("img",{src:De,style:{width:"58%"},alt:""},null,-1)])),_:1,__:[10]}))]),_:2},1024),b(" "+u(l.name),1)])]),_:1},8,["label"]),o(g,{prop:"toolType",label:e.$t("views.system.resource_management.type")},{default:a(l=>[l.row.toolType==="MCP"?(s(),A("span",Ye," MCP ")):(s(),A("span",Ze,u(e.$t(L(ne)[l.row.template_id?"INTERNAL":"CUSTOM"])),1))]),_:1},8,["label"]),o(g,{label:e.$t("common.status.label"),width:"120"},{default:a(({row:l})=>[l.isActive?(s(),A("div",et,[o(O,{class:"color-success mr-8",style:{"font-size":"16px"}},{default:a(()=>[o(be)]),_:1}),c("span",tt,u(e.$t("common.status.enabled")),1)])):(s(),A("div",lt,[o(y,{iconName:"app-disabled",class:"color-secondary mr-8"}),c("span",ot,u(e.$t("common.status.disabled")),1)]))]),_:1},8,["label"]),L(J).isEE()?(s(),r(g,{key:0,width:"150",prop:"workspace_name",label:e.$t("views.workspace.title"),"show-overflow-tooltip":""},{header:a(()=>[c("div",null,[c("span",null,u(e.$t("views.workspace.title")),1),o(Ce,{width:200,trigger:"click",visible:I.value},{reference:a(()=>[o(w,{style:{"margin-top":"-2px"},type:C.value&&C.value.length>0?"primary":"",link:"",onClick:t[3]||(t[3]=l=>I.value=!I.value)},{default:a(()=>[o(O,null,{default:a(()=>[o(he)]),_:1})]),_:1},8,["type"])]),default:a(()=>[c("div",at,[c("div",nt,[c("div",{onClick:t[6]||(t[6]=h(()=>{},["stop"]))},[o(X,{modelValue:U.value,"onUpdate:modelValue":t[4]||(t[4]=l=>U.value=l),placeholder:e.$t("common.search"),"prefix-icon":"Search",clearable:""},null,8,["modelValue","placeholder"]),P.value.length?(s(),r(ke,{key:0,height:"300"},{default:a(()=>[o(ye,{modelValue:C.value,"onUpdate:modelValue":t[5]||(t[5]=l=>C.value=l),style:{display:"flex","flex-direction":"column"}},{default:a(()=>[(s(!0),A(ee,null,te(P.value,l=>(s(),r(ge,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):(s(),r($e,{key:1,description:e.$t("common.noData")},null,8,["description"]))])])]),c("div",st,[o(w,{size:"small",onClick:t[7]||(t[7]=l=>K("clear"))},{default:a(()=>[b(u(e.$t("common.clear")),1)]),_:1}),o(w,{type:"primary",onClick:K,size:"small"},{default:a(()=>[b(u(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"])])]),_:1},8,["label"])):_("",!0),o(g,{prop:"nickname",label:e.$t("common.creator"),"show-overflow-tooltip":""},null,8,["label"]),o(g,{label:e.$t("views.document.table.updateTime"),width:"180"},{default:a(({row:l})=>[b(u(L(le)(l.update_time)),1)]),_:1},8,["label"]),o(g,{label:e.$t("common.createTime"),width:"180"},{default:a(({row:l})=>[b(u(L(le)(l.createTime)),1)]),_:1},8,["label"]),o(g,{label:e.$t("common.operation"),align:"left",width:"160",fixed:"right"},{default:a(({row:l})=>[c("span",{onClick:t[8]||(t[8]=h(()=>{},["stop"]))},[f.value.switch()?(s(),r(Te,{key:0,modelValue:l.isActive,"onUpdate:modelValue":V=>l.isActive=V,"before-change":()=>fe(l),size:"small",class:"mr-4"},null,8,["modelValue","onUpdate:modelValue","before-change"])):_("",!0)]),o(we,{direction:"vertical"}),l.template_id&&f.value.edit()?(s(),r(j,{key:0,effect:"dark",content:e.$t("common.edit"),placement:"top"},{default:a(()=>[c("span",it,[o(w,{type:"primary",text:"",onClick:h(V=>ue(l,!0),["stop"]),title:e.$t("common.edit")},{default:a(()=>[o(y,{iconName:"app-edit"})]),_:2},1032,["onClick","title"])])]),_:2},1032,["content"])):_("",!0),!l.template_id&&f.value.edit()?(s(),r(j,{key:1,effect:"dark",content:e.$t("common.edit"),placement:"top"},{default:a(()=>[c("span",ct,[o(w,{type:"primary",text:"",onClick:h(V=>de(l),["stop"]),title:e.$t("common.edit")},{default:a(()=>[o(y,{iconName:"app-edit"})]),_:2},1032,["onClick","title"])])]),_:2},1032,["content"])):_("",!0),!l.template_id&&f.value.copy()?(s(),r(j,{key:2,effect:"dark",content:e.$t("common.copy"),placement:"top"},{default:a(()=>[c("span",rt,[o(w,{type:"primary",text:"",onClick:h(V=>me(l),["stop"]),title:e.$t("common.copy")},{default:a(()=>[o(y,{iconName:"app-copy"})]),_:2},1032,["onClick","title"])])]),_:2},1032,["content"])):_("",!0),se(l)?(s(),r(Ae,{key:3,trigger:"click"},{dropdown:a(()=>[o(Ve,null,{default:a(()=>{var V;return[((V=l.initFieldList)==null?void 0:V.length)>0&&f.value.edit()?(s(),r(q,{key:0,onClick:h(Z=>re(l),["stop"])},{default:a(()=>[o(y,{iconName:"app-operation",class:"color-secondary"}),b(" "+u(e.$t("common.param.initParam")),1)]),_:2},1032,["onClick"])):_("",!0),!l.template_id&&f.value.export()?(s(),r(q,{key:1,onClick:h(Z=>ie(l),["stop"])},{default:a(()=>[o(y,{iconName:"app-export",class:"color-secondary"}),b(" "+u(e.$t("common.export")),1)]),_:2},1032,["onClick"])):_("",!0),f.value.delete()?(s(),r(q,{key:2,divided:"",onClick:h(Z=>ce(l),["stop"])},{default:a(()=>[o(y,{iconName:"app-delete",class:"color-secondary"}),b(" "+u(e.$t("common.delete")),1)]),_:2},1032,["onClick"])):_("",!0)]}),_:2},1024)]),default:a(()=>[o(w,{text:"",onClick:t[9]||(t[9]=h(()=>{},["stop"]))},{default:a(()=>[o(y,{iconName:"app-more"})]),_:1})]),_:2},1024)):_("",!0)]),_:1},8,["label"])]),_:1},8,["data","pagination-config"])]),_:1}),o(Oe,{ref_key:"InitParamDrawerRef",ref:D,onRefresh:E},null,512),o(je,{ref_key:"ToolFormDrawerRef",ref:M,onRefresh:E,title:R.value},null,8,["title"]),o(qe,{ref_key:"AddInternalToolDialogRef",ref:G,onRefresh:pe},null,512)])}}});export{_t as default};
