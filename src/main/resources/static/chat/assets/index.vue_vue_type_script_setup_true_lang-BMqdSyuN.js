import{aJ as se,bo as ie,aY as ue,aK as W,aP as r,bp as re,bb as ce,aQ as n,aZ as me,aL as d,aM as s,aR as o,aT as C,b0 as de,aS as t,aV as _,aW as g,b1 as j,a_ as D,b5 as F,b6 as I,cG as O,bi as pe,bc as ve}from"./chat-ChhQLBW1.js";import{g as ge}from"./constant-CDUVnNo5.js";const be={class:"flex-between mb-16"},fe={class:"flex-between complex-search"},_e={class:"color-text-primary lighter"},he={class:"dialog-footer mt-24"},we=se({__name:"index",props:{type:{}},setup(E,{expose:G}){const J=ie(),{user:M}=ue(),P=E,R=W(()=>J.path.includes("resource-management")?"systemManage":"workspace"),S=W(()=>ge()),h=r(!1),$=r();re(h,e=>{var l;e||(y.value="",c.value="nickname",i.value={nickname:"",username:"",permission:void 0},T.value=[],p.current_page=1,p.total=0,v.value=[],(l=$.value)==null||l.clearSelection())});const z=r(!1),y=r(""),T=r([]),c=r("nickname"),i=r({nickname:"",username:"",permission:void 0}),K=()=>{i.value={nickname:"",username:"",permission:void 0}},p=ce({current_page:1,page_size:20,total:0});function Q(){p.current_page=1,f()}function U(){p.current_page=1,f()}const v=r([]),Y=e=>{v.value=e},k=r(!1),b=r("");function Z(){v.value.length!==0&&(k.value=!0)}function q(){if(v.value.length===0||!b.value)return;const e=v.value.map(l=>({userId:l.id,permission:b.value}));x(e),A()}function A(){var e;k.value=!1,b.value="",v.value=[],(e=$.value)==null||e.clearSelection()}function X(e,l){const m=[{userId:l.id,permission:e}];x(m)}function x(e){const l=M.getWorkspaceId()||"default";O({type:"resourceAuthorization",systemType:R.value}).putResourceAuthorization(l,y.value,P.type,e,z).then(()=>{pe(ve("common.submitSuccess")),f()})}const f=()=>{const e=M.getWorkspaceId()||"default",l={};i.value[c.value]&&(l[c.value]=i.value[c.value]),O({type:"resourceAuthorization",systemType:R.value}).getResourceAuthorization(e,y.value,P.type,p,l,z).then(m=>{T.value=m.data.records||[],p.total=m.data.total||0})};return G({open:e=>{y.value=e,h.value=!0,f()}}),(e,l)=>{const m=n("el-button"),V=n("el-option"),B=n("el-select"),N=n("el-input"),w=n("el-table-column"),H=n("el-radio"),L=n("el-radio-group"),ee=n("app-table"),le=n("el-text"),ae=n("el-dialog"),oe=n("el-drawer"),te=me("loading");return s(),d(oe,{modelValue:h.value,"onUpdate:modelValue":l[6]||(l[6]=a=>h.value=a),title:e.$t("views.system.resourceAuthorization.title"),size:"60%","append-to-body":!0},{default:o(()=>[C("div",be,[t(m,{type:"primary",disabled:v.value.length===0,onClick:Z},{default:o(()=>[_(g(e.$t("views.system.resourceAuthorization.setting.configure")),1)]),_:1},8,["disabled"]),C("div",fe,[t(B,{class:"complex-search__left",modelValue:c.value,"onUpdate:modelValue":l[0]||(l[0]=a=>c.value=a),style:{width:"100px"},onChange:K},{default:o(()=>[t(V,{label:e.$t("views.userManage.userForm.nickname.label"),value:"nickname"},null,8,["label"]),t(V,{label:e.$t("views.login.loginForm.username.label"),value:"username"},null,8,["label"]),t(V,{label:e.$t("views.model.modelForm.permissionType.label"),value:"permission"},null,8,["label"])]),_:1},8,["modelValue"]),c.value==="nickname"?(s(),d(N,{key:0,modelValue:i.value.nickname,"onUpdate:modelValue":l[1]||(l[1]=a=>i.value.nickname=a),onChange:U,placeholder:e.$t("common.search"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):j("",!0),c.value==="username"?(s(),d(N,{key:1,modelValue:i.value.username,"onUpdate:modelValue":l[2]||(l[2]=a=>i.value.username=a),onChange:U,placeholder:e.$t("common.search"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):c.value==="permission"?(s(),d(B,{key:2,modelValue:i.value.permission,"onUpdate:modelValue":l[3]||(l[3]=a=>i.value.permission=a),onChange:U,filterable:"",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"",style:{width:"220px"}},{default:o(()=>[(s(!0),D(F,null,I(S.value,(a,u)=>(s(),d(V,{key:u,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):j("",!0)])]),de((s(),d(ee,{ref_key:"multipleTableRef",ref:$,class:"mt-16",data:T.value,"pagination-config":p,onSizeChange:Q,onChangePage:f,onSelectionChange:Y,maxTableHeight:200,"row-key":a=>a.id},{default:o(()=>[t(w,{type:"selection",width:"55","reserve-selection":!0}),t(w,{prop:"nickname",label:e.$t("views.userManage.userForm.nickname.label"),"min-width":"120","show-overflow-tooltip":""},null,8,["label"]),t(w,{prop:"username","min-width":"120","show-overflow-tooltip":"",label:e.$t("views.login.loginForm.username.label")},null,8,["label"]),t(w,{label:e.$t("common.operation"),align:"left",width:"340"},{default:o(({row:a})=>[t(L,{modelValue:a.permission,"onUpdate:modelValue":u=>a.permission=u,onChange:u=>X(u,a)},{default:o(()=>[(s(!0),D(F,null,I(S.value,(u,ne)=>(s(),d(H,{key:ne,value:u.value,class:"mr-16"},{default:o(()=>[_(g(u.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["label"])]),_:1},8,["data","pagination-config","row-key"])),[[te,z.value]]),t(ae,{modelValue:k.value,"onUpdate:modelValue":l[5]||(l[5]=a=>k.value=a),title:e.$t("views.system.resourceAuthorization.setting.configure"),"destroy-on-close":"",onClose:A},{footer:o(()=>[C("div",he,[t(m,{onClick:A},{default:o(()=>[_(g(e.$t("common.cancel")),1)]),_:1}),t(m,{type:"primary",onClick:q},{default:o(()=>[_(g(e.$t("common.confirm")),1)]),_:1})])]),default:o(()=>[t(L,{modelValue:b.value,"onUpdate:modelValue":l[4]||(l[4]=a=>b.value=a),class:"radio-block"},{default:o(()=>[(s(!0),D(F,null,I(S.value,(a,u)=>(s(),d(H,{key:u,value:a.value,class:"mr-16"},{default:o(()=>[C("p",_e,g(a.label),1),t(le,{class:"color-secondary lighter"},{default:o(()=>[_(g(a.desc),1)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"])]),_:1},8,["modelValue","title"])}}});export{we as _};
