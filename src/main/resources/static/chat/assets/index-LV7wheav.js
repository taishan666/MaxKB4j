import{aJ as ye,aY as Ce,bb as ke,bf as u,aP as _,be as Ae,bo as Fe,aQ as n,aL as h,aM as m,aO as T,e4 as Q,aR as a,aS as o,b1 as U,aT as f,bl as Te,aV as v,aW as d,aU as L,fi as q,bj as Ie,b9 as Ze,bt as Ge,aK as De,e7 as je,bg as Je,fj as Qe,aZ as Ye,fk as eo,b0 as oo,a_ as te,fl as ao,b7 as Oe,b8 as Me,fm as to,b5 as W,fn as lo,eD as no,fo as io,e2 as We,fp as so,fq as ro,e9 as ce,ed as po,ee as co,cp as le,cy as V,cx as F,cz as A,cq as N,bk as Ve,ea as uo}from"./chat-DmcU5C5M.js";import{_ as mo}from"./icon_import-D9IDqZyN.js";import{b as Ue}from"./data-CyF_co-P.js";import{M as fo}from"./MoveToDialog-CivbHeJc.js";import{_ as _o}from"./index.vue_vue_type_script_setup_true_lang-CRqUJIkW.js";import"./constant-xXVRI9sG.js";import"./system-CkhRQyt6.js";const go="data:image/svg+xml,%3csvg%20width='20'%20height='20'%20viewBox='0%200%2020%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M0.833313%207.4004C0.833313%207.04021%201.20266%206.79818%201.53291%206.94197L8.77364%2010.0945C8.95607%2010.1739%209.07404%2010.354%209.07404%2010.553V18.339C9.07404%2018.7152%208.67435%2018.9566%208.34141%2018.7816L1.14372%2014.9983C1.05096%2014.9474%200.973499%2014.8738%200.919056%2014.7847C0.864612%2014.6957%200.835079%2014.5943%200.833395%2014.4907L0.833313%2014.4814V7.4004ZM18.4644%206.93223C18.795%206.78607%2019.1666%207.0281%2019.1666%207.38952V14.4814C19.1666%2014.5866%2019.1379%2014.6899%2019.0833%2014.7807C19.0288%2014.8715%2018.9504%2014.9466%2018.8562%2014.9983L11.6585%2018.7816C11.3256%2018.9566%2010.9259%2018.7152%2010.9259%2018.339L10.9259%2010.5912C10.9259%2010.3933%2011.0427%2010.214%2011.2237%2010.1339L18.4644%206.93223ZM9.69988%201.7434C9.79147%201.69315%209.89483%201.66675%209.99998%201.66675C10.1051%201.66675%2010.2085%201.69315%2010.3001%201.7434L17.198%204.80727C17.5962%204.98413%2017.5934%205.55024%2017.1935%205.72316L10.1984%208.74757C10.0718%208.80232%209.92817%208.80232%209.80155%208.74757L2.80644%205.72316C2.40651%205.55025%202.40371%204.98413%202.80191%204.80727L9.69988%201.7434Z'%20fill='white'/%3e%3c/svg%3e",vo="data:image/svg+xml,%3csvg%20width='20'%20height='20'%20viewBox='0%200%2020%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M3.18428%204.04678C3.99599%203.49862%204.93827%203.33337%205.56826%203.33337H12.5001C12.0398%203.33337%2011.6667%203.70647%2011.6667%204.16671C11.6667%204.62694%2012.0398%205.00004%2012.5001%205.00004H5.56826C5.17552%205.00004%204.58372%205.11283%204.11702%205.428C3.69634%205.71209%203.33341%206.18316%203.33341%207.06392C3.33341%207.94608%203.69793%208.42805%204.12319%208.72081C4.59235%209.04379%205.18357%209.16132%205.56826%209.16132H14.4978C15.1332%209.16132%2016.0634%209.3331%2016.8602%209.89052C17.7012%2010.4789%2018.3334%2011.4598%2018.3334%2012.9079C18.3334%2014.3555%2017.7017%2015.3385%2016.8624%2015.9298C16.0666%2016.4905%2015.1362%2016.6667%2014.4978%2016.6667H7.50008C7.96032%2016.6667%208.33342%2016.2936%208.33342%2015.8334C8.33342%2015.3731%207.96032%2015%207.50008%2015H14.4978C14.882%2015%2015.4529%2014.8841%2015.9025%2014.5673C16.3087%2014.2812%2016.6667%2013.8014%2016.6667%2012.9079C16.6667%2012.0149%2016.3092%2011.5391%2015.9047%2011.2562C15.4561%2010.9423%2014.8851%2010.828%2014.4978%2010.828H5.56826C4.93022%2010.828%203.98736%2010.6507%203.17811%2010.0936C2.32496%209.50629%201.66675%208.52289%201.66675%207.06392C1.66675%205.60354%202.32656%204.62601%203.18428%204.04678Z'%20fill='white'/%3e%3cpath%20d='M7.50008%2015C7.03984%2015%206.66675%2015.3731%206.66675%2015.8334C6.66675%2016.2936%207.03984%2016.6667%207.50008%2016.6667H2.50008C2.03984%2016.6667%201.66675%2016.2936%201.66675%2015.8334C1.66675%2015.3731%202.03984%2015%202.50008%2015H7.50008Z'%20fill='white'/%3e%3cpath%20d='M12.5001%205.00004C12.9603%205.00004%2013.3334%204.62694%2013.3334%204.16671C13.3334%203.70647%2012.9603%203.33337%2012.5001%203.33337H17.4546C17.9148%203.33337%2018.2879%203.70647%2018.2879%204.16671C18.2879%204.62694%2017.9148%205.00004%2017.4546%205.00004H12.5001Z'%20fill='white'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M12.5%203.33329C12.0398%203.33329%2011.6667%203.70639%2011.6667%204.16663C11.6667%204.62686%2012.0398%204.99996%2012.5%204.99996C12.9602%204.99996%2013.3333%204.62686%2013.3333%204.16663C13.3333%203.70639%2012.9602%203.33329%2012.5%203.33329ZM10%204.16663C10%202.78591%2011.1193%201.66663%2012.5%201.66663C13.8807%201.66663%2015%202.78591%2015%204.16663C15%205.54734%2013.8807%206.66663%2012.5%206.66663C11.1193%206.66663%2010%205.54734%2010%204.16663Z'%20fill='white'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M7.5%2015C7.03976%2015%206.66667%2015.3731%206.66667%2015.8334C6.66667%2016.2936%207.03976%2016.6667%207.5%2016.6667C7.96024%2016.6667%208.33333%2016.2936%208.33333%2015.8334C8.33333%2015.3731%207.96024%2015%207.5%2015ZM5%2015.8334C5%2014.4527%206.11929%2013.3334%207.5%2013.3334C8.88071%2013.3334%2010%2014.4527%2010%2015.8334C10%2017.2141%208.88071%2018.3334%207.5%2018.3334C6.11929%2018.3334%205%2017.2141%205%2015.8334Z'%20fill='white'/%3e%3c/svg%3e",bo={blank:{edges:[],nodes:Ue},assistant:{nodes:[{id:"base-node",type:"base-node",x:120,y:260.30849999999987,properties:{config:{},height:734.766,showNode:!0,nodeName:"基本信息",nodeData:{desc:"模板",name:"知识库问答助手",prologue:`您好，我是 XXX 小助手，您可以向我提出 XXX 使用问题。
- XXX 主要功能有什么？
- XXX 如何收费？
- 需要转人工服务`,ttsType:"BROWSER"},inputFieldList:[],user_input_config:{title:"用户输入"},api_input_field_list:[],user_input_field_list:[]}},{id:"start-node",type:"start-node",x:120,y:929.6914999999999,properties:{config:{fields:[{label:"用户问题",value:"question"}],globalFields:[{label:"当前时间",value:"time"},{label:"历史聊天记录",value:"historyContext"},{label:"对话 ID",value:"chatId"}]},fields:[{label:"用户问题",value:"question"}],height:364,showNode:!0,nodeName:"开始",globalFields:[{label:"当前时间",value:"time"}]}},{id:"fd0324fc-f5e4-4fa6-a2d9-cb251b467605",type:"search-knowledge-node",x:710,y:929.6914999999999,properties:{config:{fields:[{label:"检索结果的分段列表",value:"paragraphList"},{label:"满足直接回答的分段列表",value:"isHitHandlingMethodList"},{label:"检索结果",value:"data"},{label:"满足直接回答的分段内容",value:"directlyReturn"}]},height:794,showNode:!0,nodeName:"知识库检索",condition:"AND",nodeData:{knowledgeIdList:[],knowledgeSetting:{topN:3,similarity:.6,searchMode:"embedding",maxParagraphCharNumber:5e3},questionReferenceAddress:["start-node","question"],allKnowledgeIdList:[],knowledgeList:[],showKnowledge:!1}}},{id:"420a6e4f-44ff-4847-bb81-0923630846b5",type:"condition-node",x:1300,y:929.6914999999999,properties:{width:600,config:{fields:[{label:"分支名称",value:"branchName"}]},height:544.148,showNode:!0,nodeName:"判断器",condition:"AND",nodeData:{branch:[{id:"7887",type:"IF",condition:"and",conditions:[{field:["fd0324fc-f5e4-4fa6-a2d9-cb251b467605","isHitHandlingMethodList"],value:1,compare:"is_not_null"}]},{id:"6847",type:"ELSE IF 1",condition:"and",conditions:[{field:["fd0324fc-f5e4-4fa6-a2d9-cb251b467605","paragraphList"],value:1,compare:"is_not_null"}]},{id:"2794",type:"ELSE",condition:"and",conditions:[]}]},branch_condition_list:[{index:0,height:121.383,id:"7887"},{index:1,height:121.383,id:"6847"},{index:2,height:44,id:"2794"}]}},{id:"36a440a9-5b00-4d82-b13a-8e7819112918",type:"reply-node",x:1890,y:120,properties:{config:{fields:[{label:"内容",value:"answer"}]},height:386,showNode:!0,nodeName:"指定回复",condition:"AND",nodeData:{fields:["fd0324fc-f5e4-4fa6-a2d9-cb251b467605","directlyReturn"],content:"",isResult:!0,replyType:"referencing"}}},{id:"f7c3b4a2-cb80-4e47-b050-7fef0315daaf",type:"ai-chat-node",x:1890,y:929.6914999999999,properties:{config:{fields:[{label:"AI 回答内容",value:"answer"},{label:"思考过程",value:"reasoningContent"}]},height:993.383,showNode:!0,nodeName:"AI 对话",condition:"AND",nodeData:{prompt:`已知信息：
{{知识库检索.data}}
问题：
{{开始.question}}`,system:"",modelId:"",isResult:!0,maxTokens:null,temperature:null,dialogueType:"WORK_FLOW",modelSetting:{reasoning_content_end:"</think>",reasoning_content_start:"<think>",reasoningContentEnable:!1},dialogueNumber:1}}},{id:"04dd6c1e-95f9-4757-bb3e-134d503fce54",type:"reply-node",x:1890,y:1798.383,properties:{config:{fields:[{label:"内容",value:"answer"}]},height:504,showNode:!0,nodeName:"指定回复1",condition:"AND",nodeData:{fields:[],content:"抱歉，没有在知识库查询到相关内容，请提供更详细的信息。",isResult:!0,replyType:"content"}}}],edges:[{id:"73f8992c-65ef-409a-a151-378d0927f2aa",type:"app-edge",sourceNodeId:"start-node",targetNodeId:"fd0324fc-f5e4-4fa6-a2d9-cb251b467605",startPoint:{x:280,y:929.6914999999999},endPoint:{x:550,y:929.6914999999999},properties:{},pointsList:[{x:280,y:929.6914999999999},{x:390,y:929.6914999999999},{x:440,y:929.6914999999999},{x:550,y:929.6914999999999}],sourceAnchorId:"start-node_right",targetAnchorId:"fd0324fc-f5e4-4fa6-a2d9-cb251b467605_left"},{id:"6a8d23d9-5179-424e-80c2-f08d37cdb8d4",type:"app-edge",sourceNodeId:"fd0324fc-f5e4-4fa6-a2d9-cb251b467605",targetNodeId:"420a6e4f-44ff-4847-bb81-0923630846b5",startPoint:{x:870,y:929.6914999999999},endPoint:{x:1010,y:929.6914999999999},properties:{},pointsList:[{x:870,y:929.6914999999999},{x:980,y:929.6914999999999},{x:900,y:929.6914999999999},{x:1010,y:929.6914999999999}],sourceAnchorId:"fd0324fc-f5e4-4fa6-a2d9-cb251b467605_right",targetAnchorId:"420a6e4f-44ff-4847-bb81-0923630846b5_left"},{id:"56006748-d9fe-491b-a14b-04fd568cac08",type:"app-edge",sourceNodeId:"420a6e4f-44ff-4847-bb81-0923630846b5",targetNodeId:"36a440a9-5b00-4d82-b13a-8e7819112918",startPoint:{x:1590,y:793.3089999999999},endPoint:{x:1730,y:120},properties:{},pointsList:[{x:1590,y:793.3089999999999},{x:1700,y:793.3089999999999},{x:1620,y:120},{x:1730,y:120}],sourceAnchorId:"420a6e4f-44ff-4847-bb81-0923630846b5_7887_right",targetAnchorId:"36a440a9-5b00-4d82-b13a-8e7819112918_left"},{id:"9bc8721b-07aa-4730-9347-910ed64e26b9",type:"app-edge",sourceNodeId:"420a6e4f-44ff-4847-bb81-0923630846b5",targetNodeId:"f7c3b4a2-cb80-4e47-b050-7fef0315daaf",startPoint:{x:1590,y:922.6919999999999},endPoint:{x:1730,y:929.6914999999999},properties:{},pointsList:[{x:1590,y:922.6919999999999},{x:1700,y:922.6919999999999},{x:1620,y:929.6914999999999},{x:1730,y:929.6914999999999}],sourceAnchorId:"420a6e4f-44ff-4847-bb81-0923630846b5_6847_right",targetAnchorId:"f7c3b4a2-cb80-4e47-b050-7fef0315daaf_left"},{id:"c276a5b6-ec29-4ab9-b911-a0a929ff193f",type:"app-edge",sourceNodeId:"420a6e4f-44ff-4847-bb81-0923630846b5",targetNodeId:"04dd6c1e-95f9-4757-bb3e-134d503fce54",startPoint:{x:1590,y:1013.3834999999998},endPoint:{x:1730,y:1798.383},properties:{},pointsList:[{x:1590,y:1013.3834999999998},{x:1700,y:1013.3834999999998},{x:1620,y:1798.383},{x:1730,y:1798.383}],sourceAnchorId:"420a6e4f-44ff-4847-bb81-0923630846b5_2794_right",targetAnchorId:"04dd6c1e-95f9-4757-bb3e-134d503fce54_left"}]}},ho={class:"w-full"},wo={class:"flex-center p-24"},yo={class:"dialog-footer"},Co=ye({__name:"CreateApplicationDialog",emits:["refresh"],setup(Pe,{expose:H,emit:B}){const{user:S}=Ce(),C=ke(),K=B,D=u("views.application.form.prompt.defaultPrompt",{data:"{data}",question:"{question}"}),b=u("views.application.dialog.defaultPrompt1",{question:"{question}"})+"<data></data>"+u("views.application.dialog.defaultPrompt2"),g=_({edges:[],nodes:Ue}),k=_("blank"),E=_(),z=_(!1),w=_(!1),i=_({name:"",desc:"",modelId:void 0,dialogueNumber:1,prologue:u("views.application.form.defaultPrologue"),knowledgeIdList:[],knowledgeSetting:{topN:3,similarity:.6,maxParagraphCharNumber:5e3,searchMode:"embedding",noReferencesSetting:{status:"ai_questioning",value:"{question}"}},modelSetting:{prompt:D,system:u("views.application.form.roleSettings.placeholder"),no_references_prompt:"{question}"},modelParamsSetting:{},problemOptimization:!1,problemOptimizationPrompt:b,sttModelId:void 0,ttsModelId:void 0,sttModelEnable:!1,ttsModelEnable:!1,ttsType:"BROWSER",type:"SIMPLE"}),s=Ae({name:[{required:!0,message:u("views.application.form.appName.placeholder"),trigger:"blur"}],modelId:[{required:!1,message:u("views.application.form.aiModel.placeholder"),trigger:"change"}]}),y=_("");Fe(w,c=>{var r;c||(i.value={name:"",desc:"",modelId:void 0,dialogueNumber:1,prologue:u("views.application.form.defaultPrologue"),knowledgeIdList:[],knowledgeSetting:{topN:3,similarity:.6,maxParagraphCharNumber:5e3,searchMode:"embedding",noReferencesSetting:{status:"ai_questioning",value:"{question}"}},modelSetting:{prompt:D,system:u("views.application.form.roleSettings.placeholder"),no_references_prompt:"{question}"},modelParamsSetting:{},problemOptimization:!1,problemOptimizationPrompt:b,sttModelId:void 0,ttsModelId:void 0,sttModelEnable:!1,ttsModelEnable:!1,ttsType:"BROWSER",type:"SIMPLE"},(r=E.value)==null||r.clearValidate())});const X=(c,r)=>{y.value=c,i.value.type=r||"SIMPLE",w.value=!0},Y=async c=>{c&&await c.validate(r=>{r&&(Q(i.value.type)&&(g.value.nodes[0].properties.nodeData.desc=i.value.desc,g.value.nodes[0].properties.nodeData.name=i.value.name,i.value.workFlow=g.value),q.postApplication({...i.value,folderId:y.value},z).then(x=>S.profile().then(()=>x)).then(x=>{Ie(u("common.createSuccess")),K("refresh"),Q(i.value.type)?C.push({path:`/application/workspace/${x.data.id}/workflow`}):C.push({path:`/application/workspace/${x.data.id}/${x.data.type}/setting`}),w.value=!1}))})};function Z(c){k.value=c,g.value=bo[c]}return H({open:X}),(c,r)=>{const x=n("el-input"),G=n("el-form-item"),ne=n("Plus"),ue=n("el-icon"),me=n("el-card"),ee=n("el-col"),fe=n("LogoIcon"),_e=n("el-text"),ge=n("CardBox"),ve=n("el-row"),ie=n("el-form"),se=n("el-button"),be=n("el-dialog");return m(),h(be,{title:T(Q)(i.value.type)?c.$t("views.application.createWorkFlowApplication"):c.$t("views.application.createApplication"),modelValue:w.value,"onUpdate:modelValue":r[8]||(r[8]=$=>w.value=$),width:"650","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:a(()=>[f("span",yo,[o(se,{onClick:r[6]||(r[6]=L($=>w.value=!1,["prevent"])),loading:z.value},{default:a(()=>[v(d(c.$t("common.cancel")),1)]),_:1},8,["loading"]),o(se,{type:"primary",onClick:r[7]||(r[7]=$=>Y(E.value)),loading:z.value},{default:a(()=>[v(d(c.$t("common.create")),1)]),_:1},8,["loading"])])]),default:a(()=>[o(ie,{ref_key:"applicationFormRef",ref:E,model:i.value,rules:s,"label-position":"top","require-asterisk-position":"right",onSubmit:r[5]||(r[5]=L(()=>{},["prevent"]))},{default:a(()=>[o(G,{label:c.$t("views.application.form.appName.label"),prop:"name"},{default:a(()=>[o(x,{modelValue:i.value.name,"onUpdate:modelValue":r[0]||(r[0]=$=>i.value.name=$),maxlength:"64",placeholder:c.$t("views.application.form.appName.placeholder"),"show-word-limit":"",onBlur:r[1]||(r[1]=$=>{var oe;return i.value.name=(oe=i.value.name)==null?void 0:oe.trim()})},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(G,{label:c.$t("views.application.form.appDescription.label")},{default:a(()=>[o(x,{modelValue:i.value.desc,"onUpdate:modelValue":r[2]||(r[2]=$=>i.value.desc=$),type:"textarea",placeholder:c.$t("views.application.form.appDescription.placeholder"),rows:3,maxlength:"256","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),i.value.type==="WORK_FLOW"?(m(),h(G,{key:0,label:c.$t("views.document.upload.template")},{default:a(()=>[f("div",ho,[o(ve,{gutter:16},{default:a(()=>[o(ee,{span:12},{default:a(()=>[o(me,{class:Te(["template-radio-card cursor text-center flex-center",k.value==="blank"?"active":""]),shadow:"never",onClick:r[3]||(r[3]=$=>Z("blank"))},{default:a(()=>[f("div",wo,[o(ue,{class:"mr-12"},{default:a(()=>[o(ne)]),_:1}),v(" "+d(c.$t("views.application.form.appTemplate.blankApp.title")),1)])]),_:1},8,["class"])]),_:1}),o(ee,{span:12},{default:a(()=>[o(ge,{title:c.$t("views.application.form.appTemplate.assistantApp.title"),description:c.$t("views.application.form.appTemplate.assistantApp.description"),shadow:"never",class:Te(["template-radio-card cursor",k.value==="assistant"?"active":""]),onClick:r[4]||(r[4]=$=>Z("assistant"))},{icon:a(()=>[o(fe,{height:"32px"})]),subTitle:a(()=>[o(_e,{class:"color-secondary",size:"small"},{default:a(()=>[v(d(c.$t("views.application.workflow")),1)]),_:1})]),_:1},8,["title","description","class"])]),_:1})]),_:1})])]),_:1},8,["label"])):U("",!0)]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}}),ko=Ze(Co,[["__scopeId","data-v-6da1cd60"]]),Ao={class:"dialog-footer"},Io=ye({__name:"CopyApplicationDialog",setup(Pe,{expose:H}){const B=ke(),{user:S}=Ce(),C=u("views.application.form.prompt.defaultPrompt",{data:"{data}",question:"{question}"}),K=_(),D=_(!1),b=_(!1),g=_({name:"",desc:"",modelId:"",dialogueNumber:0,prologue:u("views.application.form.defaultPrologue"),knowledgeIdList:[],knowledgeSetting:{topN:3,similarity:.6,maxParagraphCharNumber:5e3,searchMode:"embedding",noReferencesSetting:{status:"ai_questioning",value:"{question}"}},modelSetting:{prompt:C},problemOptimization:!1,type:"SIMPLE"}),k=Ae({name:[{required:!0,message:u("views.application.form.appName.placeholder"),trigger:"blur"}]}),E=_("");Fe(b,i=>{var s;i||(g.value={name:"",desc:"",modelId:"",dialogueNumber:0,prologue:u("views.application.form.defaultPrologue"),knowledgeIdList:[],knowledgeSetting:{topN:3,similarity:.6,maxParagraphCharNumber:5e3,searchMode:"embedding",noReferencesSetting:{status:"ai_questioning",value:"{question}"}},modelSetting:{prompt:C},problemOptimization:!1,type:"SIMPLE"},(s=K.value)==null||s.clearValidate())});const z=(i,s)=>{E.value=s;const y=Ge.cloneDeep(i);delete y.id,y.name=y.name+` ${u("common.copyTitle")}`,g.value=y,b.value=!0},w=async i=>{i&&await i.validate(s=>{s&&q.postApplication({...g.value,folderId:E.value},D).then(y=>S.profile().then(()=>y)).then(y=>{Ie(u("common.createSuccess")),Q(g.value.type)?B.push({path:`/application/workspace/${y.data.id}/workflow`}):B.push({path:`/application/workspace/${y.data.id}/${y.data.type}/setting`}),b.value=!1})})};return H({open:z}),(i,s)=>{const y=n("el-input"),X=n("el-form-item"),Y=n("el-form"),Z=n("el-button"),c=n("el-dialog");return m(),h(c,{title:i.$t("views.application.copyApplication"),modelValue:b.value,"onUpdate:modelValue":s[5]||(s[5]=r=>b.value=r),width:"650","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:a(()=>[f("span",Ao,[o(Z,{onClick:s[3]||(s[3]=L(r=>b.value=!1,["prevent"])),loading:D.value},{default:a(()=>[v(d(i.$t("common.cancel")),1)]),_:1},8,["loading"]),o(Z,{type:"primary",onClick:s[4]||(s[4]=r=>w(K.value)),loading:D.value},{default:a(()=>[v(d(i.$t("common.copy")),1)]),_:1},8,["loading"])])]),default:a(()=>[o(Y,{ref_key:"applicationFormRef",ref:K,model:g.value,rules:k,"label-position":"top","require-asterisk-position":"right",onSubmit:s[2]||(s[2]=L(()=>{},["prevent"]))},{default:a(()=>[o(X,{label:i.$t("views.application.form.appName.label"),prop:"name"},{default:a(()=>[o(y,{modelValue:g.value.name,"onUpdate:modelValue":s[0]||(s[0]=r=>g.value.name=r),maxlength:"64",placeholder:i.$t("views.application.form.appName.placeholder"),"show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(X,{label:i.$t("views.application.form.appDescription.label")},{default:a(()=>[o(y,{modelValue:g.value.desc,"onUpdate:modelValue":s[1]||(s[1]=r=>g.value.desc=r),type:"textarea",placeholder:i.$t("views.application.form.appDescription.placeholder"),rows:3,maxlength:"256","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}}),Po={class:"p-12-16 pb-0 mt-12"},$o={class:"p-8"},Ro={class:"flex"},No={class:"flex-between complex-search"},Lo={class:"flex"},So={class:"pre-wrap ml-8"},Eo={class:"lighter"},xo={class:"flex"},To={class:"pre-wrap ml-8"},Do={class:"lighter"},Oo={class:"flex align-center w-full"},Mo={class:"pre-wrap ml-8"},Wo={class:"lighter"},Vo={style:{"max-height":"calc(100vh - 120px)"}},Fo=["src"],Uo={key:0,class:"flex align-center"},qo={class:"color-secondary"},zo={class:"color-secondary"},Ho={key:1,class:"flex align-center"},Bo={class:"color-secondary"},Yo=ye({__name:"index",setup(Pe){const H=ke(),B=De(()=>"workspace"),S=De(()=>je.application[B.value]),{folder:C,application:K,user:D}=Ce(),b=_(!1),g=_("name"),k=_({name:"",type:"",createUser:"",publishStatus:void 0}),E=_(""),z=_([]),w=Ae({current_page:1,page_size:30,total:0}),i=_([]),s=_([]),y=_(),X=_();function Y(e){X.value.open(e.id)}const Z=_();function c(e){const t=s.value.findIndex(p=>p.id===e.id);s.value.splice(t,1)}const r=e=>{H.push({path:x(e)})},x=e=>le([new V([F.USER],[A.APPLICATION.getApplicationWorkspaceResourcePermission(e.id)],[],"AND"),F.WORKSPACE_MANAGE.getWorkspaceRole,A.APPLICATION_OVERVIEW_READ.getWorkspacePermissionWorkspaceManageRole,A.APPLICATION_OVERVIEW_READ.getApplicationWorkspaceResourcePermission(e.id)],"OR")?`/application/workspace/${e.id}/${e.type}/overview`:le([new V([F.USER],[A.APPLICATION.getApplicationWorkspaceResourcePermission(e.id)],[],"AND"),F.WORKSPACE_MANAGE.getWorkspaceRole,A.APPLICATION_EDIT.getWorkspacePermissionWorkspaceManageRole,A.APPLICATION_EDIT.getApplicationWorkspaceResourcePermission(e.id)],"OR")?e.type=="WORK_FLOW"?`/application/workspace/${e.id}/workflow`:`/application/workspace/${e.id}/${e.type}/setting`:le([new V([F.USER],[A.APPLICATION.getApplicationWorkspaceResourcePermission(e.id)],[N.IS_EE,N.IS_PE],"AND"),new V([F.WORKSPACE_MANAGE.getWorkspaceRole],[A.APPLICATION_ACCESS_READ.getWorkspacePermissionWorkspaceManageRole],[N.IS_EE,N.IS_PE],"OR"),new V([],[A.APPLICATION_ACCESS_READ.getApplicationWorkspaceResourcePermission(e.id)],[N.IS_EE,N.IS_PE],"OR")],"OR")?`/application/workspace/${e.id}/${e.type}/access`:le([new V([F.USER],[A.APPLICATION.getApplicationWorkspaceResourcePermission(e.id)],[N.IS_EE,N.IS_PE],"AND"),new V([F.WORKSPACE_MANAGE.getWorkspaceRole],[A.APPLICATION_CHAT_USER_READ.getWorkspacePermissionWorkspaceManageRole],[N.IS_EE,N.IS_PE],"OR"),new V([],[A.APPLICATION_CHAT_USER_READ.getApplicationWorkspaceResourcePermission(e.id)],[N.IS_EE,N.IS_PE],"OR")],"OR")?`/application/workspace/${e.id}/${e.type}/chat-user`:le([new V([F.USER],[A.APPLICATION.getApplicationWorkspaceResourcePermission(e.id)],[],"AND"),A.APPLICATION_CHAT_LOG_READ.getWorkspacePermissionWorkspaceManageRole,A.APPLICATION_CHAT_LOG_READ.getApplicationWorkspaceResourcePermission(e.id)],"OR")?`/application//workspace${e.id}/${e.type}/chat-log`:"/application/",G=_();function ne(e){var t;G.value.open(((t=C.currentFolder)==null?void 0:t.id)||"default",e)}const ue=()=>{k.value={name:"",createUser:""}};function me(e){(e.type=="WORK_FLOW"?p=>q.getApplicationDetail(p):p=>Promise.resolve({data:e}))(e.id).then(p=>{var pe,O,j;let R=(j=(O=(pe=p.data)==null?void 0:pe.work_flow)==null?void 0:O.nodes)==null?void 0:j.filter(I=>I.id==="base-node").map(I=>I.properties.api_input_field_list?I.properties.api_input_field_list.map(P=>({name:P.variable,value:P.default_value})):I.properties.inputFieldList?I.properties.inputFieldList.filter(P=>P.assignment_method==="api_input").map(P=>({name:P.variable,value:P.default_value})):[]).reduce((I,P)=>[...I,...P]);R=R||[];const he=ee(R)?"?"+ee(R):"";q.getAccessToken(e.id,b).then(I=>{var P;window.open(K.location+((P=I==null?void 0:I.data)==null?void 0:P.accessToken)+he)})})}function ee(e){const t=new URLSearchParams;return e.forEach(p=>{t.append(encodeURIComponent(p.name),encodeURIComponent(p.value))}),t.toString()}function fe(e){q.getApplicationDetail(e.id,b).then(t=>{var p;t!=null&&t.data&&y.value.open({...t.data,modelId:t.data.model},((p=C.currentFolder)==null?void 0:p.id)||"default")})}function _e(e){Q(e.type)?H.push({path:`/application/workspace/${e.id}/workflow`}):H.push({path:`/application/workspace/${e.id}/${e.type}/setting`})}function ge(e){Ve(`${u("views.application.delete.confirmTitle")}${e.name} ?`,u("views.application.delete.confirmMessage"),{confirmButtonText:u("common.confirm"),cancelButtonText:u("common.cancel"),confirmButtonClass:"danger"}).then(()=>{q.delApplication(e.id,b).then(()=>{const t=s.value.findIndex(p=>p.id===e.id);s.value.splice(t,1),Ie(u("common.deleteSuccess"))})}).catch(()=>{})}const ve=e=>{q.exportApplication(e.id,e.name,b).catch(t=>{t.response.status!==403&&t.response.data.text().then(p=>{uo(`${u("views.application.tip.ExportError")}:${JSON.parse(p).message}`)})})},ie=_(),se=e=>{const t=new FormData;t.append("file",e.raw,e.name),ie.value.clearFiles(),q.importApplication(C.currentFolder.id,t,b).then(async p=>{p!=null&&p.data&&(s.value=[],await D.profile())}).then(()=>{ae()}).catch(p=>{p.code===400&&Ve(u("common.tip"),u("views.application.tip.professionalMessage"),{cancelButtonText:u("common.confirm"),confirmButtonText:u("common.professional")}).then(()=>{window.open("https://tarzan.blog.csdn.net","_blank")})})},be=_();function $(e){const t={};C.asyncGetFolder(ce.APPLICATION,t,b).then(p=>{var R;i.value=p.data,e&&C.setCurrentFolder(((R=p.data)==null?void 0:R[0])||{}),ae()})}function oe(e){var t;e.id!==((t=C.currentFolder)==null?void 0:t.id)&&(C.setCurrentFolder(e),w.current_page=1,s.value=[],ae())}function $e(){w.current_page=1,s.value=[],$()}function re(){w.current_page=1,s.value=[],ae()}function ae(){var t;const e={folderId:((t=C.currentFolder)==null?void 0:t.id)||"default"};k.value[g.value]&&(e[g.value]=k.value[g.value]),e.type=E.value,q.getApplication(w,e,b).then(p=>{w.total=p.data.total,s.value=[...s.value,...p.data.records]})}return Je(()=>{var e;$(!((e=C.currentFolder)!=null&&e.id)),Qe.getAllMemberList(D.getWorkspaceId(),b).then(t=>{z.value=t.data})}),(e,t)=>{const p=n("el-divider"),R=n("el-radio-button"),he=n("el-radio-group"),pe=n("el-space"),O=n("el-option"),j=n("el-select"),I=n("el-input"),P=n("arrow-down"),Re=n("el-icon"),Ne=n("el-button"),de=n("el-avatar"),we=n("el-text"),M=n("el-dropdown-item"),qe=n("el-upload"),Le=n("el-dropdown-menu"),Se=n("el-dropdown"),Ee=n("el-tag"),ze=n("SuccessFilled"),He=n("el-col"),Be=n("el-row"),Ke=n("el-empty"),Xe=Ye("loading");return m(),h(co,{showCollapse:"",class:"application-manage"},{left:a(()=>{var l;return[f("h4",Po,d(e.$t("views.application.title")),1),f("div",$o,[o(po,{source:T(ce).APPLICATION,data:i.value,currentNodeKey:(l=T(C).currentFolder)==null?void 0:l.id,onHandleNodeClick:oe,onRefreshTree:$e},null,8,["source","data","currentNodeKey"])])]}),default:a(()=>[o(eo,null,{header:a(()=>[o(pe,{wrap:""},{default:a(()=>[o(so,{folderList:i.value,onClick:oe},null,8,["folderList"]),o(p,{direction:"vertical"}),o(he,{modelValue:E.value,"onUpdate:modelValue":t[0]||(t[0]=l=>E.value=l),onChange:re,class:"app-radio-button-group"},{default:a(()=>[o(R,{value:""},{default:a(()=>[v(d(e.$t("views.tool.all")),1)]),_:1}),o(R,{value:"SIMPLE"},{default:a(()=>[v(d(e.$t("views.application.simple")),1)]),_:1}),o(R,{value:"WORK_FLOW"},{default:a(()=>[v(d(e.$t("views.application.workflow")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),search:a(()=>[f("div",Ro,[f("div",No,[o(j,{class:"complex-search__left",modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=l=>g.value=l),style:{width:"120px"},onChange:ue},{default:a(()=>[o(O,{label:e.$t("common.creator"),value:"createUser"},null,8,["label"]),o(O,{label:e.$t("common.name"),value:"name"},null,8,["label"]),o(O,{label:e.$t("common.publishStatus"),value:"publishStatus"},null,8,["label"])]),_:1},8,["modelValue"]),g.value==="name"?(m(),h(I,{key:0,modelValue:k.value.name,"onUpdate:modelValue":t[2]||(t[2]=l=>k.value.name=l),onChange:re,placeholder:e.$t("common.searchBar.placeholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):g.value==="createUser"?(m(),h(j,{key:1,modelValue:k.value.createUser,"onUpdate:modelValue":t[3]||(t[3]=l=>k.value.createUser=l),onChange:re,filterable:"",clearable:"",style:{width:"220px"}},{default:a(()=>[(m(!0),te(Oe,null,Me(z.value,l=>(m(),h(O,{key:l.id,value:l.id,label:l.nickname},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):g.value==="publishStatus"?(m(),h(j,{key:2,modelValue:k.value.publishStatus,"onUpdate:modelValue":t[4]||(t[4]=l=>k.value.publishStatus=l),onChange:re,filterable:"",clearable:"",style:{width:"220px"}},{default:a(()=>[o(O,{label:e.$t("common.published"),value:"published"},null,8,["label"]),o(O,{label:e.$t("common.unpublished"),value:"unpublished"},null,8,["label"])]),_:1},8,["modelValue"])):U("",!0)]),S.value.create()?(m(),h(Se,{key:0,trigger:"click"},{dropdown:a(()=>[o(Le,{class:"create-dropdown"},{default:a(()=>[o(M,{onClick:t[5]||(t[5]=l=>ne("SIMPLE"))},{default:a(()=>[f("div",Lo,[o(de,{shape:"square",class:"avatar-blue mt-4",size:32},{default:a(()=>t[10]||(t[10]=[f("img",{src:go,style:{width:"65%"},alt:""},null,-1)])),_:1,__:[10]}),f("div",So,[f("div",Eo,d(e.$t("views.application.simple")),1),o(we,{type:"info",size:"small"},{default:a(()=>[v(d(e.$t("views.application.simplePlaceholder")),1)]),_:1})])])]),_:1}),o(M,{onClick:t[6]||(t[6]=l=>ne("WORK_FLOW"))},{default:a(()=>[f("div",xo,[o(de,{shape:"square",class:"avatar-purple mt-4",size:32},{default:a(()=>t[11]||(t[11]=[f("img",{src:vo,style:{width:"65%"},alt:""},null,-1)])),_:1,__:[11]}),f("div",To,[f("div",Do,d(e.$t("views.application.workflow")),1),o(we,{type:"info",size:"small"},{default:a(()=>[v(d(e.$t("views.application.workflowPlaceholder")),1)]),_:1})])])]),_:1}),o(qe,{class:"import-button",ref_key:"elUploadRef",ref:ie,"file-list":[],action:"#",multiple:"","auto-upload":!1,"show-file-list":!1,limit:1,"on-change":(l,xe)=>se(l)},{default:a(()=>[o(M,null,{default:a(()=>[f("div",Oo,[o(de,{shape:"square",class:"mt-4",size:32,style:{background:"none"}},{default:a(()=>t[12]||(t[12]=[f("img",{src:mo,alt:""},null,-1)])),_:1,__:[12]}),f("div",Mo,[f("div",Wo,d(e.$t("common.importCreate")),1)])])]),_:1})]),_:1},8,["on-change"])]),_:1})]),default:a(()=>[o(Ne,{type:"primary",class:"ml-8"},{default:a(()=>[v(d(e.$t("common.create"))+" ",1),o(Re,{class:"el-icon--right"},{default:a(()=>[o(P)]),_:1})]),_:1})]),_:1})):U("",!0)])]),default:a(()=>[oo((m(),te("div",Vo,[o(ao,{size:s.value.length,total:w.total,page_size:w.page_size,current_page:w.current_page,"onUpdate:current_page":t[9]||(t[9]=l=>w.current_page=l),onLoad:ae,loading:b.value},{default:a(()=>[s.value.length>0?(m(),h(Be,{key:0,gutter:15,class:"w-full"},{default:a(()=>[(m(!0),te(Oe,null,Me(s.value,(l,xe)=>(m(),h(He,{key:xe,xs:24,sm:12,md:12,lg:6,xl:6,class:"mb-16"},{default:a(()=>[o(to,{title:l.name,description:l.desc,class:"cursor",onClick:J=>r(l)},{icon:a(()=>[o(de,{shape:"square",size:32,style:{background:"none"}},{default:a(()=>[f("img",{src:T(We)(l==null?void 0:l.icon,T(We)("./favicon.ico")),alt:""},null,8,Fo)]),_:2},1024)]),subTitle:a(()=>[o(we,{class:"color-secondary lighter",size:"small"},{default:a(()=>[o(no,{content:l.username},{default:a(()=>[v(d(e.$t("common.creator"))+": "+d(T(io)(l.nickname)),1)]),_:2},1032,["content"])]),_:2},1024)]),tag:a(()=>[T(Q)(l.type)?(m(),h(Ee,{key:0,class:"warning-tag"},{default:a(()=>[v(d(e.$t("views.application.workflow")),1)]),_:1})):(m(),h(Ee,{key:1,class:"blue-tag"},{default:a(()=>[v(d(e.$t("views.application.simple")),1)]),_:1}))]),footer:a(()=>[l.isPublish?(m(),te("div",Uo,[o(Re,{class:"color-success mr-8",style:{"font-size":"16px"}},{default:a(()=>[o(ze)]),_:1}),f("span",qo,d(e.$t("views.application.status.published")),1),o(p,{direction:"vertical"}),o(W,{iconName:"app-clock",class:"color-secondary mr-8"}),f("span",zo,d(T(lo)(l.updateTime)),1)])):(m(),te("div",Ho,[o(W,{iconName:"app-disabled",class:"color-secondary mr-8"}),f("span",Bo,d(e.$t("views.application.status.unpublished")),1)]))]),mouseEnter:a(()=>[f("div",{onClick:t[8]||(t[8]=L(()=>{},["stop"]))},[o(Se,{trigger:"click"},{dropdown:a(()=>[o(Le,null,{default:a(()=>[o(M,{onClick:L(J=>me(l),["stop"])},{default:a(()=>[o(W,{iconName:"app-create-chat",class:"color-secondary"}),v(" "+d(e.$t("views.application.operation.toChat")),1)]),_:2},1032,["onClick"]),S.value.edit(l.id)?(m(),h(M,{key:0,onClick:L(J=>_e(l),["stop"])},{default:a(()=>[o(W,{iconName:"app-setting",class:"color-secondary"}),v(" "+d(e.$t("common.setting")),1)]),_:2},1032,["onClick"])):U("",!0),S.value.auth(l.id)?(m(),h(M,{key:1,onClick:L(J=>Y(l),["stop"])},{default:a(()=>[o(W,{iconName:"app-resource-authorization",class:"color-secondary"}),v(" "+d(e.$t("views.system.resourceAuthorization.title")),1)]),_:2},1032,["onClick"])):U("",!0),S.value.create()?(m(),h(M,{key:2,onClick:J=>fe(l)},{default:a(()=>[o(W,{iconName:"app-copy",class:"color-secondary"}),v(" "+d(e.$t("common.copy")),1)]),_:2},1032,["onClick"])):U("",!0),S.value.export(l.id)?(m(),h(M,{key:3,divided:"",onClick:L(J=>ve(l),["stop"])},{default:a(()=>[o(W,{iconName:"app-export",class:"color-secondary"}),v(" "+d(e.$t("common.export")),1)]),_:2},1032,["onClick"])):U("",!0),S.value.delete(l.id)?(m(),h(M,{key:4,divided:"",onClick:L(J=>ge(l),["stop"])},{default:a(()=>[o(W,{iconName:"app-delete",class:"color-secondary"}),v(" "+d(e.$t("common.delete")),1)]),_:2},1032,["onClick"])):U("",!0)]),_:2},1024)]),default:a(()=>[o(Ne,{text:"",onClick:t[7]||(t[7]=L(()=>{},["stop"]))},{default:a(()=>[o(W,{iconName:"app-more"})]),_:1})]),_:2},1024)])]),_:2},1032,["title","description","onClick"])]),_:2},1024))),128))]),_:1})):(m(),h(Ke,{key:1,description:e.$t("common.noData")},null,8,["description"]))]),_:1},8,["size","total","page_size","current_page","loading"])])),[[Xe,w.current_page===1&&b.value,void 0,{fullscreen:!0,lock:!0}]])]),_:1}),o(ko,{ref_key:"CreateApplicationDialogRef",ref:G},null,512),o(Io,{ref_key:"CopyApplicationDialogRef",ref:y},null,512),o(ro,{ref_key:"CreateFolderDialogRef",ref:be,onRefresh:$e},null,512),B.value==="workspace"?(m(),h(fo,{key:0,ref_key:"MoveToDialogRef",ref:Z,source:T(ce).APPLICATION,onRefresh:c},null,8,["source"])):U("",!0),o(_o,{type:T(ce).APPLICATION,ref_key:"ResourceAuthorizationDrawerRef",ref:X},null,8,["type"])]),_:1})}}});export{Yo as default};
