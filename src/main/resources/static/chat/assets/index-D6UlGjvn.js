import{aJ as re,bm as ce,aK as J,aP as p,bf as de,aQ as n,aZ as ue,a_ as v,aM as c,aT as o,b0 as R,aS as t,aV as d,aW as i,aR as a,aL as h,b3 as pe,bb as me,aO as z,b5 as _e,b6 as ve,bk as N,b1 as y,bx as he,f2 as fe,b4 as O,f3 as ge,bs as Q,be as ye,bh as be,cF as we,f4 as ke,b7 as $e}from"./chat-4wXRqTZ9.js";import{_ as Te}from"./ParagraphDialog.vue_vue_type_script_setup_true_lang-CwoZqmcm.js";import"./ParagraphForm.vue_vue_type_script_setup_true_lang-CF45AIh4.js";const Ce=""+new URL("hit-test-empty-D0jNCBAC.png",import.meta.url).href,Ne={class:"hit-test p-16-24"},Ve={class:"avatar"},xe={class:"content ml-12"},Se=["title"],De={class:"hit-test-height"},Me={class:"primary"},Re={class:"footer-content flex-between"},ze={key:0},Ke={key:0},Be={key:1,class:"ml-4"},Ie={class:"hit-test__operate"},Pe={class:"mb-16"},qe={class:"title mb-8"},Ae={class:"mb-4"},Ue={class:"mb-4"},Fe={class:"mb-4"},He={class:"mb-16"},Le={class:"title mb-8"},je={class:"mb-16"},Ee={class:"title mb-8"},Je={class:"text-right"},Oe={key:0,class:"operate-textarea flex"},Qe={class:"operate"},We={src:fe,alt:""},Ze={src:ge,alt:""},Ge=re({__name:"index",setup(Xe){const f=ce(),{params:{id:W}}=f,K=J(()=>f.path.includes("shared")?"systemShare":f.path.includes("resource-management")?"systemManage":"workspace"),B=p(),I=p(),_=p(!1),g=p([]),P=p(""),m=p(""),V=p({similarity:.6,topNumber:5,searchMode:"embedding"}),q=p(!0),r=p({}),b=p(!1),w=p(""),k=J(()=>!m.value);function Z(e){e==="keywords"?r.value.similarity=0:r.value.similarity=.6}function A(e){e==="open"?(b.value=!0,r.value=Q.cloneDeep(V.value)):e==="close"&&(b.value=!1,V.value=Q.cloneDeep(r.value))}function G(e){P.value=ye("views.paragraph.paragraphDetail"),I.value.open(e)}function U(e){!(e!=null&&e.ctrlKey)&&!(e!=null&&e.shiftKey)&&!(e!=null&&e.altKey)&&!(e!=null&&e.metaKey)?(e.preventDefault(),!k.value&&!_.value&&F()):X(e)}const X=e=>{const l=B.value.$el.querySelector(".el-textarea__inner"),u=l.selectionStart,$=l.selectionEnd;e.preventDefault(),m.value=m.value.slice(0,u)+`
`+m.value.slice($),be(()=>{l.setSelectionRange(u+1,u+1)})};function F(){const e={queryText:m.value,...V.value};we({type:"knowledge",systemType:K.value}).putKnowledgeHitTest(W,e,_).then(l=>{g.value=l.data&&ke(l.data,"comprehensive_score",!0),w.value=m.value,m.value="",q.value=!1})}function Y(e){if(e){const l=g.value.filter(u=>u.id===e.id)[0];l.content=e.content,l.title=e.title}else g.value=[],F()}return de(()=>{}),(e,l)=>{const u=n("el-text"),$=n("el-avatar"),H=n("el-empty"),ee=n("Document"),te=n("el-icon"),x=n("AppIcon"),ae=n("CardBox"),S=n("el-col"),L=n("el-row"),le=n("el-scrollbar"),T=n("el-card"),C=n("el-button"),D=n("el-radio"),se=n("el-radio-group"),j=n("el-input-number"),oe=n("el-popover"),ie=n("el-input"),ne=ue("loading");return c(),v("div",Ne,[o("h4",null,[d(i(e.$t("views.application.hitTest.title"))+" ",1),t(u,{type:"info",class:"ml-4"},{default:a(()=>[d(i(e.$t("views.application.hitTest.text")),1)]),_:1})]),R((c(),h(T,{style:{"--el-card-padding":"0"},class:"hit-test__main p-16 mt-16 mb-16"},{default:a(()=>[o("div",{class:"question-title",style:pe({visibility:w.value?"visible":"hidden"})},[o("div",Ve,[t($,null,{default:a(()=>l[8]||(l[8]=[o("img",{src:me,style:{width:"54%"},alt:""},null,-1)])),_:1,__:[8]})]),o("div",xe,[o("h4",{class:"text break-all ellipsis-1",style:{width:"66%"},title:w.value},i(w.value),9,Se)])],4),t(le,null,{default:a(()=>[o("div",De,[q.value?(c(),h(H,{key:0,image:z(Ce),description:e.$t("views.application.hitTest.emptyMessage1"),style:{"padding-top":"160px"},"image-size":125},null,8,["image","description"])):g.value.length==0?(c(),h(H,{key:1,description:e.$t("views.application.hitTest.emptyMessage2"),style:{"padding-top":"160px"},"image-size":125},null,8,["description"])):(c(),h(L,{key:2},{default:a(()=>[(c(!0),v(_e,null,ve(g.value,(s,E)=>(c(),h(S,{xs:24,sm:12,md:12,lg:8,xl:6,key:E,class:"p-8"},{default:a(()=>[t(ae,{shadow:"hover",title:s.title||"-",description:s.content,class:N(["document-card layout-bg layout-bg cursor",s.isActive?"":"disabled"]),onClick:M=>G(s)},{icon:a(()=>[t($,{class:"avatar-light",size:22},{default:a(()=>[d(i(E+1+""),1)]),_:2},1024)]),tag:a(()=>{var M;return[o("div",Me,i((M=s.similarity)==null?void 0:M.toFixed(3)),1)]}),footer:a(()=>[o("div",Re,[t(u,null,{default:a(()=>[t(te,null,{default:a(()=>[t(ee)]),_:1}),d(" "+i(s==null?void 0:s.documentName),1)]),_:2},1024),s.trampleNum||s.starNum?(c(),v("div",ze,[s.starNum?(c(),v("span",Ke,[t(x,{iconName:"app-like-color"}),d(" "+i(s.starNum),1)])):y("",!0),s.trampleNum?(c(),v("span",Be,[t(x,{iconName:"app-oppose-color"}),d(" "+i(s.trampleNum),1)])):y("",!0)])):y("",!0)])]),_:2},1032,["title","description","class","onClick"])]),_:2},1024))),128))]),_:1}))])]),_:1})]),_:1})),[[ne,_.value]]),t(Te,{ref_key:"ParagraphDialogRef",ref:I,title:P.value,onRefresh:Y,apiType:K.value},null,8,["title","apiType"]),o("div",Ie,[t(oe,{visible:b.value,placement:"right-end",width:500,trigger:"click"},{reference:a(()=>[z(f).path.includes("share/")?y("",!0):(c(),h(C,{key:0,class:"mb-8",onClick:l[0]||(l[0]=s=>A("open"))},{default:a(()=>[t(x,{iconName:"app-setting"}),d(" "+i(e.$t("common.paramSetting")),1)]),_:1}))]),default:a(()=>[o("div",Pe,[o("div",qe,i(e.$t("views.application.dialog.selectSearchMode")),1),t(se,{modelValue:r.value.searchMode,"onUpdate:modelValue":l[1]||(l[1]=s=>r.value.searchMode=s),class:"card__radio",onChange:Z},{default:a(()=>[t(T,{shadow:"never",class:N(["mb-16",r.value.searchMode==="embedding"?"active":""])},{default:a(()=>[t(D,{value:"embedding",size:"large"},{default:a(()=>[o("p",Ae,i(e.$t("views.application.dialog.vectorSearch")),1),t(u,{type:"info"},{default:a(()=>[d(i(e.$t("views.application.dialog.vectorSearchTooltip")),1)]),_:1})]),_:1})]),_:1},8,["class"]),t(T,{shadow:"never",class:N(["mb-16",r.value.searchMode==="keywords"?"active":""])},{default:a(()=>[t(D,{value:"keywords",size:"large"},{default:a(()=>[o("p",Ue,i(e.$t("views.application.dialog.fullTextSearch")),1),t(u,{type:"info"},{default:a(()=>[d(i(e.$t("views.application.dialog.fullTextSearchTooltip")),1)]),_:1})]),_:1})]),_:1},8,["class"]),t(T,{shadow:"never",class:N(["mb-16",r.value.searchMode==="hybrid"?"active":""])},{default:a(()=>[t(D,{value:"hybrid",size:"large"},{default:a(()=>[o("p",Fe,i(e.$t("views.application.dialog.hybridSearch")),1),t(u,{type:"info"},{default:a(()=>[d(i(e.$t("views.application.dialog.hybridSearchTooltip")),1)]),_:1})]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue"])]),t(L,{gutter:20},{default:a(()=>[t(S,{span:12},{default:a(()=>[o("div",He,[o("div",Le,i(e.$t("views.application.dialog.similarityThreshold")),1),t(j,{modelValue:r.value.similarity,"onUpdate:modelValue":l[2]||(l[2]=s=>r.value.similarity=s),min:0,max:r.value.searchMode==="hybrid"?2:1,precision:3,step:.1,"value-on-clear":0,"controls-position":"right",class:"w-full"},null,8,["modelValue","max"])])]),_:1}),t(S,{span:12},{default:a(()=>[o("div",je,[o("div",Ee,i(e.$t("views.application.dialog.topReferences")),1),t(j,{modelValue:r.value.topNumber,"onUpdate:modelValue":l[3]||(l[3]=s=>r.value.topNumber=s),min:1,max:1e4,"controls-position":"right",class:"w-full"},null,8,["modelValue"])])]),_:1})]),_:1}),o("div",Je,[t(C,{onClick:l[4]||(l[4]=s=>b.value=!1)},{default:a(()=>[d(i(e.$t("common.cancel")),1)]),_:1}),t(C,{type:"primary",onClick:l[5]||(l[5]=s=>A("close"))},{default:a(()=>[d(i(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"]),z(f).path.includes("share/")?y("",!0):(c(),v("div",Oe,[t(ie,{ref_key:"quickInputRef",ref:B,modelValue:m.value,"onUpdate:modelValue":l[6]||(l[6]=s=>m.value=s),type:"textarea",placeholder:e.$t("common.inputPlaceholder"),autosize:{minRows:1,maxRows:1},onKeydown:l[7]||(l[7]=he(s=>U(s),["enter"]))},null,8,["modelValue","placeholder"]),o("div",Qe,[t(C,{text:"",class:"sent-button",disabled:k.value||_.value,onClick:U},{default:a(()=>[R(o("img",We,null,512),[[O,k.value||_.value]]),R(o("img",Ze,null,512),[[O,!k.value&&!_.value]])]),_:1},8,["disabled"])])]))])])}}}),at=$e(Ge,[["__scopeId","data-v-3865a3ac"]]);export{at as default};
