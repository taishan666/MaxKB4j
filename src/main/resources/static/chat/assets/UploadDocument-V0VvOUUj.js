import{ay as G,aB as $,ba as ce,aD as n,aE as C,aF as _,aG as o,bc as E,aH as s,aI as e,aJ as l,bd as Q,bh as Z,bi as J,aK as w,bj as N,bk as de,b_ as he,ej as _e,b9 as X,de as Le,ce as Te,aC as A,bo as B,ek as re,cn as W,aA as pe,b8 as oe,bg as be,bs as $e,bq as me,bS as ge,br as ve,bf as K,el as Ve,az as ye,df as Se,em as ke,bb as Ce,en as ie,cf as le,eo as Re,bp as ue}from"./chat-BcZeCBLv.js";import{_ as we}from"./ParagraphForm.vue_vue_type_script_setup_true_lang-CYAYQbPN.js";const Fe={class:"bold title p-24",style:{"padding-bottom":"0"}},De={class:"flex align-center"},ze={class:"p-24",style:{"padding-top":"16px"}},Ie={key:1,class:"p-24"},Ue={class:"dialog-footer"},Me=G({__name:"EditParagraphDialog",props:{isConnect:Boolean,knowledgeId:String},emits:["updateContent"],setup(D,{expose:M,emit:R}){const L=R,T=$(!1),y=$({}),F=$(),z=$(),i=$(!1),d=$("");ce(T,r=>{r||(y.value={})});const u=r=>{y.value=de.cloneDeep(r),T.value=!0};function V(r,g){y.value.problemList.splice(g,1)}function b(){var r,g,S;d.value.trim()&&((r=y.value)!=null&&r.problemList.some(p=>p.content===d.value.trim())||(S=(g=y.value)==null?void 0:g.problemList)==null||S.push({content:d.value.trim()}),d.value="",i.value=!1)}function I(){i.value=!0,he(()=>{var r;(r=z.value)==null||r.focus()})}const k=async()=>{var r,g;await((r=F.value)==null?void 0:r.validate())&&(L("updateContent",{problemList:y.value.problemList,...(g=F.value)==null?void 0:g.form}),T.value=!1)};return M({open:u}),(r,g)=>{const S=n("el-col"),p=n("el-divider"),f=n("Plus"),m=n("el-icon"),v=n("el-button"),c=n("el-input"),t=n("auto-tooltip"),a=n("TagEllipsis"),x=n("el-scrollbar"),O=n("el-row"),q=n("el-dialog");return _(),C(q,{title:r.$t("views.paragraph.editParagraph"),modelValue:T.value,"onUpdate:modelValue":g[3]||(g[3]=U=>T.value=U),width:"80%","destroy-on-close":"",class:"paragraph-dialog","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:o(()=>[e("span",Ue,[s(v,{onClick:g[2]||(g[2]=N(U=>T.value=!1,["prevent"]))},{default:o(()=>[w(l(r.$t("common.cancel")),1)]),_:1}),s(v,{type:"primary",onClick:k},{default:o(()=>[w(l(r.$t("common.save")),1)]),_:1})])]),default:o(()=>[D.isConnect?(_(),C(O,{key:0},{default:o(()=>[s(S,{span:18,class:"p-24"},{default:o(()=>[s(we,{ref_key:"paragraphFormRef",ref:F,data:y.value,isEdit:!0,"knowledge-id":D.knowledgeId},null,8,["data","knowledge-id"])]),_:1}),s(S,{span:6,class:"border-l",style:{width:"300px"}},{default:o(()=>[e("p",Fe,[e("span",De,[e("span",null,l(r.$t("views.paragraph.relatedProblem.title")),1),s(p,{direction:"vertical",class:"mr-4"}),s(v,{text:"",onClick:I},{default:o(()=>[s(m,null,{default:o(()=>[s(f)]),_:1})]),_:1})])]),s(x,{height:"500px"},{default:o(()=>[e("div",ze,[i.value?(_(),C(c,{key:0,modelValue:d.value,"onUpdate:modelValue":g[0]||(g[0]=U=>d.value=U),placeholder:r.$t("views.paragraph.relatedProblem.placeholder"),onChange:b,onBlur:g[1]||(g[1]=U=>i.value=!1),ref_key:"inputRef",ref:z,class:"mb-8"},null,8,["modelValue","placeholder"])):Q("",!0),(_(!0),E(Z,null,J(y.value.problemList,(U,H)=>(_(),C(a,{key:H,onClose:j=>V(U,H),class:"question-tag",type:"info",effect:"plain",closable:""},{default:o(()=>[s(t,{content:U.content},{default:o(()=>[w(l(U.content),1)]),_:2},1032,["content"])]),_:2},1032,["onClose"]))),128))])]),_:1})]),_:1})]),_:1})):(_(),E("div",Ie,[s(we,{ref_key:"paragraphFormRef",ref:F,data:y.value,isEdit:!0,"knowledge-id":D.knowledgeId},null,8,["data","knowledge-id"])]))]),_:1},8,["title","modelValue"])}}}),Pe={class:"flex-between"},Ee={class:"lighter mt-12"},Ae={class:"lighter mt-12"},xe=G({__name:"ParagraphList",props:{modelValue:{type:Array,default:()=>[]},isConnect:Boolean,knowledgeId:String},emits:["update:modelValue"],setup(D,{emit:M}){const R=$(30),L=$(1),T=$(0),y=$(),F=M,z=$(!1),i=$([]),d=D;_e(()=>{if(d.modelValue&&d.modelValue.length>0){const r=R.value*L.value;i.value=d.modelValue.slice(0,Math.min(r,d.modelValue.length))}}),_e(()=>{const g=R.value*L.value;i.value=d.modelValue.slice(0,Math.min(g,d.modelValue.length))});const u=X(()=>i.value),V=()=>{z.value=!0,setTimeout(()=>{L.value+=1,z.value=!1},100)},b=(r,g)=>{T.value=g+R.value*(L.value-1),y.value.open(r)},I=r=>{const g=[...d.modelValue];d.isConnect&&r.title&&!(r!=null&&r.problemList.some(p=>p.content===r.title.trim()))&&r.problemList.push({content:r.title.trim()}),g[T.value]=de.cloneDeep(r),F("update:modelValue",g);const S=T.value-R.value*(L.value-1);S>=0&&S<i.value.length&&(i.value[S]=de.cloneDeep(r))},k=(r,g)=>{Te(`${A("views.paragraph.delete.confirmTitle")}${r.title||"-"} ?`,A("views.paragraph.delete.confirmMessage"),{confirmButtonText:A("common.confirm"),confirmButtonClass:"color-danger"}).then(()=>{const S=[...d.modelValue];if(S.splice(g,1),F("update:modelValue",S),i.value.splice(g,1),d.modelValue.length>i.value.length*L.value){const p=d.modelValue[i.value.length*L.value];p&&i.value.push(p)}}).catch(()=>{})};return(r,g)=>{const S=n("AppIcon"),p=n("el-button"),f=n("el-text"),m=n("el-card");return _(),E("div",null,[s(Le,{size:u.value.length,total:D.modelValue.length,page_size:R.value,current_page:L.value,"onUpdate:current_page":g[0]||(g[0]=v=>L.value=v),onLoad:g[1]||(g[1]=v=>V()),loading:z.value},{default:o(()=>[(_(!0),E(Z,null,J(u.value,(v,c)=>(_(),C(m,{key:c,shadow:"never",class:"card-never mb-16"},{default:o(()=>[e("div",Pe,[e("span",null,l(v.title||"-"),1),e("div",null,[s(p,{link:"",onClick:t=>b(v,c)},{default:o(()=>[s(S,{iconName:"app-edit"})]),_:2},1032,["onClick"]),s(p,{link:"",onClick:t=>k(v,c)},{default:o(()=>[s(S,{iconName:"app-delete"})]),_:2},1032,["onClick"])])]),e("div",Ee,l(v.content),1),e("div",Ae,[s(f,{type:"info"},{default:o(()=>[w(l(v.content.length)+" "+l(r.$t("views.paragraph.character_count")),1)]),_:2},1024)])]),_:2},1024))),128))]),_:1},8,["size","total","page_size","current_page","loading"]),s(Me,{ref_key:"EditParagraphDialogRef",ref:y,onUpdateContent:I,isConnect:D.isConnect,"knowledge-id":D.knowledgeId},null,8,["isConnect","knowledge-id"])])}}}),Be={class:"flex-center"},Ne=["src"],Xe={class:"ml-4"},qe={class:"mb-16"},He={key:0,class:"paragraph-list"},Qe=G({__name:"ParagraphPreview",props:{data:{type:Array,default:()=>[]},isConnect:Boolean,knowledgeId:String},setup(D){const M=$(0);return(R,L)=>{const T=n("el-text"),y=n("el-scrollbar"),F=n("el-tab-pane"),z=n("el-tabs");return _(),C(z,{modelValue:M.value,"onUpdate:modelValue":L[0]||(L[0]=i=>M.value=i),class:"paragraph-tabs"},{default:o(()=>[(_(!0),E(Z,null,J(D.data,(i,d)=>(_(),C(F,{key:d,label:i.name,name:d},{label:o(()=>[e("div",Be,[e("img",{src:B(re)(i&&(i==null?void 0:i.name)),alt:"",height:"16"},null,8,Ne),e("span",Xe,l(i==null?void 0:i.name),1)])]),default:o(()=>[e("div",qe,[s(T,{type:"info"},{default:o(()=>[w(l(i.content.length)+" "+l(R.$t("views.paragraph.title")),1)]),_:2},1024)]),M.value==d?(_(),E("div",He,[s(y,null,{default:o(()=>[s(xe,{modelValue:i.content,"onUpdate:modelValue":u=>i.content=u,isConnect:D.isConnect,"knowledge-id":D.knowledgeId},null,8,["modelValue","onUpdate:modelValue","isConnect","knowledge-id"])]),_:2},1024)])):Q("",!0)]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])}}}),je=W(Qe,[["__scopeId","data-v-c20b8d02"]]),Ke={class:"set-rules"},Oe={class:"title-decoration-1 mb-16"},Ze={class:"set-rules__right"},Ge={class:"mb-4"},Je={class:"mb-4"},We={class:"set-rules__form"},Ye={class:"form-item mb-16"},et={class:"title flex align-center mb-8"},tt={style:{"margin-right":"4px"}},lt={class:"form-item mb-16"},ot={class:"title mb-8"},st={class:"form-item mb-16"},nt={class:"title mb-8"},at={style:{"margin-top":"4px"}},it={class:"text-right mt-8"},ut={class:"title-decoration-1 mb-8"},dt=G({__name:"SetRules",setup(D,{expose:M}){const{knowledge:R}=pe(),L=X(()=>R.documentsFiles),T=$([]),y=oe(),{query:{id:F}}=y,z=X(()=>y.path.includes("shared")?"systemShare":y.path.includes("resource-management")?"systemManage":"workspace"),i=$("1"),d=$(!1),u=$([]),V=$(!1),b=$(!1),I=$(!0),k=be({patterns:[],limit:500,withFilter:!0});function r(p){p&&I.value&&(u.value=u.value.map(f=>({...f,content:f.content.map(m=>({...m,problemList:m.title.trim()?[m.title.trim()]:[]}))})),I.value=!1)}function g(){d.value=!0;const p=new FormData;L.value.forEach(f=>{f!=null&&f.raw&&p.append("file",f==null?void 0:f.raw)}),i.value==="2"&&Object.keys(k).forEach(f=>{f=="patterns"?k.patterns.forEach(m=>p.append("patterns",m)):p.append(f,k[f])}),K({type:"document",systemType:z.value}).postSplitDocument(F,p).then(f=>{const m=f.data;m.map(v=>{v.name.length>128&&(v.name=Ve(v.name,128)),b.value&&v.content.map(c=>{c.problemList=c.title.trim()?[c.title.trim()]:[]})}),u.value=m,d.value=!1}).catch(()=>{d.value=!1})}const S=()=>{K({type:"document",systemType:z.value}).listSplitPattern(F,V).then(p=>{T.value=p.data})};return ce(i,()=>{i.value==="2"&&S()}),$e(()=>{g()}),M({paragraphList:u,checkedConnect:b,loading:d}),(p,f)=>{const m=n("el-text"),v=n("el-radio"),c=n("el-card"),t=n("AppIcon"),a=n("el-tooltip"),x=n("el-option"),O=n("el-select"),q=n("el-slider"),U=n("el-switch"),H=n("el-radio-group"),j=n("el-scrollbar"),Y=n("el-checkbox"),se=n("el-button"),ee=n("el-col"),ne=n("el-row"),ae=me("loading");return _(),E("div",Ke,[s(ne,null,{default:o(()=>[s(ee,{span:10,class:"p-24"},{default:o(()=>[e("h4",Oe,l(p.$t("views.document.setRules.title.setting")),1),e("div",Ze,[s(j,null,{default:o(()=>[e("div",{class:"left-height",onClick:f[5]||(f[5]=N(()=>{},["stop"]))},[s(H,{modelValue:i.value,"onUpdate:modelValue":f[4]||(f[4]=P=>i.value=P),class:"card__radio"},{default:o(()=>[s(c,{shadow:"never",class:ge(["mb-16",i.value==="1"?"active":""])},{default:o(()=>[s(v,{value:"1",size:"large"},{default:o(()=>[e("p",Ge,l(p.$t("views.document.setRules.intelligent.label")),1),s(m,{type:"info"},{default:o(()=>[w(l(p.$t("views.document.setRules.intelligent.text")),1)]),_:1})]),_:1})]),_:1},8,["class"]),s(c,{shadow:"never",class:ge(["mb-16",i.value==="2"?"active":""])},{default:o(()=>[s(v,{value:"2",size:"large"},{default:o(()=>[e("p",Je,l(p.$t("views.document.setRules.advanced.label")),1),s(m,{type:"info"},{default:o(()=>[w(l(p.$t("views.document.setRules.advanced.text")),1)]),_:1})]),_:1}),i.value==="2"?(_(),C(c,{key:0,shadow:"never",class:"card-never mt-16",style:{"margin-left":"30px"}},{default:o(()=>[e("div",We,[e("div",Ye,[e("div",et,[e("span",tt,l(p.$t("views.document.setRules.patterns.label")),1),s(a,{effect:"dark",content:p.$t("views.document.setRules.patterns.tooltip"),placement:"right"},{default:o(()=>[s(t,{iconName:"app-warning",class:"app-warning-icon"})]),_:1},8,["content"])]),e("div",{onClick:f[1]||(f[1]=N(()=>{},["stop"]))},[s(O,{modelValue:k.patterns,"onUpdate:modelValue":f[0]||(f[0]=P=>k.patterns=P),multiple:"","reserve-keyword":!1,"allow-create":"","default-first-option":"",filterable:"",placeholder:p.$t("views.document.setRules.patterns.placeholder")},{default:o(()=>[(_(!0),E(Z,null,J(T.value,(P,te)=>(_(),C(x,{key:te,label:P.key,value:P.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])])]),e("div",lt,[e("div",ot,l(p.$t("views.document.setRules.limit.label")),1),s(q,{modelValue:k.limit,"onUpdate:modelValue":f[2]||(f[2]=P=>k.limit=P),"show-input":"","show-input-controls":!1,min:50,max:1e5},null,8,["modelValue"])]),e("div",st,[e("div",nt,l(p.$t("views.document.setRules.withFilter.label")),1),s(U,{size:"small",modelValue:k.withFilter,"onUpdate:modelValue":f[3]||(f[3]=P=>k.withFilter=P)},null,8,["modelValue"]),e("div",at,[s(m,{type:"info"},{default:o(()=>[w(l(p.$t("views.document.setRules.withFilter.text")),1)]),_:1})])])])]),_:1})):Q("",!0)]),_:1},8,["class"])]),_:1},8,["modelValue"])])]),_:1}),e("div",null,[s(Y,{modelValue:b.value,"onUpdate:modelValue":f[6]||(f[6]=P=>b.value=P),onChange:r,style:{"white-space":"normal"}},{default:o(()=>[w(l(p.$t("views.document.setRules.checkedConnect.label")),1)]),_:1},8,["modelValue"])]),e("div",it,[s(se,{onClick:g},{default:o(()=>[w(l(p.$t("views.document.buttons.preview")),1)]),_:1})])])]),_:1}),s(ee,{span:14,class:"p-24 border-l"},{default:o(()=>[ve((_(),E("div",null,[e("h4",ut,l(p.$t("views.document.setRules.title.preview")),1),s(je,{data:u.value,"onUpdate:data":f[7]||(f[7]=P=>u.value=P),isConnect:b.value,"knowledge-id":B(F)},null,8,["data","isConnect","knowledge-id"])])),[[ae,d.value]])]),_:1})]),_:1})])}}}),ct=W(dt,[["__scopeId","data-v-b0302eb3"]]),rt={class:"mt-8"},pt={class:"bold"},mt={class:"bold"},vt={class:"bold"},ft={class:"result-success"},_t={class:"bolder"},gt={class:"flex-between"},wt={class:"flex"},ht=["src"],bt={class:"ml-8"},$t=G({__name:"ResultSuccess",props:{data:{type:Object,default:()=>{}}},setup(D){const M=D,R=ye(),L=oe(),{params:{id:T,folderId:y}}=L,F=X(()=>L.path.includes("shared")?"systemShare":L.path.includes("resource-management")?"systemManage":"workspace"),z=X(()=>{var d;return(d=M.data)==null?void 0:d.documentList.reduce((u,V)=>u+=V.paragraph_count,0)}),i=X(()=>{var d;return((d=M.data)==null?void 0:d.documentList.reduce((u,V)=>u+=V.charLength,0))||0});return(d,u)=>{const V=n("el-text"),b=n("el-divider"),I=n("el-button"),k=n("el-result"),r=n("SuccessFilled"),g=n("el-icon"),S=n("CircleCloseFilled"),p=n("Loading"),f=n("el-card"),m=n("el-scrollbar");return _(),C(m,null,{default:o(()=>{var v;return[s(k,{icon:"color-success",title:`沁 ${d.$t("views.knowledge.ResultSuccess.title")} 沁荏},{"sub-title":o(()=>{var c;return[e("div",rt,[e("span",pt,l(((c=D.data)==null?void 0:c.documentList.length)||0),1),s(V,{type:"info",class:"ml-4"},{default:o(()=>[w(l(d.$t("common.fileUpload.document")),1)]),_:1}),s(b,{direction:"vertical"}),e("span",mt,l(z.value||0),1),s(V,{type:"info",class:"ml-4"},{default:o(()=>[w(l(d.$t("views.knowledge.ResultSuccess.paragraph")),1)]),_:1}),s(b,{direction:"vertical"}),e("span",vt,l(B(Se)(i.value)||0),1),s(V,{type:"info",class:"ml-4"},{default:o(()=>[w(l(d.$t("common.character")),1)]),_:1})])]}),extra:o(()=>[F.value==="workspace"?(_(),C(I,{key:0,onClick:u[0]||(u[0]=c=>B(R).push({path:"/knowledge"}))},{default:o(()=>[w(l(d.$t("views.knowledge.ResultSuccess.buttons.toknowledge")),1)]),_:1})):(_(),C(I,{key:1,onClick:u[1]||(u[1]=c=>B(R).push({path:`/system/${B(y)}/knowledge`}))},{default:o(()=>[w(l(d.$t("views.knowledge.ResultSuccess.buttons.toknowledge")),1)]),_:1})),s(I,{type:"primary",onClick:u[2]||(u[2]=c=>{var t;return B(R).push({path:`/knowledge/${(t=D.data)==null?void 0:t.id}/${B(y)}/document`})})},{default:o(()=>[w(l(d.$t("views.knowledge.ResultSuccess.buttons.toDocument")),1)]),_:1})]),_:1},8,["title"]),e("div",ft,[e("p",_t,l(d.$t("views.knowledge.ResultSuccess.documentList")),1),(_(!0),E(Z,null,J((v=D.data)==null?void 0:v.documentList,(c,t)=>(_(),C(f,{shadow:"never",class:"file-List-card mt-8",key:t},{default:o(()=>[e("div",gt,[e("div",wt,[e("img",{src:B(re)(c&&(c==null?void 0:c.name)),alt:"",width:"40"},null,8,ht),e("div",bt,[e("p",null,l(c&&(c==null?void 0:c.name)),1),s(V,{type:"info",size:"small"},{default:o(()=>[w(l(B(ke)(c&&(c==null?void 0:c.charLength))),1)]),_:2},1024)])]),e("div",null,[s(V,{type:"info",class:"mr-16"},{default:o(()=>[w(l(c&&(c==null?void 0:c.paragraph_count))+" "+l(d.$t("views.knowledge.ResultSuccess.paragraph_count")),1)]),_:2},1024),c.status==="1"?(_(),C(V,{key:0},{default:o(()=>[s(g,{class:"color-success"},{default:o(()=>[s(r)]),_:1})]),_:1})):c.status==="2"?(_(),C(V,{key:1},{default:o(()=>[s(g,{class:"color-danger"},{default:o(()=>[s(S)]),_:1})]),_:1})):c.status==="0"?(_(),C(V,{key:2},{default:o(()=>[s(g,{class:"is-loading primary"},{default:o(()=>[s(p)]),_:1}),w(" "+l(d.$t("views.knowledge.ResultSuccess.loading"))+"... ",1)]),_:1})):Q("",!0)])])]),_:2},1024))),128))])]}),_:1})}}}),yt=W($t,[["__scopeId","data-v-a7787e3d"]]),kt={class:"title-decoration-1 mb-8"},Ct={class:"mt-16 mb-16"},Lt={class:"update-info flex p-8-12 border-r-6 mb-16 w-full"},Tt={class:"mt-4"},Vt={class:"ml-16 lighter"},St={class:"el-upload__text"},Rt={class:"upload__decoration"},Ft={class:"update-info flex p-8-12 border-r-6 mb-16 w-full"},Dt={class:"mt-4"},zt={class:"ml-16 lighter"},It={class:"el-upload__text"},Ut={class:"upload__decoration"},Mt={class:"update-info flex p-8-12 border-r-6 mb-16 w-full"},Pt={class:"mt-4"},Et={class:"ml-16 lighter"},At={class:"el-upload__text"},xt={class:"upload__decoration"},Bt={class:"flex-between"},Nt={class:"flex"},Xt=["src"],qt={class:"ml-8"},Ht=G({__name:"UploadComponent",setup(D,{expose:M}){const R=oe(),{query:{id:L}}=R,T=X(()=>R.path.includes("shared")?"systemShare":R.path.includes("resource-management")?"systemManage":"workspace"),{knowledge:y}=pe(),F=X(()=>y.documentsFiles),z=X(()=>y.documentsType),i=$(),d=$(!1),u=$({fileType:"txt",fileList:[]}),V=be({fileList:[{required:!0,message:A("views.document.upload.requiredMessage"),trigger:"change"}]}),b=$(50),I=$(100);ce(u.value,t=>{y.saveDocumentsType(t.fileType),y.saveDocumentsFile(t.fileList)});function k(t){K({type:"document",systemType:T.value}).exportQATemplate(`${t}${A("views.document.upload.template")}.${t=="csv"?t:"xlsx"}`,t)}function r(t){K({type:"document",systemType:T.value}).exportTableTemplate(`${t}${A("views.document.upload.template")}.${t=="csv"?t:"xlsx"}`,t)}function g(){u.value.fileList=[]}function S(t){u.value.fileList.splice(t,1)}const p=(t,a)=>{if(!((t==null?void 0:t.size)/1024/1024<I.value))return le(A("views.document.tip.fileLimitSizeTip1")+I.value+"MB"),a.splice(-1,1),!1;if(!Re(t==null?void 0:t.name,u.value.fileType))return(t==null?void 0:t.name)!==".DS_Store"&&le(A("views.document.upload.errorMessage2")),a.splice(-1,1),!1;if((t==null?void 0:t.size)===0)return le(A("views.document.upload.errorMessage3")),a.splice(-1,1),!1},f=()=>{le(A("views.document.tip.fileLimitCountTip1")+b.value+A("views.document.tip.fileLimitCountTip2"))},m=t=>{let a=null;he(()=>{document.querySelector(".el-upload__input")!=null&&(a=document.querySelector(".el-upload__input"),a.webkitdirectory=t)})};function v(){if(i.value)return i.value.validate(t=>t)}function c(){K({type:"knowledge",systemType:T.value}).getKnowledgeDetail(L,d).then(t=>{b.value=t.data.fileCountLimit,I.value=t.data.fileSizeLimit})}return $e(()=>{z.value&&(u.value.fileType=z.value),F.value&&(u.value.fileList=F.value),c()}),Ce(()=>{u.value={fileType:"txt",fileList:[]}}),M({validate:v,form:u}),(t,a)=>{var te;const x=n("el-radio-button"),O=n("el-radio-group"),q=n("AppIcon"),U=n("el-button"),H=n("el-upload"),j=n("el-form-item"),Y=n("el-form"),se=n("el-text"),ee=n("el-card"),ne=n("el-col"),ae=n("el-row"),P=me("loading");return _(),E(Z,null,[e("h4",kt,l(t.$t("views.document.uploadDocument")),1),ve((_(),C(Y,{ref_key:"FormRef",ref:i,model:u.value,rules:V,"label-position":"top","require-asterisk-position":"right"},{default:o(()=>[e("div",Ct,[s(O,{modelValue:u.value.fileType,"onUpdate:modelValue":a[0]||(a[0]=h=>u.value.fileType=h),onChange:g,class:"app-radio-button-group"},{default:o(()=>[s(x,{value:"txt"},{default:o(()=>[w(l(t.$t("views.document.fileType.txt.label")),1)]),_:1}),s(x,{value:"table"},{default:o(()=>[w(l(t.$t("views.document.fileType.table.label")),1)]),_:1}),s(x,{value:"QA"},{default:o(()=>[w(l(t.$t("views.document.fileType.QA.label")),1)]),_:1})]),_:1},8,["modelValue"])]),u.value.fileType==="QA"?(_(),C(j,{key:0,prop:"fileList"},{default:o(()=>[e("div",Lt,[e("div",Tt,[s(q,{iconName:"app-warning-colorful",style:{"font-size":"16px"}})]),e("div",Vt,[e("p",null,[w(l(t.$t("views.document.fileType.QA.tip1"))+" ",1),s(U,{type:"primary",link:"",onClick:a[1]||(a[1]=h=>k("excel"))},{default:o(()=>[w(l(t.$t("views.document.upload.download"))+" Excel "+l(t.$t("views.document.upload.template")),1)]),_:1}),s(U,{type:"primary",link:"",onClick:a[2]||(a[2]=h=>k("csv"))},{default:o(()=>[w(l(t.$t("views.document.upload.download"))+" CSV "+l(t.$t("views.document.upload.template")),1)]),_:1})]),e("p",null,l(t.$t("views.document.fileType.QA.tip2")),1),e("p",null," 3. "+l(t.$t("views.document.tip.fileLimitCountTip1"))+" "+l(b.value)+" "+l(t.$t("views.document.tip.fileLimitCountTip2"))+", "+l(t.$t("views.document.tip.fileLimitSizeTip1"))+" "+l(I.value)+" MB ",1)])]),s(H,{webkitdirectory:!1,class:"w-full mb-4",drag:"",multiple:"","file-list":u.value.fileList,"onUpdate:fileList":a[5]||(a[5]=h=>u.value.fileList=h),action:"#","auto-upload":!1,"show-file-list":!1,accept:".xlsx, .xls, .csv,.zip",limit:b.value,"on-exceed":f,"on-change":p,onClick:a[6]||(a[6]=N(h=>m(!1),["prevent"]))},{default:o(()=>[a[17]||(a[17]=e("img",{src:ie,alt:""},null,-1)),e("div",St,[e("p",null,[w(l(t.$t("views.document.upload.uploadMessage"))+" ",1),e("em",{class:"hover",onClick:a[3]||(a[3]=N(h=>m(!1),["prevent"]))},l(t.$t("views.document.upload.selectFile")),1),e("em",{class:"hove ml-4",onClick:a[4]||(a[4]=N(h=>m(!0),["prevent"]))},l(t.$t("views.document.upload.selectFiles")),1)]),e("div",Rt,[e("p",null,l(t.$t("views.document.upload.formats"))+"XLS縲々LSX縲，SV縲〇IP",1)])])]),_:1,__:[17]},8,["file-list","limit"])]),_:1})):u.value.fileType==="table"?(_(),C(j,{key:1,prop:"fileList"},{default:o(()=>[e("div",Ft,[e("div",Dt,[s(q,{iconName:"app-warning-colorful",style:{"font-size":"16px"}})]),e("div",zt,[e("p",null,[w(l(t.$t("views.document.fileType.table.tip1"))+" ",1),s(U,{type:"primary",link:"",onClick:a[7]||(a[7]=h=>r("excel"))},{default:o(()=>[w(l(t.$t("views.document.upload.download"))+" Excel "+l(t.$t("views.document.upload.template")),1)]),_:1}),s(U,{type:"primary",link:"",onClick:a[8]||(a[8]=h=>r("csv"))},{default:o(()=>[w(l(t.$t("views.document.upload.download"))+" CSV "+l(t.$t("views.document.upload.template")),1)]),_:1})]),e("p",null,l(t.$t("views.document.fileType.table.tip2")),1),e("p",null,l(t.$t("views.document.fileType.table.tip3")),1),e("p",null," 4. "+l(t.$t("views.document.tip.fileLimitCountTip1"))+" "+l(b.value)+" "+l(t.$t("views.document.tip.fileLimitCountTip2"))+", "+l(t.$t("views.document.tip.fileLimitSizeTip1"))+" "+l(I.value)+" MB ",1)])]),s(H,{webkitdirectory:!1,class:"w-full mb-4",drag:"",multiple:"","file-list":u.value.fileList,"onUpdate:fileList":a[11]||(a[11]=h=>u.value.fileList=h),action:"#","auto-upload":!1,"show-file-list":!1,accept:".xlsx, .xls, .csv",limit:b.value,"on-exceed":f,"on-change":p,onClick:a[12]||(a[12]=N(h=>m(!1),["prevent"]))},{default:o(()=>[a[18]||(a[18]=e("img",{src:ie,alt:""},null,-1)),e("div",It,[e("p",null,[w(l(t.$t("views.document.upload.uploadMessage"))+" ",1),e("em",{class:"hover",onClick:a[9]||(a[9]=N(h=>m(!1),["prevent"]))},l(t.$t("views.document.upload.selectFile")),1),e("em",{class:"hover ml-4",onClick:a[10]||(a[10]=N(h=>m(!0),["prevent"]))},l(t.$t("views.document.upload.selectFiles")),1)]),e("div",Ut,[e("p",null,l(t.$t("views.document.upload.formats"))+"XLS縲々LSX縲，SV",1)])])]),_:1,__:[18]},8,["file-list","limit"])]),_:1})):(_(),C(j,{key:2,prop:"fileList"},{default:o(()=>[e("div",Mt,[e("div",Pt,[s(q,{iconName:"app-warning-colorful",style:{"font-size":"16px"}})]),e("div",Et,[e("p",null,l(t.$t("views.document.fileType.txt.tip1")),1),e("p",null," 2. "+l(t.$t("views.document.tip.fileLimitCountTip1"))+" "+l(b.value)+" "+l(t.$t("views.document.tip.fileLimitCountTip2"))+", "+l(t.$t("views.document.tip.fileLimitSizeTip1"))+" "+l(I.value)+" MB ",1)])]),s(H,{webkitdirectory:!1,class:"w-full",drag:"",multiple:"","file-list":u.value.fileList,"onUpdate:fileList":a[15]||(a[15]=h=>u.value.fileList=h),action:"#","auto-upload":!1,"show-file-list":!1,accept:".txt, .md, .log, .docx, .pdf, .html,.zip,.xlsx,.xls,.csv",limit:b.value,"on-exceed":f,"on-change":p,onClick:a[16]||(a[16]=N(h=>m(!1),["prevent"]))},{default:o(()=>[a[19]||(a[19]=e("img",{src:ie,alt:""},null,-1)),e("div",At,[e("p",null,[w(l(t.$t("views.document.upload.uploadMessage"))+" ",1),e("em",{class:"hover",onClick:a[13]||(a[13]=N(h=>m(!1),["prevent"]))},l(t.$t("views.document.upload.selectFile")),1),e("em",{class:"hover ml-4",onClick:a[14]||(a[14]=N(h=>m(!0),["prevent"]))},l(t.$t("views.document.upload.selectFiles")),1)]),e("div",xt,[e("p",null,l(t.$t("views.document.upload.formats"))+"TXT縲｀arkdown縲￣DF縲．OCX縲？TML縲々LS縲々LSX縲，SV縲〇IP ",1)])])]),_:1,__:[19]},8,["file-list","limit"])]),_:1}))]),_:1},8,["model","rules"])),[[P,d.value]]),(te=u.value.fileList)!=null&&te.length?(_(),C(ae,{key:0,gutter:8},{default:o(()=>[(_(!0),E(Z,null,J(u.value.fileList,(h,fe)=>(_(),C(ne,{key:fe,span:12,class:"mb-8"},{default:o(()=>[s(ee,{shadow:"never",class:"file-List-card"},{default:o(()=>[e("div",Bt,[e("div",Nt,[e("img",{src:B(re)(h&&(h==null?void 0:h.name)),alt:"",width:"40"},null,8,Xt),e("div",qt,[e("p",null,l(h&&(h==null?void 0:h.name)),1),s(se,{type:"info",size:"small"},{default:o(()=>[w(l(B(ke)(h&&(h==null?void 0:h.size))||"0K"),1)]),_:2},1024)])]),s(U,{text:"",onClick:el=>S(fe)},{default:o(()=>[s(q,{iconName:"app-delete"})]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):Q("",!0)],64)}}}),Qt=W(Ht,[["__scopeId","data-v-de488c7f"]]),jt={class:"upload-document p-12-24"},Kt={class:"flex align-center mb-16"},Ot={style:{display:"inline-block"}},Zt={class:"upload-document__main flex"},Gt={class:"upload-document__component main-calc-height"},Jt={key:0,class:"upload-component p-24"},Wt={key:0,class:"upload-document__footer text-right border-t"},Yt=G({__name:"UploadDocument",setup(D){const{knowledge:M}=pe(),R=X(()=>M.documentsFiles),L=X(()=>M.documentsType),T=ye(),y=oe(),{params:{folderId:F,type:z},query:{id:i}}=y,d=X(()=>y.path.includes("shared")?"systemShare":y.path.includes("resource-management")?"systemManage":"workspace"),u=$(),V=$(),b=$(!1),I=$(!1),k=$(0),r=$(null);async function g(){if(I.value=!0,await V.value.validate())if(L.value==="QA"){const m=new FormData;R.value.forEach(v=>{v!=null&&v.raw&&m.append("file",v==null?void 0:v.raw)}),i&&K({type:"document",systemType:d.value}).postQADocument(i,m,b).then(()=>{ue(A("common.submitSuccess")),p(),T.push({path:`/knowledge/${i}/${F}/${z}/document`})})}else if(L.value==="table"){const m=new FormData;R.value.forEach(v=>{v!=null&&v.raw&&m.append("file",v==null?void 0:v.raw)}),i&&K({type:"document",systemType:d.value}).postTableDocument(i,m,b).then(()=>{ue(A("common.submitSuccess")),p(),T.push({path:`/knowledge/${i}/${F}/${z}/document`})})}else k.value++>2&&(k.value=0);else I.value=!1}const S=()=>{k.value=0};function p(){M.saveDocumentsFile([]),M.saveDocumentsType("")}function f(){var v;b.value=!0;const m=[];(v=u.value)==null||v.paragraphList.map(c=>{var t;(t=u.value)!=null&&t.checkedConnect||c.content.map(a=>{delete a.problemList}),console.log("item",c),m.push({name:c.name,paragraphs:c.content,sourceFileId:c.sourceFileId})}),console.log("id",i),console.log("documents",m),i&&K({type:"document",systemType:d.value}).putMulDocument(i,m).then(()=>{ue(A("common.submitSuccess")),p(),T.push({path:`/knowledge/${i}/${F}/${z}/document`})}).catch(()=>{b.value=!1})}return Ce(()=>{p()}),(m,v)=>{var q,U,H,j;const c=n("back-button"),t=n("el-scrollbar"),a=n("el-card"),x=n("el-button"),O=me("loading");return _(),E("div",jt,[e("div",Kt,[s(c,{to:"-1",style:{"margin-left":"-4px"}}),e("h3",Ot,l(m.$t("views.document.uploadDocument")),1)]),s(a,{style:{"--el-card-padding":"0"}},{default:o(()=>[ve((_(),E("div",Zt,[e("div",Gt,[s(t,null,{default:o(()=>[k.value===0?(_(),E("div",Jt,[s(Qt,{ref_key:"UploadComponentRef",ref:V},null,512)])):k.value===1?(_(),C(ct,{key:1,ref_key:"SetRulesRef",ref:u},null,512)):k.value===2?(_(),C(yt,{key:2,data:r.value},null,8,["data"])):Q("",!0)]),_:1})])])),[[O,b.value]])]),_:1}),k.value!==2?(_(),E("div",Wt,[s(x,{onClick:v[0]||(v[0]=Y=>B(T).go(-1)),disabled:((q=u.value)==null?void 0:q.loading)||b.value},{default:o(()=>[w(l(m.$t("common.cancel")),1)]),_:1},8,["disabled"]),k.value===1?(_(),C(x,{key:0,onClick:S,disabled:((U=u.value)==null?void 0:U.loading)||b.value},{default:o(()=>[w(l(m.$t("views.document.buttons.prev")),1)]),_:1},8,["disabled"])):Q("",!0),k.value===0?(_(),C(x,{key:1,onClick:g,type:"primary",disabled:((H=u.value)==null?void 0:H.loading)||b.value},{default:o(()=>[w(l(L.value==="txt"?m.$t("views.document.buttons.next"):m.$t("views.document.buttons.import")),1)]),_:1},8,["disabled"])):Q("",!0),k.value===1?(_(),C(x,{key:2,onClick:f,type:"primary",disabled:((j=u.value)==null?void 0:j.loading)||b.value},{default:o(()=>[w(l(m.$t("views.document.buttons.import")),1)]),_:1},8,["disabled"])):Q("",!0)])):Q("",!0)])}}}),ol=W(Yt,[["__scopeId","data-v-37c38e2c"]]);export{ol as default};
