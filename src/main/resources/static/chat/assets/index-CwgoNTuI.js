import{ct as ne,fV as ke,aJ as se,aP as i,aQ as s,aL as y,aM as r,aR as t,aT as n,aS as a,aW as u,aU as z,aV as V,aY as $e,bb as Ve,bc as v,bd as Le,aZ as De,a_ as h,b0 as xe,b1 as te,b5 as M,b6 as U,aO as oe,cx as Ce,fj as Oe,b7 as Te}from"./chat-BtFLNZ96.js";import{W as Se}from"./workspace-C5Lbmjam.js";const A="/operate_log",Me=(L,b,d)=>ne(`${A}/${L.current_page}/${L.page_size}`,b,d),Ue=()=>ne(`${A}/menu_operation_option/`,void 0,void 0),Ye=(L,b)=>{ke("log.xlsx",`${A}/export/`,L,void 0,b)},W={getOperateLog:Me,getMenuList:Ue,exportOperateLog:Ye},ze={class:"border border-r-6 mb-16",style:{"white-space":"pre-wrap",height:"400px"}},Ne={class:"p-16"},Ee={class:"dialog-footer mt-16"},je=se({__name:"DetailDialog",setup(L,{expose:b}){const d=i(!1),c=i();return b({open:p=>{c.value=JSON.stringify(p.details,null,4),d.value=!0}}),(p,w)=>{const D=s("el-scrollbar"),x=s("el-button"),k=s("el-dialog");return r(),y(k,{title:p.$t("views.operateLog.table.opt.label"),modelValue:d.value,"onUpdate:modelValue":w[1]||(w[1]=T=>d.value=T),"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:t(()=>[n("span",Ee,[a(x,{onClick:w[0]||(w[0]=z(T=>d.value=!1,["prevent"]))},{default:t(()=>[V(u(p.$t("views.operateLog.close")),1)]),_:1})])]),default:t(()=>[n("div",ze,[a(D,null,{default:t(()=>[n("div",Ne,u(c.value),1)]),_:1})])]),_:1},8,["title","modelValue"])}}}),Pe={class:"operate-log p-16-24"},We={class:"mb-16"},Ae={class:"p-24"},Fe={class:"flex-between"},Re={style:{display:"flex"}},Be={class:"flex-between complex-search"},He={class:"filter"},Ie={class:"form-item mb-16"},Je={class:"text-right"},qe={class:"text-ellipsis"},Qe={class:"filter"},Ze={class:"form-item mb-16"},Ge={class:"text-right"},Ke={key:0},Xe={key:1,style:{color:"red"}},el={class:"mr-4"},ll=se({__name:"index",setup(L){const{user:b}=$e(),d=i(!1),c=i([]),O=i(!1),p=i([]),w=i(),D=i(!1),x=Ve({current_page:1,page_size:20,total:0}),k=i(""),T=i([]),Y=i(7),$=i("user"),N=i(""),C=i({startTime:"",endTime:""}),F=i(""),ie=[{value:7,label:v("views.applicationOverview.monitor.pastDayOptions.past7Days")},{value:30,label:v("views.applicationOverview.monitor.pastDayOptions.past30Days")},{value:90,label:v("views.applicationOverview.monitor.pastDayOptions.past90Days")},{value:183,label:v("views.applicationOverview.monitor.pastDayOptions.past183Days")},{value:"other",label:v("common.custom")}],re=[{value:"user",label:v("views.operateLog.table.user.label")},{value:"status",label:v("views.operateLog.table.status.label")},{value:"ip_address",label:v("views.operateLog.table.ip_address.label")}],ue=[{value:"200",label:v("views.operateLog.table.status.success")},{value:"500",label:v("views.operateLog.table.status.fail")}],R=i([]),B=i([]);function H(e){e==="clear"&&(c.value=[]),m(),d.value=!1}function I(e){e==="clear"&&(p.value=[]),m(),O.value=!1}function pe(e){m()}function de(e){$.value=e,k.value&&m()}function J(e){e!=="other"&&(C.value.startTime=Oe(e),C.value.endTime="",m())}function ce(e){C.value.startTime=e[0],C.value.endTime=e[1],m()}function ve(e){w.value.open(e)}function me(){x.current_page=1,m()}function q(){let e={startTime:C.value.startTime,endTime:C.value.endTime};return k.value&&$.value!=="status"&&(e[$.value]=k.value),$.value==="status"&&(e.status=N.value),c.value.length>0&&(e.menu=JSON.stringify(c.value)),p.value.length>0&&(e.workspace_ids=JSON.stringify(p.value)),e}function m(){return W.getOperateLog(x,q(),D).then(e=>{T.value=e.data.records,x.total=e.data.total})}function be(){return W.getMenuList().then(e=>{e.data.filter((f,S,E)=>S===E.findIndex(j=>j.menu===f.menu)).forEach(f=>{R.value.push({label:f.menu_label,value:f.menu})})})}const fe=()=>{W.exportOperateLog(q(),D)};async function _e(){if(b.isEE()){const e=await Se.getSystemWorkspaceList(D);B.value=e.data.map(o=>({label:o.name,value:o.id}))}}return Le(()=>{be(),_e(),J(Y.value)}),(e,o)=>{const f=s("el-option"),S=s("el-select"),E=s("el-date-picker"),j=s("el-input"),_=s("el-button"),Q=s("Filter"),Z=s("el-icon"),G=s("el-checkbox"),K=s("el-checkbox-group"),X=s("el-scrollbar"),ee=s("el-popover"),g=s("el-table-column"),le=s("el-tooltip"),ge=s("AppIcon"),he=s("app-table"),ye=s("el-card"),we=De("loading");return r(),h("div",Pe,[n("h2",We,u(e.$t("views.operateLog.title")),1),a(ye,{style:{"--el-card-padding":"0"},class:"main-calc-height"},{default:t(()=>[n("div",Ae,[n("div",Fe,[n("div",null,[a(S,{modelValue:Y.value,"onUpdate:modelValue":o[0]||(o[0]=l=>Y.value=l),class:"mr-12",onChange:J,style:{width:"180px"}},{default:t(()=>[(r(),h(M,null,U(ie,l=>a(f,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),Y.value==="other"?(r(),y(E,{key:0,modelValue:F.value,"onUpdate:modelValue":o[1]||(o[1]=l=>F.value=l),type:"daterange","start-placeholder":e.$t("views.applicationOverview.monitor.startDatePlaceholder"),"end-placeholder":e.$t("views.applicationOverview.monitor.endDatePlaceholder"),format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:ce},null,8,["modelValue","start-placeholder","end-placeholder"])):te("",!0)]),n("div",Re,[n("div",Be,[a(S,{modelValue:$.value,"onUpdate:modelValue":o[2]||(o[2]=l=>$.value=l),class:"complex-search__left",onChange:de,style:{width:"120px"}},{default:t(()=>[(r(),h(M,null,U(re,l=>a(f,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),$.value==="status"?(r(),y(S,{key:0,modelValue:N.value,"onUpdate:modelValue":o[3]||(o[3]=l=>N.value=l),onChange:pe,style:{width:"220px"},clearable:""},{default:t(()=>[(r(),h(M,null,U(ue,l=>a(f,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])):(r(),y(j,{key:1,modelValue:k.value,"onUpdate:modelValue":o[4]||(o[4]=l=>k.value=l),onChange:m,placeholder:e.$t("common.search"),"prefix-icon":"Search",style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"]))]),a(_,{onClick:fe,style:{"margin-left":"10px"}},{default:t(()=>[V(u(e.$t("common.export")),1)]),_:1})])]),xe((r(),y(he,{class:"mt-16",data:T.value,"pagination-config":x,onSizeChange:me,onChangePage:m},{default:t(()=>[a(g,{prop:"menu",label:e.$t("views.operateLog.table.menu.label"),width:"160"},{header:t(()=>[n("div",null,[n("span",null,u(e.$t("views.operateLog.table.menu.label")),1),a(ee,{width:200,trigger:"click",visible:d.value},{reference:t(()=>[a(_,{style:{"margin-top":"-2px"},type:c.value&&c.value.length>0?"primary":"",link:"",onClick:o[5]||(o[5]=l=>d.value=!d.value)},{default:t(()=>[a(Z,null,{default:t(()=>[a(Q)]),_:1})]),_:1},8,["type"])]),default:t(()=>[n("div",He,[n("div",Ie,[n("div",{onClick:o[7]||(o[7]=z(()=>{},["stop"]))},[a(X,{height:"300",style:{margin:"0 0 0 10px"}},{default:t(()=>[a(K,{modelValue:c.value,"onUpdate:modelValue":o[6]||(o[6]=l=>c.value=l),style:{display:"flex","flex-direction":"column"}},{default:t(()=>[(r(!0),h(M,null,U(R.value,l=>(r(),y(G,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])])]),n("div",Je,[a(_,{size:"small",onClick:o[8]||(o[8]=l=>H("clear"))},{default:t(()=>[V(u(e.$t("common.clear")),1)]),_:1}),a(_,{type:"primary",onClick:H,size:"small"},{default:t(()=>[V(u(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"])])]),_:1},8,["label"]),a(g,{prop:"operate",label:e.$t("views.operateLog.table.operate.detail")},{default:t(({row:l})=>{var P;return[a(le,{content:l.operate+((P=l.operation_object)!=null&&P.name?`【${l.operation_object.name}】`:""),effect:"dark",placement:"top"},{default:t(()=>{var ae;return[n("span",qe,u(l.operate+((ae=l.operation_object)!=null&&ae.name?`【${l.operation_object.name}】`:"")),1)]}),_:2},1032,["content"])]}),_:1},8,["label"]),a(g,{width:"120",prop:"user.username",label:e.$t("views.operateLog.table.user.label")},null,8,["label"]),oe(b).isEE()?(r(),y(g,{key:0,width:"200",prop:"workspace_name",label:e.$t("views.workspace.title")},{header:t(()=>[n("div",null,[n("span",null,u(e.$t("views.workspace.title")),1),a(ee,{width:200,trigger:"click",visible:O.value},{reference:t(()=>[a(_,{style:{"margin-top":"-2px"},type:p.value&&p.value.length>0?"primary":"",link:"",onClick:o[9]||(o[9]=l=>O.value=!O.value)},{default:t(()=>[a(Z,null,{default:t(()=>[a(Q)]),_:1})]),_:1},8,["type"])]),default:t(()=>[n("div",Qe,[n("div",Ze,[n("div",{onClick:o[11]||(o[11]=z(()=>{},["stop"]))},[a(X,{height:"300",style:{margin:"0 0 0 10px"}},{default:t(()=>[a(K,{modelValue:p.value,"onUpdate:modelValue":o[10]||(o[10]=l=>p.value=l),style:{display:"flex","flex-direction":"column"}},{default:t(()=>[(r(!0),h(M,null,U(B.value,l=>(r(),y(G,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])])]),n("div",Ge,[a(_,{size:"small",onClick:o[12]||(o[12]=l=>I("clear"))},{default:t(()=>[V(u(e.$t("common.clear")),1)]),_:1}),a(_,{type:"primary",onClick:I,size:"small"},{default:t(()=>[V(u(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"])])]),_:1},8,["label"])):te("",!0),a(g,{prop:"status",label:e.$t("views.operateLog.table.status.label"),width:"100"},{default:t(({row:l})=>[l.status===200?(r(),h("span",Ke,u(e.$t("views.operateLog.table.status.success")),1)):(r(),h("span",Xe,u(e.$t("views.operateLog.table.status.fail")),1))]),_:1},8,["label"]),a(g,{prop:"ip_address",label:e.$t("views.operateLog.table.ip_address.label"),width:"160"},null,8,["label"]),a(g,{label:e.$t("views.operateLog.table.operateTime.label"),width:"180"},{default:t(({row:l})=>[V(u(oe(Ce)(l.createTime)),1)]),_:1},8,["label"]),a(g,{label:e.$t("common.operation"),width:"60",align:"left",fixed:"right"},{default:t(({row:l})=>[n("span",el,[a(le,{effect:"dark",content:e.$t("views.operateLog.table.opt.label"),placement:"top"},{default:t(()=>[a(_,{type:"primary",text:"",onClick:z(P=>ve(l),["stop"]),class:"text-button"},{default:t(()=>[a(ge,{iconName:"app-operate-log"})]),_:2},1032,["onClick"])]),_:2},1032,["content"])])]),_:1},8,["label"])]),_:1},8,["data","pagination-config"])),[[we,D.value]])]),a(je,{ref_key:"DetailDialogRef",ref:w},null,512)]),_:1})])}}}),ol=Te(ll,[["__scopeId","data-v-97b21d8d"]]);export{ol as default};
