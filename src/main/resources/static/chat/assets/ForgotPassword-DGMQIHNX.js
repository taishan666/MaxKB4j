import{L as B,a as D}from"./LoginContainer-CHClvGFk.js";import{ay as T,az as M,aA as N,aB as t,aC as c,bW as S,aD as v,bo as Z,bp as q,bj as I,aE as U,aF as G,aG as l,aH as o,bk as w,aI as r,aJ as g,aK as b,aL as z,bm as j}from"./chat-C--1ojLo.js";const H={class:"mb-24"},J={class:"mb-24"},K={class:"mb-24"},W={class:"flex-between w-full"},O={class:"operate-container mt-12"},x=T({__name:"ForgotPassword",setup(Q){const C=M(),{theme:k,user:F}=N(),s=t({email:"",code:"",type:"reset_password"}),f=t(),E=t({email:[{required:!0,message:c("views.login.loginForm.email.requiredMessage"),trigger:"blur"},{validator:(e,a,n)=>{!/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/.test(a)&&a!=""?n(new Error(c("views.login.loginForm.email.validatorEmail"))):n()},trigger:"blur"}],code:[{required:!0,message:c("views.login.verificationCode.placeholder")}]}),i=t(!1),d=t(!1),u=t(60),p=t(!1),L=()=>{var e;(e=f.value)==null||e.validate().then(()=>z.checkCode(s.value,p)).then(()=>C.push({name:"ResetPassword",params:s.value}))},A=()=>{var e;(e=f.value)==null||e.validateField("email",a=>{a&&z.sendEmit(s.value.email,"reset_password",p).then(()=>{j(c("views.login.verificationCode.successMessage")),d.value=!0,$()})})},$=()=>{u.value<=0?(d.value=!1,u.value=60):setTimeout(()=>{u.value--,$()},1e3)};return S(()=>{i.value=!0,F.asyncGetProfile().then(()=>{i.value=!1})}),(e,a)=>{const n=v("el-input"),_=v("el-form-item"),h=v("el-button"),P=v("el-form"),R=Z("loading");return i.value?I("",!0):q((G(),U(D,{key:0},{default:l(()=>{var y,V;return[o(B,{subTitle:(y=w(k).themeInfo)!=null&&y.slogan?(V=w(k).themeInfo)==null?void 0:V.slogan:e.$t("theme.defaultSlogan")},{default:l(()=>[r("h2",H,g(e.$t("views.login.forgotPassword")),1),o(P,{class:"register-form",ref_key:"resetPasswordFormRef",ref:f,model:s.value,rules:E.value},{default:l(()=>[r("div",J,[o(_,{prop:"email"},{default:l(()=>[o(n,{size:"large",class:"input-item",modelValue:s.value.email,"onUpdate:modelValue":a[0]||(a[0]=m=>s.value.email=m),placeholder:e.$t("views.login.loginForm.email.placeholder")},null,8,["modelValue","placeholder"])]),_:1})]),r("div",K,[o(_,{prop:"code"},{default:l(()=>[r("div",W,[o(n,{size:"large",class:"code-input",modelValue:s.value.code,"onUpdate:modelValue":a[1]||(a[1]=m=>s.value.code=m),placeholder:e.$t("views.login.verificationCode.placeholder")},null,8,["modelValue","placeholder"]),o(h,{disabled:d.value,size:"large",class:"send-email-button ml-12",onClick:A,loading:i.value},{default:l(()=>[b(g(d.value?`${e.$t("views.login.verificationCode.resend")}（${u.value}s）`:e.$t("views.login.verificationCode.getVerificationCode")),1)]),_:1},8,["disabled","loading"])])]),_:1})])]),_:1},8,["model","rules"]),o(h,{size:"large",type:"primary",class:"w-full",onClick:L},{default:l(()=>[b(g(e.$t("views.login.buttons.checkCode")),1)]),_:1}),r("div",O,[o(h,{class:"register",onClick:a[2]||(a[2]=m=>w(C).push("/login")),link:"",type:"primary",icon:"ArrowLeft"},{default:l(()=>[b(g(e.$t("views.login.buttons.backLogin")),1)]),_:1})])]),_:1},8,["subTitle"])]}),_:1})),[[R,i.value||p.value]])}}});export{x as default};
