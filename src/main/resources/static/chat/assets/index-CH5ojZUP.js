import{aJ as B,aP as U,bd as L,be as i,bf as J,aQ as s,aZ as T,a_ as y,aM as m,aS as l,aR as n,b0 as D,aT as C,aV as k,aW as h,aL as E,aO as $,cx as K,cw as j,cy as z,bi as Q,cr as pe,cq as me,cE as fe,fN as ge,b5 as Z,b6 as X,e9 as ae,b1 as N,cu as he,b7 as se,aY as ve,b9 as _e,aN as be}from"./chat-4wXRqTZ9.js";import{a as O}from"./auth-setting-CxNeJbnH.js";import{_ as we,a as ye,b as Ve,c as ke,d as $e}from"./logo_wechat-BQQCOajc.js";const Ue={class:"authentication-setting__main main-calc-height"},Pe={class:"form-container p-24"},Ce=B({__name:"LDAP",setup(S){const e=U({id:"",auth_type:"LDAP",config:{ldap_server:"",base_dn:"",password:"",ou:"",ldap_filter:"",ldap_mapping:""},isActive:!0}),_=U(),p=U(!1),g=L({"config.ldap_server":[{required:!0,message:i("views.system.authentication.ldap.serverPlaceholder"),trigger:"blur"}],"config.base_dn":[{required:!0,message:i("views.system.authentication.ldap.bindDNPlaceholder"),trigger:"blur"}],"config.password":[{required:!0,message:i("views.login.loginForm.password.placeholder"),trigger:"blur"}],"config.ou":[{required:!0,message:i("views.system.authentication.ldap.ouPlaceholder"),trigger:"blur"}],"config.ldap_filter":[{required:!0,message:i("views.system.authentication.ldap.ldap_filterPlaceholder"),trigger:"blur"}],"config.ldap_mapping":[{required:!0,message:i("views.system.authentication.ldap.ldap_mappingPlaceholder"),trigger:"blur"}]}),V=async(a,o)=>{a&&await a.validate((d,r)=>{d&&(o?O.postAuthSetting(e.value,p).then(b=>{Q(i("views.system.testSuccess"))}):O.putAuthSetting(e.value.auth_type,e.value,p).then(b=>{Q(i("common.saveSuccess"))}))})};function c(){O.getAuthSetting(e.value.auth_type,p).then(a=>{a.data&&JSON.stringify(a.data)!=="{}"&&(e.value=a.data,a.data.config.ldap_mapping&&(e.value.config.ldap_mapping=JSON.stringify(JSON.parse(a.data.config.ldap_mapping))))})}return J(()=>{c()}),(a,o)=>{const d=s("el-input"),r=s("el-form-item"),b=s("el-checkbox"),A=s("el-form"),I=s("el-button"),u=s("el-scrollbar"),f=T("hasPermission"),v=T("loading");return m(),y("div",Ue,[l(u,null,{default:n(()=>[D((m(),y("div",Pe,[l(A,{ref_key:"authFormRef",ref:_,rules:g,model:e.value,"label-position":"top","require-asterisk-position":"right"},{default:n(()=>[l(r,{label:a.$t("views.system.authentication.ldap.address"),prop:"config.ldap_server"},{default:n(()=>[l(d,{modelValue:e.value.config.ldap_server,"onUpdate:modelValue":o[0]||(o[0]=t=>e.value.config.ldap_server=t),placeholder:a.$t("views.system.authentication.ldap.serverPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:a.$t("views.system.authentication.ldap.bindDN"),prop:"config.base_dn"},{default:n(()=>[l(d,{modelValue:e.value.config.base_dn,"onUpdate:modelValue":o[1]||(o[1]=t=>e.value.config.base_dn=t),placeholder:a.$t("views.system.authentication.ldap.bindDNPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:a.$t("views.system.password"),prop:"config.password"},{default:n(()=>[l(d,{modelValue:e.value.config.password,"onUpdate:modelValue":o[2]||(o[2]=t=>e.value.config.password=t),placeholder:a.$t("views.login.loginForm.password.placeholder"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:a.$t("views.system.authentication.ldap.ou"),prop:"config.ou"},{default:n(()=>[l(d,{modelValue:e.value.config.ou,"onUpdate:modelValue":o[3]||(o[3]=t=>e.value.config.ou=t),placeholder:a.$t("views.system.authentication.ldap.ouPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:a.$t("views.system.authentication.ldap.ldap_filter"),prop:"config.ldap_filter"},{default:n(()=>[l(d,{modelValue:e.value.config.ldap_filter,"onUpdate:modelValue":o[4]||(o[4]=t=>e.value.config.ldap_filter=t),placeholder:a.$t("views.system.authentication.ldap.ldap_filterPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:a.$t("views.system.authentication.ldap.ldap_mapping"),prop:"config.ldap_mapping"},{default:n(()=>[l(d,{modelValue:e.value.config.ldap_mapping,"onUpdate:modelValue":o[5]||(o[5]=t=>e.value.config.ldap_mapping=t),placeholder:'{"name":"name","email":"mail","username":"cn"}'},null,8,["modelValue"])]),_:1},8,["label"]),l(r,null,{default:n(()=>[l(b,{modelValue:e.value.isActive,"onUpdate:modelValue":o[6]||(o[6]=t=>e.value.isActive=t)},{default:n(()=>[k(h(a.$t("views.system.authentication.ldap.enableAuthentication")),1)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["rules","model"]),C("div",null,[l(I,{onClick:o[7]||(o[7]=t=>V(_.value,"test")),disabled:p.value},{default:n(()=>[k(h(a.$t("views.system.test")),1)]),_:1},8,["disabled"]),D((m(),E(I,{onClick:o[8]||(o[8]=t=>V(_.value)),type:"primary",disabled:p.value},{default:n(()=>[k(h(a.$t("common.save")),1)]),_:1},8,["disabled"])),[[f,new($(K))([$(j).ADMIN],[$(z).LOGIN_AUTH_EDIT],[],"OR")]])])])),[[v,p.value]])]),_:1})])}}}),Ae={class:"authentication-setting__main main-calc-height"},Ie={class:"form-container p-24"},Ee=B({__name:"CAS",setup(S){const e=U({id:"",auth_type:"CAS",config:{ldpUri:"",validateUrl:"",redirectUrl:""},isActive:!0}),_=U(),p=U(!1),g=L({"config.ldpUri":[{required:!0,message:i("views.system.authentication.cas.ldpUriPlaceholder"),trigger:"blur"}],"config.validateUrl":[{required:!0,message:i("views.system.authentication.cas.validateUrlPlaceholder"),trigger:"blur"}],"config.redirectUrl":[{required:!0,message:i("views.system.authentication.cas.redirectUrlPlaceholder"),trigger:"blur"}]}),V=async a=>{a&&await a.validate((o,d)=>{o&&O.putAuthSetting(e.value.auth_type,e.value,p).then(r=>{Q(i("common.saveSuccess"))})})};function c(){O.getAuthSetting(e.value.auth_type,p).then(a=>{a.data&&JSON.stringify(a.data)!=="{}"&&(a.data.config.validateUrl||(a.data.config.validateUrl=a.data.config.ldpUri),e.value=a.data),e.value.config.redirectUrl||(e.value.config.redirectUrl=window.location.origin+window.MaxKB.prefix+"/api/cas")})}return J(()=>{c()}),(a,o)=>{const d=s("el-input"),r=s("el-form-item"),b=s("el-checkbox"),A=s("el-form"),I=s("el-button"),u=s("el-scrollbar"),f=T("hasPermission"),v=T("loading");return m(),y("div",Ae,[l(u,null,{default:n(()=>[D((m(),y("div",Ie,[l(A,{ref_key:"authFormRef",ref:_,rules:g,model:e.value,"label-position":"top","require-asterisk-position":"right"},{default:n(()=>[l(r,{label:a.$t("views.system.authentication.cas.ldpUri"),prop:"config.ldpUri"},{default:n(()=>[l(d,{modelValue:e.value.config.ldpUri,"onUpdate:modelValue":o[0]||(o[0]=t=>e.value.config.ldpUri=t),placeholder:a.$t("views.system.authentication.cas.ldpUriPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:a.$t("views.system.authentication.cas.validateUrl"),prop:"config.validateUrl"},{default:n(()=>[l(d,{modelValue:e.value.config.validateUrl,"onUpdate:modelValue":o[1]||(o[1]=t=>e.value.config.validateUrl=t),placeholder:a.$t("views.system.authentication.cas.validateUrlPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:a.$t("views.system.authentication.cas.redirectUrl"),prop:"config.redirectUrl"},{default:n(()=>[l(d,{modelValue:e.value.config.redirectUrl,"onUpdate:modelValue":o[2]||(o[2]=t=>e.value.config.redirectUrl=t),placeholder:a.$t("views.system.authentication.cas.redirectUrlPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,null,{default:n(()=>[l(b,{modelValue:e.value.isActive,"onUpdate:modelValue":o[3]||(o[3]=t=>e.value.isActive=t)},{default:n(()=>[k(h(a.$t("views.system.authentication.cas.enableAuthentication")),1)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["rules","model"]),C("div",null,[D((m(),E(I,{onClick:o[4]||(o[4]=t=>V(_.value)),type:"primary",disabled:p.value},{default:n(()=>[k(h(a.$t("common.save")),1)]),_:1},8,["disabled"])),[[f,new($(K))([$(j).ADMIN],[$(z).LOGIN_AUTH_EDIT],[],"OR")]])])])),[[v,p.value]])]),_:1})])}}}),Se={class:"authentication-setting__main main-calc-height"},Re={class:"form-container p-24"},qe=B({__name:"OIDC",setup(S){const e=U({id:"",auth_type:"OIDC",config:{authEndpoint:"",tokenEndpoint:"",userInfoEndpoint:"",scope:"",state:"",clientId:"",clientSecret:"",fieldMapping:'{"username": "preferred_username", "email": "email"}',redirectUrl:""},isActive:!0}),_=U(),p=U(!1),g=L({"config.authEndpoint":[{required:!0,message:i("views.system.authentication.oidc.authEndpointPlaceholder"),trigger:"blur"}],"config.tokenEndpoint":[{required:!0,message:i("views.system.authentication.oidc.tokenEndpointPlaceholder"),trigger:"blur"}],"config.userInfoEndpoint":[{required:!0,message:i("views.system.authentication.oidc.userInfoEndpointPlaceholder"),trigger:"blur"}],"config.scope":[{required:!0,message:i("views.system.authentication.oidc.scopePlaceholder"),trigger:"blur"}],"config.clientId":[{required:!0,message:i("views.system.authentication.oidc.clientIdPlaceholder"),trigger:"blur"}],"config.clientSecret":[{required:!0,message:i("views.system.authentication.oidc.clientSecretPlaceholder"),trigger:"blur"}],"config.fieldMapping":[{required:!0,message:i("views.system.authentication.oauth2.filedMappingPlaceholder"),trigger:"blur"}],"config.redirectUrl":[{required:!0,message:i("views.system.authentication.oidc.redirectUrlPlaceholder"),trigger:"blur"}],"config.logoutEndpoint":[{required:!0,message:i("views.system.authentication.oidc.logoutEndpointPlaceholder"),trigger:"blur"}]}),V=async(a,o)=>{a&&await a.validate((d,r)=>{d&&O.putAuthSetting(e.value.auth_type,e.value,p).then(b=>{Q(i("common.saveSuccess"))})})};function c(){O.getAuthSetting(e.value.auth_type,p).then(a=>{a.data&&JSON.stringify(a.data)!=="{}"&&(e.value=a.data,(e.value.config.fieldMapping===""||e.value.config.fieldMapping===void 0)&&(e.value.config.fieldMapping='{"username": "preferred_username", "email": "email"}')),e.value.config.redirectUrl||(e.value.config.redirectUrl=window.location.origin+window.MaxKB.prefix+"/api/oidc")})}return J(()=>{c()}),(a,o)=>{const d=s("el-input"),r=s("el-form-item"),b=s("el-checkbox"),A=s("el-form"),I=s("el-button"),u=s("el-scrollbar"),f=T("hasPermission"),v=T("loading");return m(),y("div",Se,[l(u,null,{default:n(()=>[D((m(),y("div",Re,[l(A,{ref_key:"authFormRef",ref:_,rules:g,model:e.value,"label-position":"top","require-asterisk-position":"right"},{default:n(()=>[l(r,{label:a.$t("views.system.authentication.oidc.authEndpoint"),prop:"config.authEndpoint"},{default:n(()=>[l(d,{modelValue:e.value.config.authEndpoint,"onUpdate:modelValue":o[0]||(o[0]=t=>e.value.config.authEndpoint=t),placeholder:a.$t("views.system.authentication.oidc.authEndpointPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:a.$t("views.system.authentication.oidc.tokenEndpoint"),prop:"config.tokenEndpoint"},{default:n(()=>[l(d,{modelValue:e.value.config.tokenEndpoint,"onUpdate:modelValue":o[1]||(o[1]=t=>e.value.config.tokenEndpoint=t),placeholder:a.$t("views.system.authentication.oidc.tokenEndpointPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:a.$t("views.system.authentication.oidc.userInfoEndpoint"),prop:"config.userInfoEndpoint"},{default:n(()=>[l(d,{modelValue:e.value.config.userInfoEndpoint,"onUpdate:modelValue":o[2]||(o[2]=t=>e.value.config.userInfoEndpoint=t),placeholder:a.$t("views.system.authentication.oidc.userInfoEndpointPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:"Scope",prop:"config.scope"},{default:n(()=>[l(d,{modelValue:e.value.config.scope,"onUpdate:modelValue":o[3]||(o[3]=t=>e.value.config.scope=t),placeholder:"openid+profile+email "},null,8,["modelValue"])]),_:1}),l(r,{label:"State",prop:"config.state"},{default:n(()=>[l(d,{modelValue:e.value.config.state,"onUpdate:modelValue":o[4]||(o[4]=t=>e.value.config.state=t),placeholder:""},null,8,["modelValue"])]),_:1}),l(r,{label:a.$t("views.system.authentication.oidc.clientId"),prop:"config.clientId"},{default:n(()=>[l(d,{modelValue:e.value.config.clientId,"onUpdate:modelValue":o[5]||(o[5]=t=>e.value.config.clientId=t),placeholder:a.$t("views.system.authentication.oidc.clientIdPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:a.$t("views.system.authentication.oidc.clientSecret"),prop:"config.clientSecret"},{default:n(()=>[l(d,{modelValue:e.value.config.clientSecret,"onUpdate:modelValue":o[6]||(o[6]=t=>e.value.config.clientSecret=t),placeholder:a.$t("views.system.authentication.oidc.clientSecretPlaceholder"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:a.$t("views.system.authentication.oauth2.filedMapping"),prop:"config.fieldMapping"},{default:n(()=>[l(d,{modelValue:e.value.config.fieldMapping,"onUpdate:modelValue":o[7]||(o[7]=t=>e.value.config.fieldMapping=t),placeholder:a.$t("views.system.authentication.oauth2.filedMappingPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:a.$t("views.system.authentication.oidc.redirectUrl"),prop:"config.redirectUrl"},{default:n(()=>[l(d,{modelValue:e.value.config.redirectUrl,"onUpdate:modelValue":o[8]||(o[8]=t=>e.value.config.redirectUrl=t),placeholder:a.$t("views.system.authentication.oidc.redirectUrlPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,null,{default:n(()=>[l(b,{modelValue:e.value.isActive,"onUpdate:modelValue":o[9]||(o[9]=t=>e.value.isActive=t)},{default:n(()=>[k(h(a.$t("views.system.authentication.oidc.enableAuthentication")),1)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["rules","model"]),C("div",null,[D((m(),E(I,{onClick:o[10]||(o[10]=t=>V(_.value)),type:"primary",disabled:p.value},{default:n(()=>[k(h(a.$t("common.save")),1)]),_:1},8,["disabled"])),[[f,new($(K))([$(j).ADMIN],[$(z).LOGIN_AUTH_EDIT],[],"OR")]])])])),[[v,p.value]])]),_:1})])}}}),le="/platform",Ne=S=>pe(`${le}/source`,void 0,S),Te=(S,e)=>fe(`${le}/source`,S,void 0,e),De=(S,e)=>me(`${le}/source`,S,void 0,e),H={getPlatformInfo:Ne,updateConfig:Te,validateConnection:De},Me={class:"flex align-center",style:{"margin-left":"-8px"}},Oe={class:"dialog-footer"},Qe=B({__name:"EditModal",emits:["refresh"],setup(S,{expose:e,emit:_}){const p=U(!1),g=U(!1),V=U(),c=L({key:"",logoSrc:"",name:"",isActive:!1,isValid:!1,config:{}}),a=t=>({corp_id:"Corp ID",app_key:(c==null?void 0:c.key)!="lark"?"APP Key":"App ID",app_secret:"APP Secret",agent_id:"Agent ID",callback_url:i("views.application.applicationAccess.callback")})[t]||(t?t.charAt(0).toUpperCase()+t.slice(1):""),o=t=>{switch(t){case"app_key":return[{required:!0,message:i("views.system.authentication.scanTheQRCode.appKeyPlaceholder"),trigger:["blur","change"]}];case"app_secret":return[{required:!0,message:i("views.system.authentication.scanTheQRCode.appSecretPlaceholder"),trigger:["blur","change"]}];case"corp_id":return[{required:!0,message:i("views.system.authentication.scanTheQRCode.corpIdPlaceholder"),trigger:["blur","change"]}];case"agent_id":return[{required:!0,message:i("views.system.authentication.scanTheQRCode.agentIdPlaceholder"),trigger:["blur","change"]}];case"callback_url":return[{required:!0,message:i("views.application.applicationAccess.callbackTip"),trigger:["blur","change"]},{pattern:/^https?:\/\/.+/,message:i("views.system.authentication.scanTheQRCode.callbackWarning"),trigger:["blur","change"]}];default:return[]}};e({open:async t=>{var F;p.value=!0,g.value=!0,Object.assign(c,t);const P=window.location.origin+window.MaxKB.prefix;switch(t.key){case"wecom":c.config.app_key&&(c.config.agent_id=c.config.app_key,delete c.config.app_key),c.config.callback_url=`${P}/api/wecom`;break;case"dingtalk":c.config.agent_id&&(c.config.corp_id=c.config.agent_id,delete c.config.agent_id),c.config={corp_id:c.config.corp_id,app_key:c.config.app_key,app_secret:c.config.app_secret,callback_url:P},c.config.callback_url=`${P}/api/dingtalk`;break;case"lark":c.config.callback_url=`${P}/api/lark`;break}(F=V.value)==null||F.clearValidate()}});const r=()=>{var t;(t=V.value)==null||t.validate(P=>{P?v():ae(i("views.system.authentication.scanTheQRCode.validateFailedTip"))})},b=()=>{var t;p.value=!1,(t=V.value)==null||t.clearValidate(),f("refresh")};function A(){H.validateConnection(c,g).then(t=>{t.data?Q(i("views.system.authentication.scanTheQRCode.validateSuccess")):ae(i("views.system.authentication.scanTheQRCode.validateFailed"))})}const I=new Set(["app_secret","client_secret","secret"]),u=t=>I.has(t),f=_;function v(){H.updateConfig(c,g).then(t=>{var P;Q(i("common.saveSuccess")),f("refresh"),p.value=!1,(P=V.value)==null||P.clearValidate()})}return(t,P)=>{const F=s("el-input"),W=s("el-form-item"),G=s("el-button"),x=s("el-drawer");return m(),E(x,{modelValue:p.value,"onUpdate:modelValue":P[0]||(P[0]=Y=>p.value=Y),size:"60%","append-to-body":!0,"destroy-on-close":!0,onClose:b},{header:n(()=>[C("div",Me,[C("h4",null,h(c.name+t.$t("views.system.authentication.scanTheQRCode.setting")),1)])]),footer:n(()=>[C("span",Oe,[l(G,{onClick:b},{default:n(()=>[k(h(t.$t("common.cancel")),1)]),_:1}),l(G,{onClick:A},{default:n(()=>[k(h(t.$t("views.system.authentication.scanTheQRCode.validate")),1)]),_:1}),l(G,{type:"primary",onClick:r},{default:n(()=>[k(h(t.$t("common.save")),1)]),_:1})])]),default:n(()=>[l($(ge),{model:c.config,"label-width":"120px","label-position":"top","require-asterisk-position":"right",ref_key:"formRef",ref:V},{default:n(()=>[(m(!0),y(Z,null,X(c.config,(Y,q)=>(m(),E(W,{key:q,label:a(q),prop:q,rules:o(q)},{default:n(()=>[l(F,{modelValue:c.config[q],"onUpdate:modelValue":ee=>c.config[q]=ee,type:u(q)?"password":"text","show-password":u(q)},null,8,["modelValue","onUpdate:modelValue","type","show-password"])]),_:2},1032,["label","prop","rules"]))),128))]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),Fe={class:"scan-height"},Le={class:"flex-between"},Be={class:"flex align-center"},Je=["src"],Ge={class:"ml-8"},He={key:1},Ke={class:"mr-4"},je={key:0,class:"border-t mt-16"},ze={class:"mt-4 mb-16 flex align-center"},We={key:0,class:"vertical-middle lighter break-all ellipsis-1"},Ye={key:1,class:"vertical-middle lighter break-all ellipsis-1"},Ze={key:2,class:"vertical-middle lighter break-all ellipsis-1"},Xe={class:"ml-4"},xe=B({__name:"SCAN",setup(S){const e=U(),_=U(!1),p=L(V()),g=L({});J(()=>{o()});function V(){return[c("wecom",i("views.system.authentication.scanTheQRCode.wecom")),c("dingtalk",i("views.system.authentication.scanTheQRCode.dingtalk")),c("lark",i("views.system.authentication.scanTheQRCode.lark"))]}function c(u,f){let v="";switch(u){case"wecom":v="wechat-work";break;case"dingtalk":v="dingtalk";break;case"lark":v="lark";break;default:v="";break}const t={...u==="wecom"?{corp_id:"",agent_id:""}:{app_key:""},app_secret:"",callback_url:""};return{key:u,logoSrc:new URL(Object.assign({"../../../../assets/logo/logo_dingtalk.svg":$e,"../../../../assets/logo/logo_lark.svg":ke,"../../../../assets/logo/logo_slack.svg":Ve,"../../../../assets/logo/logo_wechat-work.svg":ye,"../../../../assets/logo/logo_wechat.svg":we})[`../../../../assets/logo/logo_${v}.svg`],import.meta.url).href,name:f,isActive:!1,isValid:!1,config:t}}function a(u,f){return{corp_id:"Corp ID",app_key:(f==null?void 0:f.key)!="lark"?"APP Key":"App ID",app_secret:"APP Secret",agent_id:"Agent ID",callback_url:i("views.application.applicationAccess.callback")}[u]||(u?u.charAt(0).toUpperCase()+u.slice(1):"")}function o(){_.value=!0,H.getPlatformInfo(_).then(u=>{u&&p.forEach(f=>{const v=u.data.find(t=>t.auth_type===f.key);if(v){if(Object.assign(f,{isValid:v.is_valid,isActive:v.isActive,config:v.config}),f.key==="dingtalk"){const{corp_id:t,app_key:P,app_secret:F}=f.config;f.config={corp_id:t,app_key:P,app_secret:F,callback_url:f.config.callback_url}}g[f.key]={},g[f.key].app_secret=!1}})})}function d(u){H.validateConnection(u,_).then(f=>{f.data?Q(i("views.system.authentication.scanTheQRCode.validateSuccess")):ae(i("views.system.authentication.scanTheQRCode.validateFailed"))})}function r(){o()}function b(u){H.updateConfig(u,_).then(f=>{Q(i("common.saveSuccess"))})}function A(u){g[u]||(g[u]={}),g[u].app_secret=!g[u].app_secret}function I(u){var f;(f=e.value)==null||f.open(u)}return(u,f)=>{const v=s("el-tag"),t=s("el-button"),P=s("el-switch"),F=s("el-text"),W=s("AppIcon"),G=s("View"),x=s("el-icon"),Y=s("el-col"),q=s("el-row"),ee=s("el-collapse-transition"),re=s("el-card"),ce=s("el-scrollbar"),de=T("hasPermission"),ue=T("loading");return D((m(),y("div",Fe,[l(ce,null,{default:n(()=>[(m(!0),y(Z,null,X(p,w=>(m(),y("div",{key:w.key,class:"mb-16"},[l(re,{class:"border-none mb-16",shadow:"none"},{default:n(()=>[C("div",Le,[C("div",Be,[C("img",{src:w.logoSrc,alt:"",width:"24px"},null,8,Je),C("h5",Ge,h(w.name),1),w.isValid?(m(),E(v,{key:0,type:"success",class:"ml-8"},{default:n(()=>[k(h(u.$t("views.system.authentication.scanTheQRCode.effective")),1)]),_:1})):N("",!0)]),C("div",null,[w.isValid?N("",!0):D((m(),E(t,{key:0,type:"primary",onClick:M=>I(w)},{default:n(()=>[k(h(u.$t("views.system.authentication.scanTheQRCode.access")),1)]),_:2},1032,["onClick"])),[[de,new($(K))([$(j).ADMIN],[$(z).LOGIN_AUTH_EDIT],[],"OR")]]),w.isValid?(m(),y("span",He,[C("span",Ke,h(w.isActive?u.$t("views.system.authentication.scanTheQRCode.alreadyTurnedOn"):u.$t("views.system.authentication.scanTheQRCode.notEnabled")),1),l(P,{size:"small",modelValue:w.isActive,"onUpdate:modelValue":M=>w.isActive=M,disabled:!w.isValid,onChange:M=>b(w)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])])):N("",!0)])]),l(ee,null,{default:n(()=>[w.isValid?(m(),y("div",je,[l(q,{gutter:12,class:"mt-16"},{default:n(()=>[(m(!0),y(Z,null,X(w.config,(M,R)=>(m(),E(Y,{key:R,span:12},{default:n(()=>{var oe,ne;return[l(F,{type:"info"},{default:n(()=>[k(h(a(R,w)),1)]),_:2},1024),C("div",ze,[R!=="app_secret"?(m(),y("span",We,h(M),1)):N("",!0),R==="app_secret"&&!((oe=g[w.key])!=null&&oe[R])?(m(),y("span",Ye,"************")):N("",!0),R==="app_secret"&&((ne=g[w.key])!=null&&ne[R])?(m(),y("span",Ze,h(M),1)):N("",!0),C("span",null,[l(t,{type:"primary",text:"",onClick:()=>$(he)(M)},{default:n(()=>[l(W,{iconName:"app-copy"})]),_:2},1032,["onClick"])]),C("span",Xe,[R==="app_secret"?(m(),E(t,{key:0,type:"primary",text:"",onClick:te=>A(w.key)},{default:n(()=>{var te,ie;return[R==="app_secret"&&!((te=g[w.key])!=null&&te[R])?(m(),E(W,{key:0,iconName:"app-password-hide"})):N("",!0),R==="app_secret"&&((ie=g[w.key])!=null&&ie[R])?(m(),E(x,{key:1},{default:n(()=>[l(G)]),_:1})):N("",!0)]}),_:2},1032,["onClick"])):N("",!0)])])]}),_:2},1024))),128))]),_:2},1024),l(t,{type:"primary",onClick:M=>I(w)},{default:n(()=>[k(h(u.$t("common.edit")),1)]),_:2},1032,["onClick"]),l(t,{onClick:M=>d(w)},{default:n(()=>[k(h(u.$t("views.system.authentication.scanTheQRCode.validate")),1)]),_:2},1032,["onClick"])])):N("",!0)]),_:2},1024)]),_:2},1024)]))),128)),l(Qe,{ref_key:"EditModelRef",ref:e,onRefresh:r},null,512)]),_:1})])),[[ue,_.value]])}}}),et=se(xe,[["__scopeId","data-v-da0dbd8d"]]),tt={class:"authentication-setting__main main-calc-height"},at={class:"form-container p-24"},lt=B({__name:"OAuth2",setup(S){const e=U({id:"",auth_type:"OAuth2",config:{authEndpoint:"",tokenEndpoint:"",userInfoEndpoint:"",scope:"",clientId:"",clientSecret:"",redirectUrl:"",fieldMapping:""},isActive:!0}),_=U(),p=U(!1),g=L({"config.authEndpoint":[{required:!0,message:i("views.system.authentication.oauth2.authEndpointPlaceholder"),trigger:"blur"}],"config.tokenEndpoint":[{required:!0,message:i("views.system.authentication.oauth2.tokenEndpointPlaceholder"),trigger:"blur"}],"config.userInfoEndpoint":[{required:!0,message:i("views.system.authentication.oauth2.userInfoEndpointPlaceholder"),trigger:"blur"}],"config.scope":[{required:!0,message:i("views.system.authentication.oauth2.scopePlaceholder"),trigger:"blur"}],"config.clientId":[{required:!0,message:i("views.system.authentication.oauth2.clientIdPlaceholder"),trigger:"blur"}],"config.clientSecret":[{required:!0,message:i("views.system.authentication.oauth2.clientSecretPlaceholder"),trigger:"blur"}],"config.redirectUrl":[{required:!0,message:i("views.system.authentication.oauth2.redirectUrlPlaceholder"),trigger:"blur"}],"config.fieldMapping":[{required:!0,message:i("views.system.authentication.oauth2.filedMappingPlaceholder"),trigger:"blur"}]}),V=async(a,o)=>{a&&await a.validate((d,r)=>{d&&O.putAuthSetting(e.value.auth_type,e.value,p).then(b=>{Q(i("common.saveSuccess"))})})};function c(){O.getAuthSetting(e.value.auth_type,p).then(a=>{a.data&&JSON.stringify(a.data)!=="{}"&&(e.value=a.data),e.value.config.redirectUrl||(e.value.config.redirectUrl=window.location.origin+window.MaxKB.prefix+"/api/oauth2")})}return J(()=>{c()}),(a,o)=>{const d=s("el-input"),r=s("el-form-item"),b=s("el-checkbox"),A=s("el-form"),I=s("el-button"),u=s("el-scrollbar"),f=T("hasPermission"),v=T("loading");return m(),y("div",tt,[l(u,null,{default:n(()=>[D((m(),y("div",at,[l(A,{ref_key:"authFormRef",ref:_,rules:g,model:e.value,"label-position":"top","require-asterisk-position":"right"},{default:n(()=>[l(r,{label:a.$t("views.system.authentication.oauth2.authEndpoint"),prop:"config.authEndpoint"},{default:n(()=>[l(d,{modelValue:e.value.config.authEndpoint,"onUpdate:modelValue":o[0]||(o[0]=t=>e.value.config.authEndpoint=t),placeholder:a.$t("views.system.authentication.oauth2.authEndpointPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:a.$t("views.system.authentication.oauth2.tokenEndpoint"),prop:"config.tokenEndpoint"},{default:n(()=>[l(d,{modelValue:e.value.config.tokenEndpoint,"onUpdate:modelValue":o[1]||(o[1]=t=>e.value.config.tokenEndpoint=t),placeholder:a.$t("views.system.authentication.oauth2.tokenEndpointPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:a.$t("views.system.authentication.oauth2.userInfoEndpoint"),prop:"config.userInfoEndpoint"},{default:n(()=>[l(d,{modelValue:e.value.config.userInfoEndpoint,"onUpdate:modelValue":o[2]||(o[2]=t=>e.value.config.userInfoEndpoint=t),placeholder:a.$t("views.system.authentication.oauth2.userInfoEndpointPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:a.$t("views.system.authentication.oauth2.scope"),prop:"config.scope"},{default:n(()=>[l(d,{modelValue:e.value.config.scope,"onUpdate:modelValue":o[3]||(o[3]=t=>e.value.config.scope=t),placeholder:a.$t("views.system.authentication.oauth2.scopePlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:a.$t("views.system.authentication.oauth2.clientId"),prop:"config.clientId"},{default:n(()=>[l(d,{modelValue:e.value.config.clientId,"onUpdate:modelValue":o[4]||(o[4]=t=>e.value.config.clientId=t),placeholder:a.$t("views.system.authentication.oauth2.clientIdPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:a.$t("views.system.authentication.oauth2.clientSecret"),prop:"config.clientSecret"},{default:n(()=>[l(d,{modelValue:e.value.config.clientSecret,"onUpdate:modelValue":o[5]||(o[5]=t=>e.value.config.clientSecret=t),placeholder:a.$t("views.system.authentication.oauth2.clientSecretPlaceholder"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:a.$t("views.system.authentication.oauth2.redirectUrl"),prop:"config.redirectUrl"},{default:n(()=>[l(d,{modelValue:e.value.config.redirectUrl,"onUpdate:modelValue":o[6]||(o[6]=t=>e.value.config.redirectUrl=t),placeholder:a.$t("views.system.authentication.oauth2.redirectUrlPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:a.$t("views.system.authentication.oauth2.filedMapping"),prop:"config.fieldMapping"},{default:n(()=>[l(d,{modelValue:e.value.config.fieldMapping,"onUpdate:modelValue":o[7]||(o[7]=t=>e.value.config.fieldMapping=t),placeholder:a.$t("views.system.authentication.oauth2.filedMappingPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,null,{default:n(()=>[l(b,{modelValue:e.value.isActive,"onUpdate:modelValue":o[8]||(o[8]=t=>e.value.isActive=t)},{default:n(()=>[k(h(a.$t("views.system.authentication.oauth2.enableAuthentication")),1)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["rules","model"]),C("div",null,[D((m(),E(I,{onClick:o[9]||(o[9]=t=>V(_.value)),type:"primary",disabled:p.value},{default:n(()=>[k(h(a.$t("common.save")),1)]),_:1},8,["disabled"])),[[f,new($(K))([$(j).ADMIN],[$(z).LOGIN_AUTH_EDIT],[],"OR")]])])])),[[v,p.value]])]),_:1})])}}}),ot={class:"authentication-setting p-16-24"},nt={class:"ml-4 color-text-primary"},it=B({__name:"index",setup(S){const{user:e}=ve(),_=_e(),p=U("LDAP"),g=[{label:i("views.system.authentication.ldap.title"),name:"LDAP",component:Ce},{label:i("views.system.authentication.cas.title"),name:"CAS",component:Ee},{label:i("views.system.authentication.oidc.title"),name:"OIDC",component:qe},{label:i("views.system.authentication.oauth2.title"),name:"OAuth2",component:lt},{label:i("views.system.authentication.scanTheQRCode.title"),name:"SCAN",component:et}];return J(()=>{e.isExpire()&&_.push({path:"/application"})}),(V,c)=>{const a=s("el-breadcrumb-item"),o=s("el-breadcrumb"),d=s("el-tab-pane"),r=s("el-tabs");return m(),y("div",ot,[l(o,{"separator-icon":"ArrowRight",class:"mb-16"},{default:n(()=>[l(a,null,{default:n(()=>[k(h($(i)("views.system.subTitle")),1)]),_:1}),l(a,null,{default:n(()=>[C("h5",nt,h(V.$t("views.system.authentication.title")),1)]),_:1})]),_:1}),l(r,{modelValue:p.value,"onUpdate:modelValue":c[0]||(c[0]=b=>p.value=b),class:"mt-4"},{default:n(()=>[(m(),y(Z,null,X(g,(b,A)=>l(d,{key:A,label:b.label,name:b.name},{default:n(()=>[(m(),E(be(b.component)))]),_:2},1032,["label","name"])),64))]),_:1},8,["modelValue"])])}}}),dt=se(it,[["__scopeId","data-v-794acd44"]]);export{dt as default};
