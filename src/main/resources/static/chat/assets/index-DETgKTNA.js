import{l as Ee,_ as Fe}from"./vue-draggable-plus-DOoq_K5N.js";import{aJ as _e,bp as we,aP as u,bq as ye,bg as ke,aQ as d,aL as m,aM as r,aU as A,aR as o,aS as l,fg as He,aT as k,aV as b,aW as v,cI as N,aK as W,e9 as Te,aZ as Ve,b0 as fe,bn as Me,b1 as h,a_ as U,aO as R,b6 as J,b5 as Qe,bm as Re,bf as V,bk as he,ba as Ie,be as Oe,eg as Je,b8 as me,b9 as Pe,bv as We}from"./chat-CJ-GWxNS.js";import{_ as Ue}from"./ParagraphDialog.vue_vue_type_script_setup_true_lang-t9oi90wO.js";import{_ as Ae}from"./index.vue_vue_type_script_setup_true_lang-D7x8IDnf.js";import"./ParagraphForm.vue_vue_type_script_setup_true_lang-D2SnBysI.js";const Ze={class:"dialog-footer"},Be=_e({__name:"SelectDocumentDialog",props:{apiType:{}},emits:["refresh"],setup(oe,{expose:Z,emit:$}){const K=oe,_=we(),{params:{id:B,documentId:S}}=_,D=$,f=u(),x=u({}),g=u(!1),C=u(!1),L=u([]);ye(g,c=>{var w;c||(L.value=[],(w=f.value)==null||w.clearValidate())});const z=c=>{L.value=c,g.value=!0},E=async()=>{var c;if(await((c=f.value)==null?void 0:c.validate())){const w={idList:L.value};N({type:"paragraph",systemType:K.apiType}).putMigrateMulParagraph(B,S,f.value.form.knowledgeId,f.value.form.documentId,w,C).then(()=>{D("refresh"),g.value=!1})}};function i(){N({type:"knowledge",systemType:K.apiType}).getKnowledgeDetail(B,C).then(c=>{x.value=c.data})}ke(()=>{i()});function Q(c){localStorage.setItem(B+"chat_knowledge_id",c)}function F(c){localStorage.setItem(B+"chat_document_id",c)}return Z({open:z,dialogVisible:g}),(c,w)=>{const G=d("el-button"),X=d("el-dialog");return r(),m(X,{title:`${c.$t("views.chatLog.selectKnowledge")}/${c.$t("common.fileUpload.document")}`,modelValue:g.value,"onUpdate:modelValue":w[1]||(w[1]=M=>g.value=M),width:"500","close-on-click-modal":!1,"close-on-press-escape":!1,onClick:w[2]||(w[2]=A(()=>{},["stop"]))},{footer:o(()=>[k("span",Ze,[l(G,{onClick:w[0]||(w[0]=A(M=>g.value=!1,["prevent"]))},{default:o(()=>[b(v(c.$t("common.cancel")),1)]),_:1}),l(G,{type:"primary",onClick:E,loading:C.value},{default:o(()=>[b(v(c.$t("views.document.setting.migration")),1)]),_:1},8,["loading"])])]),default:o(()=>[l(He,{ref_key:"SelectKnowledgeDocumentRef",ref:f,apiType:c.apiType,onChangeKnowledge:Q,onChangeDocument:F,isApplication:!0,"workspace-id":x.value.workspaceId},null,8,["apiType","workspace-id"])]),_:1},8,["title","modelValue"])}}}),Xe={key:0,class:"mk-sticky"},Ye={class:"mr-8"},ea={class:"mr-8"},aa={class:"w-full flex-between",style:{"line-height":"22px"}},ta={class:"flex align-center"},la={class:"mb-16"},oa=_e({__name:"ParagraphCard",props:{data:{},disabled:{type:Boolean},showMoveUp:{type:Boolean},showMoveDown:{type:Boolean}},emits:["dialogVisibleChange","clickCard","changeState","deleteParagraph","refresh","refreshMigrateParagraph","move"],setup(oe,{emit:Z}){const $=oe,K=we(),{params:{id:_,documentId:B},query:{from:S}}=K,D=W(()=>S),f=W(()=>Te.knowledge[D.value]),x=a=>f.value.doc_generate(a)||f.value.doc_edit(a),g=Z,C=u(!1),L=u(!1),z=u({}),E=u(!1),i=u(!1);function Q(){E.value=!0,i.value=!1}function F(){E.value=i.value}async function c(a){const n={isActive:!a.isActive};await N({type:"paragraph",systemType:D.value}).putParagraph(_,B,a.id,n,L).then(()=>(g("changeState",a.id),!0)).catch(()=>!1)}function w(){N({type:"knowledge",systemType:D.value}).getKnowledgeDetail(_,C).then(a=>{z.value=a.data})}const G=u();function X(a){G.value&&G.value.open([a.id],"paragraph",a.id)}function M(a){Re(`${V("views.paragraph.delete.confirmTitle")} ${a.title||"-"} ?`,V("views.paragraph.delete.confirmMessage"),{confirmButtonText:V("common.confirm"),confirmButtonClass:"danger"}).then(()=>{N({type:"paragraph",systemType:D.value}).delParagraph(_,B,a.id,C).then(()=>{g("deleteParagraph",a.id),he(V("common.deleteSuccess"))})}).catch(()=>{})}const p=u(),Y=u("");function T(a){$.disabled||(Y.value=V("views.paragraph.paragraphDetail"),p.value.open(a))}const pe=f.value.doc_edit(_);function ne(a){!pe||ie.value||($.disabled?g("clickCard"):T(a))}function se(a){Y.value=V("views.paragraph.addParagraph"),p.value.open(a,"add")}const ee=u();function ce(a){ee.value.open([a.id])}function ae(a){g("refresh",a)}function ve(){g("refreshMigrateParagraph",$.data)}const ie=W(()=>{var a,n,H;return((a=p.value)==null?void 0:a.dialogVisible)||((n=ee.value)==null?void 0:n.dialogVisible)||((H=G.value)==null?void 0:H.dialogVisible)});return ke(()=>{w()}),ye(ie,a=>{g("dialogVisibleChange",a)}),(a,n)=>{const H=d("el-switch"),re=d("el-divider"),te=d("el-button"),de=d("CirclePlus"),e=d("el-icon"),t=d("el-dropdown-item"),y=d("ArrowRight"),q=d("el-dropdown-menu"),O=d("el-dropdown"),I=d("el-card"),ue=d("MdPreview"),ge=Ve("loading");return fe((r(),m(I,{shadow:"hover",class:Me(["paragraph-box cursor",a.data.isActive?"":"disabled"]),onMouseenter:n[10]||(n[10]=P=>Q()),onMouseleave:n[11]||(n[11]=P=>F()),onClick:n[12]||(n[12]=A(P=>ne(a.data),["stop"]))},{default:o(()=>[a.disabled?h("",!0):fe((r(),U("div",Xe,[x(R(_))?(r(),m(I,{key:0,class:"paragraph-box-operation mt-8 mr-8",shadow:"always",style:{"--el-card-padding":"8px 12px","--el-card-border-radius":"8px"},onClick:n[8]||(n[8]=A(()=>{},["stop"]))},{default:o(()=>[f.value.doc_edit(R(_))?(r(),m(H,{key:0,loading:L.value,modelValue:a.data.isActive,"onUpdate:modelValue":n[0]||(n[0]=P=>a.data.isActive=P),"before-change":()=>c(a.data),size:"small"},null,8,["loading","modelValue","before-change"])):h("",!0),l(re,{direction:"vertical"}),k("span",Ye,[f.value.doc_edit(R(_))?(r(),m(te,{key:0,link:"",onClick:n[1]||(n[1]=A(P=>T(a.data),["stop"]))},{default:o(()=>[l(J,{iconName:"app-edit",size:16,title:a.$t("common.edit")},null,8,["title"])]),_:1})):h("",!0)]),k("span",ea,[f.value.doc_edit(R(_))?(r(),m(te,{key:0,link:"",onClick:n[2]||(n[2]=A(P=>se(a.data),["stop"]))},{default:o(()=>[l(e,{size:16,title:a.$t("common.add")},{default:o(()=>[l(e,null,{default:o(()=>[l(de)]),_:1})]),_:1},8,["title"])]),_:1})):h("",!0)]),x(R(_))?(r(),m(O,{key:1,trigger:"click",teleported:!1},{dropdown:o(()=>[l(q,{style:{"min-width":"140px"}},{default:o(()=>[f.value.doc_generate(R(_))?(r(),m(t,{key:0,onClick:n[3]||(n[3]=A(P=>X(a.data),["stop"]))},{default:o(()=>[l(J,{iconName:"app-generate-question"}),b(" "+v(a.$t("views.document.generateQuestion.title")),1)]),_:1})):h("",!0),f.value.doc_edit(R(_))?(r(),m(t,{key:1,onClick:n[4]||(n[4]=A(P=>ce(a.data),["stop"]))},{default:o(()=>[l(J,{iconName:"app-migrate"}),b(" "+v(a.$t("views.document.setting.migration")),1)]),_:1})):h("",!0),f.value.doc_edit(R(_))?(r(),m(t,{key:2},{default:o(()=>[l(O,{class:"w-full",trigger:"hover","show-arrow":!1,placement:"right-start","popper-class":"move-position-popper"},{dropdown:o(()=>[l(q,null,{default:o(()=>[$.showMoveUp?(r(),m(t,{key:0,onClick:n[5]||(n[5]=A(P=>g("move","up"),["stop"]))},{default:o(()=>[b(v(a.$t("views.document.movePosition.moveUp")),1)]),_:1})):h("",!0),$.showMoveDown?(r(),m(t,{key:1,onClick:n[6]||(n[6]=A(P=>g("move","down"),["stop"]))},{default:o(()=>[b(v(a.$t("views.document.movePosition.moveDown")),1)]),_:1})):h("",!0)]),_:1})]),default:o(()=>[k("div",aa,[k("div",ta,[l(J,{iconName:"app-migrate"}),b(" "+v(a.$t("views.document.movePosition.title")),1)]),l(e,{class:"color-input-placeholder",size:16,style:{"margin-right":"0"}},{default:o(()=>[l(y)]),_:1})])]),_:1})]),_:1})):h("",!0),f.value.doc_edit(R(_))?(r(),m(t,{key:3,onClick:n[7]||(n[7]=A(P=>M(a.data),["stop"]))},{default:o(()=>[l(J,{iconName:"app-delete"}),b(" "+v(a.$t("common.delete")),1)]),_:1})):h("",!0)]),_:1})]),default:o(()=>[l(te,{text:""},{default:o(()=>[l(J,{iconName:"app-more"})]),_:1})]),_:1})):h("",!0)]),_:1})):h("",!0)],512)),[[Qe,E.value]]),k("h2",la,v(a.data.title||"-"),1),l(ue,{ref:"editorRef",editorId:"preview-only",modelValue:a.data.content,class:"maxkb-md",style:{background:"none"},onClickPreview:n[9]||(n[9]=P=>ne(a.data))},null,8,["modelValue"]),l(Ue,{ref_key:"ParagraphDialogRef",ref:p,title:Y.value,onRefresh:ae,apiType:D.value},null,8,["title","apiType"]),l(Be,{ref_key:"SelectDocumentDialogRef",ref:ee,onRefresh:ve,apiType:D.value,"workspace-id":z.value.workspaceId},null,8,["apiType","workspace-id"]),l(Ae,{ref_key:"GenerateRelatedDialogRef",ref:G,onRefresh:ae,apiType:D.value},null,8,["apiType"])]),_:1},8,["class"])),[[ge,C.value]])}}}),Se=Ie(oa,[["__scopeId","data-v-490d1d8c"]]),na={class:"paragraph p-12-24"},sa={class:"flex align-center",style:{width:"78%"}},ia={style:{display:"inline-block"}},ra={class:"break-all"},da={key:0,class:"header-button"},ua={class:"flex-between p-12-16 border-b"},pa={class:"paragraph-sidebar p-16"},ca=["title"],va={class:"w-full"},ga={key:1},ma={class:"paragraph-detail"},fa=["id"],ha={key:0,class:"paragraph-card flex w-full"},_a=["id"],wa={key:0,class:"mul-operation border-t w-full"},ya={class:"ml-8"},ka=_e({__name:"index",setup(oe){const Z=we(),{params:{id:$,documentId:K},query:{from:_,isShared:B}}=Z,S=W(()=>_),D=W(()=>B==="true"),f=W(()=>Te.knowledge[S.value]),x=u(),g=u(),C=u(!1),L=u(!1),z=u({}),E=u({}),i=u([]),Q=u(""),F=u(""),c=u("title"),w=u(!1);ye(()=>{var e;return(e=g.value)==null?void 0:e.dialogVisible},e=>{w.value=e});function G(e){w.value=e}const X=(e,t)=>{var y;e.preventDefault(),(y=document.querySelector(`${t}`))==null||y.scrollIntoView({behavior:"smooth",block:"start"})},M=u(!1),p=u([]);function Y(e){const t=p.value.indexOf(e);t===-1?p.value.push(e):p.value.splice(t,1)}const T=Oe({current_page:1,page_size:30,total:0});function pe(e){const t=i.value.findIndex(y=>y.id===e);i.value.splice(t,1)}function ne(e){const t=i.value.findIndex(y=>y.id===e);i.value[t].isActive=!i.value[t].isActive}function se(e){e&&(p.value=[e.id]),i.value=i.value.filter(t=>!p.value.includes(t.id)),p.value=[],he(V("views.document.tip.migrationSuccess"))}function ee(e){x.value.open(p.value)}function ce(){Re(`${V("views.document.delete.confirmTitle1")} ${p.value.length} ${V("views.document.delete.confirmTitle2")}`,V("views.paragraph.delete.confirmMessage"),{confirmButtonText:V("common.confirm"),confirmButtonClass:"danger"}).then(()=>{N({type:"paragraph",systemType:S.value}).putMulParagraph($,K,p.value,L).then(()=>{i.value=i.value.filter(e=>!p.value.includes(e.id)),p.value=[],he(V("views.document.delete.successMessage"))})}).catch(()=>{})}function ae(e){M.value=e,p.value=[]}function ve(){T.current_page=1,i.value=[],n()}function ie(){Q.value=V("views.paragraph.addParagraph"),g.value.open()}function a(){N({type:"document",isShared:D.value,systemType:S.value}).getDocumentDetail($,K,C).then(e=>{z.value=e.data}),N({type:"knowledge",isShared:B.value,systemType:S.value}).getKnowledgeDetail($,C).then(e=>{E.value=e.data})}function n(){N({type:"paragraph",isShared:D.value,systemType:S.value}).getParagraphPage($,K,T,F.value&&{[c.value]:F.value},C).then(e=>{i.value=[...i.value,...e.data.records],T.total=e.data.total})}function H(e){if(e){const t=i.value.findIndex(y=>y.id===e.id);i.value.splice(t,1,e)}else T.current_page=1,i.value=[],n()}const re=u();function te(e){const t=[];p.value.map(y=>{y&&t.push(y)}),re.value.open(t,"paragraph")}function de(e,t,y){const q=We.cloneDeep(t);q&&(q.newPosition=q.newPosition+1);const O=q??{paragraphId:i.value[e.newIndex].id,newPosition:i.value[e.newIndex+1].position};if(N({type:"paragraph",systemType:S.value}).putAdjustPosition($,K,O,C),t){const I=i.value.splice(y,1)[0];i.value.splice(t.newPosition,0,I)}}return ke(()=>{a(),n()}),(e,t)=>{var $e,De;const y=d("back-button"),q=d("el-link"),O=d("el-text"),I=d("el-button"),ue=d("el-option"),ge=d("el-select"),P=d("el-input"),ze=d("el-anchor-link"),Ne=d("el-anchor"),be=d("el-scrollbar"),Ke=d("el-empty"),Le=d("el-checkbox"),Ge=d("InfiniteScroll"),qe=d("el-checkbox-group"),je=d("el-card"),xe=Ve("loading");return r(),U("div",na,[k("div",sa,[l(y,{to:"-1",style:{"margin-left":"-4px"}}),k("h3",ia,v(($e=z.value)==null?void 0:$e.name),1),((De=z.value)==null?void 0:De.type)==="1"?(r(),m(O,{key:0,type:"info"},{default:o(()=>{var s,j;return[b("（"+v(e.$t("views.document.form.sourceUrl.label"))+"：",1),l(q,{href:(j=(s=z.value)==null?void 0:s.meta)==null?void 0:j.sourceUrl,target:"_blank"},{default:o(()=>{var le,Ce;return[k("span",ra,v((Ce=(le=z.value)==null?void 0:le.meta)==null?void 0:Ce.sourceUrl),1)]}),_:1},8,["href"]),t[9]||(t[9]=b("） ",-1))]}),_:1,__:[9]})):h("",!0)]),!D.value&&f.value.doc_edit(R($))?(r(),U("div",da,[M.value===!1?(r(),m(I,{key:0,onClick:t[0]||(t[0]=s=>ae(!0))},{default:o(()=>[b(v(e.$t("views.paragraph.setting.batchSelected")),1)]),_:1})):h("",!0),M.value===!0?(r(),m(I,{key:1,onClick:t[1]||(t[1]=s=>ae(!1))},{default:o(()=>[b(v(e.$t("views.paragraph.setting.cancelSelected")),1)]),_:1})):h("",!0),M.value===!1?(r(),m(I,{key:2,onClick:ie,type:"primary",disabled:C.value},{default:o(()=>[b(v(e.$t("views.paragraph.addParagraph")),1)]),_:1},8,["disabled"])):h("",!0)])):h("",!0),fe((r(),m(je,{style:{"--el-card-padding":"0"},class:"paragraph__main mt-16"},{default:o(()=>[k("div",ua,[k("span",null,v(T.total)+" "+v(e.$t("views.paragraph.paragraph_count")),1),l(P,{modelValue:F.value,"onUpdate:modelValue":t[3]||(t[3]=s=>F.value=s),placeholder:e.$t("common.search"),class:"input-with-select",style:{width:"260px"},onChange:ve,clearable:""},{prepend:o(()=>[l(ge,{modelValue:c.value,"onUpdate:modelValue":t[2]||(t[2]=s=>c.value=s),placeholder:"Select",style:{width:"80px"}},{default:o(()=>[l(ue,{label:e.$t("common.title"),value:"title"},null,8,["label"]),l(ue,{label:e.$t("common.content"),value:"content"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue","placeholder"])]),l(Je,{showCollapse:""},{left:o(()=>[k("div",pa,[l(be,{class:"paragraph-scollbar"},{default:o(()=>[l(Ne,{direction:"vertical",type:"default",offset:130,container:".paragraph-scollbar",onClick:X},{default:o(()=>[(r(!0),U(me,null,Pe(i.value,(s,j)=>(r(),U(me,{key:s.id},[s.title?(r(),m(ze,{key:0,href:`#m${s.id}`,title:s.title},{default:o(()=>[k("span",{title:s.title},v(s.title),9,ca)]),_:2},1032,["href","title"])):h("",!0)],64))),128))]),_:1})]),_:1})])]),default:o(()=>[k("div",va,[i.value.length==0?(r(),m(Ke,{key:0,description:e.$t("common.noData")},null,8,["description"])):(r(),U("div",ga,[l(be,{class:"paragraph-scollbar"},{default:o(()=>[k("div",ma,[l(qe,{modelValue:p.value,"onUpdate:modelValue":t[6]||(t[6]=s=>p.value=s)},{default:o(()=>[l(Ge,{size:i.value.length,total:T.total,page_size:T.page_size,current_page:T.current_page,"onUpdate:current_page":t[5]||(t[5]=s=>T.current_page=s),onLoad:n,loading:C.value},{default:o(()=>[l(R(Ee),{ref:"el",modelValue:i.value,"onUpdate:modelValue":t[4]||(t[4]=s=>i.value=s),disabled:M.value===!0||D.value||w.value||!f.value.doc_edit(R($)),handle:".handle",animation:150,ghostClass:"ghost",onEnd:de},{default:o(()=>[(r(!0),U(me,null,Pe(i.value,(s,j)=>(r(),U("div",{key:s.id,id:`m${s.id}`,class:"flex mb-16"},[M.value===!0?(r(),U("div",ha,[l(Le,{value:s.id},null,8,["value"]),l(Se,{data:s,class:Me(["mb-8 w-full",{"is-selected":p.value.includes(s.id)}]),disabled:!0,onClickCard:le=>Y(s.id)},null,8,["data","class","onClickCard"])])):(r(),U("div",{key:1,class:"handle paragraph-card flex w-full",id:s.id},[t[10]||(t[10]=k("img",{src:Fe,alt:"",height:"15",class:"handle-img mr-8 mt-24 cursor"},null,-1)),l(Se,{data:s,showMoveUp:j!==0,showMoveDown:j<i.value.length-1,class:"mb-8 w-full",onChangeState:ne,onDeleteParagraph:pe,onMove:le=>de(null,{paragraphId:s.id,newPosition:le==="up"?j-1:j+1},j),onRefresh:H,onRefreshMigrateParagraph:se,disabled:D.value,onDialogVisibleChange:G},null,8,["data","showMoveUp","showMoveDown","onMove","disabled"])],8,_a))],8,fa))),128))]),_:1},8,["modelValue","disabled"])]),_:1},8,["size","total","page_size","current_page","loading"])]),_:1},8,["modelValue"])])]),_:1})]))])]),_:1}),M.value===!0?(r(),U("div",wa,[l(I,{disabled:p.value.length===0,onClick:t[7]||(t[7]=s=>te())},{default:o(()=>[b(v(e.$t("views.document.generateQuestion.title")),1)]),_:1},8,["disabled"]),l(I,{disabled:p.value.length===0,onClick:t[8]||(t[8]=s=>ee())},{default:o(()=>[b(v(e.$t("views.document.setting.migration")),1)]),_:1},8,["disabled"]),l(I,{disabled:p.value.length===0,onClick:ce},{default:o(()=>[b(v(e.$t("common.delete")),1)]),_:1},8,["disabled"]),k("span",ya,v(e.$t("common.selected"))+" "+v(p.value.length)+" "+v(e.$t("views.document.items")),1)])):h("",!0)]),_:1})),[[xe,T.current_page===1&&C.value||L.value]]),l(Ue,{ref_key:"ParagraphDialogRef",ref:g,title:Q.value,apiType:S.value,onRefresh:H},null,8,["title","apiType"]),l(Be,{ref_key:"SelectDocumentDialogRef",ref:x,onRefresh:se,apiType:S.value,workspaceId:E.value.workspaceId},null,8,["apiType","workspaceId"]),l(Ae,{ref_key:"GenerateRelatedDialogRef",ref:re,onRefresh:H,apiType:S.value},null,8,["apiType"])])}}}),Sa=Ie(ka,[["__scopeId","data-v-aeda1e26"]]);export{Sa as default};
