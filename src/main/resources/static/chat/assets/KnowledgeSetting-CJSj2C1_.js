import{ay as X,b8 as Y,b9 as C,c4 as Z,aB as k,bg as ee,aC as u,bs as le,aD as d,bq as te,bc as V,aF as c,aI as s,aH as a,aJ as p,aG as o,br as oe,aE as b,bd as w,cs as ae,aK as L,ct as se,cu as ie,bo as D,cf as ne,bf as _,bp as T,co as re}from"./chat-BFw4auTk.js";import{_ as ue}from"./BaseForm.vue_vue_type_script_setup_true_lang-DsS2IdpL.js";const de={class:"p-16-24"},pe={class:"mb-16"},me={class:"knowledge-setting main-calc-height"},ce={class:"p-24"},fe={class:"title-decoration-1 mb-16"},ve={class:"flex align-center"},ge={class:"flex align-center"},we={class:"flex align-center"},_e={key:2},ye={class:"title-decoration-1 mb-16"},ke={class:"flex align-center"},be={class:"mr-4"},he={class:"text-right"},Se=X({__name:"KnowledgeSetting",setup(Le){const $=Y(),{params:{id:f,folderId:F}}=$,m=C(()=>$.path.includes("shared")?"systemShare":$.path.includes("resource-management")?"systemManage":"workspace"),N=C(()=>Z.knowledge[m.value]),E=C(()=>F==="share"),z=k(),h=k(),y=k(!1),i=k({}),U=k(""),t=k({sourceUrl:"",selector:"",app_id:"",app_secret:"",folder_token:"",fileCountLimit:50,fileSizeLimit:100}),P=ee({sourceUrl:[{required:!0,message:u("views.knowledge.form.sourceUrl.requiredMessage"),trigger:"blur"}],app_id:[{required:!0,message:u("views.application.applicationAccess.larkSetting.appIdPlaceholder"),trigger:"blur"}],app_secret:[{required:!0,message:u("views.application.applicationAccess.larkSetting.appSecretPlaceholder"),trigger:"blur"}],folder_token:[{required:!0,message:u("views.application.applicationAccess.larkSetting.folderTokenPlaceholder"),trigger:"blur"}]});async function j(){var e;await((e=h.value)==null?void 0:e.validate())&&await z.value.validate(l=>{if(l){const r=i.value.type===1||i.value.type===2?{meta:t.value,fileCountLimit:t.value.fileCountLimit,fileSizeLimit:t.value.fileSizeLimit,...h.value.form}:{fileCountLimit:t.value.fileCountLimit,fileSizeLimit:t.value.fileSizeLimit,...h.value.form};U.value!==h.value.form.embeddingModelId?ne(u("common.tip"),u("views.knowledge.tip.updateModeMessage"),{confirmButtonText:u("views.knowledge.setting.vectorization")}).then(()=>{i.value.type===4?_({type:"knowledge",systemType:m.value}).putLarkKnowledge(f,r,y).then(()=>{_({type:"knowledge",systemType:m.value}).putReEmbeddingKnowledge(f).then(()=>{T(u("common.saveSuccess"))})}):_({type:"knowledge",systemType:m.value}).putKnowledge(f,r,y).then(()=>{_({type:"knowledge",systemType:m.value}).putReEmbeddingKnowledge(f).then(()=>{T(u("common.saveSuccess"))})})}).catch(()=>{}):i.value.type===4?_({type:"knowledge",systemType:m.value}).putLarkKnowledge(f,r,y).then(()=>{T(u("common.saveSuccess"))}):_({type:"knowledge",systemType:m.value}).putKnowledge(f,r,y).then(()=>{T(u("common.saveSuccess"))})}})}function G(){_({type:"knowledge",isShared:E.value,systemType:m.value}).getKnowledgeDetail(f,y).then(e=>{var l,r,v,g;i.value=e.data,U.value=(l=e.data)==null?void 0:l.embeddingModelId,((r=i.value)==null?void 0:r.type)===0&&(t.value.fileCountLimit=e.data.fileCountLimit,t.value.fileSizeLimit=e.data.fileSizeLimit),(((v=i.value)==null?void 0:v.type)===1||((g=i.value)==null?void 0:g.type)===2)&&(t.value=e.data.meta)})}return le(()=>{G()}),(e,l)=>{const r=d("el-avatar"),v=d("el-text"),g=d("el-card"),S=d("el-form-item"),K=d("el-input"),I=d("el-slider"),H=d("AppIcon"),J=d("el-tooltip"),x=d("el-form"),O=d("el-button"),Q=d("el-scrollbar"),W=te("loading");return c(),V("div",de,[s("h2",pe,p(e.$t("common.setting")),1),a(g,{style:{"--el-card-padding":"0"}},{default:o(()=>[s("div",me,[a(Q,null,{default:o(()=>[oe((c(),V("div",ce,[s("h4",fe,p(e.$t("common.info")),1),a(ue,{ref_key:"BaseFormRef",ref:h,data:i.value,apiType:m.value},null,8,["data","apiType"]),a(x,{ref_key:"webFormRef",ref:z,rules:P,model:t.value,"label-position":"top","require-asterisk-position":"right"},{default:o(()=>{var q,B,M;return[a(S,{label:e.$t("views.knowledge.knowledgeType.label"),required:""},{default:o(()=>{var n,R,A;return[((n=i.value)==null?void 0:n.type)===0?(c(),b(g,{key:0,shadow:"never",class:"mb-8 w-full layout-bg",style:{"line-height":"22px"}},{default:o(()=>[s("div",ve,[a(r,{class:"mr-8 avatar-blue",shape:"square",size:32},{default:o(()=>l[6]||(l[6]=[s("img",{src:ae,style:{width:"58%"},alt:""},null,-1)])),_:1,__:[6]}),s("div",null,[s("div",null,p(e.$t("views.knowledge.knowledgeType.generalKnowledge")),1),a(v,{type:"info"},{default:o(()=>[L(p(e.$t("views.knowledge.knowledgeType.generalInfo")),1)]),_:1})])])]),_:1})):w("",!0),((R=i.value)==null?void 0:R.type)===1?(c(),b(g,{key:1,shadow:"never",class:"mb-8 w-full layout-bg",style:{"line-height":"22px"}},{default:o(()=>[s("div",ge,[a(r,{class:"mr-8 avatar-purple",shape:"square",size:32},{default:o(()=>l[7]||(l[7]=[s("img",{src:se,style:{width:"58%"},alt:""},null,-1)])),_:1,__:[7]}),s("div",null,[s("div",null,p(e.$t("views.knowledge.knowledgeType.webKnowledge")),1),a(v,{type:"info"},{default:o(()=>[L(p(e.$t("views.knowledge.knowledgeType.webInfo")),1)]),_:1})])])]),_:1})):w("",!0),((A=i.value)==null?void 0:A.type)===2?(c(),b(g,{key:2,shadow:"never",class:"mb-8 w-full layout-bg",style:{"line-height":"22px"}},{default:o(()=>[s("div",we,[a(r,{class:"mr-8 avatar-orange",shape:"square",size:32},{default:o(()=>l[8]||(l[8]=[s("img",{src:ie,style:{width:"60%"},alt:""},null,-1)])),_:1,__:[8]}),s("div",null,[s("p",null,[a(v,null,{default:o(()=>[L(p(e.$t("views.knowledge.knowledgeType.workflowKnowledge")),1)]),_:1})]),a(v,{type:"info"},{default:o(()=>[L(p(e.$t("views.knowledge.knowledgeType.workflowInfo")),1)]),_:1})])])]),_:1})):w("",!0)]}),_:1},8,["label"]),((q=i.value)==null?void 0:q.type)===1?(c(),b(S,{key:0,label:e.$t("views.knowledge.form.sourceUrl.label"),prop:"sourceUrl"},{default:o(()=>[a(K,{modelValue:t.value.sourceUrl,"onUpdate:modelValue":l[0]||(l[0]=n=>t.value.sourceUrl=n),placeholder:e.$t("views.knowledge.form.sourceUrl.placeholder"),onBlur:l[1]||(l[1]=n=>t.value.sourceUrl=t.value.sourceUrl.trim())},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):w("",!0),((B=i.value)==null?void 0:B.type)===1?(c(),b(S,{key:1,label:e.$t("views.knowledge.form.selector.label")},{default:o(()=>[a(K,{modelValue:t.value.selector,"onUpdate:modelValue":l[2]||(l[2]=n=>t.value.selector=n),placeholder:e.$t("views.knowledge.form.selector.placeholder"),onBlur:l[3]||(l[3]=n=>t.value.selector=t.value.selector.trim())},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):w("",!0),((M=i.value)==null?void 0:M.type)===0?(c(),V("div",_e,[s("h4",ye,p(e.$t("common.otherSetting")),1),a(S,{label:e.$t("views.knowledge.form.fileCountLimit.label")},{default:o(()=>[a(I,{modelValue:t.value.fileCountLimit,"onUpdate:modelValue":l[4]||(l[4]=n=>t.value.fileCountLimit=n),"show-input":"","show-input-controls":!1,min:1,max:1e3,class:"custom-slider"},null,8,["modelValue"])]),_:1},8,["label"]),a(S,null,{label:o(()=>[s("div",ke,[s("span",be,p(e.$t("views.knowledge.form.fileSizeLimit.label")),1),a(J,{effect:"dark",content:e.$t("views.knowledge.form.fileSizeLimit.placeholder"),placement:"right"},{default:o(()=>[a(H,{iconName:"app-warning",class:"app-warning-icon"})]),_:1},8,["content"])])]),default:o(()=>[a(I,{modelValue:t.value.fileSizeLimit,"onUpdate:modelValue":l[5]||(l[5]=n=>t.value.fileSizeLimit=n),"show-input":"","show-input-controls":!1,min:1,max:1e3,class:"custom-slider"},null,8,["modelValue"])]),_:1})])):w("",!0)]}),_:1},8,["rules","model"]),s("div",he,[!D($).path.includes("share/")&&N.value.edit(D(f))?(c(),b(O,{key:0,onClick:j,type:"primary"},{default:o(()=>[L(p(e.$t("common.save")),1)]),_:1})):w("",!0)])])),[[W,y.value]])]),_:1})])]),_:1})])}}}),Ce=re(Se,[["__scopeId","data-v-10bb96e6"]]);export{Ce as default};
