import{aJ as J,aP as h,bn as ce,aQ as s,aL as k,aM as f,aR as o,a_ as x,aS as n,aT as e,aW as l,b1 as Q,b5 as K,b6 as W,aV as g,aU as B,bs as de,bh as he,fs as _e,aK as H,bj as Le,be as E,aO as A,ft as re,b7 as Y,aY as pe,bm as le,bd as $e,bf as be,aZ as me,bk as ge,b0 as ve,cF as O,fu as Te,b9 as ye,e$ as Ve,fv as ke,eM as Ce,e9 as te,fw as Se,bi as ie}from"./chat-4wXRqTZ9.js";import{_ as we}from"./ParagraphForm.vue_vue_type_script_setup_true_lang-CF45AIh4.js";const Re={class:"bold title p-24",style:{"padding-bottom":"0"}},Fe={class:"flex align-center"},De={class:"p-24",style:{"padding-top":"16px"}},Me={key:1,class:"p-24"},Ue={class:"dialog-footer"},ze=J({__name:"EditParagraphDialog",props:{isConnect:Boolean,knowledgeId:String},emits:["updateContent"],setup(M,{expose:I,emit:F}){const C=F,V=h(!1),$=h({}),D=h(),L=h(),p=h(!1),u=h("");ce(V,m=>{m||($.value={})});const c=m=>{$.value=de.cloneDeep(m),V.value=!0};function b(m,_){$.value.problem_list.splice(_,1)}function R(){var m,_,T;u.value.trim()&&((m=$.value)!=null&&m.problem_list.some(v=>v.content===u.value.trim())||(T=(_=$.value)==null?void 0:_.problem_list)==null||T.push({content:u.value.trim()}),u.value="",p.value=!1)}function y(){p.value=!0,he(()=>{var m;(m=L.value)==null||m.focus()})}const U=async()=>{var m,_;await((m=D.value)==null?void 0:m.validate())&&(C("updateContent",{problem_list:$.value.problem_list,...(_=D.value)==null?void 0:_.form}),V.value=!1)};return I({open:c}),(m,_)=>{const T=s("el-col"),v=s("el-divider"),a=s("Plus"),r=s("el-icon"),S=s("el-button"),d=s("el-input"),t=s("auto-tooltip"),i=s("TagEllipsis"),q=s("el-scrollbar"),Z=s("el-row"),N=s("el-dialog");return f(),k(N,{title:m.$t("views.paragraph.editParagraph"),modelValue:V.value,"onUpdate:modelValue":_[3]||(_[3]=z=>V.value=z),width:"80%","destroy-on-close":"",class:"paragraph-dialog","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:o(()=>[e("span",Ue,[n(S,{onClick:_[2]||(_[2]=B(z=>V.value=!1,["prevent"]))},{default:o(()=>[g(l(m.$t("common.cancel")),1)]),_:1}),n(S,{type:"primary",onClick:U},{default:o(()=>[g(l(m.$t("common.save")),1)]),_:1})])]),default:o(()=>[M.isConnect?(f(),k(Z,{key:0},{default:o(()=>[n(T,{span:18,class:"p-24"},{default:o(()=>[n(we,{ref_key:"paragraphFormRef",ref:D,data:$.value,isEdit:!0,"knowledge-id":M.knowledgeId},null,8,["data","knowledge-id"])]),_:1}),n(T,{span:6,class:"border-l",style:{width:"300px"}},{default:o(()=>[e("p",Re,[e("span",Fe,[e("span",null,l(m.$t("views.paragraph.relatedProblem.title")),1),n(v,{direction:"vertical",class:"mr-4"}),n(S,{text:"",onClick:y},{default:o(()=>[n(r,null,{default:o(()=>[n(a)]),_:1})]),_:1})])]),n(q,{height:"500px"},{default:o(()=>[e("div",De,[p.value?(f(),k(d,{key:0,modelValue:u.value,"onUpdate:modelValue":_[0]||(_[0]=z=>u.value=z),placeholder:m.$t("views.paragraph.relatedProblem.placeholder"),onChange:R,onBlur:_[1]||(_[1]=z=>p.value=!1),ref_key:"inputRef",ref:L,class:"mb-8"},null,8,["modelValue","placeholder"])):Q("",!0),(f(!0),x(K,null,W($.value.problem_list,(z,X)=>(f(),k(i,{key:X,onClose:j=>b(z,X),class:"question-tag",type:"info",effect:"plain",closable:""},{default:o(()=>[n(t,{content:z.content},{default:o(()=>[g(l(z.content),1)]),_:2},1032,["content"])]),_:2},1032,["onClose"]))),128))])]),_:1})]),_:1})]),_:1})):(f(),x("div",Me,[n(we,{ref_key:"paragraphFormRef",ref:D,data:$.value,isEdit:!0,"knowledge-id":M.knowledgeId},null,8,["data","knowledge-id"])]))]),_:1},8,["title","modelValue"])}}}),Ie={class:"flex-between"},Pe={class:"lighter mt-12"},xe={class:"lighter mt-12"},Ee=J({__name:"ParagraphList",props:{modelValue:{type:Array,default:()=>[]},isConnect:Boolean,knowledgeId:String},emits:["update:modelValue"],setup(M,{emit:I}){const F=h(30),C=h(1),V=h(0),$=h(),D=I,L=h(!1),p=h([]),u=M;_e(()=>{if(u.modelValue&&u.modelValue.length>0){const m=F.value*C.value;p.value=u.modelValue.slice(0,Math.min(m,u.modelValue.length))}}),_e(()=>{const _=F.value*C.value;p.value=u.modelValue.slice(0,Math.min(_,u.modelValue.length))});const c=H(()=>p.value),b=()=>{L.value=!0,setTimeout(()=>{C.value+=1,L.value=!1},100)},R=(m,_)=>{V.value=_+F.value*(C.value-1),$.value.open(m)},y=m=>{const _=[...u.modelValue];u.isConnect&&m.title&&!(m!=null&&m.problem_list.some(v=>v.content===m.title.trim()))&&m.problem_list.push({content:m.title.trim()}),_[V.value]=de.cloneDeep(m),D("update:modelValue",_);const T=V.value-F.value*(C.value-1);T>=0&&T<p.value.length&&(p.value[T]=de.cloneDeep(m))},U=(m,_)=>{Le(`${E("views.paragraph.delete.confirmTitle")}${m.title||"-"} ?`,E("views.paragraph.delete.confirmMessage"),{confirmButtonText:E("common.confirm"),confirmButtonClass:"color-danger"}).then(()=>{const T=[...u.modelValue];if(T.splice(_,1),D("update:modelValue",T),p.value.splice(_,1),u.modelValue.length>p.value.length*C.value){const v=u.modelValue[p.value.length*C.value];v&&p.value.push(v)}}).catch(()=>{})};return(m,_)=>{const T=s("AppIcon"),v=s("el-button"),a=s("el-text"),r=s("el-card"),S=s("InfiniteScroll");return f(),x("div",null,[n(S,{size:c.value.length,total:M.modelValue.length,page_size:F.value,current_page:C.value,"onUpdate:current_page":_[0]||(_[0]=d=>C.value=d),onLoad:_[1]||(_[1]=d=>b()),loading:L.value},{default:o(()=>[(f(!0),x(K,null,W(c.value,(d,t)=>(f(),k(r,{key:t,shadow:"never",class:"card-never mb-16"},{default:o(()=>[e("div",Ie,[e("span",null,l(d.title||"-"),1),e("div",null,[n(v,{link:"",onClick:i=>R(d,t)},{default:o(()=>[n(T,{iconName:"app-edit"})]),_:2},1032,["onClick"]),n(v,{link:"",onClick:i=>U(d,t)},{default:o(()=>[n(T,{iconName:"app-delete"})]),_:2},1032,["onClick"])])]),e("div",Pe,l(d.content),1),e("div",xe,[n(a,{type:"info"},{default:o(()=>[g(l(d.content.length)+" "+l(m.$t("views.paragraph.character_count")),1)]),_:2},1024)])]),_:2},1024))),128))]),_:1},8,["size","total","page_size","current_page","loading"]),n(ze,{ref_key:"EditParagraphDialogRef",ref:$,onUpdateContent:y,isConnect:M.isConnect,"knowledge-id":M.knowledgeId},null,8,["isConnect","knowledge-id"])])}}}),Ae={class:"flex-center"},Be=["src"],He={class:"ml-4"},Ne={class:"mb-16"},Xe={key:0,class:"paragraph-list"},qe=J({__name:"ParagraphPreview",props:{data:{type:Array,default:()=>[]},isConnect:Boolean,knowledgeId:String},setup(M){const I=h(0);return(F,C)=>{const V=s("el-text"),$=s("el-scrollbar"),D=s("el-tab-pane"),L=s("el-tabs");return f(),k(L,{modelValue:I.value,"onUpdate:modelValue":C[0]||(C[0]=p=>I.value=p),class:"paragraph-tabs"},{default:o(()=>[(f(!0),x(K,null,W(M.data,(p,u)=>(f(),k(D,{key:u,label:p.name,name:u},{label:o(()=>[e("div",Ae,[e("img",{src:A(re)(p&&(p==null?void 0:p.name)),alt:"",height:"16"},null,8,Be),e("span",He,l(p==null?void 0:p.name),1)])]),default:o(()=>[e("div",Ne,[n(V,{type:"info"},{default:o(()=>[g(l(p.content.length)+" "+l(F.$t("views.paragraph.title")),1)]),_:2},1024)]),I.value==u?(f(),x("div",Xe,[n($,null,{default:o(()=>[n(Ee,{modelValue:p.content,"onUpdate:modelValue":c=>p.content=c,isConnect:M.isConnect,"knowledge-id":M.knowledgeId},null,8,["modelValue","onUpdate:modelValue","isConnect","knowledge-id"])]),_:2},1024)])):Q("",!0)]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])}}}),Qe=Y(qe,[["__scopeId","data-v-c20b8d02"]]),Ze={class:"set-rules"},Oe={class:"title-decoration-1 mb-16"},je={class:"set-rules__right"},Ke={class:"mb-4"},Je={class:"mb-4"},We={class:"set-rules__form"},Ye={class:"form-item mb-16"},Ge={class:"title flex align-center mb-8"},et={style:{"margin-right":"4px"}},tt={class:"form-item mb-16"},lt={class:"title mb-8"},ot={class:"form-item mb-16"},nt={class:"title mb-8"},st={style:{"margin-top":"4px"}},at={class:"text-right mt-8"},it={class:"title-decoration-1 mb-8"},ut=J({__name:"SetRules",setup(M,{expose:I}){const{knowledge:F}=pe(),C=H(()=>F.documentsFiles),V=h([]),$=le(),{query:{id:D}}=$,L=H(()=>$.path.includes("shared")?"systemShare":$.path.includes("resource-management")?"systemManage":"workspace"),p=h("1"),u=h(!1),c=h([]),b=h(!1),R=h(!1),y=h(!0),U=$e({patterns:[],limit:500,with_filter:!0});function m(v){v&&y.value&&(c.value=c.value.map(a=>({...a,content:a.content.map(r=>({...r,problem_list:r.title.trim()?[{content:r.title.trim()}]:[]}))})),y.value=!1)}function _(){u.value=!0;const v=new FormData;C.value.forEach(a=>{a!=null&&a.raw&&v.append("file",a==null?void 0:a.raw)}),p.value==="2"&&Object.keys(U).forEach(a=>{a=="patterns"?U.patterns.forEach(r=>v.append("patterns",r)):v.append(a,U[a])}),O({type:"document",systemType:L.value}).postSplitDocument(D,v).then(a=>{const r=a.data;r.map(S=>{S.name.length>128&&(S.name=Te(S.name,128)),R.value&&S.content.map(d=>{d.problem_list=d.title.trim()?[{content:d.title.trim()}]:[]})}),c.value=r,u.value=!1}).catch(()=>{u.value=!1})}const T=()=>{O({type:"document",systemType:L.value}).listSplitPattern(D,b).then(v=>{V.value=v.data})};return ce(p,()=>{p.value==="2"&&T()}),be(()=>{_()}),I({paragraphList:c,checkedConnect:R,loading:u}),(v,a)=>{const r=s("el-text"),S=s("el-radio"),d=s("el-card"),t=s("AppIcon"),i=s("el-tooltip"),q=s("el-option"),Z=s("el-select"),N=s("el-slider"),z=s("el-switch"),X=s("el-radio-group"),j=s("el-scrollbar"),oe=s("el-checkbox"),ne=s("el-button"),G=s("el-col"),se=s("el-row"),ae=me("loading");return f(),x("div",Ze,[n(se,null,{default:o(()=>[n(G,{span:10,class:"p-24"},{default:o(()=>[e("h4",Oe,l(v.$t("views.document.setRules.title.setting")),1),e("div",je,[n(j,null,{default:o(()=>[e("div",{class:"left-height",onClick:a[5]||(a[5]=B(()=>{},["stop"]))},[n(X,{modelValue:p.value,"onUpdate:modelValue":a[4]||(a[4]=P=>p.value=P),class:"card__radio"},{default:o(()=>[n(d,{shadow:"never",class:ge(["mb-16",p.value==="1"?"active":""])},{default:o(()=>[n(S,{value:"1",size:"large"},{default:o(()=>[e("p",Ke,l(v.$t("views.document.setRules.intelligent.label")),1),n(r,{type:"info"},{default:o(()=>[g(l(v.$t("views.document.setRules.intelligent.text")),1)]),_:1})]),_:1})]),_:1},8,["class"]),n(d,{shadow:"never",class:ge(["mb-16",p.value==="2"?"active":""])},{default:o(()=>[n(S,{value:"2",size:"large"},{default:o(()=>[e("p",Je,l(v.$t("views.document.setRules.advanced.label")),1),n(r,{type:"info"},{default:o(()=>[g(l(v.$t("views.document.setRules.advanced.text")),1)]),_:1})]),_:1}),p.value==="2"?(f(),k(d,{key:0,shadow:"never",class:"card-never mt-16",style:{"margin-left":"30px"}},{default:o(()=>[e("div",We,[e("div",Ye,[e("div",Ge,[e("span",et,l(v.$t("views.document.setRules.patterns.label")),1),n(i,{effect:"dark",content:v.$t("views.document.setRules.patterns.tooltip"),placement:"right"},{default:o(()=>[n(t,{iconName:"app-warning",class:"app-warning-icon"})]),_:1},8,["content"])]),e("div",{onClick:a[1]||(a[1]=B(()=>{},["stop"]))},[n(Z,{modelValue:U.patterns,"onUpdate:modelValue":a[0]||(a[0]=P=>U.patterns=P),multiple:"","allow-create":"","default-first-option":"",filterable:"",placeholder:v.$t("views.document.setRules.patterns.placeholder")},{default:o(()=>[(f(!0),x(K,null,W(V.value,(P,ee)=>(f(),k(q,{key:ee,label:P.key,value:P.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])])]),e("div",tt,[e("div",lt,l(v.$t("views.document.setRules.limit.label")),1),n(N,{modelValue:U.limit,"onUpdate:modelValue":a[2]||(a[2]=P=>U.limit=P),"show-input":"","show-input-controls":!1,min:50,max:1e5},null,8,["modelValue"])]),e("div",ot,[e("div",nt,l(v.$t("views.document.setRules.with_filter.label")),1),n(z,{size:"small",modelValue:U.with_filter,"onUpdate:modelValue":a[3]||(a[3]=P=>U.with_filter=P)},null,8,["modelValue"]),e("div",st,[n(r,{type:"info"},{default:o(()=>[g(l(v.$t("views.document.setRules.with_filter.text")),1)]),_:1})])])])]),_:1})):Q("",!0)]),_:1},8,["class"])]),_:1},8,["modelValue"])])]),_:1}),e("div",null,[n(oe,{modelValue:R.value,"onUpdate:modelValue":a[6]||(a[6]=P=>R.value=P),onChange:m,style:{"white-space":"normal"}},{default:o(()=>[g(l(v.$t("views.document.setRules.checkedConnect.label")),1)]),_:1},8,["modelValue"])]),e("div",at,[n(ne,{onClick:_},{default:o(()=>[g(l(v.$t("views.document.buttons.preview")),1)]),_:1})])])]),_:1}),n(G,{span:14,class:"p-24 border-l"},{default:o(()=>[ve((f(),x("div",null,[e("h4",it,l(v.$t("views.document.setRules.title.preview")),1),n(Qe,{data:c.value,"onUpdate:data":a[7]||(a[7]=P=>c.value=P),isConnect:R.value,"knowledge-id":A(D)},null,8,["data","isConnect","knowledge-id"])])),[[ae,u.value]])]),_:1})]),_:1})])}}}),dt=Y(ut,[["__scopeId","data-v-f7dfc923"]]),ct={class:"mt-8"},rt={class:"bold"},pt={class:"bold"},mt={class:"bold"},vt={class:"result-success"},ft={class:"bolder"},_t={class:"flex-between"},gt={class:"flex"},wt=["src"],ht={class:"ml-8"},$t=J({__name:"ResultSuccess",props:{data:{type:Object,default:()=>{}}},setup(M){const I=M,F=ye(),C=le(),{params:{id:V,folderId:$}}=C,D=H(()=>C.path.includes("shared")?"systemShare":C.path.includes("resource-management")?"systemManage":"workspace"),L=H(()=>{var u;return(u=I.data)==null?void 0:u.documentList.reduce((c,b)=>c+=b.paragraph_count,0)}),p=H(()=>{var u;return((u=I.data)==null?void 0:u.documentList.reduce((c,b)=>c+=b.charLength,0))||0});return(u,c)=>{const b=s("el-text"),R=s("el-divider"),y=s("el-button"),U=s("el-result"),m=s("SuccessFilled"),_=s("el-icon"),T=s("CircleCloseFilled"),v=s("Loading"),a=s("el-card"),r=s("el-scrollbar");return f(),k(r,null,{default:o(()=>{var S;return[n(U,{icon:"color-success",title:`沁 ${u.$t("views.knowledge.ResultSuccess.title")} 沁荏},{"sub-title":o(()=>{var d;return[e("div",ct,[e("span",rt,l(((d=M.data)==null?void 0:d.documentList.length)||0),1),n(b,{type:"info",class:"ml-4"},{default:o(()=>[g(l(u.$t("common.fileUpload.document")),1)]),_:1}),n(R,{direction:"vertical"}),e("span",pt,l(L.value||0),1),n(b,{type:"info",class:"ml-4"},{default:o(()=>[g(l(u.$t("views.knowledge.ResultSuccess.paragraph")),1)]),_:1}),n(R,{direction:"vertical"}),e("span",mt,l(A(Ve)(p.value)||0),1),n(b,{type:"info",class:"ml-4"},{default:o(()=>[g(l(u.$t("common.character")),1)]),_:1})])]}),extra:o(()=>[D.value==="workspace"?(f(),k(y,{key:0,onClick:c[0]||(c[0]=d=>A(F).push({path:"/knowledge"}))},{default:o(()=>[g(l(u.$t("views.knowledge.ResultSuccess.buttons.toknowledge")),1)]),_:1})):(f(),k(y,{key:1,onClick:c[1]||(c[1]=d=>A(F).push({path:`/system/${A($)}/knowledge`}))},{default:o(()=>[g(l(u.$t("views.knowledge.ResultSuccess.buttons.toknowledge")),1)]),_:1})),n(y,{type:"primary",onClick:c[2]||(c[2]=d=>{var t;return A(F).push({path:`/knowledge/${(t=M.data)==null?void 0:t.id}/${A($)}/document`})})},{default:o(()=>[g(l(u.$t("views.knowledge.ResultSuccess.buttons.toDocument")),1)]),_:1})]),_:1},8,["title"]),e("div",vt,[e("p",ft,l(u.$t("views.knowledge.ResultSuccess.documentList")),1),(f(!0),x(K,null,W((S=M.data)==null?void 0:S.documentList,(d,t)=>(f(),k(a,{shadow:"never",class:"file-List-card mt-8",key:t},{default:o(()=>[e("div",_t,[e("div",gt,[e("img",{src:A(re)(d&&(d==null?void 0:d.name)),alt:"",width:"40"},null,8,wt),e("div",ht,[e("p",null,l(d&&(d==null?void 0:d.name)),1),n(b,{type:"info",size:"small"},{default:o(()=>[g(l(A(ke)(d&&(d==null?void 0:d.charLength))),1)]),_:2},1024)])]),e("div",null,[n(b,{type:"info",class:"mr-16"},{default:o(()=>[g(l(d&&(d==null?void 0:d.paragraph_count))+" "+l(u.$t("views.knowledge.ResultSuccess.paragraph_count")),1)]),_:2},1024),d.status==="1"?(f(),k(b,{key:0},{default:o(()=>[n(_,{class:"color-success"},{default:o(()=>[n(m)]),_:1})]),_:1})):d.status==="2"?(f(),k(b,{key:1},{default:o(()=>[n(_,{class:"color-danger"},{default:o(()=>[n(T)]),_:1})]),_:1})):d.status==="0"?(f(),k(b,{key:2},{default:o(()=>[n(_,{class:"is-loading primary"},{default:o(()=>[n(v)]),_:1}),g(" "+l(u.$t("views.knowledge.ResultSuccess.loading"))+"... ",1)]),_:1})):Q("",!0)])])]),_:2},1024))),128))])]}),_:1})}}}),bt=Y($t,[["__scopeId","data-v-a7787e3d"]]),ue="data:image/svg+xml,%3csvg%20width='40'%20height='40'%20viewBox='0%200%2040%2040'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M33.0404%2011.3738C33.2279%2011.5614%2033.3333%2011.8157%2033.3333%2012.0809V34.8149C33.3333%2035.8376%2032.5374%2036.6667%2031.5555%2036.6667H8.4444C7.46256%2036.6667%206.66663%2035.8376%206.66663%2034.8149V5.18523C6.66663%204.16248%207.46256%203.33337%208.4444%203.33337H24.5857C24.851%203.33337%2025.1053%203.43873%2025.2929%203.62627L33.0404%2011.3738Z'%20fill='%233370FF'/%3e%3cpath%20d='M20.6509%2015.8135C20.3173%2015.3965%2019.683%2015.3965%2019.3494%2015.8135L14.4166%2021.9795C13.9801%2022.5251%2014.3686%2023.3334%2015.0673%2023.3334H18.3335V26.6667H21.6668V23.3334H24.9329C25.6317%2023.3334%2026.0202%2022.5251%2025.5837%2021.9795L20.6509%2015.8135Z'%20fill='white'/%3e%3cpath%20d='M18.3335%2030.0001V28.3334H21.6668V30.0001H18.3335Z'%20fill='white'/%3e%3cpath%20d='M25%203.33337L33.3333%2011.6667H26.6667C25.7462%2011.6667%2025%2010.9205%2025%2010V3.33337Z'%20fill='%232B5FD9'/%3e%3c/svg%3e",yt={class:"title-decoration-1 mb-8"},kt={class:"mt-16 mb-16"},Ct={class:"update-info flex p-8-12 border-r-6 mb-16 w-full"},Lt={class:"mt-4"},Tt={class:"ml-16 lighter"},Vt={class:"el-upload__text"},St={class:"upload__decoration"},Rt={class:"update-info flex p-8-12 border-r-6 mb-16 w-full"},Ft={class:"mt-4"},Dt={class:"ml-16 lighter"},Mt={class:"el-upload__text"},Ut={class:"upload__decoration"},zt={class:"update-info flex p-8-12 border-r-6 mb-16 w-full"},It={class:"mt-4"},Pt={class:"ml-16 lighter"},xt={class:"el-upload__text"},Et={class:"upload__decoration"},At={class:"flex-between"},Bt={class:"flex"},Ht=["src"],Nt={class:"ml-8"},Xt=J({__name:"UploadComponent",setup(M,{expose:I}){const F=le(),{query:{id:C}}=F,V=H(()=>F.path.includes("shared")?"systemShare":F.path.includes("resource-management")?"systemManage":"workspace"),{knowledge:$}=pe(),D=H(()=>$.documentsFiles),L=H(()=>$.documentsType),p=h(),u=h(!1),c=h({fileType:"txt",fileList:[]}),b=$e({fileList:[{required:!0,message:E("views.document.upload.requiredMessage"),trigger:"change"}]}),R=h(50),y=h(100);ce(c.value,t=>{$.saveDocumentsType(t.fileType),$.saveDocumentsFile(t.fileList)});function U(t){O({type:"document",systemType:V.value}).exportQATemplate(`${t}${E("views.document.upload.template")}.${t=="csv"?t:"xlsx"}`,t)}function m(t){O({type:"document",systemType:V.value}).exportTableTemplate(`${t}${E("views.document.upload.template")}.${t=="csv"?t:"xlsx"}`,t)}function _(){c.value.fileList=[]}function T(t){c.value.fileList.splice(t,1)}const v=(t,i)=>{if(!((t==null?void 0:t.size)/1024/1024<y.value))return te(E("views.document.tip.fileLimitSizeTip1")+y.value+"MB"),i.splice(-1,1),!1;if(!Se(t==null?void 0:t.name,c.value.fileType))return(t==null?void 0:t.name)!==".DS_Store"&&te(E("views.document.upload.errorMessage2")),i.splice(-1,1),!1;if((t==null?void 0:t.size)===0)return te(E("views.document.upload.errorMessage3")),i.splice(-1,1),!1},a=()=>{te(E("views.document.tip.fileLimitCountTip1")+R.value+E("views.document.tip.fileLimitCountTip2"))},r=t=>{let i=null;he(()=>{document.querySelector(".el-upload__input")!=null&&(i=document.querySelector(".el-upload__input"),i.webkitdirectory=t)})};function S(){if(p.value)return p.value.validate(t=>t)}function d(){O({type:"knowledge",systemType:V.value}).getKnowledgeDetail(C,u).then(t=>{R.value=t.data.fileCountLimit,y.value=t.data.fileSizeLimit})}return be(()=>{L.value&&(c.value.fileType=L.value),D.value&&(c.value.fileList=D.value),d()}),Ce(()=>{c.value={fileType:"txt",fileList:[]}}),I({validate:S,form:c}),(t,i)=>{var ee;const q=s("el-radio-button"),Z=s("el-radio-group"),N=s("AppIcon"),z=s("el-button"),X=s("el-upload"),j=s("el-form-item"),oe=s("el-form"),ne=s("el-text"),G=s("el-card"),se=s("el-col"),ae=s("el-row"),P=me("loading");return f(),x(K,null,[e("h4",yt,l(t.$t("views.document.uploadDocument")),1),ve((f(),k(oe,{ref_key:"FormRef",ref:p,model:c.value,rules:b,"label-position":"top","require-asterisk-position":"right"},{default:o(()=>[e("div",kt,[n(Z,{modelValue:c.value.fileType,"onUpdate:modelValue":i[0]||(i[0]=w=>c.value.fileType=w),onChange:_,class:"app-radio-button-group"},{default:o(()=>[n(q,{value:"txt"},{default:o(()=>[g(l(t.$t("views.document.fileType.txt.label")),1)]),_:1}),n(q,{value:"table"},{default:o(()=>[g(l(t.$t("views.document.fileType.table.label")),1)]),_:1}),n(q,{value:"QA"},{default:o(()=>[g(l(t.$t("views.document.fileType.QA.label")),1)]),_:1})]),_:1},8,["modelValue"])]),c.value.fileType==="QA"?(f(),k(j,{key:0,prop:"fileList"},{default:o(()=>[e("div",Ct,[e("div",Lt,[n(N,{iconName:"app-warning-colorful",style:{"font-size":"16px"}})]),e("div",Tt,[e("p",null,[g(l(t.$t("views.document.fileType.QA.tip1"))+" ",1),n(z,{type:"primary",link:"",onClick:i[1]||(i[1]=w=>U("excel"))},{default:o(()=>[g(l(t.$t("views.document.upload.download"))+" Excel "+l(t.$t("views.document.upload.template")),1)]),_:1}),n(z,{type:"primary",link:"",onClick:i[2]||(i[2]=w=>U("csv"))},{default:o(()=>[g(l(t.$t("views.document.upload.download"))+" CSV "+l(t.$t("views.document.upload.template")),1)]),_:1})]),e("p",null,l(t.$t("views.document.fileType.QA.tip2")),1),e("p",null," 3. "+l(t.$t("views.document.tip.fileLimitCountTip1"))+" "+l(R.value)+" "+l(t.$t("views.document.tip.fileLimitCountTip2"))+", "+l(t.$t("views.document.tip.fileLimitSizeTip1"))+" "+l(y.value)+" MB ",1)])]),n(X,{webkitdirectory:!1,class:"w-full mb-4",drag:"",multiple:"","file-list":c.value.fileList,"onUpdate:fileList":i[5]||(i[5]=w=>c.value.fileList=w),action:"#","auto-upload":!1,"show-file-list":!1,accept:".xlsx, .xls, .csv,.zip",limit:R.value,"on-exceed":a,"on-change":v,onClick:i[6]||(i[6]=B(w=>r(!1),["prevent"]))},{default:o(()=>[i[17]||(i[17]=e("img",{src:ue,alt:""},null,-1)),e("div",Vt,[e("p",null,[g(l(t.$t("views.document.upload.uploadMessage"))+" ",1),e("em",{class:"hover",onClick:i[3]||(i[3]=B(w=>r(!1),["prevent"]))},l(t.$t("views.document.upload.selectFile")),1),e("em",{class:"hove ml-4",onClick:i[4]||(i[4]=B(w=>r(!0),["prevent"]))},l(t.$t("views.document.upload.selectFiles")),1)]),e("div",St,[e("p",null,l(t.$t("views.document.upload.formats"))+"XLS縲々LSX縲，SV縲〇IP",1)])])]),_:1,__:[17]},8,["file-list","limit"])]),_:1})):c.value.fileType==="table"?(f(),k(j,{key:1,prop:"fileList"},{default:o(()=>[e("div",Rt,[e("div",Ft,[n(N,{iconName:"app-warning-colorful",style:{"font-size":"16px"}})]),e("div",Dt,[e("p",null,[g(l(t.$t("views.document.fileType.table.tip1"))+" ",1),n(z,{type:"primary",link:"",onClick:i[7]||(i[7]=w=>m("excel"))},{default:o(()=>[g(l(t.$t("views.document.upload.download"))+" Excel "+l(t.$t("views.document.upload.template")),1)]),_:1}),n(z,{type:"primary",link:"",onClick:i[8]||(i[8]=w=>m("csv"))},{default:o(()=>[g(l(t.$t("views.document.upload.download"))+" CSV "+l(t.$t("views.document.upload.template")),1)]),_:1})]),e("p",null,l(t.$t("views.document.fileType.table.tip2")),1),e("p",null,l(t.$t("views.document.fileType.table.tip3")),1),e("p",null," 4. "+l(t.$t("views.document.tip.fileLimitCountTip1"))+" "+l(R.value)+" "+l(t.$t("views.document.tip.fileLimitCountTip2"))+", "+l(t.$t("views.document.tip.fileLimitSizeTip1"))+" "+l(y.value)+" MB ",1)])]),n(X,{webkitdirectory:!1,class:"w-full mb-4",drag:"",multiple:"","file-list":c.value.fileList,"onUpdate:fileList":i[11]||(i[11]=w=>c.value.fileList=w),action:"#","auto-upload":!1,"show-file-list":!1,accept:".xlsx, .xls, .csv",limit:R.value,"on-exceed":a,"on-change":v,onClick:i[12]||(i[12]=B(w=>r(!1),["prevent"]))},{default:o(()=>[i[18]||(i[18]=e("img",{src:ue,alt:""},null,-1)),e("div",Mt,[e("p",null,[g(l(t.$t("views.document.upload.uploadMessage"))+" ",1),e("em",{class:"hover",onClick:i[9]||(i[9]=B(w=>r(!1),["prevent"]))},l(t.$t("views.document.upload.selectFile")),1),e("em",{class:"hover ml-4",onClick:i[10]||(i[10]=B(w=>r(!0),["prevent"]))},l(t.$t("views.document.upload.selectFiles")),1)]),e("div",Ut,[e("p",null,l(t.$t("views.document.upload.formats"))+"XLS縲々LSX縲，SV",1)])])]),_:1,__:[18]},8,["file-list","limit"])]),_:1})):(f(),k(j,{key:2,prop:"fileList"},{default:o(()=>[e("div",zt,[e("div",It,[n(N,{iconName:"app-warning-colorful",style:{"font-size":"16px"}})]),e("div",Pt,[e("p",null,l(t.$t("views.document.fileType.txt.tip1")),1),e("p",null," 2. "+l(t.$t("views.document.tip.fileLimitCountTip1"))+" "+l(R.value)+" "+l(t.$t("views.document.tip.fileLimitCountTip2"))+", "+l(t.$t("views.document.tip.fileLimitSizeTip1"))+" "+l(y.value)+" MB ",1)])]),n(X,{webkitdirectory:!1,class:"w-full",drag:"",multiple:"","file-list":c.value.fileList,"onUpdate:fileList":i[15]||(i[15]=w=>c.value.fileList=w),action:"#","auto-upload":!1,"show-file-list":!1,accept:".txt, .md, .log, .docx, .pdf, .html,.zip,.xlsx,.xls,.csv",limit:R.value,"on-exceed":a,"on-change":v,onClick:i[16]||(i[16]=B(w=>r(!1),["prevent"]))},{default:o(()=>[i[19]||(i[19]=e("img",{src:ue,alt:""},null,-1)),e("div",xt,[e("p",null,[g(l(t.$t("views.document.upload.uploadMessage"))+" ",1),e("em",{class:"hover",onClick:i[13]||(i[13]=B(w=>r(!1),["prevent"]))},l(t.$t("views.document.upload.selectFile")),1),e("em",{class:"hover ml-4",onClick:i[14]||(i[14]=B(w=>r(!0),["prevent"]))},l(t.$t("views.document.upload.selectFiles")),1)]),e("div",Et,[e("p",null,l(t.$t("views.document.upload.formats"))+"TXT縲｀arkdown縲￣DF縲．OCX縲？TML縲々LS縲々LSX縲，SV縲〇IP ",1)])])]),_:1,__:[19]},8,["file-list","limit"])]),_:1}))]),_:1},8,["model","rules"])),[[P,u.value]]),(ee=c.value.fileList)!=null&&ee.length?(f(),k(ae,{key:0,gutter:8},{default:o(()=>[(f(!0),x(K,null,W(c.value.fileList,(w,fe)=>(f(),k(se,{key:fe,span:12,class:"mb-8"},{default:o(()=>[n(G,{shadow:"never",class:"file-List-card"},{default:o(()=>[e("div",At,[e("div",Bt,[e("img",{src:A(re)(w&&(w==null?void 0:w.name)),alt:"",width:"40"},null,8,Ht),e("div",Nt,[e("p",null,l(w&&(w==null?void 0:w.name)),1),n(ne,{type:"info",size:"small"},{default:o(()=>[g(l(A(ke)(w&&(w==null?void 0:w.size))||"0K"),1)]),_:2},1024)])]),n(z,{text:"",onClick:Gt=>T(fe)},{default:o(()=>[n(N,{iconName:"app-delete"})]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):Q("",!0)],64)}}}),qt=Y(Xt,[["__scopeId","data-v-de488c7f"]]),Qt={class:"upload-document p-12-24"},Zt={class:"flex align-center mb-16"},Ot={style:{display:"inline-block"}},jt={class:"upload-document__main flex"},Kt={class:"upload-document__component main-calc-height"},Jt={key:0,class:"upload-component p-24"},Wt={key:0,class:"upload-document__footer text-right border-t"},Yt=J({__name:"UploadDocument",setup(M){const{knowledge:I}=pe(),F=H(()=>I.documentsFiles),C=H(()=>I.documentsType),V=ye(),$=le(),{params:{folderId:D},query:{id:L}}=$,p=H(()=>$.path.includes("shared")?"systemShare":$.path.includes("resource-management")?"systemManage":"workspace"),u=h(),c=h(),b=h(!1),R=h(!1),y=h(0),U=h(null);async function m(){if(R.value=!0,await c.value.validate())if(C.value==="QA"){const a=new FormData;F.value.forEach(r=>{r!=null&&r.raw&&a.append("file",r==null?void 0:r.raw)}),L&&O({type:"document",systemType:p.value}).postQADocument(L,a,b).then(()=>{ie(E("common.submitSuccess")),T(),V.push({path:`/knowledge/${L}/${D}/document`})})}else if(C.value==="table"){const a=new FormData;F.value.forEach(r=>{r!=null&&r.raw&&a.append("file",r==null?void 0:r.raw)}),L&&O({type:"document",systemType:p.value}).postTableDocument(L,a,b).then(()=>{ie(E("common.submitSuccess")),T(),V.push({path:`/knowledge/${L}/${D}/document`})})}else y.value++>2&&(y.value=0);else R.value=!1}const _=()=>{y.value=0};function T(){I.saveDocumentsFile([]),I.saveDocumentsType("")}function v(){var r;b.value=!0;const a=[];(r=u.value)==null||r.paragraphList.map(S=>{var d;(d=u.value)!=null&&d.checkedConnect||S.content.map(t=>{delete t.problem_list}),a.push({name:S.name,paragraphs:S.content,source_file_id:S.source_file_id})}),L&&O({type:"document",systemType:p.value}).putMulDocument(L,a).then(()=>{ie(E("common.submitSuccess")),T(),V.push({path:`/knowledge/${L}/${D}/document`})}).catch(()=>{b.value=!1})}return Ce(()=>{T()}),(a,r)=>{var Z,N,z,X;const S=s("back-button"),d=s("el-scrollbar"),t=s("el-card"),i=s("el-button"),q=me("loading");return f(),x("div",Qt,[e("div",Zt,[n(S,{to:"-1",style:{"margin-left":"-4px"}}),e("h3",Ot,l(a.$t("views.document.uploadDocument")),1)]),n(t,{style:{"--el-card-padding":"0"}},{default:o(()=>[ve((f(),x("div",jt,[e("div",Kt,[n(d,null,{default:o(()=>[y.value===0?(f(),x("div",Jt,[n(qt,{ref_key:"UploadComponentRef",ref:c},null,512)])):y.value===1?(f(),k(dt,{key:1,ref_key:"SetRulesRef",ref:u},null,512)):y.value===2?(f(),k(bt,{key:2,data:U.value},null,8,["data"])):Q("",!0)]),_:1})])])),[[q,b.value]])]),_:1}),y.value!==2?(f(),x("div",Wt,[n(i,{onClick:r[0]||(r[0]=j=>A(V).go(-1)),disabled:((Z=u.value)==null?void 0:Z.loading)||b.value},{default:o(()=>[g(l(a.$t("common.cancel")),1)]),_:1},8,["disabled"]),y.value===1?(f(),k(i,{key:0,onClick:_,disabled:((N=u.value)==null?void 0:N.loading)||b.value},{default:o(()=>[g(l(a.$t("views.document.buttons.prev")),1)]),_:1},8,["disabled"])):Q("",!0),y.value===0?(f(),k(i,{key:1,onClick:m,type:"primary",disabled:((z=u.value)==null?void 0:z.loading)||b.value},{default:o(()=>[g(l(C.value==="txt"?a.$t("views.document.buttons.next"):a.$t("views.document.buttons.import")),1)]),_:1},8,["disabled"])):Q("",!0),y.value===1?(f(),k(i,{key:2,onClick:v,type:"primary",disabled:((X=u.value)==null?void 0:X.loading)||b.value},{default:o(()=>[g(l(a.$t("views.document.buttons.import")),1)]),_:1},8,["disabled"])):Q("",!0)])):Q("",!0)])}}}),ll=Y(Yt,[["__scopeId","data-v-aabad103"]]);export{ll as default};
