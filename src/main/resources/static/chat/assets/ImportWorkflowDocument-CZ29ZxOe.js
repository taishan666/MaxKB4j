import{ay as z,az as J,b8 as j,aB as d,b9 as W,b5 as Q,bs as X,aD as y,bq as Y,bc as C,aF as r,aI as k,aH as b,cN as Z,aJ as E,aG as i,br as ee,aE as c,cO as te,bT as ae,bo as oe,bd as f,aK as D,bf as T,bu as s,c1 as n,c3 as a,c2 as ne,bW as se,b_ as le,cr as re}from"./chat-BFw4auTk.js";import{_ as ue,a as de}from"./KnowledgeBase.vue_vue_type_script_setup_true_lang-yMXT1IEb.js";import{_ as ie}from"./Result.vue_vue_type_script_setup_true_lang-DgFNZFXB.js";const ce={class:"upload-document p-12-24"},_e={class:"flex align-center mb-16"},me={style:{display:"inline-block"}},pe={class:"upload-document__main flex"},Ee={class:"upload-document__component main-calc-height"},ge={class:"upload-component p-24",style:{"min-width":"850px"}},ve={class:"upload-document__footer text-right border-t"},Re=z({__name:"ImportWorkflowDocument",setup(ke){se("upload",(e,l)=>re.postUploadFile(e,t,"KNOWLEDGE",l));const w=J(),g=j(),$=d(0),{params:{folderId:_},query:{id:t}}=g,S=W(()=>g.path.includes("shared")?"systemShare":g.path.includes("resource-management")?"systemManage":"workspace"),K={dataSource:de,knowledgeBase:ue,result:ie},u=d(!1),m=d(),O=d(),R=d({}),o=d("dataSource"),p=d(null),A=W(()=>{var l,h;const e=(h=(l=p.value)==null?void 0:l.nodes)==null?void 0:h.find(N=>N.type===Q.KnowledgeBase);return e?e.properties.user_input_field_list:[]}),I=()=>{m.value.validate().then(()=>{R.value[o.value]=m.value.get_data(),o.value="knowledgeBase"})},L=()=>{m.value.validate().then(()=>{o.value="dataSource"})},M=()=>{m.value.validate().then(()=>{R.value[o.value]=m.value.get_data(),T({type:"knowledge",systemType:S.value}).workflowUpload(t,R.value,u).then(e=>{O.value=e.data.id,o.value="result"})})};function G(){T({type:"knowledge",systemType:S.value}).getKnowledgeDetail(t,u).then(e=>{p.value=e.data.workFlow})}const B=()=>{o.value="dataSource",$.value++,O.value=void 0;const e=p.value;p.value=null,R.value={},le(()=>{p.value=e})},U=()=>{w.push({path:`/knowledge/${t}/${_}/2/document`})},H=()=>g.path.includes("resource-management")?w.push({path:x()}):g.path.includes("shared")?w.push({path:P()}):w.push({path:V()}),P=()=>s([n.ADMIN,a.SHARED_KNOWLEDGE_DOCUMENT_READ],"OR")?`/knowledge/${t}/shared/2/document`:s([n.ADMIN,a.SHARED_KNOWLEDGE_PROBLEM_READ],"OR")?`/knowledge/${t}/shared/2/problem`:s([n.ADMIN,a.SHARED_KNOWLEDGE_HIT_TEST_READ],"OR")?`/knowledge/${t}/shared/2/hit-test`:s([n.ADMIN,a.SHARED_KNOWLEDGE_CHAT_USER_READ],"OR")?`/knowledge/${t}/shared/2/chat-user`:s([n.ADMIN,a.SHARED_KNOWLEDGE_EDIT],"OR")?`/knowledge/${t}/shared/2/setting`:"/system/shared/knowledge",x=()=>s([n.ADMIN,a.RESOURCE_KNOWLEDGE_DOCUMENT_READ],"OR")?`/knowledge/${t}/resource-management/2/document`:s([n.ADMIN,a.RESOURCE_KNOWLEDGE_PROBLEM_READ],"OR")?`/knowledge/${t}/resource-management/2/problem`:s([n.ADMIN,a.RESOURCE_KNOWLEDGE_HIT_TEST],"OR")?`/knowledge/${t}/resource-management/2/hit-test`:s([n.ADMIN,a.RESOURCE_KNOWLEDGE_CHAT_USER_READ],"OR")?`/knowledge/${t}/resource-management/2/chat-user`:s([n.ADMIN,a.RESOURCE_KNOWLEDGE_EDIT],"OR")?`/knowledge/${t}/resource-management/2/setting`:"/system/resource-management/knowledge",V=()=>{const e=l=>s([new ne([n.USER],[a.KNOWLEDGE.getKnowledgeWorkspaceResourcePermission(t)],[],"AND"),n.WORKSPACE_MANAGE.getWorkspaceRole,l.getWorkspacePermissionWorkspaceManageRole,l.getKnowledgeWorkspaceResourcePermission(t)],"OR");return e(a.KNOWLEDGE_DOCUMENT_READ)?`/knowledge/${t}/${_}/2/document`:e(a.KNOWLEDGE_PROBLEM_READ)?`/knowledge/${t}/${_}/2/problem`:e(a.KNOWLEDGE_HIT_TEST_READ)?`/knowledge/${t}/${_}/2/hit-test`:e(a.KNOWLEDGE_CHAT_USER_READ)?`/knowledge/${t}/${_}/2/chat-user`:e(a.KNOWLEDGE_EDIT)?`/knowledge/${t}/${_}/2/setting`:"/knowledge"};return X(()=>{G()}),(e,l)=>{const h=y("el-scrollbar"),N=y("el-card"),v=y("el-button"),F=Y("loading");return r(),C("div",ce,[k("div",_e,[b(Z,{onClick:H,style:{"margin-left":"-4px"}}),k("h3",me,E(e.$t("views.document.importDocument")),1)]),b(N,{style:{"--el-card-padding":"0"}},{default:i(()=>[ee((r(),C("div",pe,[k("div",Ee,[b(h,null,{default:i(()=>[k("div",ge,[(r(),c(te,{key:$.value,include:["dataSource","knowledgeBase"]},[(r(),c(ae(K[o.value]),{ref_key:"ActionRef",ref:m,loading:u.value,"onUpdate:loading":l[0]||(l[0]=q=>u.value=q),workflow:p.value,knowledgeId:oe(t),id:O.value},null,40,["loading","workflow","knowledgeId","id"]))],1024))])]),_:1})])])),[[F,u.value]])]),_:1}),k("div",ve,[o.value=="result"?(r(),c(v,{key:0,onClick:B},{default:i(()=>[D(E(e.$t("views.document.buttons.continueImporting")),1)]),_:1})):f("",!0),A.value.length>0&&o.value=="knowledgeBase"?(r(),c(v,{key:1,loading:u.value,onClick:L},{default:i(()=>[D(E(e.$t("common.steps.prev")),1)]),_:1},8,["loading"])):f("",!0),A.value.length>0&&o.value=="dataSource"?(r(),c(v,{key:2,disabled:u.value,onClick:I},{default:i(()=>[D(E(e.$t("common.steps.next")),1)]),_:1},8,["disabled"])):f("",!0),(A.value.length>0?o.value=="knowledgeBase":o.value=="dataSource")?(r(),c(v,{key:3,onClick:M,type:"primary",disabled:u.value},{default:i(()=>[D(E(e.$t("views.document.buttons.import")),1)]),_:1},8,["disabled"])):f("",!0),o.value=="result"?(r(),c(v,{key:4,type:"primary",onClick:U},{default:i(()=>[D(E(e.$t("views.knowledge.ResultSuccess.buttons.toDocument")),1)]),_:1})):f("",!0)])])}}});export{Re as default};
