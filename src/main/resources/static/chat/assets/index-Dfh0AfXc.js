import{aJ as Ce,bo as ye,aP as v,cz as W,cy as g,cA as C,aK as R,bb as K,bd as Ue,bp as oe,a_ as H,aT as o,aS as s,aW as h,aO as O,e9 as Oe,aR as i,aQ as r,cG as N,b0 as ne,aZ as Te,aL as w,b1 as z,cq as re,aV as F,bc as ie,aM as b,bi as ke,b7 as Re}from"./chat-ChhQLBW1.js";const we={class:"group p-16-24"},Se={class:"mb-16"},Ie={class:"color-secondary"},Le={class:"flex"},De={class:"user-left border-r"},Pe={class:"p-24 pb-0"},Ne={class:"medium mb-12"},Ve={class:"list-height-left"},Me={class:"p-16"},$e=["title"],Ge={class:"user-right"},We={class:"flex-between"},Ke={class:"flex align-center"},He=["title"],ze={class:"color-input-placeholder ml-4"},Fe={key:0,class:"flex align-center"},Be={class:"color-secondary mr-8"},je={class:"flex-between mb-16",style:{"margin-top":"18px"}},qe={class:"flex complex-search"},xe=Ce({__name:"index",setup(Je){const u=ye(),{params:{id:B,folderId:ue}}=u,j=v({APPLICATION:new W([g.ADMIN,g.WORKSPACE_MANAGE.getWorkspaceRole,g.USER.getWorkspaceRole],[C.APPLICATION_CHAT_USER_EDIT,C.APPLICATION_CHAT_USER_EDIT.getApplicationWorkspaceResourcePermission(B)],[],"OR"),KNOWLEDGE:new W([g.ADMIN,g.WORKSPACE_MANAGE.getWorkspaceRole,g.USER.getWorkspaceRole],[C.KNOWLEDGE_CHAT_USER_EDIT,C.KNOWLEDGE_CHAT_USER_EDIT.getKnowledgeWorkspaceResourcePermission(B)],[],"OR"),RESOURCE_APPLICATION:[g.ADMIN,C.RESOURCE_APPLICATION_CHAT_USER_EDIT],RESOURCE_KNOWLEDGE:[g.ADMIN,C.RESOURCE_KNOWLEDGE_CHAT_USER_EDIT],SHAREDKNOWLEDGE:new W([g.ADMIN],[C.SHARED_KNOWLEDGE_CHAT_USER_EDIT],[],"OR")}),q=R(()=>{var e,a,n;if(u.path.includes("shared"))return"SHAREDKNOWLEDGE";if(u.path.includes("resource-management")){if(((e=u.meta)==null?void 0:e.resourceType)==="KNOWLEDGE")return"RESOURCE_KNOWLEDGE";if(((a=u.meta)==null?void 0:a.resourceType)==="APPLICATION")return"RESOURCE_APPLICATION"}return(n=u.meta)==null?void 0:n.resourceType}),T=K({resource_id:u.params.id,resourceType:u.meta.resourceType}),S=v(""),I=v(!1),L=v([]),V=v([]),t=v(),D=R(()=>u.path.includes("shared")?"systemShare":u.path.includes("resource-management")?"systemManage":"workspace");async function x(){try{const e=await N({type:"chatUser",isShared:Q.value,systemType:D.value}).getUserGroupList(T,I);L.value=e.data,V.value=J(L.value,S.value)}catch(e){console.error(e)}}Ue(async()=>{await x(),t.value=L.value[0]});function J(e,a){return a.length?e.filter(n=>n.name.toLowerCase().includes(a.toLowerCase())):e}oe(S,e=>{V.value=J(L.value,e)});const d=K({});function ce(e){for(const a in d)delete d[a];t.value=e}async function de(){var a,n,_,p,m;const e=[{user_group_id:(a=t.value)==null?void 0:a.id,is_auth:!((n=t.value)!=null&&n.is_auth)}];try{await N({type:"chatUser",systemType:D.value}).editUserGroupList(T,e,I),await x(),t.value={name:(_=t.value)==null?void 0:_.name,id:(p=t.value)==null?void 0:p.id,is_auth:!((m=t.value)!=null&&m.is_auth)},A()}catch($){console.error($)}}const M=v(!1),f=v("username"),E=v({username:"",nickname:"",source:""}),y=K({current_page:1,page_size:20,total:0}),U=v([]),Q=R(()=>ue==="share");async function A(){var n,_;if(!((n=t.value)!=null&&n.id))return;const e={},a=E.value[f.value];a!=null&&a!==""&&(e[f.value]=a);try{const p=await N({type:"chatUser",isShared:Q.value,systemType:D.value}).getUserGroupUserList(T,(_=t.value)==null?void 0:_.id,y,e,M);p.data.records.forEach(m=>{d[m.id]===void 0&&(d[m.id]=m.is_auth),m.is_auth=d[m.id]}),U.value=p.data.records,y.total=p.data.total}catch(p){console.error(p)}}function pe(){y.current_page=1,A()}oe(()=>{var e;return(e=t.value)==null?void 0:e.id},()=>{y.current_page=1,A()});const Z=R(()=>U.value.length>0&&U.value.every(e=>d[e.id])),me=R(()=>!Z.value&&U.value.some(e=>d[e.id])),ve=e=>{U.value.forEach(a=>{a.is_auth=e,d[a.id]=e})},he=(e,a)=>{a.is_auth=e,d[a.id]=e};async function _e(){var e;try{const a=Object.entries(d).map(([n,_])=>({chatUserId:n,is_auth:_}));await N({type:"chatUser",systemType:D.value}).putUserGroupUser(T,(e=t.value)==null?void 0:e.id,a,M),ke(ie("common.saveSuccess"))}catch(a){console.error(a)}}return(e,a)=>{const n=r("el-input"),_=r("common-list"),p=r("el-scrollbar"),m=r("el-divider"),$=r("UserFilled"),ge=r("el-icon"),be=r("el-switch"),c=r("el-option"),X=r("el-select"),fe=r("el-button"),P=r("el-table-column"),Y=r("el-checkbox"),Ee=r("app-table"),Ae=r("el-card"),ee=Te("loading");return b(),H("div",we,[o("div",Se,[o("h2",null,h(e.$t("views.chatUser.title")),1),o("div",Ie,h(T.resourceType===O(Oe).APPLICATION?e.$t("views.chatUser.applicationTitleTip"):e.$t("views.chatUser.knowledgeTitleTip")),1)]),s(Ae,{style:{"--el-card-padding":"0"}},{default:i(()=>{var ae,le,se,te;return[o("div",Le,[o("div",De,[o("div",Pe,[o("h4",Ne,h(e.$t("views.chatUser.group.title")),1),s(n,{modelValue:S.value,"onUpdate:modelValue":a[0]||(a[0]=l=>S.value=l),placeholder:e.$t("common.search"),"prefix-icon":"Search",clearable:""},null,8,["modelValue","placeholder"])]),o("div",Ve,[ne((b(),w(p,null,{default:i(()=>{var l;return[o("div",Me,[s(_,{data:V.value,onClick:ce,"default-active":(l=t.value)==null?void 0:l.id},{default:i(({row:k})=>[o("span",{class:"ellipsis-1",title:k.name},h(k.name),9,$e)]),empty:i(()=>a[5]||(a[5]=[o("span",null,null,-1)])),_:1},8,["data","default-active"])])]}),_:1})),[[ee,I.value]])])]),ne((b(),H("div",Ge,[o("div",We,[o("div",Ke,[o("h4",{class:"medium ellipsis",title:(ae=t.value)==null?void 0:ae.name},h(((le=t.value)==null?void 0:le.name)||"-"),9,He),s(m,{direction:"vertical",class:"mr-8 ml-8"}),s(ge,{class:"color-input-placeholder"},{default:i(()=>[s($)]),_:1}),o("span",ze,h(y.total),1)]),!O(u).path.includes("share/")&&O(re)(j.value[q.value],"OR")?(b(),H("div",Fe,[o("div",Be,h(e.$t("views.chatUser.autoAuthorization")),1),s(be,{size:"small","model-value":(se=t.value)==null?void 0:se.is_auth,onClick:de,loading:I.value},null,8,["model-value","loading"])])):z("",!0)]),o("div",je,[o("div",qe,[s(X,{class:"complex-search__left",modelValue:f.value,"onUpdate:modelValue":a[1]||(a[1]=l=>f.value=l),style:{width:"120px"}},{default:i(()=>[s(c,{label:e.$t("views.login.loginForm.username.label"),value:"username"},null,8,["label"]),s(c,{label:e.$t("views.userManage.userForm.nickname.label"),value:"nickname"},null,8,["label"]),s(c,{label:e.$t("views.userManage.source.label"),value:"source"},null,8,["label"])]),_:1},8,["modelValue"]),f.value==="username"?(b(),w(n,{key:0,modelValue:E.value.username,"onUpdate:modelValue":a[2]||(a[2]=l=>E.value.username=l),onChange:A,placeholder:e.$t("common.inputPlaceholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):f.value==="nickname"?(b(),w(n,{key:1,modelValue:E.value.nickname,"onUpdate:modelValue":a[3]||(a[3]=l=>E.value.nickname=l),onChange:A,placeholder:e.$t("common.inputPlaceholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):f.value==="source"?(b(),w(X,{key:2,modelValue:E.value.source,"onUpdate:modelValue":a[4]||(a[4]=l=>E.value.source=l),onChange:A,placeholder:e.$t("common.selectPlaceholder"),style:{width:"220px"},clearable:""},{default:i(()=>[s(c,{label:e.$t("views.userManage.source.local"),value:"LOCAL"},null,8,["label"]),s(c,{label:"CAS",value:"CAS"}),s(c,{label:"LDAP",value:"LDAP"}),s(c,{label:"OIDC",value:"OIDC"}),s(c,{label:"OAuth2",value:"OAuth2"}),s(c,{label:e.$t("views.userManage.source.wecom"),value:"wecom"},null,8,["label"]),s(c,{label:e.$t("views.userManage.source.lark"),value:"lark"},null,8,["label"]),s(c,{label:e.$t("views.userManage.source.dingtalk"),value:"dingtalk"},null,8,["label"])]),_:1},8,["modelValue","placeholder"])):z("",!0)]),!O(u).path.includes("share/")&&O(re)(j.value[q.value],"OR")?(b(),w(fe,{key:0,type:"primary",disabled:(te=t.value)==null?void 0:te.is_auth,onClick:_e},{default:i(()=>[F(h(O(ie)("common.save")),1)]),_:1},8,["disabled"])):z("",!0)]),s(Ee,{data:U.value,"pagination-config":y,onSizeChange:pe,onChangePage:A,maxTableHeight:350},{default:i(()=>[s(P,{prop:"nickname",label:e.$t("views.userManage.userForm.nickname.label")},null,8,["label"]),s(P,{prop:"username",label:e.$t("views.login.loginForm.username.label")},null,8,["label"]),s(P,{prop:"source",label:e.$t("views.userManage.source.label")},{default:i(({row:l})=>[F(h(l.source==="LOCAL"?e.$t("views.userManage.source.local"):l.source==="wecom"?e.$t("views.userManage.source.wecom"):l.source==="lark"?e.$t("views.userManage.source.lark"):l.source==="dingtalk"?e.$t("views.userManage.source.dingtalk"):l.source==="OAUTH2"||l.source==="OAuth2"?"OAuth2":l.source),1)]),_:1},8,["label"]),s(P,{width:140,align:"center"},{header:i(()=>{var l;return[s(Y,{"model-value":Z.value,indeterminate:me.value,disabled:(l=t.value)==null?void 0:l.is_auth,onChange:ve},{default:i(()=>[F(h(e.$t("views.chatUser.authorization")),1)]),_:1},8,["model-value","indeterminate","disabled"])]}),default:i(({row:l})=>{var k;return[s(Y,{modelValue:l.is_auth,"onUpdate:modelValue":G=>l.is_auth=G,indeterminate:l.indeterminate,disabled:(k=t.value)==null?void 0:k.is_auth,onChange:G=>he(G,l)},null,8,["modelValue","onUpdate:modelValue","indeterminate","disabled","onChange"])]}),_:1})]),_:1},8,["data","pagination-config"])])),[[ee,M.value]])])]}),_:1})])}}}),Ze=Re(xe,[["__scopeId","data-v-492699b9"]]);export{Ze as default};
