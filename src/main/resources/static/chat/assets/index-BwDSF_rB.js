const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./dingtalkQrCode-CHPZgVD8.js","./logo_dingtalk-CyDPr22R.js","./chat-4wXRqTZ9.js","./chat-CteZECtG.css","./dingtalkQrCode-CulsC8mV.css","./larkQrCode-BxQlh_4v.js","./logo_lark-DULIW3z6.js","./wecomQrCode-BLDdNVUG.js","./wecom.prod-CCkvMpRe.js","./wecomQrCode-Cct41S0k.css"])))=>i.map(i=>d[i]);
import{aJ as X,aP as u,aY as z,b9 as re,bm as ie,aQ as f,aL as m,aM as a,aU as ve,aR as i,aS as v,aV as ce,aW as R,be as y,bu as W,bf as ue,bh as fe,bv as H,b7 as de,a_ as g,aT as r,a$ as ge,b6 as pe,b1 as k,aN as he,bw as be,b5 as J,bl as K,bt as we,aK as ye,aZ as Ce,b0 as Le,aO as w,b2 as se,bx as ke,b3 as xe,aX as ne,bj as Ae}from"./chat-4wXRqTZ9.js";import{_ as Oe,a as $e}from"./dynamic-import-helper-B1wUOttj.js";const De=X({__name:"password",setup(D){const h=u(),{chatUser:x}=z(),t=u(!1),C=re(),M=ie(),V=()=>x.passwordAuthentication(d.value.password).then(O=>{C.push({name:"chat",params:{accessToken:x.accessToken},query:M.query})}),A=(O,L,n)=>{L===""?n(new Error(y("chat.passwordValidator.errorMessage1"))):V().catch(()=>{n(new Error(y("chat.passwordValidator.errorMessage2")))})},P=()=>{h.value.validate()},b={password:[{required:!0,validator:A,trigger:"manual"}]},d=u({password:""});return(O,L)=>{const n=f("el-input"),F=f("el-form-item"),U=f("el-button"),Q=f("el-form");return a(),m(Q,{ref_key:"FormRef",ref:h,model:d.value,onSubmit:ve(P,["prevent"])},{default:i(()=>[v(F,{prop:"value",rules:b.password},{default:i(()=>[v(n,{"show-password":"",modelValue:d.value.password,"onUpdate:modelValue":L[0]||(L[0]=l=>d.value.password=l)},null,8,["modelValue"])]),_:1},8,["rules"]),v(U,{class:"w-full mt-8",type:"primary",onClick:P,loading:t.value},{default:i(()=>[ce(R(O.$t("common.confirm")),1)]),_:1},8,["loading"])]),_:1},8,["model"])}}}),Ve=768,Re=()=>{const{common:D}=z(),h=()=>{var C;return((C=document.body)==null?void 0:C.getBoundingClientRect()).width-1<Ve},x=()=>{if(!document.hidden){const t=h();D.toggleDevice(t?H.Mobile:H.Desktop)}};W(()=>{window.addEventListener("resize",x)}),ue(()=>{fe(()=>{h()&&D.toggleDevice(H.Mobile)})})},Pe={},Ie={class:"login-warp flex-center"},Me={class:"login-container w-full h-full"},Te={class:"flex-center w-full h-full"};function qe(D,h){return a(),g("div",Ie,[r("div",Me,[r("div",Te,[ge(D.$slots,"default",{},void 0,!0)])])])}const Ee=de(Pe,[["render",qe],["__scopeId","data-v-e5a94abc"]]),Ue={key:0,class:"text-center"},Qe=X({__name:"QrCodeTab",props:{tabs:{}},setup(D){const{chatUser:h}=z(),x=D,t=u(""),C=u([]),M=u({app_key:"",app_secret:""});async function V(){try{return await h.getQrSource()}catch{return[]}}ue(async()=>{x.tabs.length>0&&(t.value=x.tabs[0].key),C.value=await V(),A(t.value)});const A=b=>{const d=C.value.find(O=>O.auth_type===b);d&&d.config&&(M.value=d.config)},P=b=>{t.value=b,A(b)};return(b,d)=>{const O=f("el-tab-pane"),L=f("el-tabs");return a(),m(L,{modelValue:t.value,"onUpdate:modelValue":d[0]||(d[0]=n=>t.value=n),onTabChange:P},{default:i(()=>[(a(!0),g(J,null,pe(b.tabs,n=>(a(),m(O,{key:n.key,label:n.value,name:n.key},{default:i(()=>[n.key===t.value?(a(),g("div",Ue,[(a(),m(he(be(()=>Oe(Object.assign({"./dingtalkQrCode.vue":()=>K(()=>import("./dingtalkQrCode-CHPZgVD8.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url),"./larkQrCode.vue":()=>K(()=>import("./larkQrCode-BxQlh_4v.js"),__vite__mapDeps([5,6,2,3]),import.meta.url),"./wecomQrCode.vue":()=>K(()=>import("./wecomQrCode-BLDdNVUG.js"),__vite__mapDeps([7,2,3,8,9]),import.meta.url)}),`./${n.key}QrCode.vue`,2))),{config:M.value},null,8,["config"]))])):k("",!0)]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])}}}),Se={class:"user-login-container p-24"},ze={key:0,class:"flex-center",style:{"margin-bottom":"32px"}},Fe=["src"],Be={key:1,class:"user-login__header"},je={class:"flex-between"},Ne={class:"flex align-center"},He={class:"mr-12 ml-16 flex"},Ke=["src"],We=["title"],Je={class:"mb-24"},Xe={key:0,class:"mb-24"},Ye={key:1},Ze={class:"mb-24"},Ge={class:"mb-24"},eo={key:0,class:"mb-24"},oo={class:"flex-between w-full"},to=["src"],ao={key:2},lo={key:3,class:"login-gradient-divider lighter mt-24"},so={class:"text-center mt-16"},no=X({__name:"index",setup(D){Re();const h=re(),{theme:x,chatUser:t,common:C}=z(),{locale:M}=we({useScope:"global"}),V=u(!1),A=ie(),P=u(""),{params:{accessToken:b},query:{mode:d}}=A,O=ye(()=>{console.log(C.isMobile());let e="";return!d||d==="pc"?e=C.isMobile()?"mobile":"pc":e=d,console.log(e),e==="pc"}),L=u(),n=u({username:"",password:"",captcha:""}),F=u({username:[{required:!0,message:y("views.login.loginForm.username.requiredMessage"),trigger:"blur"}],password:[{required:!0,message:y("views.login.loginForm.password.requiredMessage"),trigger:"blur"}],captcha:[{required:!0,message:y("views.login.loginForm.captcha.requiredMessage"),trigger:"blur"}]}),U=()=>{var e;(e=L.value)==null||e.validate().then(()=>{c.value==="LDAP"?t.ldapLogin(n.value).then(o=>{h.push({name:"chat",params:{accessToken:t.accessToken},query:A.query})}):t.login(n.value).then(o=>{h.push({name:"chat",params:{accessToken:t.accessToken},query:A.query})})})};function Q(){ne.getCaptcha().then(e=>{P.value=e.data.captcha})}W(()=>{M.value=t.getLanguage(),Q()});const l=u([]),B=u([""]),c=u(""),T=u(!1),Y=u([]);function _e(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const o=Math.random()*16|0;return(e==="x"?o:o&3|8).toString(16)})}function Z(e,o=!1){e==="LDAP"||e===""||ne.getAuthSetting(e,V).then(I=>{if(!I.data||!I.data.config)return;const _=I.data.config,q=new URLSearchParams(A.query).toString();let $=`${_.redirectUrl}/${b}`;q&&($+=`?${q}`);let p;if(e==="CAS")p=_.ldpUri,p+=p.indexOf("?")!==-1?`&service=${encodeURIComponent($)}`:`?service=${encodeURIComponent($)}`;else if(e==="OIDC"){const N=_.scope||"openid+profile+email";p=`${_.authEndpoint}?client_id=${_.clientId}&redirect_uri=${$}&response_type=code&scope=${N}`,_.state&&(p+=`&state=${_.state}`)}else e==="OAuth2"&&(p=`${_.authEndpoint}?client_id=${_.clientId}&response_type=code&redirect_uri=${$}&state=${_e()}`,_.scope&&(p+=`&scope=${_.scope}`));p&&(o?Ae(y("views.login.jump_tip"),"",{confirmButtonText:y("views.login.jump"),cancelButtonText:y("common.cancel"),confirmButtonClass:""}).then(()=>{window.location.href=p}).catch(()=>{}):(console.log("url",p),window.location.href=p))})}function j(e){var o;if(c.value=e==="LDAP"?e:"LOCAL",e!=="LOCAL"&&(c.value=e),e==="QR_CODE"){c.value=e,T.value=!0;return}T.value=!1,n.value={username:"",password:"",captcha:""},Z(e),(o=L.value)==null||o.clearValidate()}return W(()=>{var e;(e=t.chat_profile)!=null&&e.login_value&&(l.value=t.chat_profile.login_value,l.value.includes("LOCAL")?l.value=["LOCAL",...l.value.filter(o=>o!=="LOCAL")]:l.value.includes("LDAP")&&(l.value=["LDAP",...l.value.filter(o=>o!=="LDAP")]),c.value=l.value[0]||"LOCAL",!l.value.includes("LOCAL")&&!l.value.includes("LDAP")&&(c.value=""),l.value.length==1&&["CAS","OIDC","OAuth2"].includes(l.value[0])&&Z(l.value[0]),B.value=l.value.filter(o=>!["CAS","OIDC","OAuth2","LOCAL","LDAP"].includes(o)),l.value=l.value.filter(o=>!["lark","wecom","dingtalk"].includes(o)),B.value.length>0&&(B.value.forEach(o=>{Y.value.push({key:o,value:o==="wecom"?y("views.system.authentication.scanTheQRCode.wecom"):o==="dingtalk"?y("views.system.authentication.scanTheQRCode.dingtalk"):y("views.system.authentication.scanTheQRCode.lark")})}),!l.value.includes("LOCAL")&&!l.value.includes("LDAP")&&(T.value=!0),l.value=["QR_CODE",...l.value]))}),(e,o)=>{const I=f("el-avatar"),_=f("LogoIcon"),q=f("el-card"),$=f("el-input"),p=f("el-form-item"),N=f("el-form"),S=f("el-button"),me=Ce("loading");return V.value?k("",!0):Le((a(),m(Ee,{key:0},{default:i(()=>{var G,ee,oe,te,ae,le;return[r("div",Se,[O.value?(a(),g("div",ze,[w(se)((G=w(t).chat_profile)==null?void 0:G.icon)?(a(),m(I,{key:0,shape:"square",size:32,class:"mr-8",style:{background:"none"}},{default:i(()=>{var s;return[r("img",{src:(s=w(t).chat_profile)==null?void 0:s.icon,alt:""},null,8,Fe)]}),_:1})):(a(),m(_,{key:1,height:"32px",class:"mr-8"})),r("h1",null,R((ee=w(t).chat_profile)==null?void 0:ee.application_name),1)])):(a(),g("div",Be,[r("div",je,[r("div",Ne,[r("div",He,[w(se)((oe=w(t).chat_profile)==null?void 0:oe.icon)?(a(),m(I,{key:0,shape:"square",size:32,style:{background:"none"}},{default:i(()=>{var s;return[r("img",{src:(s=w(t).chat_profile)==null?void 0:s.icon,alt:""},null,8,Ke)]}),_:1})):(a(),m(_,{key:1,height:"32px"}))]),r("h4",{class:"ellipsis",style:{"max-width":"270px"},title:(te=w(t).chat_profile)==null?void 0:te.application_name},R((ae=w(t).chat_profile)==null?void 0:ae.application_name),9,We)])])])),((le=w(t).chat_profile)==null?void 0:le.authentication_type)=="password"?(a(),m(q,{key:2,class:"login-card"},{default:i(()=>[r("h2",Je,R(e.$t("views.applicationOverview.appInfo.LimitDialog.authenticationValue")),1),v(De)]),_:1})):(a(),m(q,{key:3,class:"login-card",style:{"--el-card-padding":"0"}},{default:i(()=>[!T.value&&(c.value==="LDAP"||c.value==="LOCAL")?(a(),g("h2",Xe,R(c.value=="LOCAL"?e.$t("views.login.title"):c.value),1)):k("",!0),!T.value&&(c.value==="LDAP"||c.value==="LOCAL")?(a(),g("div",Ye,[v(N,{class:"login-form",rules:F.value,model:n.value,ref_key:"loginFormRef",ref:L,onKeyup:ke(U,["enter"])},{default:i(()=>[r("div",Ze,[v(p,{prop:"username"},{default:i(()=>[v($,{size:"large",class:"input-item",modelValue:n.value.username,"onUpdate:modelValue":o[0]||(o[0]=s=>n.value.username=s),placeholder:e.$t("views.login.loginForm.username.placeholder")},null,8,["modelValue","placeholder"])]),_:1})]),r("div",Ge,[v(p,{prop:"password"},{default:i(()=>[v($,{type:"password",size:"large",class:"input-item",modelValue:n.value.password,"onUpdate:modelValue":o[1]||(o[1]=s=>n.value.password=s),placeholder:e.$t("views.login.loginForm.password.placeholder"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1})]),c.value!=="LDAP"?(a(),g("div",eo,[v(p,{prop:"captcha"},{default:i(()=>[r("div",oo,[v($,{size:"large",class:"input-item",modelValue:n.value.captcha,"onUpdate:modelValue":o[2]||(o[2]=s=>n.value.captcha=s),placeholder:e.$t("views.login.loginForm.captcha.placeholder")},null,8,["modelValue","placeholder"]),r("img",{src:P.value,alt:"",height:"38",class:"ml-8 cursor border border-r-6",onClick:Q},null,8,to)])]),_:1})])):k("",!0)]),_:1},8,["rules","model"]),v(S,{size:"large",type:"primary",class:"w-full",onClick:U,loading:V.value},{default:i(()=>[ce(R(e.$t("views.login.buttons.login")),1)]),_:1},8,["loading"])])):k("",!0),T.value?(a(),g("div",ao,[v(Qe,{tabs:Y.value},null,8,["tabs"])])):k("",!0),l.value.length>1?(a(),g("div",lo,[r("span",null,R(e.$t("views.login.moreMethod")),1)])):k("",!0),r("div",so,[(a(!0),g(J,null,pe(l.value,s=>(a(),g(J,null,[s!=="LOCAL"&&c.value!==s&&s!=="QR_CODE"?(a(),m(S,{circle:"",key:s,class:"login-button-circle color-secondary",onClick:E=>j(s)},{default:i(()=>{var E;return[r("span",{style:xe({"font-size":s==="OAUTH2"?"8px":"10px",color:(E=w(x).themeInfo)==null?void 0:E.theme})},R(s),5)]}),_:2},1032,["onClick"])):k("",!0),s==="QR_CODE"&&c.value!==s?(a(),m(S,{circle:"",key:s,class:"login-button-circle color-secondary",onClick:o[3]||(o[3]=E=>j("QR_CODE"))},{default:i(()=>o[5]||(o[5]=[r("img",{src:$e,width:"25px"},null,-1)])),_:2,__:[5]},1024)):k("",!0),s==="LOCAL"&&c.value!="LOCAL"?(a(),m(S,{circle:"",key:s,class:"login-button-circle color-secondary",style:{"font-size":"24px"},icon:"UserFilled",onClick:o[4]||(o[4]=E=>j("LOCAL"))})):k("",!0)],64))),256))])]),_:1}))])]}),_:1})),[[me,V.value]])}}}),ro=de(no,[["__scopeId","data-v-f368ed29"]]),uo=Object.freeze(Object.defineProperty({__proto__:null,default:ro},Symbol.toStringTag,{value:"Module"}));export{De as _,uo as a,Re as u};
