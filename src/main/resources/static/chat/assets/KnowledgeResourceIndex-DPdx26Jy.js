import{aJ as we,bc as ye,aY as be,aK as he,e9 as $e,aP as d,be as Ce,bq as Ve,bg as Ke,ci as xe,aQ as n,a_ as $,aM as s,aS as o,aR as l,aV as p,aW as c,aO as C,bf as v,aT as u,aL as r,b1 as m,b8 as H,b9 as J,aU as _,cy as Q,fH as T,bk as D,bm as Se}from"./chat-CJ-GWxNS.js";import{S as Ne}from"./SyncWebDialog-hr2N2zIO.js";import{_ as Te}from"./index.vue_vue_type_script_setup_true_lang-D7x8IDnf.js";import{l as Me}from"./permission-api-jU84h_jY.js";import"./workspace-CAzQVdA7.js";const Ue={class:"p-16-24"},Re={class:"ml-4 color-text-primary"},Le={class:"flex-between mb-16"},De={class:"complex-search"},ze={class:"flex align-center"},Ae={class:"ml-8"},Ee={key:0},Pe={key:1},Be={key:2},We={class:"filter"},Ie={class:"form-item mb-16 ml-4"},Fe={class:"text-right"},Ge={key:0,class:"mr-8"},Oe={class:"mr-8"},je=we({__name:"KnowledgeResourceIndex",setup(Ze){const P=ye(),{user:B}=be(),i=he(()=>$e.knowledge.systemManage),Y=()=>i.value.doc_read()||i.value.problem_read()||i.value.edit()||i.value.knowledge_chat_user_read()||i.value.hit_test(),j=()=>i.value.sync()||i.value.generate()||i.value.edit()||i.value.export()||i.value.delete()||i.value.auth(),f=d("name"),k=d({name:"",createUser:""}),W=d([]),S=d(!1),I=d([]),z=Ce({current_page:1,page_size:20,total:0}),X=e=>{T.exportKnowledge(e.name,e.id,S).then(()=>{D(v("common.exportSuccess"))})},ee=e=>{T.exportZipKnowledge(e.name,e.id,S).then(()=>{D(v("common.exportSuccess"))})};function te(e){Se(`${v("views.knowledge.delete.confirmTitle")}${e.name} ?`,`${v("views.knowledge.delete.confirmMessage1")} ${e.applicationMappingCount} ${v("views.knowledge.delete.confirmMessage2")}`,{confirmButtonText:v("common.confirm"),confirmButtonClass:"danger"}).then(()=>{T.delKnowledge(e.id,S).then(()=>{y(),D(v("common.deleteSuccess"))})}).catch(()=>{})}const A=d();function oe(e){A.value&&A.value.open([],"knowledge",e)}const F=d();function le(e){F.value.open(e.id)}function ae(e){T.putReEmbeddingKnowledge(e.id).then(()=>{D(v("common.submitSuccess"))})}const M=d([]),U=d(!1),w=d([]),V=d(""),R=d([]);Ve([()=>M.value,()=>V.value],()=>{V.value.length||(R.value=M.value),R.value=M.value.filter(e=>e.label.toLowerCase().includes(V.value.toLowerCase()))},{immediate:!0});function G(e){e==="clear"&&(w.value=[]),V.value="",y(),U.value=!1}async function ne(){if(B.isEE()){const e=await Me("workspace").getSystemWorkspaceList(S);M.value=e.data.map(a=>({label:a.name,value:a.id}))}}const se=()=>{k.value={name:"",createUser:""}};function y(){const e={};k.value[f.value]&&(e[f.value]=k.value[f.value]),w.value.length>0&&(e.workspace_ids=JSON.stringify(w.value)),T.getKnowledgeListPage(z,e,S).then(a=>{var N,L;z.total=(N=a.data)==null?void 0:N.total,I.value=(L=a.data)==null?void 0:L.records})}return Ke(()=>{ne(),y(),xe.getAllMemberList("").then(e=>{W.value=e.data})}),(e,a)=>{const N=n("el-breadcrumb-item"),L=n("el-breadcrumb"),E=n("el-option"),O=n("el-select"),Z=n("el-input"),ie=n("KnowledgeIcon"),b=n("el-table-column"),ce=n("Filter"),re=n("el-icon"),K=n("el-button"),de=n("el-checkbox"),ue=n("el-checkbox-group"),pe=n("el-scrollbar"),me=n("el-empty"),ve=n("el-popover"),g=n("AppIcon"),q=n("el-tooltip"),x=n("el-dropdown-item"),ge=n("el-dropdown-menu"),_e=n("el-dropdown"),fe=n("app-table"),ke=n("el-card");return s(),$("div",Ue,[o(L,{"separator-icon":"ArrowRight"},{default:l(()=>[o(N,null,{default:l(()=>[p(c(C(v)("views.system.resource_management.label")),1)]),_:1}),o(N,null,{default:l(()=>[u("h5",Re,c(C(v)("views.knowledge.title")),1)]),_:1})]),_:1}),o(ke,{class:"mt-16",style:{height:"calc(var(--app-main-height) + 20px)"}},{default:l(()=>[u("div",Le,[u("div",De,[o(O,{class:"complex-search__left",modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=t=>f.value=t),style:{width:"120px"},onChange:se},{default:l(()=>[o(E,{label:e.$t("common.creator"),value:"createUser"},null,8,["label"]),o(E,{label:e.$t("common.name"),value:"name"},null,8,["label"])]),_:1},8,["modelValue"]),f.value==="name"?(s(),r(Z,{key:0,modelValue:k.value.name,"onUpdate:modelValue":a[1]||(a[1]=t=>k.value.name=t),onChange:y,placeholder:e.$t("common.searchBar.placeholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):f.value==="createUser"?(s(),r(O,{key:1,modelValue:k.value.createUser,"onUpdate:modelValue":a[2]||(a[2]=t=>k.value.createUser=t),onChange:y,filterable:"",clearable:"",style:{width:"220px"}},{default:l(()=>[(s(!0),$(H,null,J(W.value,t=>(s(),r(E,{key:t.id,value:t.id,label:t.nickname},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):m("",!0)])]),o(fe,{data:I.value,"pagination-config":z,onSizeChange:y,onChangePage:y,maxTableHeight:260},{default:l(()=>[o(b,{width:"220",label:e.$t("common.name"),"show-overflow-tooltip":""},{default:l(({row:t})=>[u("div",ze,[o(ie,{type:t.type,size:24},null,8,["type"]),u("span",Ae,c(t.name),1)])]),_:1},8,["label"]),o(b,{prop:"toolType",label:e.$t("views.system.resource_management.type"),width:"110"},{default:l(({row:t})=>[t.type===1?(s(),$("span",Ee,c(e.$t("views.knowledge.knowledgeType.webKnowledge")),1)):t.type===2?(s(),$("span",Pe,c(e.$t("views.knowledge.knowledgeType.larkKnowledge")),1)):(s(),$("span",Be,c(e.$t("views.knowledge.knowledgeType.generalKnowledge")),1))]),_:1},8,["label"]),C(B).isEE()?(s(),r(b,{key:0,width:"150",prop:"workspace_name",label:e.$t("views.workspace.title"),"show-overflow-tooltip":""},{header:l(()=>[u("div",null,[u("span",null,c(e.$t("views.workspace.title")),1),o(ve,{width:200,trigger:"click",visible:U.value},{reference:l(()=>[o(K,{style:{"margin-top":"-2px"},type:w.value&&w.value.length>0?"primary":"",link:"",onClick:a[3]||(a[3]=t=>U.value=!U.value)},{default:l(()=>[o(re,null,{default:l(()=>[o(ce)]),_:1})]),_:1},8,["type"])]),default:l(()=>[u("div",We,[u("div",Ie,[u("div",{onClick:a[6]||(a[6]=_(()=>{},["stop"]))},[o(Z,{modelValue:V.value,"onUpdate:modelValue":a[4]||(a[4]=t=>V.value=t),placeholder:e.$t("common.search"),"prefix-icon":"Search",clearable:""},null,8,["modelValue","placeholder"]),R.value.length?(s(),r(pe,{key:0,height:"300"},{default:l(()=>[o(ue,{modelValue:w.value,"onUpdate:modelValue":a[5]||(a[5]=t=>w.value=t),style:{display:"flex","flex-direction":"column"}},{default:l(()=>[(s(!0),$(H,null,J(R.value,t=>(s(),r(de,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):(s(),r(me,{key:1,description:e.$t("common.noData")},null,8,["description"]))])])]),u("div",Fe,[o(K,{size:"small",onClick:a[7]||(a[7]=t=>G("clear"))},{default:l(()=>[p(c(e.$t("common.clear")),1)]),_:1}),o(K,{type:"primary",onClick:G,size:"small"},{default:l(()=>[p(c(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"])])]),_:1},8,["label"])):m("",!0),o(b,{prop:"nickname",label:e.$t("common.creator"),"show-overflow-tooltip":""},null,8,["label"]),o(b,{label:e.$t("views.document.table.updateTime"),width:"180"},{default:l(({row:t})=>[p(c(C(Q)(t.update_time)),1)]),_:1},8,["label"]),o(b,{label:e.$t("common.createTime"),width:"180"},{default:l(({row:t})=>[p(c(C(Q)(t.createTime)),1)]),_:1},8,["label"]),o(b,{label:e.$t("common.operation"),align:"left",width:"120",fixed:"right"},{default:l(({row:t})=>[o(q,{effect:"dark",content:e.$t("views.system.resource_management.management"),placement:"top"},{default:l(()=>[Y()?(s(),$("span",Ge,[o(K,{type:"primary",text:"",title:e.$t("views.system.resource_management.management"),onClick:h=>C(P).push({path:`/knowledge/${t.id}/resource-management/document`})},{default:l(()=>[o(g,{iconName:"app-admin-operation"})]),_:2},1032,["title","onClick"])])):m("",!0)]),_:2},1032,["content"]),o(q,{effect:"dark",content:e.$t("views.knowledge.setting.vectorization"),placement:"top"},{default:l(()=>[u("span",Oe,[i.value.vector()?(s(),r(K,{key:0,type:"primary",text:"",title:e.$t("views.knowledge.setting.vectorization"),onClick:_(h=>ae(t),["stop"])},{default:l(()=>[o(g,{iconName:"app-vectorization"})]),_:2},1032,["title","onClick"])):m("",!0)])]),_:2},1032,["content"]),j()?(s(),r(_e,{key:0,trigger:"click"},{dropdown:l(()=>[o(ge,null,{default:l(()=>[t.type===1&&i.value.sync()?(s(),r(x,{key:0,onClick:_(h=>le(t),["stop"])},{default:l(()=>[o(g,{iconName:"app-sync",class:"color-secondary"}),p(" "+c(e.$t("views.knowledge.setting.sync")),1)]),_:2},1032,["onClick"])):m("",!0),i.value.generate()?(s(),r(x,{key:1,onClick:_(h=>oe(t),["stop"])},{default:l(()=>[o(g,{iconName:"app-generate-question",class:"color-secondary"}),p(" "+c(e.$t("views.document.generateQuestion.title")),1)]),_:2},1032,["onClick"])):m("",!0),i.value.edit()?(s(),r(x,{key:2,onClick:h=>C(P).push({path:`/knowledge/${t.id}/resource-management/setting`})},{default:l(()=>[o(g,{iconName:"app-setting",class:"color-secondary"}),p(" "+c(e.$t("common.setting")),1)]),_:2},1032,["onClick"])):m("",!0),i.value.export()?(s(),r(x,{key:3,onClick:_(h=>X(t),["stop"])},{default:l(()=>[o(g,{iconName:"app-export",class:"color-secondary"}),p(c(e.$t("views.document.setting.export"))+" Excel ",1)]),_:2},1032,["onClick"])):m("",!0),i.value.export()?(s(),r(x,{key:4,onClick:_(h=>ee(t),["stop"])},{default:l(()=>[o(g,{iconName:"app-export",class:"color-secondary"}),p(c(e.$t("views.document.setting.export"))+" ZIP",1)]),_:2},1032,["onClick"])):m("",!0),i.value.delete()?(s(),r(x,{key:5,type:"danger",onClick:_(h=>te(t),["stop"])},{default:l(()=>[o(g,{iconName:"app-delete",class:"color-secondary"}),p(" "+c(e.$t("common.delete")),1)]),_:2},1032,["onClick"])):m("",!0)]),_:2},1024)]),default:l(()=>[o(K,{text:"",onClick:a[8]||(a[8]=_(()=>{},["stop"]))},{default:l(()=>[o(g,{iconName:"app-more"})]),_:1})]),_:2},1024)):m("",!0)]),_:1},8,["label"])]),_:1},8,["data","pagination-config"])]),_:1}),o(Ne,{ref_key:"SyncWebDialogRef",ref:F},null,512),o(Te,{ref_key:"GenerateRelatedDialogRef",ref:A,apiType:"systemManage"},null,512)])}}});export{je as default};
