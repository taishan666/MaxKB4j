import{aJ as G,aP as $,bo as ce,aQ as s,aL as C,aM as f,aR as o,a_ as x,aS as n,aT as e,aW as t,b1 as Q,b7 as K,b8 as J,aV as g,aU as B,bt as de,bi as he,ft as _e,aK as H,fl as Le,bk as Te,bf as E,aO as A,fu as re,b9 as W,aY as pe,bn as le,be as $e,bg as be,aZ as me,bl as ge,b0 as ve,cG as O,fv as Ve,bb as ye,f0 as Se,fw as ke,eN as Ce,ea as te,fx as Re,bj as ie}from"./chat-DmcU5C5M.js";import{_ as we}from"./ParagraphForm.vue_vue_type_script_setup_true_lang-BH1AugAr.js";const Fe={class:"bold title p-24",style:{"padding-bottom":"0"}},De={class:"flex align-center"},Me={class:"p-24",style:{"padding-top":"16px"}},Ue={key:1,class:"p-24"},ze={class:"dialog-footer"},Pe=G({__name:"EditParagraphDialog",props:{isConnect:Boolean,knowledgeId:String},emits:["updateContent"],setup(M,{expose:P,emit:F}){const L=F,S=$(!1),b=$({}),D=$(),T=$(),r=$(!1),i=$("");ce(S,p=>{p||(b.value={})});const d=p=>{b.value=de.cloneDeep(p),S.value=!0};function y(p,_){b.value.problem_list.splice(_,1)}function R(){var p,_,V;i.value.trim()&&((p=b.value)!=null&&p.problem_list.some(v=>v.content===i.value.trim())||(V=(_=b.value)==null?void 0:_.problem_list)==null||V.push({content:i.value.trim()}),i.value="",r.value=!1)}function k(){r.value=!0,he(()=>{var p;(p=T.value)==null||p.focus()})}const U=async()=>{var p,_;await((p=D.value)==null?void 0:p.validate())&&(L("updateContent",{problem_list:b.value.problem_list,...(_=D.value)==null?void 0:_.form}),S.value=!1)};return P({open:d}),(p,_)=>{const V=s("el-col"),v=s("el-divider"),a=s("Plus"),c=s("el-icon"),h=s("el-button"),m=s("el-input"),l=s("auto-tooltip"),u=s("TagEllipsis"),q=s("el-scrollbar"),Z=s("el-row"),N=s("el-dialog");return f(),C(N,{title:p.$t("views.paragraph.editParagraph"),modelValue:S.value,"onUpdate:modelValue":_[3]||(_[3]=z=>S.value=z),width:"80%","destroy-on-close":"",class:"paragraph-dialog","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:o(()=>[e("span",ze,[n(h,{onClick:_[2]||(_[2]=B(z=>S.value=!1,["prevent"]))},{default:o(()=>[g(t(p.$t("common.cancel")),1)]),_:1}),n(h,{type:"primary",onClick:U},{default:o(()=>[g(t(p.$t("common.save")),1)]),_:1})])]),default:o(()=>[M.isConnect?(f(),C(Z,{key:0},{default:o(()=>[n(V,{span:18,class:"p-24"},{default:o(()=>[n(we,{ref_key:"paragraphFormRef",ref:D,data:b.value,isEdit:!0,"knowledge-id":M.knowledgeId},null,8,["data","knowledge-id"])]),_:1}),n(V,{span:6,class:"border-l",style:{width:"300px"}},{default:o(()=>[e("p",Fe,[e("span",De,[e("span",null,t(p.$t("views.paragraph.relatedProblem.title")),1),n(v,{direction:"vertical",class:"mr-4"}),n(h,{text:"",onClick:k},{default:o(()=>[n(c,null,{default:o(()=>[n(a)]),_:1})]),_:1})])]),n(q,{height:"500px"},{default:o(()=>[e("div",Me,[r.value?(f(),C(m,{key:0,modelValue:i.value,"onUpdate:modelValue":_[0]||(_[0]=z=>i.value=z),placeholder:p.$t("views.paragraph.relatedProblem.placeholder"),onChange:R,onBlur:_[1]||(_[1]=z=>r.value=!1),ref_key:"inputRef",ref:T,class:"mb-8"},null,8,["modelValue","placeholder"])):Q("",!0),(f(!0),x(K,null,J(b.value.problem_list,(z,X)=>(f(),C(u,{key:X,onClose:j=>y(z,X),class:"question-tag",type:"info",effect:"plain",closable:""},{default:o(()=>[n(l,{content:z.content},{default:o(()=>[g(t(z.content),1)]),_:2},1032,["content"])]),_:2},1032,["onClose"]))),128))])]),_:1})]),_:1})]),_:1})):(f(),x("div",Ue,[n(we,{ref_key:"paragraphFormRef",ref:D,data:b.value,isEdit:!0,"knowledge-id":M.knowledgeId},null,8,["data","knowledge-id"])]))]),_:1},8,["title","modelValue"])}}}),Ie={class:"flex-between"},xe={class:"lighter mt-12"},Ee={class:"lighter mt-12"},Ae=G({__name:"ParagraphList",props:{modelValue:{type:Array,default:()=>[]},isConnect:Boolean,knowledgeId:String},emits:["update:modelValue"],setup(M,{emit:P}){const F=$(30),L=$(1),S=$(0),b=$(),D=P,T=$(!1),r=$([]),i=M;_e(()=>{if(i.modelValue&&i.modelValue.length>0){const p=F.value*L.value;r.value=i.modelValue.slice(0,Math.min(p,i.modelValue.length))}}),_e(()=>{const _=F.value*L.value;r.value=i.modelValue.slice(0,Math.min(_,i.modelValue.length))});const d=H(()=>r.value),y=()=>{T.value=!0,setTimeout(()=>{L.value+=1,T.value=!1},100)},R=(p,_)=>{S.value=_+F.value*(L.value-1),b.value.open(p)},k=p=>{const _=[...i.modelValue];i.isConnect&&p.title&&!(p!=null&&p.problem_list.some(v=>v.content===p.title.trim()))&&p.problem_list.push({content:p.title.trim()}),_[S.value]=de.cloneDeep(p),D("update:modelValue",_);const V=S.value-F.value*(L.value-1);V>=0&&V<r.value.length&&(r.value[V]=de.cloneDeep(p))},U=(p,_)=>{Te(`${E("views.paragraph.delete.confirmTitle")}${p.title||"-"} ?`,E("views.paragraph.delete.confirmMessage"),{confirmButtonText:E("common.confirm"),confirmButtonClass:"color-danger"}).then(()=>{const V=[...i.modelValue];if(V.splice(_,1),D("update:modelValue",V),r.value.splice(_,1),i.modelValue.length>r.value.length*L.value){const v=i.modelValue[r.value.length*L.value];v&&r.value.push(v)}}).catch(()=>{})};return(p,_)=>{const V=s("AppIcon"),v=s("el-button"),a=s("el-text"),c=s("el-card");return f(),x("div",null,[n(Le,{size:d.value.length,total:M.modelValue.length,page_size:F.value,current_page:L.value,"onUpdate:current_page":_[0]||(_[0]=h=>L.value=h),onLoad:_[1]||(_[1]=h=>y()),loading:T.value},{default:o(()=>[(f(!0),x(K,null,J(d.value,(h,m)=>(f(),C(c,{key:m,shadow:"never",class:"card-never mb-16"},{default:o(()=>[e("div",Ie,[e("span",null,t(h.title||"-"),1),e("div",null,[n(v,{link:"",onClick:l=>R(h,m)},{default:o(()=>[n(V,{iconName:"app-edit"})]),_:2},1032,["onClick"]),n(v,{link:"",onClick:l=>U(h,m)},{default:o(()=>[n(V,{iconName:"app-delete"})]),_:2},1032,["onClick"])])]),e("div",xe,t(h.content),1),e("div",Ee,[n(a,{type:"info"},{default:o(()=>[g(t(h.content.length)+" "+t(p.$t("views.paragraph.character_count")),1)]),_:2},1024)])]),_:2},1024))),128))]),_:1},8,["size","total","page_size","current_page","loading"]),n(Pe,{ref_key:"EditParagraphDialogRef",ref:b,onUpdateContent:k,isConnect:M.isConnect,"knowledge-id":M.knowledgeId},null,8,["isConnect","knowledge-id"])])}}}),Be={class:"flex-center"},He=["src"],Ne={class:"ml-4"},Xe={class:"mb-16"},qe={key:0,class:"paragraph-list"},Qe=G({__name:"ParagraphPreview",props:{data:{type:Array,default:()=>[]},isConnect:Boolean,knowledgeId:String},setup(M){const P=$(0);return(F,L)=>{const S=s("el-text"),b=s("el-scrollbar"),D=s("el-tab-pane"),T=s("el-tabs");return f(),C(T,{modelValue:P.value,"onUpdate:modelValue":L[0]||(L[0]=r=>P.value=r),class:"paragraph-tabs"},{default:o(()=>[(f(!0),x(K,null,J(M.data,(r,i)=>(f(),C(D,{key:i,label:r.name,name:i},{label:o(()=>[e("div",Be,[e("img",{src:A(re)(r&&(r==null?void 0:r.name)),alt:"",height:"16"},null,8,He),e("span",Ne,t(r==null?void 0:r.name),1)])]),default:o(()=>[e("div",Xe,[n(S,{type:"info"},{default:o(()=>[g(t(r.content.length)+" "+t(F.$t("views.paragraph.title")),1)]),_:2},1024)]),P.value==i?(f(),x("div",qe,[n(b,null,{default:o(()=>[n(Ae,{modelValue:r.content,"onUpdate:modelValue":d=>r.content=d,isConnect:M.isConnect,"knowledge-id":M.knowledgeId},null,8,["modelValue","onUpdate:modelValue","isConnect","knowledge-id"])]),_:2},1024)])):Q("",!0)]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])}}}),Ze=W(Qe,[["__scopeId","data-v-c20b8d02"]]),Oe={class:"set-rules"},je={class:"title-decoration-1 mb-16"},Ke={class:"set-rules__right"},Ge={class:"mb-4"},Je={class:"mb-4"},We={class:"set-rules__form"},Ye={class:"form-item mb-16"},et={class:"title flex align-center mb-8"},tt={style:{"margin-right":"4px"}},lt={class:"form-item mb-16"},ot={class:"title mb-8"},nt={class:"form-item mb-16"},st={class:"title mb-8"},at={style:{"margin-top":"4px"}},it={class:"text-right mt-8"},ut={class:"title-decoration-1 mb-8"},dt=G({__name:"SetRules",setup(M,{expose:P}){const{knowledge:F}=pe(),L=H(()=>F.documentsFiles),S=$([]),b=le(),{query:{id:D}}=b,T=H(()=>b.path.includes("shared")?"systemShare":b.path.includes("resource-management")?"systemManage":"workspace"),r=$("1"),i=$(!1),d=$([]),y=$(!1),R=$(!1),k=$(!0),U=$e({patterns:[],limit:500,with_filter:!0});function p(v){v&&k.value&&(d.value=d.value.map(a=>({...a,content:a.content.map(c=>({...c,problem_list:c.title.trim()?[{content:c.title.trim()}]:[]}))})),k.value=!1)}function _(){i.value=!0;const v=new FormData;L.value.forEach(a=>{a!=null&&a.raw&&v.append("file",a==null?void 0:a.raw)}),r.value==="2"&&Object.keys(U).forEach(a=>{a=="patterns"?U.patterns.forEach(c=>v.append("patterns",c)):v.append(a,U[a])}),O({type:"document",systemType:T.value}).postSplitDocument(D,v).then(a=>{const c=a.data;c.map(h=>{h.name.length>128&&(h.name=Ve(h.name,128)),R.value&&h.content.map(m=>{m.problem_list=m.title.trim()?[{content:m.title.trim()}]:[]})}),d.value=c,i.value=!1}).catch(()=>{i.value=!1})}const V=()=>{O({type:"document",systemType:T.value}).listSplitPattern(D,y).then(v=>{S.value=v.data})};return ce(r,()=>{r.value==="2"&&V()}),be(()=>{_()}),P({paragraphList:d,checkedConnect:R,loading:i}),(v,a)=>{const c=s("el-text"),h=s("el-radio"),m=s("el-card"),l=s("AppIcon"),u=s("el-tooltip"),q=s("el-option"),Z=s("el-select"),N=s("el-slider"),z=s("el-switch"),X=s("el-radio-group"),j=s("el-scrollbar"),oe=s("el-checkbox"),ne=s("el-button"),Y=s("el-col"),se=s("el-row"),ae=me("loading");return f(),x("div",Oe,[n(se,null,{default:o(()=>[n(Y,{span:10,class:"p-24"},{default:o(()=>[e("h4",je,t(v.$t("views.document.setRules.title.setting")),1),e("div",Ke,[n(j,null,{default:o(()=>[e("div",{class:"left-height",onClick:a[5]||(a[5]=B(()=>{},["stop"]))},[n(X,{modelValue:r.value,"onUpdate:modelValue":a[4]||(a[4]=I=>r.value=I),class:"card__radio"},{default:o(()=>[n(m,{shadow:"never",class:ge(["mb-16",r.value==="1"?"active":""])},{default:o(()=>[n(h,{value:"1",size:"large"},{default:o(()=>[e("p",Ge,t(v.$t("views.document.setRules.intelligent.label")),1),n(c,{type:"info"},{default:o(()=>[g(t(v.$t("views.document.setRules.intelligent.text")),1)]),_:1})]),_:1})]),_:1},8,["class"]),n(m,{shadow:"never",class:ge(["mb-16",r.value==="2"?"active":""])},{default:o(()=>[n(h,{value:"2",size:"large"},{default:o(()=>[e("p",Je,t(v.$t("views.document.setRules.advanced.label")),1),n(c,{type:"info"},{default:o(()=>[g(t(v.$t("views.document.setRules.advanced.text")),1)]),_:1})]),_:1}),r.value==="2"?(f(),C(m,{key:0,shadow:"never",class:"card-never mt-16",style:{"margin-left":"30px"}},{default:o(()=>[e("div",We,[e("div",Ye,[e("div",et,[e("span",tt,t(v.$t("views.document.setRules.patterns.label")),1),n(u,{effect:"dark",content:v.$t("views.document.setRules.patterns.tooltip"),placement:"right"},{default:o(()=>[n(l,{iconName:"app-warning",class:"app-warning-icon"})]),_:1},8,["content"])]),e("div",{onClick:a[1]||(a[1]=B(()=>{},["stop"]))},[n(Z,{modelValue:U.patterns,"onUpdate:modelValue":a[0]||(a[0]=I=>U.patterns=I),multiple:"","allow-create":"","default-first-option":"",filterable:"",placeholder:v.$t("views.document.setRules.patterns.placeholder")},{default:o(()=>[(f(!0),x(K,null,J(S.value,(I,ee)=>(f(),C(q,{key:ee,label:I.key,value:I.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])])]),e("div",lt,[e("div",ot,t(v.$t("views.document.setRules.limit.label")),1),n(N,{modelValue:U.limit,"onUpdate:modelValue":a[2]||(a[2]=I=>U.limit=I),"show-input":"","show-input-controls":!1,min:50,max:1e5},null,8,["modelValue"])]),e("div",nt,[e("div",st,t(v.$t("views.document.setRules.with_filter.label")),1),n(z,{size:"small",modelValue:U.with_filter,"onUpdate:modelValue":a[3]||(a[3]=I=>U.with_filter=I)},null,8,["modelValue"]),e("div",at,[n(c,{type:"info"},{default:o(()=>[g(t(v.$t("views.document.setRules.with_filter.text")),1)]),_:1})])])])]),_:1})):Q("",!0)]),_:1},8,["class"])]),_:1},8,["modelValue"])])]),_:1}),e("div",null,[n(oe,{modelValue:R.value,"onUpdate:modelValue":a[6]||(a[6]=I=>R.value=I),onChange:p,style:{"white-space":"normal"}},{default:o(()=>[g(t(v.$t("views.document.setRules.checkedConnect.label")),1)]),_:1},8,["modelValue"])]),e("div",it,[n(ne,{onClick:_},{default:o(()=>[g(t(v.$t("views.document.buttons.preview")),1)]),_:1})])])]),_:1}),n(Y,{span:14,class:"p-24 border-l"},{default:o(()=>[ve((f(),x("div",null,[e("h4",ut,t(v.$t("views.document.setRules.title.preview")),1),n(Ze,{data:d.value,"onUpdate:data":a[7]||(a[7]=I=>d.value=I),isConnect:R.value,"knowledge-id":A(D)},null,8,["data","isConnect","knowledge-id"])])),[[ae,i.value]])]),_:1})]),_:1})])}}}),ct=W(dt,[["__scopeId","data-v-f7dfc923"]]),rt={class:"mt-8"},pt={class:"bold"},mt={class:"bold"},vt={class:"bold"},ft={class:"result-success"},_t={class:"bolder"},gt={class:"flex-between"},wt={class:"flex"},ht=["src"],$t={class:"ml-8"},bt=G({__name:"ResultSuccess",props:{data:{type:Object,default:()=>{}}},setup(M){const P=M,F=ye(),L=le(),{params:{id:S,folderId:b}}=L,D=H(()=>L.path.includes("shared")?"systemShare":L.path.includes("resource-management")?"systemManage":"workspace"),T=H(()=>{var i;return(i=P.data)==null?void 0:i.documentList.reduce((d,y)=>d+=y.paragraph_count,0)}),r=H(()=>{var i;return((i=P.data)==null?void 0:i.documentList.reduce((d,y)=>d+=y.charLength,0))||0});return(i,d)=>{const y=s("el-text"),R=s("el-divider"),k=s("el-button"),U=s("el-result"),p=s("SuccessFilled"),_=s("el-icon"),V=s("CircleCloseFilled"),v=s("Loading"),a=s("el-card"),c=s("el-scrollbar");return f(),C(c,null,{default:o(()=>{var h;return[n(U,{icon:"color-success",title:`沁 ${i.$t("views.knowledge.ResultSuccess.title")} 沁荏},{"sub-title":o(()=>{var m;return[e("div",rt,[e("span",pt,t(((m=M.data)==null?void 0:m.documentList.length)||0),1),n(y,{type:"info",class:"ml-4"},{default:o(()=>[g(t(i.$t("common.fileUpload.document")),1)]),_:1}),n(R,{direction:"vertical"}),e("span",mt,t(T.value||0),1),n(y,{type:"info",class:"ml-4"},{default:o(()=>[g(t(i.$t("views.knowledge.ResultSuccess.paragraph")),1)]),_:1}),n(R,{direction:"vertical"}),e("span",vt,t(A(Se)(r.value)||0),1),n(y,{type:"info",class:"ml-4"},{default:o(()=>[g(t(i.$t("common.character")),1)]),_:1})])]}),extra:o(()=>[D.value==="workspace"?(f(),C(k,{key:0,onClick:d[0]||(d[0]=m=>A(F).push({path:"/knowledge"}))},{default:o(()=>[g(t(i.$t("views.knowledge.ResultSuccess.buttons.toknowledge")),1)]),_:1})):(f(),C(k,{key:1,onClick:d[1]||(d[1]=m=>A(F).push({path:`/system/${A(b)}/knowledge`}))},{default:o(()=>[g(t(i.$t("views.knowledge.ResultSuccess.buttons.toknowledge")),1)]),_:1})),n(k,{type:"primary",onClick:d[2]||(d[2]=m=>{var l;return A(F).push({path:`/knowledge/${(l=M.data)==null?void 0:l.id}/${A(b)}/document`})})},{default:o(()=>[g(t(i.$t("views.knowledge.ResultSuccess.buttons.toDocument")),1)]),_:1})]),_:1},8,["title"]),e("div",ft,[e("p",_t,t(i.$t("views.knowledge.ResultSuccess.documentList")),1),(f(!0),x(K,null,J((h=M.data)==null?void 0:h.documentList,(m,l)=>(f(),C(a,{shadow:"never",class:"file-List-card mt-8",key:l},{default:o(()=>[e("div",gt,[e("div",wt,[e("img",{src:A(re)(m&&(m==null?void 0:m.name)),alt:"",width:"40"},null,8,ht),e("div",$t,[e("p",null,t(m&&(m==null?void 0:m.name)),1),n(y,{type:"info",size:"small"},{default:o(()=>[g(t(A(ke)(m&&(m==null?void 0:m.charLength))),1)]),_:2},1024)])]),e("div",null,[n(y,{type:"info",class:"mr-16"},{default:o(()=>[g(t(m&&(m==null?void 0:m.paragraph_count))+" "+t(i.$t("views.knowledge.ResultSuccess.paragraph_count")),1)]),_:2},1024),m.status==="1"?(f(),C(y,{key:0},{default:o(()=>[n(_,{class:"color-success"},{default:o(()=>[n(p)]),_:1})]),_:1})):m.status==="2"?(f(),C(y,{key:1},{default:o(()=>[n(_,{class:"color-danger"},{default:o(()=>[n(V)]),_:1})]),_:1})):m.status==="0"?(f(),C(y,{key:2},{default:o(()=>[n(_,{class:"is-loading primary"},{default:o(()=>[n(v)]),_:1}),g(" "+t(i.$t("views.knowledge.ResultSuccess.loading"))+"... ",1)]),_:1})):Q("",!0)])])]),_:2},1024))),128))])]}),_:1})}}}),yt=W(bt,[["__scopeId","data-v-a7787e3d"]]),ue="data:image/svg+xml,%3csvg%20width='40'%20height='40'%20viewBox='0%200%2040%2040'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M33.0404%2011.3738C33.2279%2011.5614%2033.3333%2011.8157%2033.3333%2012.0809V34.8149C33.3333%2035.8376%2032.5374%2036.6667%2031.5555%2036.6667H8.4444C7.46256%2036.6667%206.66663%2035.8376%206.66663%2034.8149V5.18523C6.66663%204.16248%207.46256%203.33337%208.4444%203.33337H24.5857C24.851%203.33337%2025.1053%203.43873%2025.2929%203.62627L33.0404%2011.3738Z'%20fill='%233370FF'/%3e%3cpath%20d='M20.6509%2015.8135C20.3173%2015.3965%2019.683%2015.3965%2019.3494%2015.8135L14.4166%2021.9795C13.9801%2022.5251%2014.3686%2023.3334%2015.0673%2023.3334H18.3335V26.6667H21.6668V23.3334H24.9329C25.6317%2023.3334%2026.0202%2022.5251%2025.5837%2021.9795L20.6509%2015.8135Z'%20fill='white'/%3e%3cpath%20d='M18.3335%2030.0001V28.3334H21.6668V30.0001H18.3335Z'%20fill='white'/%3e%3cpath%20d='M25%203.33337L33.3333%2011.6667H26.6667C25.7462%2011.6667%2025%2010.9205%2025%2010V3.33337Z'%20fill='%232B5FD9'/%3e%3c/svg%3e",kt={class:"title-decoration-1 mb-8"},Ct={class:"mt-16 mb-16"},Lt={class:"update-info flex p-8-12 border-r-6 mb-16 w-full"},Tt={class:"mt-4"},Vt={class:"ml-16 lighter"},St={class:"el-upload__text"},Rt={class:"upload__decoration"},Ft={class:"update-info flex p-8-12 border-r-6 mb-16 w-full"},Dt={class:"mt-4"},Mt={class:"ml-16 lighter"},Ut={class:"el-upload__text"},zt={class:"upload__decoration"},Pt={class:"update-info flex p-8-12 border-r-6 mb-16 w-full"},It={class:"mt-4"},xt={class:"ml-16 lighter"},Et={class:"el-upload__text"},At={class:"upload__decoration"},Bt={class:"flex-between"},Ht={class:"flex"},Nt=["src"],Xt={class:"ml-8"},qt=G({__name:"UploadComponent",setup(M,{expose:P}){const F=le(),{query:{id:L}}=F,S=H(()=>F.path.includes("shared")?"systemShare":F.path.includes("resource-management")?"systemManage":"workspace"),{knowledge:b}=pe(),D=H(()=>b.documentsFiles),T=H(()=>b.documentsType),r=$(),i=$(!1),d=$({fileType:"txt",fileList:[]}),y=$e({fileList:[{required:!0,message:E("views.document.upload.requiredMessage"),trigger:"change"}]}),R=$(50),k=$(100);ce(d.value,l=>{b.saveDocumentsType(l.fileType),b.saveDocumentsFile(l.fileList)});function U(l){O({type:"document",systemType:S.value}).exportQATemplate(`${l}${E("views.document.upload.template")}.${l=="csv"?l:"xlsx"}`,l)}function p(l){O({type:"document",systemType:S.value}).exportTableTemplate(`${l}${E("views.document.upload.template")}.${l=="csv"?l:"xlsx"}`,l)}function _(){d.value.fileList=[]}function V(l){d.value.fileList.splice(l,1)}const v=(l,u)=>{if(!((l==null?void 0:l.size)/1024/1024<k.value))return te(E("views.document.tip.fileLimitSizeTip1")+k.value+"MB"),u.splice(-1,1),!1;if(!Re(l==null?void 0:l.name,d.value.fileType))return(l==null?void 0:l.name)!==".DS_Store"&&te(E("views.document.upload.errorMessage2")),u.splice(-1,1),!1;if((l==null?void 0:l.size)===0)return te(E("views.document.upload.errorMessage3")),u.splice(-1,1),!1},a=()=>{te(E("views.document.tip.fileLimitCountTip1")+R.value+E("views.document.tip.fileLimitCountTip2"))},c=l=>{let u=null;he(()=>{document.querySelector(".el-upload__input")!=null&&(u=document.querySelector(".el-upload__input"),u.webkitdirectory=l)})};function h(){if(r.value)return r.value.validate(l=>l)}function m(){O({type:"knowledge",systemType:S.value}).getKnowledgeDetail(L,i).then(l=>{R.value=l.data.fileCountLimit,k.value=l.data.fileSizeLimit})}return be(()=>{T.value&&(d.value.fileType=T.value),D.value&&(d.value.fileList=D.value),m()}),Ce(()=>{d.value={fileType:"txt",fileList:[]}}),P({validate:h,form:d}),(l,u)=>{var ee;const q=s("el-radio-button"),Z=s("el-radio-group"),N=s("AppIcon"),z=s("el-button"),X=s("el-upload"),j=s("el-form-item"),oe=s("el-form"),ne=s("el-text"),Y=s("el-card"),se=s("el-col"),ae=s("el-row"),I=me("loading");return f(),x(K,null,[e("h4",kt,t(l.$t("views.document.uploadDocument")),1),ve((f(),C(oe,{ref_key:"FormRef",ref:r,model:d.value,rules:y,"label-position":"top","require-asterisk-position":"right"},{default:o(()=>[e("div",Ct,[n(Z,{modelValue:d.value.fileType,"onUpdate:modelValue":u[0]||(u[0]=w=>d.value.fileType=w),onChange:_,class:"app-radio-button-group"},{default:o(()=>[n(q,{value:"txt"},{default:o(()=>[g(t(l.$t("views.document.fileType.txt.label")),1)]),_:1}),n(q,{value:"table"},{default:o(()=>[g(t(l.$t("views.document.fileType.table.label")),1)]),_:1}),n(q,{value:"QA"},{default:o(()=>[g(t(l.$t("views.document.fileType.QA.label")),1)]),_:1})]),_:1},8,["modelValue"])]),d.value.fileType==="QA"?(f(),C(j,{key:0,prop:"fileList"},{default:o(()=>[e("div",Lt,[e("div",Tt,[n(N,{iconName:"app-warning-colorful",style:{"font-size":"16px"}})]),e("div",Vt,[e("p",null,[g(t(l.$t("views.document.fileType.QA.tip1"))+" ",1),n(z,{type:"primary",link:"",onClick:u[1]||(u[1]=w=>U("excel"))},{default:o(()=>[g(t(l.$t("views.document.upload.download"))+" Excel "+t(l.$t("views.document.upload.template")),1)]),_:1}),n(z,{type:"primary",link:"",onClick:u[2]||(u[2]=w=>U("csv"))},{default:o(()=>[g(t(l.$t("views.document.upload.download"))+" CSV "+t(l.$t("views.document.upload.template")),1)]),_:1})]),e("p",null,t(l.$t("views.document.fileType.QA.tip2")),1),e("p",null," 3. "+t(l.$t("views.document.tip.fileLimitCountTip1"))+" "+t(R.value)+" "+t(l.$t("views.document.tip.fileLimitCountTip2"))+", "+t(l.$t("views.document.tip.fileLimitSizeTip1"))+" "+t(k.value)+" MB ",1)])]),n(X,{webkitdirectory:!1,class:"w-full mb-4",drag:"",multiple:"","file-list":d.value.fileList,"onUpdate:fileList":u[5]||(u[5]=w=>d.value.fileList=w),action:"#","auto-upload":!1,"show-file-list":!1,accept:".xlsx, .xls, .csv,.zip",limit:R.value,"on-exceed":a,"on-change":v,onClick:u[6]||(u[6]=B(w=>c(!1),["prevent"]))},{default:o(()=>[u[17]||(u[17]=e("img",{src:ue,alt:""},null,-1)),e("div",St,[e("p",null,[g(t(l.$t("views.document.upload.uploadMessage"))+" ",1),e("em",{class:"hover",onClick:u[3]||(u[3]=B(w=>c(!1),["prevent"]))},t(l.$t("views.document.upload.selectFile")),1),e("em",{class:"hove ml-4",onClick:u[4]||(u[4]=B(w=>c(!0),["prevent"]))},t(l.$t("views.document.upload.selectFiles")),1)]),e("div",Rt,[e("p",null,t(l.$t("views.document.upload.formats"))+"XLS縲々LSX縲，SV縲〇IP",1)])])]),_:1,__:[17]},8,["file-list","limit"])]),_:1})):d.value.fileType==="table"?(f(),C(j,{key:1,prop:"fileList"},{default:o(()=>[e("div",Ft,[e("div",Dt,[n(N,{iconName:"app-warning-colorful",style:{"font-size":"16px"}})]),e("div",Mt,[e("p",null,[g(t(l.$t("views.document.fileType.table.tip1"))+" ",1),n(z,{type:"primary",link:"",onClick:u[7]||(u[7]=w=>p("excel"))},{default:o(()=>[g(t(l.$t("views.document.upload.download"))+" Excel "+t(l.$t("views.document.upload.template")),1)]),_:1}),n(z,{type:"primary",link:"",onClick:u[8]||(u[8]=w=>p("csv"))},{default:o(()=>[g(t(l.$t("views.document.upload.download"))+" CSV "+t(l.$t("views.document.upload.template")),1)]),_:1})]),e("p",null,t(l.$t("views.document.fileType.table.tip2")),1),e("p",null,t(l.$t("views.document.fileType.table.tip3")),1),e("p",null," 4. "+t(l.$t("views.document.tip.fileLimitCountTip1"))+" "+t(R.value)+" "+t(l.$t("views.document.tip.fileLimitCountTip2"))+", "+t(l.$t("views.document.tip.fileLimitSizeTip1"))+" "+t(k.value)+" MB ",1)])]),n(X,{webkitdirectory:!1,class:"w-full mb-4",drag:"",multiple:"","file-list":d.value.fileList,"onUpdate:fileList":u[11]||(u[11]=w=>d.value.fileList=w),action:"#","auto-upload":!1,"show-file-list":!1,accept:".xlsx, .xls, .csv",limit:R.value,"on-exceed":a,"on-change":v,onClick:u[12]||(u[12]=B(w=>c(!1),["prevent"]))},{default:o(()=>[u[18]||(u[18]=e("img",{src:ue,alt:""},null,-1)),e("div",Ut,[e("p",null,[g(t(l.$t("views.document.upload.uploadMessage"))+" ",1),e("em",{class:"hover",onClick:u[9]||(u[9]=B(w=>c(!1),["prevent"]))},t(l.$t("views.document.upload.selectFile")),1),e("em",{class:"hover ml-4",onClick:u[10]||(u[10]=B(w=>c(!0),["prevent"]))},t(l.$t("views.document.upload.selectFiles")),1)]),e("div",zt,[e("p",null,t(l.$t("views.document.upload.formats"))+"XLS縲々LSX縲，SV",1)])])]),_:1,__:[18]},8,["file-list","limit"])]),_:1})):(f(),C(j,{key:2,prop:"fileList"},{default:o(()=>[e("div",Pt,[e("div",It,[n(N,{iconName:"app-warning-colorful",style:{"font-size":"16px"}})]),e("div",xt,[e("p",null,t(l.$t("views.document.fileType.txt.tip1")),1),e("p",null," 2. "+t(l.$t("views.document.tip.fileLimitCountTip1"))+" "+t(R.value)+" "+t(l.$t("views.document.tip.fileLimitCountTip2"))+", "+t(l.$t("views.document.tip.fileLimitSizeTip1"))+" "+t(k.value)+" MB ",1)])]),n(X,{webkitdirectory:!1,class:"w-full",drag:"",multiple:"","file-list":d.value.fileList,"onUpdate:fileList":u[15]||(u[15]=w=>d.value.fileList=w),action:"#","auto-upload":!1,"show-file-list":!1,accept:".txt, .md, .log, .docx, .pdf, .html,.zip,.xlsx,.xls,.csv",limit:R.value,"on-exceed":a,"on-change":v,onClick:u[16]||(u[16]=B(w=>c(!1),["prevent"]))},{default:o(()=>[u[19]||(u[19]=e("img",{src:ue,alt:""},null,-1)),e("div",Et,[e("p",null,[g(t(l.$t("views.document.upload.uploadMessage"))+" ",1),e("em",{class:"hover",onClick:u[13]||(u[13]=B(w=>c(!1),["prevent"]))},t(l.$t("views.document.upload.selectFile")),1),e("em",{class:"hover ml-4",onClick:u[14]||(u[14]=B(w=>c(!0),["prevent"]))},t(l.$t("views.document.upload.selectFiles")),1)]),e("div",At,[e("p",null,t(l.$t("views.document.upload.formats"))+"TXT縲｀arkdown縲￣DF縲．OCX縲？TML縲々LS縲々LSX縲，SV縲〇IP ",1)])])]),_:1,__:[19]},8,["file-list","limit"])]),_:1}))]),_:1},8,["model","rules"])),[[I,i.value]]),(ee=d.value.fileList)!=null&&ee.length?(f(),C(ae,{key:0,gutter:8},{default:o(()=>[(f(!0),x(K,null,J(d.value.fileList,(w,fe)=>(f(),C(se,{key:fe,span:12,class:"mb-8"},{default:o(()=>[n(Y,{shadow:"never",class:"file-List-card"},{default:o(()=>[e("div",Bt,[e("div",Ht,[e("img",{src:A(re)(w&&(w==null?void 0:w.name)),alt:"",width:"40"},null,8,Nt),e("div",Xt,[e("p",null,t(w&&(w==null?void 0:w.name)),1),n(ne,{type:"info",size:"small"},{default:o(()=>[g(t(A(ke)(w&&(w==null?void 0:w.size))||"0K"),1)]),_:2},1024)])]),n(z,{text:"",onClick:el=>V(fe)},{default:o(()=>[n(N,{iconName:"app-delete"})]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):Q("",!0)],64)}}}),Qt=W(qt,[["__scopeId","data-v-de488c7f"]]),Zt={class:"upload-document p-12-24"},Ot={class:"flex align-center mb-16"},jt={style:{display:"inline-block"}},Kt={class:"upload-document__main flex"},Gt={class:"upload-document__component main-calc-height"},Jt={key:0,class:"upload-component p-24"},Wt={key:0,class:"upload-document__footer text-right border-t"},Yt=G({__name:"UploadDocument",setup(M){const{knowledge:P}=pe(),F=H(()=>P.documentsFiles),L=H(()=>P.documentsType),S=ye(),b=le(),{params:{folderId:D},query:{id:T}}=b,r=H(()=>b.path.includes("shared")?"systemShare":b.path.includes("resource-management")?"systemManage":"workspace"),i=$(),d=$(),y=$(!1),R=$(!1),k=$(0),U=$(null);async function p(){if(R.value=!0,await d.value.validate())if(L.value==="QA"){const a=new FormData;F.value.forEach(c=>{c!=null&&c.raw&&a.append("file",c==null?void 0:c.raw)}),T&&O({type:"document",systemType:r.value}).postQADocument(T,a,y).then(()=>{ie(E("common.submitSuccess")),V(),S.push({path:`/knowledge/${T}/${D}/document`})})}else if(L.value==="table"){const a=new FormData;F.value.forEach(c=>{c!=null&&c.raw&&a.append("file",c==null?void 0:c.raw)}),T&&O({type:"document",systemType:r.value}).postTableDocument(T,a,y).then(()=>{ie(E("common.submitSuccess")),V(),S.push({path:`/knowledge/${T}/${D}/document`})})}else k.value++>2&&(k.value=0);else R.value=!1}const _=()=>{k.value=0};function V(){P.saveDocumentsFile([]),P.saveDocumentsType("")}function v(){var c;y.value=!0;const a=[];(c=i.value)==null||c.paragraphList.map(h=>{var m;(m=i.value)!=null&&m.checkedConnect||h.content.map(l=>{delete l.problem_list}),a.push({name:h.name,paragraphs:h.content,source_file_id:h.source_file_id})}),T&&O({type:"document",systemType:r.value}).putMulDocument(T,a).then(()=>{ie(E("common.submitSuccess")),V(),S.push({path:`/knowledge/${T}/${D}/document`})}).catch(()=>{y.value=!1})}return Ce(()=>{V()}),(a,c)=>{var Z,N,z,X;const h=s("back-button"),m=s("el-scrollbar"),l=s("el-card"),u=s("el-button"),q=me("loading");return f(),x("div",Zt,[e("div",Ot,[n(h,{to:"-1",style:{"margin-left":"-4px"}}),e("h3",jt,t(a.$t("views.document.uploadDocument")),1)]),n(l,{style:{"--el-card-padding":"0"}},{default:o(()=>[ve((f(),x("div",Kt,[e("div",Gt,[n(m,null,{default:o(()=>[k.value===0?(f(),x("div",Jt,[n(Qt,{ref_key:"UploadComponentRef",ref:d},null,512)])):k.value===1?(f(),C(ct,{key:1,ref_key:"SetRulesRef",ref:i},null,512)):k.value===2?(f(),C(yt,{key:2,data:U.value},null,8,["data"])):Q("",!0)]),_:1})])])),[[q,y.value]])]),_:1}),k.value!==2?(f(),x("div",Wt,[n(u,{onClick:c[0]||(c[0]=j=>A(S).go(-1)),disabled:((Z=i.value)==null?void 0:Z.loading)||y.value},{default:o(()=>[g(t(a.$t("common.cancel")),1)]),_:1},8,["disabled"]),k.value===1?(f(),C(u,{key:0,onClick:_,disabled:((N=i.value)==null?void 0:N.loading)||y.value},{default:o(()=>[g(t(a.$t("views.document.buttons.prev")),1)]),_:1},8,["disabled"])):Q("",!0),k.value===0?(f(),C(u,{key:1,onClick:p,type:"primary",disabled:((z=i.value)==null?void 0:z.loading)||y.value},{default:o(()=>[g(t(L.value==="txt"?a.$t("views.document.buttons.next"):a.$t("views.document.buttons.import")),1)]),_:1},8,["disabled"])):Q("",!0),k.value===1?(f(),C(u,{key:2,onClick:v,type:"primary",disabled:((X=i.value)==null?void 0:X.loading)||y.value},{default:o(()=>[g(t(a.$t("views.document.buttons.import")),1)]),_:1},8,["disabled"])):Q("",!0)])):Q("",!0)])}}}),ol=W(Yt,[["__scopeId","data-v-aabad103"]]);export{ol as default};
