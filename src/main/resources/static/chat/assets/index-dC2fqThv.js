import{cu as ne,fS as ke,aJ as se,aP as i,aQ as s,aL as y,aM as r,aR as t,aT as n,aS as a,aW as u,aU as N,aV as V,aY as $e,be as Ve,bf as v,bg as Le,aZ as De,a_ as h,b0 as Ce,b1 as te,b8 as U,b9 as Y,aO as oe,cy as xe,fe as Oe,ba as Se}from"./chat-DICb8T2p.js";import{W as Me}from"./workspace-YKUAx1A7.js";const F="/operate_log",Ue=(L,_,d)=>ne(`${F}/${L.current_page}/${L.page_size}`,_,d),Ye=()=>ne(`${F}/menu_operation_option/`,void 0,void 0),ze=(L,_)=>{ke("log.xlsx",`${F}/export/`,L,void 0,_)},A={getOperateLog:Ue,getMenuList:Ye,exportOperateLog:ze},Ne={class:"border border-r-6 mb-16",style:{"white-space":"pre-wrap",height:"400px"}},Ee={class:"p-16"},Pe={class:"dialog-footer mt-16"},We=se({__name:"DetailDialog",setup(L,{expose:_}){const d=i(!1),c=i();return _({open:p=>{c.value=JSON.stringify(p.details,null,4),d.value=!0}}),(p,w)=>{const D=s("el-scrollbar"),C=s("el-button"),k=s("el-dialog");return r(),y(k,{title:p.$t("views.operateLog.table.opt.label"),modelValue:d.value,"onUpdate:modelValue":w[1]||(w[1]=S=>d.value=S),"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:t(()=>[n("span",Pe,[a(C,{onClick:w[0]||(w[0]=N(S=>d.value=!1,["prevent"]))},{default:t(()=>[V(u(p.$t("views.operateLog.close")),1)]),_:1})])]),default:t(()=>[n("div",Ne,[a(D,null,{default:t(()=>[n("div",Ee,u(c.value),1)]),_:1})])]),_:1},8,["title","modelValue"])}}}),je={class:"operate-log p-16-24"},Ae={class:"mb-16"},Fe={class:"p-24"},Re={class:"flex-between"},Te={style:{display:"flex"}},Be={class:"flex-between complex-search"},He={class:"filter"},Ie={class:"form-item mb-16"},Je={class:"text-right"},qe={class:"text-ellipsis"},Qe={class:"filter"},Ze={class:"form-item mb-16"},Ge={class:"text-right"},Ke={key:0},Xe={key:1,style:{color:"red"}},el={class:"mr-4"},ll=se({__name:"index",setup(L){const{user:_}=$e(),d=i(!1),c=i([]),O=i(!1),p=i([]),w=i(),D=i(!1),C=Ve({current_page:1,page_size:20,total:0}),k=i(""),S=i([]),z=i(7),$=i("user"),E=i(""),x=i({start_time:"",end_time:""}),R=i(""),ie=[{value:7,label:v("views.applicationOverview.monitor.pastDayOptions.past7Days")},{value:30,label:v("views.applicationOverview.monitor.pastDayOptions.past30Days")},{value:90,label:v("views.applicationOverview.monitor.pastDayOptions.past90Days")},{value:183,label:v("views.applicationOverview.monitor.pastDayOptions.past183Days")},{value:"other",label:v("common.custom")}],re=[{value:"user",label:v("views.operateLog.table.user.label")},{value:"status",label:v("views.operateLog.table.status.label")},{value:"ip_address",label:v("views.operateLog.table.ip_address.label")}],ue=[{value:"200",label:v("views.operateLog.table.status.success")},{value:"500",label:v("views.operateLog.table.status.fail")}],T=i([]),B=i([]);function H(e){e==="clear"&&(c.value=[]),m(),d.value=!1}function I(e){e==="clear"&&(p.value=[]),m(),O.value=!1}function pe(e){m()}function de(e){$.value=e,k.value&&m()}function J(e){e!=="other"&&(x.value.start_time=Oe(e),x.value.end_time="",m())}function ce(e){x.value.start_time=e[0],x.value.end_time=e[1],m()}function ve(e){w.value.open(e)}function me(){C.current_page=1,m()}function q(){let e={start_time:x.value.start_time,end_time:x.value.end_time};return k.value&&$.value!=="status"&&(e[$.value]=k.value),$.value==="status"&&(e.status=E.value),c.value.length>0&&(e.menu=JSON.stringify(c.value)),p.value.length>0&&(e.workspace_ids=JSON.stringify(p.value)),e}function m(){return A.getOperateLog(C,q(),D).then(e=>{S.value=e.data.records,C.total=e.data.total})}function _e(){return A.getMenuList().then(e=>{e.data.filter((f,M,P)=>M===P.findIndex(W=>W.menu===f.menu)).forEach(f=>{T.value.push({label:f.menu_label,value:f.menu})})})}const fe=()=>{A.exportOperateLog(q(),D)};async function be(){if(_.isEE()){const e=await Me.getSystemWorkspaceList(D);B.value=e.data.map(o=>({label:o.name,value:o.id}))}}return Le(()=>{_e(),be(),J(z.value)}),(e,o)=>{const f=s("el-option"),M=s("el-select"),P=s("el-date-picker"),W=s("el-input"),b=s("el-button"),Q=s("Filter"),Z=s("el-icon"),G=s("el-checkbox"),K=s("el-checkbox-group"),X=s("el-scrollbar"),ee=s("el-popover"),g=s("el-table-column"),le=s("el-tooltip"),ge=s("AppIcon"),he=s("app-table"),ye=s("el-card"),we=De("loading");return r(),h("div",je,[n("h2",Ae,u(e.$t("views.operateLog.title")),1),a(ye,{style:{"--el-card-padding":"0"},class:"main-calc-height"},{default:t(()=>[n("div",Fe,[n("div",Re,[n("div",null,[a(M,{modelValue:z.value,"onUpdate:modelValue":o[0]||(o[0]=l=>z.value=l),class:"mr-12",onChange:J,style:{width:"180px"}},{default:t(()=>[(r(),h(U,null,Y(ie,l=>a(f,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),z.value==="other"?(r(),y(P,{key:0,modelValue:R.value,"onUpdate:modelValue":o[1]||(o[1]=l=>R.value=l),type:"daterange","start-placeholder":e.$t("views.applicationOverview.monitor.startDatePlaceholder"),"end-placeholder":e.$t("views.applicationOverview.monitor.endDatePlaceholder"),format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:ce},null,8,["modelValue","start-placeholder","end-placeholder"])):te("",!0)]),n("div",Te,[n("div",Be,[a(M,{modelValue:$.value,"onUpdate:modelValue":o[2]||(o[2]=l=>$.value=l),class:"complex-search__left",onChange:de,style:{width:"120px"}},{default:t(()=>[(r(),h(U,null,Y(re,l=>a(f,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),$.value==="status"?(r(),y(M,{key:0,modelValue:E.value,"onUpdate:modelValue":o[3]||(o[3]=l=>E.value=l),onChange:pe,style:{width:"220px"},clearable:""},{default:t(()=>[(r(),h(U,null,Y(ue,l=>a(f,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])):(r(),y(W,{key:1,modelValue:k.value,"onUpdate:modelValue":o[4]||(o[4]=l=>k.value=l),onChange:m,placeholder:e.$t("common.search"),"prefix-icon":"Search",style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"]))]),a(b,{onClick:fe,style:{"margin-left":"10px"}},{default:t(()=>[V(u(e.$t("common.export")),1)]),_:1})])]),Ce((r(),y(he,{class:"mt-16",data:S.value,"pagination-config":C,onSizeChange:me,onChangePage:m},{default:t(()=>[a(g,{prop:"menu",label:e.$t("views.operateLog.table.menu.label"),width:"160"},{header:t(()=>[n("div",null,[n("span",null,u(e.$t("views.operateLog.table.menu.label")),1),a(ee,{width:200,trigger:"click",visible:d.value},{reference:t(()=>[a(b,{style:{"margin-top":"-2px"},type:c.value&&c.value.length>0?"primary":"",link:"",onClick:o[5]||(o[5]=l=>d.value=!d.value)},{default:t(()=>[a(Z,null,{default:t(()=>[a(Q)]),_:1})]),_:1},8,["type"])]),default:t(()=>[n("div",He,[n("div",Ie,[n("div",{onClick:o[7]||(o[7]=N(()=>{},["stop"]))},[a(X,{height:"300",style:{margin:"0 0 0 10px"}},{default:t(()=>[a(K,{modelValue:c.value,"onUpdate:modelValue":o[6]||(o[6]=l=>c.value=l),style:{display:"flex","flex-direction":"column"}},{default:t(()=>[(r(!0),h(U,null,Y(T.value,l=>(r(),y(G,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])])]),n("div",Je,[a(b,{size:"small",onClick:o[8]||(o[8]=l=>H("clear"))},{default:t(()=>[V(u(e.$t("common.clear")),1)]),_:1}),a(b,{type:"primary",onClick:H,size:"small"},{default:t(()=>[V(u(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"])])]),_:1},8,["label"]),a(g,{prop:"operate",label:e.$t("views.operateLog.table.operate.detail")},{default:t(({row:l})=>{var j;return[a(le,{content:l.operate+((j=l.operation_object)!=null&&j.name?`【${l.operation_object.name}】`:""),effect:"dark",placement:"top"},{default:t(()=>{var ae;return[n("span",qe,u(l.operate+((ae=l.operation_object)!=null&&ae.name?`【${l.operation_object.name}】`:"")),1)]}),_:2},1032,["content"])]}),_:1},8,["label"]),a(g,{width:"120",prop:"user.username",label:e.$t("views.operateLog.table.user.label")},null,8,["label"]),oe(_).isEE()?(r(),y(g,{key:0,width:"200",prop:"workspace_name",label:e.$t("views.workspace.title")},{header:t(()=>[n("div",null,[n("span",null,u(e.$t("views.workspace.title")),1),a(ee,{width:200,trigger:"click",visible:O.value},{reference:t(()=>[a(b,{style:{"margin-top":"-2px"},type:p.value&&p.value.length>0?"primary":"",link:"",onClick:o[9]||(o[9]=l=>O.value=!O.value)},{default:t(()=>[a(Z,null,{default:t(()=>[a(Q)]),_:1})]),_:1},8,["type"])]),default:t(()=>[n("div",Qe,[n("div",Ze,[n("div",{onClick:o[11]||(o[11]=N(()=>{},["stop"]))},[a(X,{height:"300",style:{margin:"0 0 0 10px"}},{default:t(()=>[a(K,{modelValue:p.value,"onUpdate:modelValue":o[10]||(o[10]=l=>p.value=l),style:{display:"flex","flex-direction":"column"}},{default:t(()=>[(r(!0),h(U,null,Y(B.value,l=>(r(),y(G,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])])]),n("div",Ge,[a(b,{size:"small",onClick:o[12]||(o[12]=l=>I("clear"))},{default:t(()=>[V(u(e.$t("common.clear")),1)]),_:1}),a(b,{type:"primary",onClick:I,size:"small"},{default:t(()=>[V(u(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"])])]),_:1},8,["label"])):te("",!0),a(g,{prop:"status",label:e.$t("views.operateLog.table.status.label"),width:"100"},{default:t(({row:l})=>[l.status===200?(r(),h("span",Ke,u(e.$t("views.operateLog.table.status.success")),1)):(r(),h("span",Xe,u(e.$t("views.operateLog.table.status.fail")),1))]),_:1},8,["label"]),a(g,{prop:"ip_address",label:e.$t("views.operateLog.table.ip_address.label"),width:"160"},null,8,["label"]),a(g,{label:e.$t("views.operateLog.table.operateTime.label"),width:"180"},{default:t(({row:l})=>[V(u(oe(xe)(l.createTime)),1)]),_:1},8,["label"]),a(g,{label:e.$t("common.operation"),width:"60",align:"left",fixed:"right"},{default:t(({row:l})=>[n("span",el,[a(le,{effect:"dark",content:e.$t("views.operateLog.table.opt.label"),placement:"top"},{default:t(()=>[a(b,{type:"primary",text:"",onClick:N(j=>ve(l),["stop"]),class:"text-button"},{default:t(()=>[a(ge,{iconName:"app-operate-log"})]),_:2},1032,["onClick"])]),_:2},1032,["content"])])]),_:1},8,["label"])]),_:1},8,["data","pagination-config"])),[[we,D.value]])]),a(We,{ref_key:"DetailDialogRef",ref:w},null,512)]),_:1})])}}}),ol=Se(ll,[["__scopeId","data-v-475ff2a5"]]);export{ol as default};
