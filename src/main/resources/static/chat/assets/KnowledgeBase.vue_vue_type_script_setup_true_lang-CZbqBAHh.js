import{ay as $,aA as z,b8 as A,b9 as u,aB as l,b7 as E,aC as M,ba as G,aD as b,aE as k,aF as f,aG as m,aI as C,aH as x,aJ as V,bc as H,bh as J,bi as j,bS as O,aK as P,bT as Q,bo as X,bU as Y,bV as W,b5 as _,bf as Z,bW as ee,bq as ae,br as te}from"./chat-BcZeCBLv.js";const oe={class:"title-decoration-1 mb-16 mt-4"},re={class:"flex align-center"},ie=$({__name:"DataSource",props:{workflow:{},knowledgeId:{},loading:{type:Boolean}},emits:["update:loading"],setup(y,{expose:h,emit:v}){const{user:D}=z(),d=A(),c=y,S=u(()=>d.path.includes("shared")?"systemShare":d.path.includes("resource-management")?"systemManage":"workspace"),I=l([]),B=u(()=>D.getWorkspaceId()),F=v,r=u({get:()=>c.loading,set:e=>{F("update:loading",e)}}),t=l(),o=l({nodeId:""}),n=l({}),g=u({get:()=>({...n.value,...o.value}),set:e=>{n.value=e}}),p=u(()=>{var e,a;return(a=(e=c.workflow)==null?void 0:e.nodes)==null?void 0:a.filter(i=>i.properties.kind===E.DataSource)}),L=l({current_tool_id:void 0});ee("get_extra",()=>L.value);const N=e=>{o.value.nodeId=e;const a=p.value.find(i=>i.id==e);a.properties.nodeData&&a.properties.nodeData.toolLibId&&(L.value.current_tool_id=a.properties.nodeData.toolLibId),e=a?[_.DataSourceLocalNode,_.DataSourceWebNode].includes(a.type)?a.type:a.properties.nodeData.toolLibId:e,Z({type:"knowledge",systemType:S.value}).getKnowledgeWorkflowFormList(c.knowledgeId,[_.DataSourceLocalNode,_.DataSourceWebNode].includes(a.type)?"local":"tool",e,a,r).then(i=>{var w;(w=t.value)==null||w.render(i.data)})},K=l({nodeId:{required:!0,trigger:"blur",message:M("views.tool.dataSource.requiredMessage")}}),q=()=>{var e;return(e=t.value)==null?void 0:e.validate()},R=()=>g.value;return G(p,()=>{o.value.nodeId||p.value&&p.value.length>0&&N(p.value[0].id)},{immediate:!0}),h({validate:q,get_data:R}),(e,a)=>{const i=b("el-card"),w=b("el-col"),T=b("el-row"),U=b("el-form-item");return f(),k(W,{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=s=>g.value=s),render_data:I.value,model:g.value,ref_key:"dynamicsFormRef",ref:t,"label-position":"top","require-asterisk-position":"right","other-params":{current_workspace_id:B.value,current_knowledge_id:e.knowledgeId}},{default:m(()=>[C("h4",oe,V(e.$t("views.tool.dataSource.selectDataSource")),1),x(U,{label:e.$t("views.tool.dataSource.title"),prop:"nodeId",rules:K.value.nodeId},{default:m(()=>[x(T,{class:"w-full",gutter:8},{default:m(()=>[(f(!0),H(J,null,j(p.value,s=>(f(),k(w,{span:8,key:s.id},{default:m(()=>[x(i,{shadow:"never",class:O(["card-checkbox cursor w-full mb-8",o.value.nodeId===s.id?"active":""]),style:{"--el-card-padding":"4px 12px"},onClick:ne=>N(s.id)},{default:m(()=>[C("div",re,[(f(),k(Q(X(Y)(`${s.type}-icon`)),{class:"mr-8",size:20,item:s==null?void 0:s.properties.nodeData},null,8,["item"])),P(" "+V(s.properties.nodeName),1)])]),_:2},1032,["class","onClick"])]),_:2},1024))),128))]),_:1})]),_:1},8,["label","rules"])]),_:1},8,["modelValue","render_data","model","other-params"])}}}),se={class:"title-decoration-1 mb-16 mt-4"},ue=$({__name:"KnowledgeBase",props:{workflow:{}},setup(y,{expose:h}){const v=y,D=l(),d=l({}),c=l(),S=()=>{var r;return(r=c.value)==null?void 0:r.validate()},I=u(()=>{var t,o;return((o=(t=v.workflow)==null?void 0:t.nodes)==null?void 0:o.find(n=>n.type===_.KnowledgeBase)).properties.userInputConfig.title}),B=u(()=>{var t,o;const r=(o=(t=v.workflow)==null?void 0:t.nodes)==null?void 0:o.find(n=>n.type===_.KnowledgeBase);return r?r.properties.userInputFieldList:[]});return h({validate:S,get_data:()=>d.value}),(r,t)=>{const o=ae("loading");return te((f(),k(W,{modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=n=>d.value=n),render_data:B.value,model:d.value,ref_key:"dynamicsFormRef",ref:c,"label-position":"top","require-asterisk-position":"right"},{default:m(()=>[C("h4",se,V(I.value||r.$t("chat.userInput")),1)]),_:1},8,["modelValue","render_data","model"])),[[o,D.value]])}}});export{ue as _,ie as a};
