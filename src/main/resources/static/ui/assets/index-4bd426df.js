import{cp as pe,d1 as _e,dA as fe,cq as g,d6 as me,ct as ve,cu as s,cU as ge,cx as r,cy as I,cB as d,cJ as l,cz as n,cA as o,cC as F,cD as Z,cF as h,cv as he,cH as z,dv as we,dw as Ce,cK as i,ec as ye,cE as w,cN as q,ev as ke,dZ as xe,d_ as be,c_ as W,cZ as c,dn as k,en as x,cQ as $e,cR as De}from"./index-ba87ae2c.js";import{S as Ie}from"./SyncWebDialog-033d022b.js";const Se={class:"dataset-list-container p-24",style:{"padding-top":"16px"}},Ae={class:"flex-between mb-16"},Ve={class:"flex-between"},ze={class:"delete-button"},Be={class:"footer-content flex-between"},Me={class:"bold"},Re={class:"bold"},Te={class:"bold"},Ne=pe({__name:"index",setup(Ue){const{user:f,common:H}=_e(),B=fe(),M=g(),R=g(),p=g(!1),m=g([]),_=me({current_page:1,page_size:30,total:0}),b=g(""),$=g([]),v=g("all");function G(){H.asyncGetValid(xe.Dataset,be.Dataset,p).then(async e=>{e!=null&&e.data?M.value.open():(e==null?void 0:e.code)===400&&W(c("common.tip"),c("views.dataset.tip.professionalMessage"),{cancelButtonText:c("common.confirm"),confirmButtonText:c("common.professional")}).then(()=>{window.open("https://maxkb.cn/pricing.html","_blank")}).catch(()=>{})})}function J(){k(c("views.dataset.tip.syncSuccess"))}function K(e){x.putReEmbeddingDataset(e.id).then(()=>{k(c("common.submitSuccess"))})}function O(e){R.value.open(e.id)}function T(){f.userInfo&&localStorage.setItem(f.userInfo.id+"dataset",v.value),_.current_page=1,m.value=[],S()}const P=e=>{x.exportDataset(e.name,e.id,p).then(a=>{k(c("common.exportSuccess"))})},Q=e=>{x.exportZipDataset(e.name,e.id,p).then(a=>{k(c("common.exportSuccess"))})};function j(e){W(`${c("views.dataset.delete.confirmTitle")}${e.name} ?`,`${c("views.dataset.delete.confirmMessage1")} ${e.applicationMappingCount} ${c("views.dataset.delete.confirmMessage2")}`,{confirmButtonText:c("common.confirm"),confirmButtonClass:"danger"}).then(()=>{x.delDataset(e.id,p).then(()=>{const a=m.value.findIndex(u=>u.id===e.id);m.value.splice(a,1),k(c("common.deleteSuccess"))})}).catch(()=>{})}function S(){const e={...b.value&&{name:b.value},...v.value&&v.value!=="all"&&{select_user_id:v.value}};x.getDataset(_,e,p).then(a=>{a.data.records.forEach(u=>{var D;f.userInfo&&u.userId===f.userInfo.id?u.username=f.userInfo.username:u.username=(D=$.value.find(A=>A.value===u.userId))==null?void 0:D.label}),_.total=a.data.total,m.value=[...m.value,...a.data.records]})}function X(){$e.getUserList("DATASET",p).then(e=>{if(e.data){if($.value=e.data.map(a=>({label:a.username,value:a.id})),f.userInfo){const a=localStorage.getItem(f.userInfo.id+"dataset");a&&$.value.find(u=>u.value===a)&&(v.value=a)}S()}})}return ve(()=>{X()}),(e,a)=>{const u=s("el-option"),D=s("el-select"),A=s("el-input"),Y=s("CardAdd"),N=s("el-col"),U=s("AppAvatar"),ee=s("auto-tooltip"),te=s("el-text"),E=s("el-tag"),L=s("el-divider"),ae=s("MoreFilled"),ne=s("el-icon"),oe=s("el-button"),C=s("el-dropdown-item"),V=s("AppIcon"),se=s("el-dropdown-menu"),le=s("el-dropdown"),ce=s("CardBox"),de=s("el-row"),ie=s("InfiniteScroll"),re=ge("loading");return r(),I("div",Se,[d("div",Ae,[d("h4",null,l(e.$t("views.dataset.title")),1),d("div",Ve,[n(D,{modelValue:v.value,"onUpdate:modelValue":a[0]||(a[0]=t=>v.value=t),class:"mr-12",onChange:T,style:{"max-width":"240px",width:"150px"}},{default:o(()=>[(r(!0),I(F,null,Z($.value,t=>(r(),h(u,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),n(A,{modelValue:b.value,"onUpdate:modelValue":a[1]||(a[1]=t=>b.value=t),onChange:T,placeholder:e.$t("views.dataset.searchBar.placeholder"),"prefix-icon":"Search",class:"w-240",style:{"max-width":"240px"},clearable:""},null,8,["modelValue","placeholder"])])]),he((r(),I("div",null,[n(ie,{size:m.value.length,total:_.total,page_size:_.page_size,current_page:_.current_page,"onUpdate:current_page":a[4]||(a[4]=t=>_.current_page=t),onLoad:S,loading:p.value},{default:o(()=>[n(de,{gutter:15},{default:o(()=>[n(N,{xs:24,sm:12,md:8,lg:6,xl:6,class:"mb-16"},{default:o(()=>[n(Y,{title:e.$t("views.dataset.createDataset"),onClick:G},null,8,["title"])]),_:1}),(r(!0),I(F,null,Z(m.value,(t,ue)=>(r(),h(N,{key:ue,xs:24,sm:12,md:8,lg:6,xl:6,class:"mb-16"},{default:o(()=>[n(ce,{title:t.name,description:t.desc,class:"cursor",onClick:y=>z(B).push({path:`/dataset/${t.id}/document`})},{icon:o(()=>[t.type==="1"?(r(),h(U,{key:0,class:"mr-8 avatar-purple",shape:"square",size:32},{default:o(()=>a[5]||(a[5]=[d("img",{src:we,style:{width:"58%"},alt:""},null,-1)])),_:1})):(r(),h(U,{key:1,class:"mr-8 avatar-blue",shape:"square",size:32},{default:o(()=>a[6]||(a[6]=[d("img",{src:Ce,style:{width:"58%"},alt:""},null,-1)])),_:1}))]),subTitle:o(()=>[n(te,{class:"color-secondary",size:"small"},{default:o(()=>[n(ee,{content:t.username},{default:o(()=>[i(l(e.$t("common.creator"))+": "+l(t.username),1)]),_:2},1032,["content"])]),_:2},1024)]),footer:o(()=>[d("div",Be,[d("div",null,[d("span",Me,l((t==null?void 0:t.documentCount)||0),1),i(" "+l(e.$t("views.dataset.documentCount")),1),n(L,{direction:"vertical"}),d("span",Re,l(z(ye)(t==null?void 0:t.charLength)||0),1),i(" "+l(e.$t("common.character")),1),n(L,{direction:"vertical"}),d("span",Te,l((t==null?void 0:t.applicationMappingCount)||0),1),i(" "+l(e.$t("views.dataset.relatedApp_count")),1)]),d("div",{onClick:a[3]||(a[3]=w(()=>{},["stop"]))},[n(le,{trigger:"click"},{dropdown:o(()=>[n(se,null,{default:o(()=>[t.type==="1"?(r(),h(C,{key:0,icon:"Refresh",onClick:w(y=>O(t),["stop"])},{default:o(()=>[i(l(e.$t("views.dataset.setting.sync")),1)]),_:2},1032,["onClick"])):q("",!0),n(C,{onClick:y=>K(t)},{default:o(()=>[n(V,{iconName:"app-document-refresh",style:{"font-size":"16px"}}),i(" "+l(e.$t("views.dataset.setting.vectorization")),1)]),_:2},1032,["onClick"]),n(C,{icon:"Setting",onClick:w(y=>z(B).push({path:`/dataset/${t.id}/setting`}),["stop"])},{default:o(()=>[i(l(e.$t("common.setting")),1)]),_:2},1032,["onClick"]),n(C,{onClick:w(y=>P(t),["stop"])},{default:o(()=>[n(V,{iconName:"app-export"}),i(l(e.$t("views.document.setting.export"))+" Excel",1)]),_:2},1032,["onClick"]),n(C,{onClick:w(y=>Q(t),["stop"])},{default:o(()=>[n(V,{iconName:"app-export"}),i(l(e.$t("views.document.setting.export"))+" ZIP",1)]),_:2},1032,["onClick"]),n(C,{icon:"Delete",onClick:w(y=>j(t),["stop"])},{default:o(()=>[i(l(e.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:o(()=>[n(oe,{text:"",onClick:a[2]||(a[2]=w(()=>{},["stop"]))},{default:o(()=>[n(ne,null,{default:o(()=>[n(ae)]),_:1})]),_:1})]),_:2},1024)])])]),default:o(()=>[d("div",ze,[t.type==="0"?(r(),h(E,{key:0,class:"blue-tag",style:{height:"22px"}},{default:o(()=>[i(l(e.$t("views.dataset.general")),1)]),_:1})):t.type==="1"?(r(),h(E,{key:1,class:"purple-tag",type:"warning",style:{height:"22px"}},{default:o(()=>[i(l(e.$t("views.dataset.web")),1)]),_:1})):q("",!0)])]),_:2},1032,["title","description","onClick"])]),_:2},1024))),128))]),_:1})]),_:1},8,["size","total","page_size","current_page","loading"])])),[[re,_.current_page===1&&p.value,void 0,{fullscreen:!0,lock:!0}]]),n(Ie,{ref_key:"SyncWebDialogRef",ref:R,onRefresh:J},null,512),n(ke,{ref_key:"CreateDatasetDialogRef",ref:M},null,512)])}}});const Fe=De(Ne,[["__scopeId","data-v-5e35283d"]]);export{Fe as default};
