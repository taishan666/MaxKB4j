import{cp as g,dA as u,d1 as _,fn as m,cq as f,di as h,cx as k,cy as y,cB as o,cJ as v,cC as C,cY as w}from"./index-ba87ae2c.js";const q="/ui/assets/logo_dingtalk-e26abd13.svg",x={class:"flex-center mb-16"},Q=g({__name:"dingtalkQrCode",props:{config:{}},setup(a){const i=a,r=u(),{user:c}=_(),{load:d}=m("https://g.alicdn.com/dingding/h5-dingtalk-login/0.21.0/ddlogin.js"),s=f(!1),p=async()=>{try{if(await d(!0),!s.value)return;const e={appKey:i.config.app_key,appSecret:i.config.app_secret,corp_id:i.config.corp_id},t=encodeURIComponent(window.location.origin);window.DTFrameLogin({id:"ding-talk-qr",width:280,height:280},{redirect_uri:t,client_id:e.appKey,scope:"openid corpid",response_type:"code",state:"fit2cloud-ding-qr",prompt:"consent",corpId:e.corp_id},n=>{const l=n.authCode;c.dingCallback(l).then(()=>{r.push({name:"home"})})},n=>{w(n)})}catch(e){console.error(e)}};return h(()=>i.config,e=>{e.app_secret&&e.app_key&&e.corp_id&&(s.value=!0,p())},{immediate:!0}),(e,t)=>(k(),y(C,null,[o("div",x,[t[0]||(t[0]=o("img",{src:q,alt:"",width:"24px",class:"mr-4"},null,-1)),o("h2",null,v(e.$t("views.system.authentication.scanTheQRCode.dingtalkQrCode")),1)]),t[1]||(t[1]=o("div",{class:"ding-talk-qrName"},[o("div",{id:"ding-talk-qr"})],-1))],64))}});export{Q as default};
