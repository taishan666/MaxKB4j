import{dW as re,dX as ce,dY as Le,eI as ye,eJ as he,cp as ue,cq as v,d6 as pe,cZ as u,di as ve,cu as i,cx as M,cF as P,cA as o,cB as $,cz as l,cE as A,cK as F,cJ as g,cy as E,cC as ee,cD as le,cT as me,cU as _e,cv as be,cH as fe,eG as Ve,cV as ge,eH as Te,c_ as X,cY as $e,cQ as we,dn as Z,d1 as Me,ct as Fe,d5 as Q,e0 as Ce,du as Ue,ei as ke,e1 as Ie,cN as xe,e2 as Be,cR as De}from"./index-2f436c9e.js";const x="/mcp_lib",Ne=(_,c)=>re(`${x}`,_||{},c),Pe=(_,c,w)=>re(`${x}/${_.current_page}/${_.page_size}`,c,w),Re=(_,c)=>ce(`${x}`,_,void 0,c),Se=(_,c,w)=>Le(`${x}/${_}`,c,void 0,w),ze=(_,c)=>ce(`${x}/debug`,_,void 0,c),Ae=(_,c)=>ye(`${x}/${_}`,void 0,{},c),qe=(_,c)=>re(`${x}/${_}`,void 0,c),Ee=(_,c,w)=>he(c+".mcp",`${x}/${_}/export`,void 0,w),je=(_,c)=>ce(`${x}/import`,_,void 0,c),N={getMcpLib:Pe,postMcpLib:Re,putMcpLib:Se,postMcpLibDebug:ze,getAllMcpLib:Ne,delMcpLib:Ae,getMcpLibById:qe,exportMcpLib:Ee,importMcpLib:je},Oe={class:"dialog-footer"},He=ue({__name:"FieldFormDialog",emits:["refresh"],setup(_,{expose:c,emit:w}){const U=["string","int","dict","array","float"],V=w,h=v(),k=v(!1),T=v(!1),p=v({name:"",type:U[0],source:"reference",is_required:!0}),L=pe({name:[{required:!0,message:u("views.mcpLib.mcpForm.form.toolName.placeholder"),trigger:"blur"}]}),y=v(!1);ve(y,f=>{f||(p.value={name:"",type:U[0],source:"reference",is_required:!0},T.value=!1)});const I=f=>{f&&(p.value=me.cloneDeep(f),T.value=!0),y.value=!0},r=async f=>{f&&await f.validate(m=>{m&&(V("refresh",p.value),y.value=!1)})};return c({open:I}),(f,m)=>{const j=i("el-input"),B=i("el-form-item"),R=i("el-option"),q=i("el-select"),O=i("el-switch"),S=i("el-form"),s=i("el-button"),a=i("el-dialog");return M(),P(a,{title:T.value?f.$t("views.template.templateForm.title.editParam"):f.$t("views.template.templateForm.title.addParam"),modelValue:y.value,"onUpdate:modelValue":m[8]||(m[8]=e=>y.value=e),"close-on-click-modal":!1,"close-on-press-escape":!1,"destroy-on-close":!0,"append-to-body":""},{footer:o(()=>[$("span",Oe,[l(s,{onClick:m[6]||(m[6]=A(e=>y.value=!1,["prevent"]))},{default:o(()=>[F(g(f.$t("common.cancel")),1)]),_:1}),l(s,{type:"primary",onClick:m[7]||(m[7]=e=>r(h.value)),loading:k.value},{default:o(()=>[F(g(T.value?f.$t("common.save"):f.$t("common.add")),1)]),_:1},8,["loading"])])]),default:o(()=>[l(S,{"label-position":"top",ref_key:"fieldFormRef",ref:h,rules:L,model:p.value,"require-asterisk-position":"right"},{default:o(()=>[l(B,{label:f.$t("views.mcpLib.mcpForm.form.paramName.label"),prop:"name"},{default:o(()=>[l(j,{modelValue:p.value.name,"onUpdate:modelValue":m[0]||(m[0]=e=>p.value.name=e),placeholder:f.$t("views.mcpLib.mcpForm.form.paramName.placeholder"),maxlength:"64","show-word-limit":"",onBlur:m[1]||(m[1]=e=>p.value.name=p.value.name.trim())},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(B,{label:f.$t("views.mcpLib.mcpForm.form.dataType.label")},{default:o(()=>[l(q,{modelValue:p.value.type,"onUpdate:modelValue":m[2]||(m[2]=e=>p.value.type=e)},{default:o(()=>[(M(),E(ee,null,le(U,e=>l(R,{key:e,label:e,value:e},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(B,{label:f.$t("views.mcpLib.mcpForm.form.source.label")},{default:o(()=>[l(q,{modelValue:p.value.source,"onUpdate:modelValue":m[3]||(m[3]=e=>p.value.source=e)},{default:o(()=>[l(R,{label:f.$t("views.mcpLib.mcpForm.form.source.reference"),value:"reference"},null,8,["label"]),l(R,{label:f.$t("views.mcpLib.mcpForm.form.source.custom"),value:"custom"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(B,{label:f.$t("views.mcpLib.mcpForm.form.required.label"),onClick:m[5]||(m[5]=A(()=>{},["prevent"]))},{default:o(()=>[l(O,{size:"small",modelValue:p.value.is_required,"onUpdate:modelValue":m[4]||(m[4]=e=>p.value.is_required=e)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])}}}),Je={class:"title-decoration-1 mb-16"},We={class:"mb-4"},Ye={class:"flex-between"},Ge={class:"title-decoration-1 mb-16"},Ke=ue({__name:"McpFormDrawer",props:{title:String},emits:["refresh"],setup(_,{expose:c,emit:w}){const U=w,V=v(),h=v(),k=v(),T=v(!1),p=v(!1),L=v(!1),y=v(!1),I=v(null),r=v({name:"",desc:"",sseUrl:"",mcpTools:[],permissionType:"PRIVATE"});ve(L,s=>{var a;s||(T.value=!1,y.value=!1,I.value=null,r.value={name:"",desc:"",sseUrl:"",mcpTools:[],permissionType:"PRIVATE"},(a=k.value)==null||a.clearValidate())});const f=pe({name:[{required:!0,message:u("views.mcpLib.mcpForm.form.mcpName.requiredMessage"),trigger:"blur"}],permissionType:[{required:!0,message:u("views.mcpLib.mcpForm.form.permissionType.requiredMessage"),trigger:"change"}]});function m(){T.value||!j(r.value)?L.value=!1:X(u("common.tip"),u("views.functionLib.tip.saveMessage"),{confirmButtonText:u("common.confirm"),type:"warning"}).then(()=>{L.value=!1}).catch(()=>{})}function j(s){return Object.values(s).some(a=>Array.isArray(a)?a.length!==0:a!=null&&a!=="")}function B(){h.value.open(r.value)}function R(){if(!r.value.sseUrl){$e(u("views.applicationWorkflow.nodes.mcpNode.mcpServerTip"));return}we.getMcpTools({sseUrl:r.value.sseUrl},p).then(s=>{r.value.mcpTools=s.data,Z(u("views.applicationWorkflow.nodes.mcpNode.getToolsSuccess"))})}function q(s){var a,e;I.value!==null?(a=r.value.mcpTools)==null||a.splice(I.value,1,s):(e=r.value.mcpTools)==null||e.push(s),I.value=null}const O=async s=>{s&&await s.validate(a=>{var e;a&&(T.value?N.putMcpLib((e=r.value)==null?void 0:e.id,r.value,p).then(t=>{Z(u("common.editSuccess")),U("refresh",t.data),L.value=!1}):N.postMcpLib(r.value,p).then(t=>{Z(u("common.createSuccess")),U("refresh"),L.value=!1}))})};return c({open:s=>{s&&(T.value=!!(s!=null&&s.id),r.value=me.cloneDeep(s)),L.value=!0,setTimeout(()=>{y.value=!0},100)}}),(s,a)=>{const e=i("el-input"),t=i("el-form-item"),d=i("el-text"),C=i("el-radio"),H=i("el-card"),J=i("el-col"),oe=i("el-row"),te=i("el-radio-group"),Y=i("el-form"),ne=i("Plus"),G=i("el-icon"),D=i("el-button"),W=i("el-tag"),K=i("el-table-column"),ae=i("el-table"),se=i("el-drawer"),ie=_e("loading");return M(),P(se,{modelValue:L.value,"onUpdate:modelValue":a[11]||(a[11]=b=>L.value=b),size:"60%","before-close":m},{header:o(()=>[$("h4",null,g(_.title),1)]),footer:o(()=>[$("div",null,[l(D,{loading:p.value,onClick:a[9]||(a[9]=b=>L.value=!1)},{default:o(()=>[F(g(s.$t("common.cancel")),1)]),_:1},8,["loading"]),l(D,{loading:p.value,onClick:B},{default:o(()=>[F(g(s.$t("common.debug")),1)]),_:1},8,["loading"]),l(D,{type:"primary",onClick:a[10]||(a[10]=b=>O(k.value)),loading:p.value},{default:o(()=>[F(g(T.value?s.$t("common.save"):s.$t("common.create")),1)]),_:1},8,["loading"])])]),default:o(()=>[$("div",null,[$("h4",Je,g(s.$t("views.mcpLib.mcpForm.title.baseInfo")),1),be((M(),P(Y,{ref_key:"FormRef",ref:k,model:r.value,rules:f,"label-position":"top","require-asterisk-position":"right",onSubmit:a[7]||(a[7]=A(()=>{},["prevent"]))},{default:o(()=>[l(t,{label:s.$t("views.mcpLib.mcpForm.form.mcpName.label"),prop:"name"},{default:o(()=>[l(e,{modelValue:r.value.name,"onUpdate:modelValue":a[0]||(a[0]=b=>r.value.name=b),placeholder:s.$t("views.mcpLib.mcpForm.form.mcpName.placeholder"),maxlength:"64","show-word-limit":"",onBlur:a[1]||(a[1]=b=>{var n;return r.value.name=(n=r.value.name)==null?void 0:n.trim()})},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(t,{label:s.$t("views.mcpLib.mcpForm.form.mcpDescription.label")},{default:o(()=>[l(e,{modelValue:r.value.desc,"onUpdate:modelValue":a[2]||(a[2]=b=>r.value.desc=b),type:"textarea",placeholder:s.$t("views.mcpLib.mcpForm.form.mcpDescription.placeholder"),maxlength:"128","show-word-limit":"",autosize:{minRows:3},onBlur:a[3]||(a[3]=b=>{var n;return r.value.desc=(n=r.value.desc)==null?void 0:n.trim()})},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(t,{label:"MCP SSE URL",prop:"sseUrl"},{default:o(()=>[l(e,{modelValue:r.value.sseUrl,"onUpdate:modelValue":a[4]||(a[4]=b=>r.value.sseUrl=b),placeholder:s.$t("views.mcpLib.mcpForm.form.mcpSseUrl.placeholder"),maxlength:"256","show-word-limit":"",onBlur:a[5]||(a[5]=b=>{var n;return r.value.sseUrl=(n=r.value.sseUrl)==null?void 0:n.trim()})},null,8,["modelValue","placeholder"])]),_:1}),l(t,{prop:"permissionType"},{label:o(()=>[$("span",null,g(s.$t("views.mcpLib.mcpForm.form.permissionType.label")),1)]),default:o(()=>[l(te,{modelValue:r.value.permissionType,"onUpdate:modelValue":a[6]||(a[6]=b=>r.value.permissionType=b),class:"card__radio"},{default:o(()=>[l(oe,{gutter:16},{default:o(()=>[(M(!0),E(ee,null,le(fe(Ve),(b,n)=>(M(),P(J,{key:n,span:12},{default:o(()=>[l(H,{shadow:"never",class:ge(["mb-16",r.value.permissionType===n?"active":""])},{default:o(()=>[l(C,{value:n,size:"large"},{default:o(()=>[$("p",We,g(s.$t(b)),1),l(d,{type:"info"},{default:o(()=>[F(g(s.$t(fe(Te)[n])),1)]),_:2},1024)]),_:2},1032,["value"])]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[ie,p.value]]),$("div",Ye,[$("h4",Ge,g(s.$t("common.param.inputParam")),1),l(D,{link:"",type:"primary",onClick:a[8]||(a[8]=b=>R())},{default:o(()=>[l(G,{class:"mr-4"},{default:o(()=>[l(ne)]),_:1}),F(" "+g(s.$t("views.mcpLib.mcpForm.form.getTool")),1)]),_:1})]),l(ae,{data:r.value.mcpTools,class:"mb-16"},{default:o(()=>[l(K,{label:s.$t("views.mcpLib.mcpForm.form.toolName.label")},{default:o(({row:b})=>[l(W,{type:"info",class:"info-tag"},{default:o(()=>[F(g(b.name),1)]),_:2},1024)]),_:1},8,["label"]),l(K,{prop:"description",label:s.$t("views.mcpLib.mcpForm.form.toolDesc.label")},null,8,["label"])]),_:1},8,["data"])]),l(He,{ref_key:"FieldFormDialogRef",ref:V,onRefresh:q},null,512)]),_:1},8,["modelValue"])}}}),Qe={class:"function-lib-list-container p-24",style:{"padding-top":"16px"}},Xe={class:"flex-between mb-16"},Ze={class:"flex-between"},el={class:"flex align-center cursor p-8"},ll={class:"status-button"},ol={class:"footer-content flex-between"},tl=ue({__name:"index",setup(_){const{user:c}=Me(),w=v(!1),U=v(),V=v([]),h=pe({current_page:1,page_size:30,total:0}),k=v(""),T=v(""),p=v(!1),L=v([]),y=v("all"),I=v(),r=e=>{var t;return((t=c.userInfo)==null?void 0:t.id)===(e==null?void 0:e.userId)};function f(e){T.value=e?u("views.mcpLib.editMcp"):u("views.mcpLib.createMcp"),e?((e==null?void 0:e.permissionType)!=="PUBLIC"||r(e))&&U.value.open(e):U.value.open(e)}function m(){c.userInfo&&localStorage.setItem(c.userInfo.id+"mcp",y.value),h.total=0,h.current_page=1,V.value=[],S()}function j(e,t){if(!e)X(`${u("views.mcpLib.disabled.confirmTitle")}${t.name} ?`,u("views.mcpLib.disabled.confirmMessage"),{confirmButtonText:u("views.mcpLib.setting.disabled"),confirmButtonClass:"danger"}).then(()=>{const d={isActive:e};N.putMcpLib(t.id,d,p).then(C=>{})}).catch(()=>{t.isActive=!0});else{const d={isActive:e};N.putMcpLib(t.id,d,p).then(C=>{})}}function B(e){X(`${u("views.mcpLib.delete.confirmTitle")}${e.name} ?`,u("views.mcpLib.delete.confirmMessage"),{confirmButtonText:u("common.confirm"),cancelButtonText:u("common.cancel"),confirmButtonClass:"danger"}).then(()=>{N.delMcpLib(e.id,w).then(()=>{const t=V.value.findIndex(d=>d.id===e.id);V.value.splice(t,1),Z(u("common.deleteSuccess"))})}).catch(()=>{})}function R(e){T.value=u("views.mcpLib.copyMcp");const t=me.cloneDeep(e);delete t.id,t.name=t.name+`  ${u("views.mcpLib.McForm.title.copy")}`,U.value.open(t)}function q(e){N.exportMcpLib(e.id,e.name,w).catch(t=>{t.response.status!==403&&t.response.data.text().then(d=>{$e(`${u("views.application.tip.ExportError")}:${JSON.parse(d).message}`)})})}function O(e){const t=new FormData;t.append("file",e.raw,e.name),I.value.clearFiles(),N.importMcpLib(t,w).then(async d=>{d!=null&&d.data&&m()}).catch(d=>{d.code===400&&X(u("common.tip"),u("views.application.tip.professionalMessage"),{cancelButtonText:u("common.confirm"),confirmButtonText:u("common.professional")}).then(()=>{window.open("https://tarzan.blog.csdn.net","_blank")})})}function S(){const e={...k.value&&{name:k.value},...y.value&&y.value!=="all"&&{select_user_id:y.value}};N.getMcpLib(h,e,w).then(t=>{t.data.records.forEach(d=>{var C;c.userInfo&&d.userId===c.userInfo.id?d.username=c.userInfo.username:d.username=(C=L.value.find(H=>H.value===d.userId))==null?void 0:C.label}),V.value=[...V.value,...t.data.records],h.total=t.data.total})}function s(e){var t;if(console.log("refresh",e),e){const d=V.value.findIndex(C=>C.id===e.id);c.userInfo&&e.userId===c.userInfo.id?e.username=c.userInfo.username:e.username=(t=L.value.find(C=>C.value===e.userId))==null?void 0:t.label,V.value.splice(d,1,e)}else h.total=0,h.current_page=1,V.value=[],S()}function a(){we.getUserList("MCP",w).then(e=>{if(e.data){if(L.value=e.data.map(t=>({label:t.username,value:t.id})),c.userInfo){const t=localStorage.getItem(c.userInfo.id+"function");t&&L.value.find(d=>d.value===t)&&(y.value=t)}S()}})}return Fe(()=>{a()}),(e,t)=>{const d=i("el-option"),C=i("el-select"),H=i("el-input"),J=i("el-divider"),oe=i("el-upload"),te=i("el-card"),Y=i("el-col"),ne=i("el-text"),G=i("el-tag"),D=i("el-button"),W=i("el-tooltip"),K=i("Delete"),ae=i("el-icon"),se=i("el-switch"),ie=i("el-row"),b=_e("loading");return M(),E("div",Qe,[$("div",Xe,[$("h4",null,g(e.$t("views.mcpLib.title")),1),$("div",Ze,[l(C,{modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=n=>y.value=n),class:"mr-12",style:{"max-width":"240px",width:"150px"},onChange:m},{default:o(()=>[(M(!0),E(ee,null,le(L.value,n=>(M(),P(d,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(H,{modelValue:k.value,"onUpdate:modelValue":t[1]||(t[1]=n=>k.value=n),onChange:m,placeholder:e.$t("views.mcpLib.searchBar.placeholder"),"prefix-icon":"Search",class:"w-240",style:{"max-width":"240px"},clearable:""},null,8,["modelValue","placeholder"])])]),be((M(),E("div",null,[l(Be,{size:V.value.length,total:h.total,page_size:h.page_size,current_page:h.current_page,"onUpdate:current_page":t[4]||(t[4]=n=>h.current_page=n),onLoad:S,loading:w.value},{default:o(()=>[l(ie,{gutter:15},{default:o(()=>[l(Y,{xs:24,sm:12,md:8,lg:6,xl:6,class:"mb-16"},{default:o(()=>[l(te,{shadow:"hover",class:"application-card-add",style:{"--el-card-padding":"8px"}},{default:o(()=>[$("div",{class:"card-add-button flex align-center cursor p-8",onClick:t[2]||(t[2]=n=>f())},[l(Q,{iconName:"app-add-application",class:"mr-8"}),F(" "+g(e.$t("views.mcpLib.createMcp")),1)]),l(J,{style:{margin:"8px 0"}}),l(oe,{ref_key:"elUploadRef",ref:I,"file-list":[],action:"#",multiple:"","auto-upload":!1,"show-file-list":!1,limit:1,"on-change":(n,de)=>O(n),class:"card-add-button"},{default:o(()=>[$("div",el,[l(Q,{iconName:"app-import",class:"mr-8"}),F(" "+g(e.$t("views.mcpLib.importMcp")),1)])]),_:1},8,["on-change"])]),_:1})]),_:1}),(M(!0),E(ee,null,le(V.value,(n,de)=>(M(),P(Y,{xs:24,sm:12,md:8,lg:6,xl:6,key:de,class:"mb-16"},{default:o(()=>[l(Ce,{title:n.name,description:n.desc,class:ge(["function-lib-card",n.permissionType==="PUBLIC"&&!r(n)?"":"cursor"]),onClick:z=>f(n)},{icon:o(()=>[l(Ue,{class:"mr-12 avatar-green",shape:"square",size:32},{default:o(()=>t[5]||(t[5]=[$("img",{src:ke,style:{width:"58%"},alt:""},null,-1)])),_:1})]),subTitle:o(()=>[l(ne,{class:"color-secondary",size:"small"},{default:o(()=>[l(Ie,{content:n.username},{default:o(()=>[F(g(e.$t("common.creator"))+": "+g(n.username),1)]),_:2},1032,["content"])]),_:2},1024)]),footer:o(()=>[$("div",ol,[$("div",null,[l(W,{effect:"dark",content:e.$t("common.copy"),placement:"top"},{default:o(()=>[l(D,{text:"",onClick:A(z=>R(n),["stop"]),disabled:n.permissionType==="PUBLIC"&&!r(n)},{default:o(()=>[l(Q,{iconName:"app-copy"})]),_:2},1032,["onClick","disabled"])]),_:2},1032,["content"]),l(J,{direction:"vertical"}),l(W,{effect:"dark",content:e.$t("common.export"),placement:"top"},{default:o(()=>[l(D,{text:"",onClick:A(z=>q(n),["stop"]),disabled:n.permissionType==="PUBLIC"&&!r(n)},{default:o(()=>[l(Q,{iconName:"app-export"})]),_:2},1032,["onClick","disabled"])]),_:2},1032,["content"]),l(J,{direction:"vertical"}),l(W,{effect:"dark",content:e.$t("common.delete"),placement:"top"},{default:o(()=>[l(D,{disabled:n.permissionType==="PUBLIC"&&!r(n),text:"",onClick:A(z=>B(n),["stop"])},{default:o(()=>[l(ae,null,{default:o(()=>[l(K)]),_:1})]),_:2},1032,["disabled","onClick"])]),_:2},1032,["content"])]),$("div",{onClick:t[3]||(t[3]=A(()=>{},["stop"]))},[l(se,{disabled:n.permissionType==="PUBLIC"&&!r(n),modelValue:n.isActive,"onUpdate:modelValue":z=>n.isActive=z,onChange:z=>j(z,n),size:"small"},null,8,["disabled","modelValue","onUpdate:modelValue","onChange"])])])]),default:o(()=>[$("div",ll,[n.permissionType==="PUBLIC"?(M(),P(G,{key:0,class:"info-tag",style:{height:"22px"}},{default:o(()=>[F(g(e.$t("common.public")),1)]),_:1})):n.permissionType==="PRIVATE"?(M(),P(G,{key:1,class:"danger-tag",style:{height:"22px"}},{default:o(()=>[F(g(e.$t("common.private")),1)]),_:1})):xe("",!0)])]),_:2},1032,["title","description","onClick","class"])]),_:2},1024))),128))]),_:1})]),_:1},8,["size","total","page_size","current_page","loading"])])),[[b,h.current_page===1&&w.value||p.value,void 0,{fullscreen:!0,lock:!0}]]),l(Ke,{ref_key:"McpFormDrawerRef",ref:U,onRefresh:s,title:T.value},null,8,["title"])])}}});const al=De(tl,[["__scopeId","data-v-8fbb5fa4"]]);export{al as default};
