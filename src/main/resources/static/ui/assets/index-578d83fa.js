import{cp as ne,dA as le,d1 as ie,cZ as s,cq as f,d6 as pe,di as Ie,cu as l,cx as _,cF as C,cA as n,cB as y,cz as a,cE as V,cK as k,cJ as v,cT as Ve,dY as se,dZ as ce,d_ as Fe,cQ as M,dn as re,cP as Z,ct as Ne,cU as Se,cy as R,cC as oe,cD as ae,cv as De,cH as J,dD as Ue,cN as te,d$ as Me,cY as Te,c_ as Y,cR as Be}from"./index-eeff5fe9.js";const Le={class:"dialog-footer"},Pe=ne({__name:"CopyApplicationDialog",setup(de,{expose:B}){const F=le(),{common:g,user:z}=ie(),N=s("views.application.applicationForm.form.prompt.defaultPrompt",{data:"{data}",question:"{question}"}),S=f(),x=f(!1),u=f(!1),d=f({name:"",desc:"",modelId:"",dialogueNumber:0,prologue:s("views.application.applicationForm.form.defaultPrologue"),datasetIdList:[],datasetSetting:{topN:3,similarity:.6,maxParagraphCharNumber:5e3,searchMode:"embedding",noReferencesSetting:{status:"ai_questioning",value:"{question}"}},modelSetting:{prompt:N},problemOptimization:!1,type:"SIMPLE"}),h=pe({name:[{required:!0,message:s("views.application.applicationForm.form.appName.placeholder"),trigger:"blur"}]});Ie(u,c=>{var i;c||(d.value={name:"",desc:"",modelId:"",dialogueNumber:0,prologue:s("views.application.applicationForm.form.defaultPrologue"),datasetIdList:[],datasetSetting:{topN:3,similarity:.6,maxParagraphCharNumber:5e3,searchMode:"embedding",noReferencesSetting:{status:"ai_questioning",value:"{question}"}},modelSetting:{prompt:N},problemOptimization:!1,type:"SIMPLE"},(i=S.value)==null||i.clearValidate())});const D=c=>{const i=Ve.cloneDeep(c);delete i.id,i.name=i.name+` ${s("views.application.applicationForm.title.copy")}`,d.value=i,u.value=!0},b=c=>{z.isEnterprise()?A(c):g.asyncGetValid(se.Application,ce.Application,x).then(async i=>{i!=null&&i.data?A(c):Fe(s("common.tip"),s("views.application.tip.professionalMessage"))})},A=async c=>{c&&await c.validate(i=>{i&&M.postApplication(d.value,x).then($=>{re(s("common.createSuccess")),Z(d.value.type)?F.push({path:`/application/${$.data.id}/workflow`}):F.push({path:`/application/${$.data.id}/${$.data.type}/setting`}),u.value=!1})})};return B({open:D}),(c,i)=>{const $=l("el-input"),L=l("el-form-item"),q=l("el-form"),P=l("el-button"),E=l("el-dialog");return _(),C(E,{title:c.$t("views.application.copyApplication"),modelValue:u.value,"onUpdate:modelValue":i[4]||(i[4]=w=>u.value=w),width:"650","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:n(()=>[y("span",Le,[a(P,{onClick:i[2]||(i[2]=V(w=>u.value=!1,["prevent"])),loading:x.value},{default:n(()=>[k(v(c.$t("common.cancel")),1)]),_:1},8,["loading"]),a(P,{type:"primary",onClick:i[3]||(i[3]=w=>b(S.value)),loading:x.value},{default:n(()=>[k(v(c.$t("common.copy")),1)]),_:1},8,["loading"])])]),default:n(()=>[a(q,{ref_key:"applicationFormRef",ref:S,model:d.value,rules:h,"label-position":"top","require-asterisk-position":"right"},{default:n(()=>[a(L,{label:c.$t("views.application.applicationForm.form.appName.label"),prop:"name"},{default:n(()=>[a($,{modelValue:d.value.name,"onUpdate:modelValue":i[0]||(i[0]=w=>d.value.name=w),maxlength:"64",placeholder:c.$t("views.application.applicationForm.form.appName.placeholder"),"show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(L,{label:c.$t("views.application.applicationForm.form.appDescription.label")},{default:n(()=>[a($,{modelValue:d.value.desc,"onUpdate:modelValue":i[1]||(i[1]=w=>d.value.desc=w),type:"textarea",placeholder:c.$t("views.application.applicationForm.form.appDescription.placeholder"),rows:3,maxlength:"256","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}}),Re={class:"application-list-container p-24",style:{"padding-top":"16px"}},ze={class:"flex-between mb-16"},qe={class:"flex-between"},Ee={class:"flex align-center cursor p-8"},Oe=["src"],Ge={class:"status-tag"},He={class:"footer-content"},Je=ne({__name:"index",setup(de){const B=f(),{application:F,user:g,common:z}=ie(),N=le(),S=f(),x=f(),u=f(!1),d=f([]),h=pe({current_page:1,page_size:30,total:0}),D=f([]),b=f("all"),A=f(""),c=f([]);function i(e){F.asyncGetApplicationDetail(e.id,u).then(o=>{o!=null&&o.data&&S.value.open({...o.data,modelId:o.data.model})})}const $=e=>g.userInfo?g.userInfo.id==e.userId:!1;function L(e){Z(e.type)?N.push({path:`/application/${e.id}/workflow`}):N.push({path:`/application/${e.id}/${e.type}/setting`})}const q=e=>{M.exportApplication(e.id,e.name,u).catch(o=>{o.response.status!==403&&o.response.data.text().then(p=>{Te(`${s("views.application.tip.ExportError")}:${JSON.parse(p).message}`)})})},P=e=>{const o=new FormData;o.append("file",e.raw,e.name),B.value.clearFiles(),M.importApplication(o,u).then(async p=>{p!=null&&p.data&&w()}).catch(p=>{p.code===400&&Y(s("common.tip"),s("views.application.tip.professionalMessage"),{cancelButtonText:s("common.confirm"),confirmButtonText:s("common.professional")}).then(()=>{window.open("https://maxkb.cn/pricing.html","_blank")})})};function E(){z.asyncGetValid(se.Application,ce.Application,u).then(async e=>{e!=null&&e.data?x.value.open():(e==null?void 0:e.code)===400&&Y(s("common.tip"),s("views.application.tip.professionalMessage"),{cancelButtonText:s("common.confirm"),confirmButtonText:s("common.professional")}).then(()=>{window.open("https://maxkb.cn/pricing.html","_blank")})})}function w(){g.userInfo&&localStorage.setItem(g.userInfo.id+"application",b.value),d.value=[],h.current_page=1,h.total=0,O()}function j(e){const o=new URLSearchParams;return e.forEach(p=>{o.append(encodeURIComponent(p.name),encodeURIComponent(p.value))}),o.toString()}function ue(e){var p,I,U;(U=(I=(p=d.value.filter(r=>r.id===e)[0])==null?void 0:p.workFlow)==null?void 0:I.nodes)==null||U.filter(r=>r.id==="base-node").map(r=>{c.value=r.properties.api_input_field_list?r.properties.api_input_field_list.map(m=>({name:m.variable,value:m.default_value})):r.properties.inputFieldList?r.properties.inputFieldList.filter(m=>m.assignment_method==="api_input").map(m=>({name:m.variable,value:m.default_value})):[]});const o=j(c.value)?"?"+j(c.value):"";F.asyncGetAccessToken(e,u).then(r=>{var m;window.open(F.location+((m=r==null?void 0:r.data)==null?void 0:m.accessToken)+o)})}function me(e){Y(`${s("views.application.delete.confirmTitle")}${e.name} ?`,s("views.application.delete.confirmMessage"),{confirmButtonText:s("common.confirm"),cancelButtonText:s("common.cancel"),confirmButtonClass:"danger"}).then(()=>{M.delApplication(e.id,u).then(()=>{const o=d.value.findIndex(p=>p.id===e.id);d.value.splice(o,1),re(s("common.deleteSuccess"))})}).catch(()=>{})}function O(){const e={...A.value&&{name:A.value},...b.value&&b.value!=="all"&&{select_user_id:b.value}};M.getApplication(h,e,u).then(o=>{o.data.records.forEach(p=>{var I;g.userInfo&&p.userId===g.userInfo.id?p.username=g.userInfo.username:p.username=(I=D.value.find(U=>U.value===p.userId))==null?void 0:I.label}),d.value=[...d.value,...o.data.records],h.total=o.data.total})}function fe(){M.getUserList("APPLICATION",u).then(e=>{if(e.data){if(D.value=e.data.map(o=>({label:o.username,value:o.id})),g.userInfo){const o=localStorage.getItem(g.userInfo.id+"application");o&&D.value.find(p=>p.value===o)&&(b.value=o)}O()}})}return Ne(()=>{fe()}),(e,o)=>{const p=l("el-option"),I=l("el-select"),U=l("el-input"),r=l("AppIcon"),m=l("el-divider"),_e=l("el-upload"),ve=l("el-card"),K=l("el-col"),Q=l("AppAvatar"),ge=l("auto-tooltip"),he=l("el-text"),W=l("el-tag"),G=l("el-button"),X=l("el-tooltip"),we=l("MoreFilled"),ye=l("el-icon"),H=l("el-dropdown-item"),ke=l("el-dropdown-menu"),be=l("el-dropdown"),$e=l("CardBox"),Ce=l("el-row"),xe=l("InfiniteScroll"),Ae=Se("loading");return _(),R("div",Re,[y("div",ze,[y("h4",null,v(e.$t("views.application.title")),1),y("div",qe,[a(I,{modelValue:b.value,"onUpdate:modelValue":o[0]||(o[0]=t=>b.value=t),class:"mr-12",onChange:w,style:{"max-width":"240px",width:"150px"}},{default:n(()=>[(_(!0),R(oe,null,ae(D.value,t=>(_(),C(p,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(U,{modelValue:A.value,"onUpdate:modelValue":o[1]||(o[1]=t=>A.value=t),onChange:w,placeholder:e.$t("views.application.searchBar.placeholder"),"prefix-icon":"Search",class:"w-240",style:{"min-width":"240px"},clearable:""},null,8,["modelValue","placeholder"])])]),De((_(),R("div",null,[a(xe,{size:d.value.length,total:h.total,page_size:h.page_size,current_page:h.current_page,"onUpdate:current_page":o[5]||(o[5]=t=>h.current_page=t),onLoad:O,loading:u.value},{default:n(()=>[a(Ce,{gutter:15},{default:n(()=>[a(K,{xs:24,sm:12,md:8,lg:6,xl:6,class:"mb-16"},{default:n(()=>[a(ve,{shadow:"hover",class:"application-card-add",style:{"--el-card-padding":"8px"}},{default:n(()=>[y("div",{class:"card-add-button flex align-center cursor p-8",onClick:E},[a(r,{iconName:"app-add-application",class:"mr-8"}),k(" "+v(e.$t("views.application.createApplication")),1)]),a(m,{style:{margin:"8px 0"}}),a(_e,{ref_key:"elUploadRef",ref:B,"file-list":[],action:"#",multiple:"","auto-upload":!1,"show-file-list":!1,limit:1,"on-change":(t,ee)=>P(t),class:"card-add-button"},{default:n(()=>[y("div",Ee,[a(r,{iconName:"app-import",class:"mr-8"}),k(" "+v(e.$t("views.application.importApplication")),1)])]),_:1},8,["on-change"])]),_:1})]),_:1}),(_(!0),R(oe,null,ae(d.value,(t,ee)=>(_(),C(K,{xs:24,sm:12,md:8,lg:6,xl:6,key:ee,class:"mb-16"},{default:n(()=>[a($e,{title:t.name,description:t.desc,class:"application-card cursor",onClick:T=>J(N).push({path:`/application/${t.id}/${t.type}/overview`})},{icon:n(()=>[J(Ue)(t==null?void 0:t.icon)?(_(),C(Q,{key:0,shape:"square",size:32,style:{background:"none"},class:"mr-8"},{default:n(()=>[y("img",{src:t==null?void 0:t.icon,alt:""},null,8,Oe)]),_:2},1024)):t!=null&&t.name?(_(),C(Q,{key:1,name:t==null?void 0:t.name,pinyinColor:"",shape:"square",size:32,class:"mr-8"},null,8,["name"])):te("",!0)]),subTitle:n(()=>[a(he,{class:"color-secondary",size:"small"},{default:n(()=>[a(ge,{content:t.username},{default:n(()=>[k(v(e.$t("common.creator"))+": "+v(t.username),1)]),_:2},1032,["content"])]),_:2},1024)]),footer:n(()=>[y("div",He,[a(X,{effect:"dark",content:e.$t("views.application.setting.demo"),placement:"top"},{default:n(()=>[a(G,{text:"",onClick:[o[2]||(o[2]=V(()=>{},["stop"])),T=>ue(t.id)]},{default:n(()=>[a(r,{iconName:"app-view"})]),_:2},1032,["onClick"])]),_:2},1032,["content"]),a(m,{direction:"vertical"}),a(X,{effect:"dark",content:e.$t("common.setting"),placement:"top"},{default:n(()=>[a(G,{text:"",onClick:V(T=>L(t),["stop"])},{default:n(()=>[a(r,{iconName:"Setting"})]),_:2},1032,["onClick"])]),_:2},1032,["content"]),a(m,{direction:"vertical"}),y("span",{onClick:o[4]||(o[4]=V(()=>{},["stop"]))},[a(be,{trigger:"click"},{dropdown:n(()=>[a(ke,null,{default:n(()=>[$(t)?(_(),C(H,{key:0,onClick:T=>i(t)},{default:n(()=>[a(r,{iconName:"app-copy"}),k(" "+v(e.$t("common.copy")),1)]),_:2},1032,["onClick"])):te("",!0),a(H,{onClick:V(T=>q(t),["stop"])},{default:n(()=>[a(r,{iconName:"app-export"}),k(" "+v(e.$t("common.export")),1)]),_:2},1032,["onClick"]),a(H,{icon:"Delete",onClick:V(T=>me(t),["stop"])},{default:n(()=>[k(v(e.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:n(()=>[a(G,{text:"",onClick:o[3]||(o[3]=V(()=>{},["stop"]))},{default:n(()=>[a(ye,null,{default:n(()=>[a(we)]),_:1})]),_:1})]),_:2},1024)])])]),default:n(()=>[y("div",Ge,[J(Z)(t.type)?(_(),C(W,{key:0,type:"warning",style:{height:"22px"}},{default:n(()=>[k(v(e.$t("views.application.workflow")),1)]),_:1})):(_(),C(W,{key:1,class:"blue-tag",style:{height:"22px"}},{default:n(()=>[k(v(e.$t("views.application.simple")),1)]),_:1}))])]),_:2},1032,["title","description","onClick"])]),_:2},1024))),128))]),_:1})]),_:1},8,["size","total","page_size","current_page","loading"])])),[[Ae,h.current_page===1&&u.value,void 0,{fullscreen:!0,lock:!0}]]),a(Me,{ref_key:"CreateApplicationDialogRef",ref:x},null,512),a(Pe,{ref_key:"CopyApplicationDialogRef",ref:S},null,512)])}}});const Ze=Be(Je,[["__scopeId","data-v-e4cf665d"]]);export{Ze as default};
