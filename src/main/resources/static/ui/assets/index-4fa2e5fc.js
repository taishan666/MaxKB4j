import{cp as le,dA as ie,d1 as se,cZ as p,cq as m,d6 as pe,di as Ce,cu as s,cx as _,cF as C,cA as n,cB as y,cz as o,cE as V,cK as b,cJ as v,cT as xe,dZ as ce,d_ as re,d$ as Ae,cQ as M,dn as de,cP as K,ct as Ie,cU as Ve,cy as z,cC as ae,cD as oe,cv as Fe,d5 as U,e0 as Ne,cH as Z,dD as Se,du as te,cN as ne,e1 as De,e2 as Te,e3 as Ue,cY as Me,c_ as j,cR as Le}from"./index-ba87ae2c.js";const Pe={class:"dialog-footer"},Re=le({__name:"CopyApplicationDialog",setup(ue,{expose:P}){const F=ie(),{common:g,user:q}=se(),N=p("views.application.applicationForm.form.prompt.defaultPrompt",{data:"{data}",question:"{question}"}),S=m(),x=m(!1),d=m(!1),r=m({name:"",desc:"",modelId:"",dialogueNumber:0,prologue:p("views.application.applicationForm.form.defaultPrologue"),datasetIdList:[],datasetSetting:{topN:3,similarity:.6,maxParagraphCharNumber:5e3,searchMode:"embedding",noReferencesSetting:{status:"ai_questioning",value:"{question}"}},modelSetting:{prompt:N},problemOptimization:!1,type:"SIMPLE"}),h=pe({name:[{required:!0,message:p("views.application.applicationForm.form.appName.placeholder"),trigger:"blur"}]});Ce(d,c=>{var l;c||(r.value={name:"",desc:"",modelId:"",dialogueNumber:0,prologue:p("views.application.applicationForm.form.defaultPrologue"),datasetIdList:[],datasetSetting:{topN:3,similarity:.6,maxParagraphCharNumber:5e3,searchMode:"embedding",noReferencesSetting:{status:"ai_questioning",value:"{question}"}},modelSetting:{prompt:N},problemOptimization:!1,type:"SIMPLE"},(l=S.value)==null||l.clearValidate())});const D=c=>{const l=xe.cloneDeep(c);delete l.id,l.name=l.name+` ${p("views.application.applicationForm.title.copy")}`,r.value=l,d.value=!0},k=c=>{q.isEnterprise()?A(c):g.asyncGetValid(ce.Application,re.Application,x).then(async l=>{l!=null&&l.data?A(c):Ae(p("common.tip"),p("views.application.tip.professionalMessage"))})},A=async c=>{c&&await c.validate(l=>{l&&M.postApplication(r.value,x).then($=>{de(p("common.createSuccess")),K(r.value.type)?F.push({path:`/application/${$.data.id}/workflow`}):F.push({path:`/application/${$.data.id}/${$.data.type}/setting`}),d.value=!1})})};return P({open:D}),(c,l)=>{const $=s("el-input"),R=s("el-form-item"),E=s("el-form"),B=s("el-button"),O=s("el-dialog");return _(),C(O,{title:c.$t("views.application.copyApplication"),modelValue:d.value,"onUpdate:modelValue":l[4]||(l[4]=w=>d.value=w),width:"650","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:n(()=>[y("span",Pe,[o(B,{onClick:l[2]||(l[2]=V(w=>d.value=!1,["prevent"])),loading:x.value},{default:n(()=>[b(v(c.$t("common.cancel")),1)]),_:1},8,["loading"]),o(B,{type:"primary",onClick:l[3]||(l[3]=w=>k(S.value)),loading:x.value},{default:n(()=>[b(v(c.$t("common.copy")),1)]),_:1},8,["loading"])])]),default:n(()=>[o(E,{ref_key:"applicationFormRef",ref:S,model:r.value,rules:h,"label-position":"top","require-asterisk-position":"right"},{default:n(()=>[o(R,{label:c.$t("views.application.applicationForm.form.appName.label"),prop:"name"},{default:n(()=>[o($,{modelValue:r.value.name,"onUpdate:modelValue":l[0]||(l[0]=w=>r.value.name=w),maxlength:"64",placeholder:c.$t("views.application.applicationForm.form.appName.placeholder"),"show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(R,{label:c.$t("views.application.applicationForm.form.appDescription.label")},{default:n(()=>[o($,{modelValue:r.value.desc,"onUpdate:modelValue":l[1]||(l[1]=w=>r.value.desc=w),type:"textarea",placeholder:c.$t("views.application.applicationForm.form.appDescription.placeholder"),rows:3,maxlength:"256","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}}),Be={class:"application-list-container p-24",style:{"padding-top":"16px"}},ze={class:"flex-between mb-16"},qe={class:"flex-between"},Ee={class:"flex align-center cursor p-8"},Oe=["src"],Ge={class:"status-tag"},He={class:"footer-content"},Je=le({__name:"index",setup(ue){const P=m(),{application:F,user:g,common:q}=se(),N=ie(),S=m(),x=m(),d=m(!1),r=m([]),h=pe({current_page:1,page_size:30,total:0}),D=m([]),k=m("all"),A=m(""),c=m([]);function l(e){F.asyncGetApplicationDetail(e.id,d).then(a=>{a!=null&&a.data&&S.value.open({...a.data,modelId:a.data.model})})}const $=e=>g.userInfo?g.userInfo.id==e.userId:!1;function R(e){K(e.type)?N.push({path:`/application/${e.id}/workflow`}):N.push({path:`/application/${e.id}/${e.type}/setting`})}const E=e=>{M.exportApplication(e.id,e.name,d).catch(a=>{a.response.status!==403&&a.response.data.text().then(i=>{Me(`${p("views.application.tip.ExportError")}:${JSON.parse(i).message}`)})})},B=e=>{const a=new FormData;a.append("file",e.raw,e.name),P.value.clearFiles(),M.importApplication(a,d).then(async i=>{i!=null&&i.data&&w()}).catch(i=>{i.code===400&&j(p("common.tip"),p("views.application.tip.professionalMessage"),{cancelButtonText:p("common.confirm"),confirmButtonText:p("common.professional")}).then(()=>{window.open("https://maxkb.cn/pricing.html","_blank")})})};function O(){q.asyncGetValid(ce.Application,re.Application,d).then(async e=>{e!=null&&e.data?x.value.open():(e==null?void 0:e.code)===400&&j(p("common.tip"),p("views.application.tip.professionalMessage"),{cancelButtonText:p("common.confirm"),confirmButtonText:p("common.professional")}).then(()=>{window.open("https://maxkb.cn/pricing.html","_blank")})})}function w(){g.userInfo&&localStorage.setItem(g.userInfo.id+"application",k.value),r.value=[],h.current_page=1,h.total=0,G()}function Q(e){const a=new URLSearchParams;return e.forEach(i=>{a.append(encodeURIComponent(i.name),encodeURIComponent(i.value))}),a.toString()}function me(e){var i,I,T;(T=(I=(i=r.value.filter(u=>u.id===e)[0])==null?void 0:i.workFlow)==null?void 0:I.nodes)==null||T.filter(u=>u.id==="base-node").map(u=>{c.value=u.properties.api_input_field_list?u.properties.api_input_field_list.map(f=>({name:f.variable,value:f.default_value})):u.properties.inputFieldList?u.properties.inputFieldList.filter(f=>f.assignment_method==="api_input").map(f=>({name:f.variable,value:f.default_value})):[]});const a=Q(c.value)?"?"+Q(c.value):"";F.asyncGetAccessToken(e,d).then(u=>{var f;window.open(F.location+((f=u==null?void 0:u.data)==null?void 0:f.accessToken)+a)})}function fe(e){j(`${p("views.application.delete.confirmTitle")}${e.name} ?`,p("views.application.delete.confirmMessage"),{confirmButtonText:p("common.confirm"),cancelButtonText:p("common.cancel"),confirmButtonClass:"danger"}).then(()=>{M.delApplication(e.id,d).then(()=>{const a=r.value.findIndex(i=>i.id===e.id);r.value.splice(a,1),de(p("common.deleteSuccess"))})}).catch(()=>{})}function G(){const e={...A.value&&{name:A.value},...k.value&&k.value!=="all"&&{select_user_id:k.value}};M.getApplication(h,e,d).then(a=>{a.data.records.forEach(i=>{var I;g.userInfo&&i.userId===g.userInfo.id?i.username=g.userInfo.username:i.username=(I=D.value.find(T=>T.value===i.userId))==null?void 0:I.label}),r.value=[...r.value,...a.data.records],h.total=a.data.total})}function _e(){M.getUserList("APPLICATION",d).then(e=>{if(e.data){if(D.value=e.data.map(a=>({label:a.username,value:a.id})),g.userInfo){const a=localStorage.getItem(g.userInfo.id+"application");a&&D.value.find(i=>i.value===a)&&(k.value=a)}G()}})}return Ie(()=>{_e()}),(e,a)=>{const i=s("el-option"),I=s("el-select"),T=s("el-input"),u=s("el-divider"),f=s("el-upload"),ve=s("el-card"),W=s("el-col"),ge=s("el-text"),Y=s("el-tag"),H=s("el-button"),X=s("el-tooltip"),he=s("MoreFilled"),we=s("el-icon"),J=s("el-dropdown-item"),ye=s("el-dropdown-menu"),be=s("el-dropdown"),ke=s("el-row"),$e=Ve("loading");return _(),z("div",Be,[y("div",ze,[y("h4",null,v(e.$t("views.application.title")),1),y("div",qe,[o(I,{modelValue:k.value,"onUpdate:modelValue":a[0]||(a[0]=t=>k.value=t),class:"mr-12",onChange:w,style:{"max-width":"240px",width:"150px"}},{default:n(()=>[(_(!0),z(ae,null,oe(D.value,t=>(_(),C(i,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(T,{modelValue:A.value,"onUpdate:modelValue":a[1]||(a[1]=t=>A.value=t),onChange:w,placeholder:e.$t("views.application.searchBar.placeholder"),"prefix-icon":"Search",class:"w-240",style:{"min-width":"240px"},clearable:""},null,8,["modelValue","placeholder"])])]),Fe((_(),z("div",null,[o(Te,{size:r.value.length,total:h.total,page_size:h.page_size,current_page:h.current_page,"onUpdate:current_page":a[5]||(a[5]=t=>h.current_page=t),onLoad:G,loading:d.value},{default:n(()=>[o(ke,{gutter:15},{default:n(()=>[o(W,{xs:24,sm:12,md:8,lg:6,xl:6,class:"mb-16"},{default:n(()=>[o(ve,{shadow:"hover",class:"application-card-add",style:{"--el-card-padding":"8px"}},{default:n(()=>[y("div",{class:"card-add-button flex align-center cursor p-8",onClick:O},[o(U,{iconName:"app-add-application",class:"mr-8"}),b(" "+v(e.$t("views.application.createApplication")),1)]),o(u,{style:{margin:"8px 0"}}),o(f,{ref_key:"elUploadRef",ref:P,"file-list":[],action:"#",multiple:"","auto-upload":!1,"show-file-list":!1,limit:1,"on-change":(t,ee)=>B(t),class:"card-add-button"},{default:n(()=>[y("div",Ee,[o(U,{iconName:"app-import",class:"mr-8"}),b(" "+v(e.$t("views.application.importApplication")),1)])]),_:1},8,["on-change"])]),_:1})]),_:1}),(_(!0),z(ae,null,oe(r.value,(t,ee)=>(_(),C(W,{xs:24,sm:12,md:8,lg:6,xl:6,key:ee,class:"mb-16"},{default:n(()=>[o(Ne,{title:t.name,description:t.desc,class:"application-card cursor",onClick:L=>Z(N).push({path:`/application/${t.id}/${t.type}/overview`})},{icon:n(()=>[Z(Se)(t==null?void 0:t.icon)?(_(),C(te,{key:0,shape:"square",size:32,style:{background:"none"},class:"mr-8"},{default:n(()=>[y("img",{src:t==null?void 0:t.icon,alt:""},null,8,Oe)]),_:2},1024)):t!=null&&t.name?(_(),C(te,{key:1,name:t==null?void 0:t.name,pinyinColor:"",shape:"square",size:32,class:"mr-8"},null,8,["name"])):ne("",!0)]),subTitle:n(()=>[o(ge,{class:"color-secondary",size:"small"},{default:n(()=>[o(De,{content:t.username},{default:n(()=>[b(v(e.$t("common.creator"))+": "+v(t.username),1)]),_:2},1032,["content"])]),_:2},1024)]),footer:n(()=>[y("div",He,[o(X,{effect:"dark",content:e.$t("views.application.setting.demo"),placement:"top"},{default:n(()=>[o(H,{text:"",onClick:[a[2]||(a[2]=V(()=>{},["stop"])),L=>me(t.id)]},{default:n(()=>[o(U,{iconName:"app-view"})]),_:2},1032,["onClick"])]),_:2},1032,["content"]),o(u,{direction:"vertical"}),o(X,{effect:"dark",content:e.$t("common.setting"),placement:"top"},{default:n(()=>[o(H,{text:"",onClick:V(L=>R(t),["stop"])},{default:n(()=>[o(U,{iconName:"Setting"})]),_:2},1032,["onClick"])]),_:2},1032,["content"]),o(u,{direction:"vertical"}),y("span",{onClick:a[4]||(a[4]=V(()=>{},["stop"]))},[o(be,{trigger:"click"},{dropdown:n(()=>[o(ye,null,{default:n(()=>[$(t)?(_(),C(J,{key:0,onClick:L=>l(t)},{default:n(()=>[o(U,{iconName:"app-copy"}),b(" "+v(e.$t("common.copy")),1)]),_:2},1032,["onClick"])):ne("",!0),o(J,{onClick:V(L=>E(t),["stop"])},{default:n(()=>[o(U,{iconName:"app-export"}),b(" "+v(e.$t("common.export")),1)]),_:2},1032,["onClick"]),o(J,{icon:"Delete",onClick:V(L=>fe(t),["stop"])},{default:n(()=>[b(v(e.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:n(()=>[o(H,{text:"",onClick:a[3]||(a[3]=V(()=>{},["stop"]))},{default:n(()=>[o(we,null,{default:n(()=>[o(he)]),_:1})]),_:1})]),_:2},1024)])])]),default:n(()=>[y("div",Ge,[Z(K)(t.type)?(_(),C(Y,{key:0,type:"warning",style:{height:"22px"}},{default:n(()=>[b(v(e.$t("views.application.workflow")),1)]),_:1})):(_(),C(Y,{key:1,class:"blue-tag",style:{height:"22px"}},{default:n(()=>[b(v(e.$t("views.application.simple")),1)]),_:1}))])]),_:2},1032,["title","description","onClick"])]),_:2},1024))),128))]),_:1})]),_:1},8,["size","total","page_size","current_page","loading"])])),[[$e,h.current_page===1&&d.value,void 0,{fullscreen:!0,lock:!0}]]),o(Ue,{ref_key:"CreateApplicationDialogRef",ref:x},null,512),o(Re,{ref_key:"CopyApplicationDialogRef",ref:S},null,512)])}}});const je=Le(Je,[["__scopeId","data-v-99dfb74a"]]);export{je as default};
