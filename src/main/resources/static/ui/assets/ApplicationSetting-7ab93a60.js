import{cp as je,d1 as He,dy as Je,cZ as h,cq as u,d6 as Qe,ct as Ze,cu as s,cU as Xe,cx as p,cF as r,cA as o,cB as n,cJ as d,cz as t,cK as c,cv as E,cE as ie,cy as q,cC as Ye,cD as el,cH as k,dt as N,dv as ll,dw as al,cN as b,cw as se,dD as tl,dn as ol,cQ as U,cT as L,cR as nl}from"./index-eeff5fe9.js";import{A as il,T as sl,a as dl,b as pl,_ as ul}from"./ReasoningParamSettingDialog.vue_vue_type_style_index_0_scope_true_lang-8198dc9e.js";import{_ as rl}from"./EditAvatarDialog.vue_vue_type_script_setup_true_lang-c674b9b0.js";const ml={class:"flex-between w-full"},cl={class:"p-24 mb-16",style:{"padding-bottom":"0"}},vl={class:"title-decoration-1"},fl={class:"scrollbar-height-left"},gl={class:"flex-between"},_l={class:"flex-between"},bl={class:"flex-between"},yl={class:"w-full"},hl={class:"flex-between"},wl={class:"flex align-center",style:{width:"80%"}},Sl=["title"],Ml={class:"flex-between"},Il={class:"mr-4"},Vl={class:"flex"},kl={class:"flex-between"},Pl={class:"mr-4"},$l={key:0,class:"danger"},Fl={class:"flex"},Dl={class:"flex-between"},Tl={class:"mr-4"},Rl={key:0,class:"danger"},Al={class:"flex"},Cl={class:"w-full"},El={class:"flex-between w-full"},ql={class:"title-decoration-1 mb-16"},Nl={class:"dialog-bg"},Ul={class:"flex align-center p-24"},Ll=["src"],Bl={class:"scrollbar-height"},Ol=je({__name:"ApplicationSetting",setup(zl){const{model:Kl,application:P}=He(),de=Je(),{params:{id:v}}=de,pe=h("views.application.applicationForm.form.prompt.defaultPrompt",{data:"{data}",question:"{question}"}),ue=h("views.application.applicationForm.dialog.defaultPrompt1",{question:"{question}"})+"<data></data>"+h("views.application.applicationForm.dialog.defaultPrompt2"),$=u(),B=u(),F=u(),O=u(),z=u(),K=u(),W=u(),m=u(!1),x=u(!1),l=u({name:"",desc:"",modelId:"",dialogueNumber:1,prologue:h("views.application.applicationForm.form.defaultPrologue"),datasetIdList:[],datasetSetting:{topN:3,similarity:.6,maxParagraphCharNumber:5e3,searchMode:"embedding",noReferencesSetting:{status:"ai_questioning",value:"{question}"}},modelSetting:{prompt:pe,system:h("views.application.applicationForm.form.roleSettings.placeholder"),noReferencesPrompt:"{question}",reasoningContentEnable:!1},modelParamsSetting:{},problemOptimization:!1,problemOptimizationPrompt:ue,sttModelId:"",ttsModelId:"",sttModelEnable:!1,sttAutoSend:!1,ttsModelEnable:!1,ttsType:"BROWSER",type:"SIMPLE"}),re=Qe({name:[{required:!0,message:h("views.application.applicationForm.form.appName.placeholder"),trigger:"blur"}]}),G=u(null),w=u([]),j=u(null),H=u(null),D=u(!1);function me(e){l.value.prologue=e}function ce(e){l.value.modelSetting.system=e}function ve(e){l.value.modelSetting={...l.value.modelSetting,...e}}const fe=async e=>{e&&await e.validate((a,_)=>{a&&P.asyncPutApplication(v,l.value,m).then(T=>{ol(h("common.saveSuccess"))})})},ge=e=>{var a;l.value.modelId=e,e?(a=$.value)==null||a.reset_default(e,v):J({})},_e=()=>{var e;l.value.modelId&&((e=$.value)==null||e.open(l.value.modelId,v,l.value.modelParamsSetting))},be=()=>{var e;(e=B.value)==null||e.open(l.value.modelSetting)},ye=()=>{var e;l.value.ttsModelId&&((e=F.value)==null||e.open(l.value.ttsModelId,v,l.value.ttsModelParamsSetting))},he=()=>{var e;(e=O.value)==null||e.open(l.value)};function we(e){l.value={...l.value,...e}}function J(e){l.value.modelParamsSetting=e}function Q(e){l.value.ttsModelParamsSetting=e}function Se(e){l.value.datasetIdList&&l.value.datasetIdList.splice(l.value.datasetIdList.indexOf(e),1)}function Me(e){l.value.datasetIdList=e}function Ie(){K.value.open(l.value.datasetIdList)}function Z(){P.asyncGetApplicationDetail(v,m).then(e=>{l.value=e.data,l.value.modelId=e.data.model,l.value.sttModelId=e.data.sttModel,l.value.ttsModelId=e.data.ttsModel,l.value.ttsType=e.data.ttsType,l.value.modelSetting.noReferencesPrompt=e.data.modelSetting.noReferencesPrompt||"{question}"})}function X(){P.asyncGetApplicationDataset(v,x).then(e=>{w.value=e.data})}function Y(){m.value=!0,U.getApplicationModel(v).then(e=>{G.value=L.groupBy(e==null?void 0:e.data,"provider"),m.value=!1}).catch(()=>{m.value=!1})}function Ve(){m.value=!0,U.getApplicationSTTModel(v).then(e=>{j.value=L.groupBy(e==null?void 0:e.data,"provider"),m.value=!1}).catch(()=>{m.value=!1})}function ke(){m.value=!0,U.getApplicationTTSModel(v).then(e=>{H.value=L.groupBy(e==null?void 0:e.data,"provider"),m.value=!1}).catch(()=>{m.value=!1})}function Pe(){var e;l.value.ttsModelId?(e=F.value)==null||e.reset_default(l.value.ttsModelId,v):Q({})}function $e(){l.value.ttsModelEnable||(l.value.ttsModelId="",l.value.ttsType="BROWSER")}function ee(){l.value.sttModelEnable||(l.value.sttModelId="")}function Fe(){W.value.open(l.value)}function De(){Z()}function Te(){X()}return Ze(()=>{Y(),X(),Z(),Ve(),ke()}),(e,a)=>{const _=s("el-button"),T=s("el-input"),f=s("el-form-item"),R=s("ModelSelect"),le=s("MdEditorMagnify"),Re=s("el-input-number"),Ae=s("AppIcon"),Ce=s("Plus"),S=s("el-icon"),Ee=s("el-text"),M=s("AppAvatar"),qe=s("Close"),Ne=s("el-card"),A=s("el-col"),ae=s("el-row"),Ue=s("Setting"),C=s("el-switch"),te=s("el-checkbox"),oe=s("el-radio"),Le=s("el-radio-group"),Be=s("Operation"),Oe=s("el-form"),ze=s("el-scrollbar"),Ke=s("EditPen"),We=s("AiChat"),xe=s("LayoutContainer"),Ge=Xe("loading");return p(),r(xe,{class:"create-application"},{header:o(()=>[n("div",ml,[n("h3",null,d(e.$t("common.setting")),1),t(_,{type:"primary",onClick:a[0]||(a[0]=i=>fe(z.value)),disabled:m.value},{default:o(()=>[c(d(e.$t("views.application.applicationForm.buttons.publish")),1)]),_:1},8,["disabled"])])]),default:o(()=>[E((p(),r(ae,null,{default:o(()=>[t(A,{span:10},{default:o(()=>[n("div",cl,[n("h4",vl,d(e.$t("views.applicationOverview.appInfo.header")),1)]),n("div",fl,[t(ze,null,{default:o(()=>[t(Oe,{"hide-required-asterisk":"",ref_key:"applicationFormRef",ref:z,model:l.value,rules:re,"label-position":"top","require-asterisk-position":"right",class:"p-24",style:{"padding-top":"0"}},{default:o(()=>[t(f,{prop:"name"},{label:o(()=>[n("div",gl,[n("span",null,[c(d(e.$t("views.application.applicationForm.form.appName.label"))+" ",1),a[21]||(a[21]=n("span",{class:"danger"},"*",-1))])])]),default:o(()=>[t(T,{modelValue:l.value.name,"onUpdate:modelValue":a[1]||(a[1]=i=>l.value.name=i),maxlength:"64",placeholder:e.$t("views.application.applicationForm.form.appName.placeholder"),"show-word-limit":"",onBlur:a[2]||(a[2]=i=>{var g;return l.value.name=(g=l.value.name)==null?void 0:g.trim()})},null,8,["modelValue","placeholder"])]),_:1}),t(f,{label:e.$t("views.application.applicationForm.form.appDescription.label")},{default:o(()=>[t(T,{modelValue:l.value.desc,"onUpdate:modelValue":a[3]||(a[3]=i=>l.value.desc=i),type:"textarea",placeholder:e.$t("views.application.applicationForm.form.appDescription.placeholder"),rows:3,maxlength:"256","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(f,{label:e.$t("views.application.applicationForm.form.aiModel.label")},{label:o(()=>[n("div",_l,[n("span",null,d(e.$t("views.application.applicationForm.form.aiModel.label")),1),t(_,{type:"primary",link:"",onClick:_e,disabled:!l.value.modelId},{default:o(()=>[c(d(e.$t("common.paramSetting")),1)]),_:1},8,["disabled"])])]),default:o(()=>[t(R,{modelValue:l.value.modelId,"onUpdate:modelValue":a[4]||(a[4]=i=>l.value.modelId=i),placeholder:e.$t("views.application.applicationForm.form.aiModel.placeholder"),options:G.value,onChange:ge,onSubmitModel:Y,showFooter:""},null,8,["modelValue","placeholder","options"])]),_:1},8,["label"]),t(f,{label:e.$t("views.application.applicationForm.form.roleSettings.label")},{default:o(()=>[t(le,{title:e.$t("views.application.applicationForm.form.roleSettings.label"),modelValue:l.value.modelSetting.system,"onUpdate:modelValue":a[5]||(a[5]=i=>l.value.modelSetting.system=i),style:{height:"120px"},onSubmitDialog:ce,placeholder:e.$t("views.application.applicationForm.form.roleSettings.placeholder")},null,8,["title","modelValue","placeholder"])]),_:1},8,["label"]),t(f,{label:e.$t("views.application.applicationForm.form.historyRecord.label"),onClick:a[7]||(a[7]=ie(()=>{},["prevent"]))},{default:o(()=>[t(Re,{modelValue:l.value.dialogueNumber,"onUpdate:modelValue":a[6]||(a[6]=i=>l.value.dialogueNumber=i),min:0,"value-on-clear":0,"controls-position":"right",class:"w-full",step:1,"step-strictly":!0},null,8,["modelValue"])]),_:1},8,["label"]),t(f,{label:"$t('views.application.applicationForm.form.relatedKnowledgeBase')"},{label:o(()=>[n("div",bl,[n("span",null,d(e.$t("views.application.applicationForm.form.relatedKnowledge.label")),1),n("div",null,[t(_,{type:"primary",link:"",onClick:he},{default:o(()=>[t(Ae,{iconName:"app-operation",class:"mr-4"}),c(" "+d(e.$t("common.paramSetting")),1)]),_:1}),t(_,{type:"primary",link:"",onClick:Ie},{default:o(()=>[t(S,{class:"mr-4"},{default:o(()=>[t(Ce)]),_:1}),c(" "+d(e.$t("common.add")),1)]),_:1})])])]),default:o(()=>{var i;return[n("div",yl,[((i=l.value.datasetIdList)==null?void 0:i.length)===0?(p(),r(Ee,{key:0,type:"info"},{default:o(()=>[c(d(e.$t("views.application.applicationForm.form.relatedKnowledge.placeholder")),1)]),_:1})):(p(),r(ae,{key:1,gutter:12},{default:o(()=>[(p(!0),q(Ye,null,el(l.value.datasetIdList,(g,V)=>(p(),r(A,{xs:24,sm:24,md:24,lg:12,xl:12,class:"mb-8",key:V},{default:o(()=>[t(Ne,{class:"relate-dataset-card border-r-4",shadow:"never"},{default:o(()=>{var I,y,ne;return[n("div",hl,[n("div",wl,[((I=k(N)(w.value,g,"id"))==null?void 0:I.type)==="1"?(p(),r(M,{key:0,class:"mr-8 avatar-purple",shape:"square",size:32},{default:o(()=>a[22]||(a[22]=[n("img",{src:ll,style:{width:"58%"},alt:""},null,-1)])),_:1})):(p(),r(M,{key:1,class:"mr-8 avatar-blue",shape:"square",size:32},{default:o(()=>a[23]||(a[23]=[n("img",{src:al,style:{width:"58%"},alt:""},null,-1)])),_:1})),n("span",{class:"ellipsis cursor",title:(y=k(N)(w.value,g,"id"))==null?void 0:y.name},d((ne=k(N)(w.value,g,"id"))==null?void 0:ne.name),9,Sl)]),t(_,{text:"",onClick:Wl=>Se(g)},{default:o(()=>[t(S,null,{default:o(()=>[t(qe)]),_:1})]),_:2},1032,["onClick"])])]}),_:2},1024)]),_:2},1024))),128))]),_:1}))])]}),_:1}),t(f,{label:e.$t("views.application.applicationForm.form.prologue")},{default:o(()=>[t(le,{title:e.$t("views.application.applicationForm.form.prologue"),modelValue:l.value.prologue,"onUpdate:modelValue":a[8]||(a[8]=i=>l.value.prologue=i),style:{height:"150px"},onSubmitDialog:me},null,8,["title","modelValue"])]),_:1},8,["label"]),t(f,{onClick:a[10]||(a[10]=ie(()=>{},["prevent"]))},{label:o(()=>[n("div",Ml,[n("span",Il,d(e.$t("views.application.applicationForm.form.reasoningContent.label")),1),n("div",Vl,[t(_,{type:"primary",link:"",onClick:be},{default:o(()=>[t(S,null,{default:o(()=>[t(Ue)]),_:1})]),_:1}),t(C,{class:"ml-8",size:"small",modelValue:l.value.modelSetting.reasoning_content_enable,"onUpdate:modelValue":a[9]||(a[9]=i=>l.value.modelSetting.reasoning_content_enable=i),onChange:ee},null,8,["modelValue"])])])]),_:1}),t(f,{prop:"sttModelId",rules:{required:l.value.sttModelEnable,message:e.$t("views.application.applicationForm.form.voiceInput.requiredMessage"),trigger:"change"}},{label:o(()=>[n("div",kl,[n("span",Pl,[c(d(e.$t("views.application.applicationForm.form.voiceInput.label"))+" ",1),l.value.sttModelEnable?(p(),q("span",$l,"*")):b("",!0)]),n("div",Fl,[l.value.sttModelEnable?(p(),r(te,{key:0,modelValue:l.value.sttAutoSend,"onUpdate:modelValue":a[11]||(a[11]=i=>l.value.sttAutoSend=i)},{default:o(()=>[c(d(e.$t("views.application.applicationForm.form.voiceInput.autoSend")),1)]),_:1},8,["modelValue"])):b("",!0),t(C,{class:"ml-8",size:"small",modelValue:l.value.sttModelEnable,"onUpdate:modelValue":a[12]||(a[12]=i=>l.value.sttModelEnable=i),onChange:ee},null,8,["modelValue"])])])]),default:o(()=>[E(t(R,{modelValue:l.value.sttModelId,"onUpdate:modelValue":a[13]||(a[13]=i=>l.value.sttModelId=i),placeholder:e.$t("views.application.applicationForm.form.voiceInput.placeholder"),options:j.value},null,8,["modelValue","placeholder","options"]),[[se,l.value.sttModelEnable]])]),_:1},8,["rules"]),t(f,{prop:"ttsModelId",rules:{required:l.value.ttsType==="TTS"&&l.value.ttsModelEnable,message:e.$t("views.application.applicationForm.form.voicePlay.requiredMessage"),trigger:"change"}},{label:o(()=>[n("div",Dl,[n("span",Tl,[c(d(e.$t("views.application.applicationForm.form.voicePlay.label"))+" ",1),l.value.ttsType==="TTS"&&l.value.ttsModelEnable?(p(),q("span",Rl,"*")):b("",!0)]),n("div",Al,[l.value.ttsModelEnable?(p(),r(te,{key:0,modelValue:l.value.ttsAutoplay,"onUpdate:modelValue":a[14]||(a[14]=i=>l.value.ttsAutoplay=i)},{default:o(()=>[c(d(e.$t("views.application.applicationForm.form.voicePlay.autoPlay")),1)]),_:1},8,["modelValue"])):b("",!0),t(C,{class:"ml-8",size:"small",modelValue:l.value.ttsModelEnable,"onUpdate:modelValue":a[15]||(a[15]=i=>l.value.ttsModelEnable=i),onChange:$e},null,8,["modelValue"])])])]),default:o(()=>[n("div",Cl,[E(t(Le,{modelValue:l.value.ttsType,"onUpdate:modelValue":a[16]||(a[16]=i=>l.value.ttsType=i),class:"mb-8"},{default:o(()=>[t(oe,{value:"BROWSER"},{default:o(()=>[c(d(e.$t("views.application.applicationForm.form.voicePlay.browser")),1)]),_:1}),t(oe,{value:"TTS"},{default:o(()=>[c(d(e.$t("views.application.applicationForm.form.voicePlay.tts")),1)]),_:1})]),_:1},8,["modelValue"]),[[se,l.value.ttsModelEnable]])]),n("div",El,[l.value.ttsType==="TTS"&&l.value.ttsModelEnable?(p(),r(R,{key:0,modelValue:l.value.ttsModelId,"onUpdate:modelValue":a[17]||(a[17]=i=>l.value.ttsModelId=i),placeholder:e.$t("views.application.applicationForm.form.voicePlay.placeholder"),options:H.value,onChange:a[18]||(a[18]=i=>Pe())},null,8,["modelValue","placeholder","options"])):b("",!0),l.value.ttsType==="TTS"?(p(),r(_,{key:1,onClick:ye,disabled:!l.value.ttsModelId,class:"ml-8"},{default:o(()=>[t(S,null,{default:o(()=>[t(Be)]),_:1})]),_:1},8,["disabled"])):b("",!0)])]),_:1},8,["rules"])]),_:1},8,["model","rules"])]),_:1})])]),_:1}),t(A,{span:14,class:"p-24 border-l"},{default:o(()=>{var i,g,V,I;return[n("h4",ql,d(e.$t("views.application.applicationForm.title.appTest")),1),n("div",Nl,[n("div",Ul,[n("div",{class:"edit-avatar mr-12",onMouseenter:a[19]||(a[19]=y=>D.value=!0),onMouseleave:a[20]||(a[20]=y=>D.value=!1)},[k(tl)((i=l.value)==null?void 0:i.icon)?(p(),r(M,{key:0,shape:"square",size:32,style:{background:"none"}},{default:o(()=>{var y;return[n("img",{src:(y=l.value)==null?void 0:y.icon,alt:""},null,8,Ll)]}),_:1})):(g=l.value)!=null&&g.name?(p(),r(M,{key:1,name:(V=l.value)==null?void 0:V.name,pinyinColor:"",shape:"square",size:32},null,8,["name"])):b("",!0),D.value?(p(),r(M,{key:2,shape:"square",class:"edit-mask",size:32,onClick:Fe},{default:o(()=>[t(S,null,{default:o(()=>[t(Ke)]),_:1})]),_:1})):b("",!0)],32),n("h4",null,d(((I=l.value)==null?void 0:I.name)||e.$t("views.application.applicationForm.form.appName.label")),1)]),n("div",Bl,[t(We,{applicationDetails:l.value,type:"debug-ai-chat"},null,8,["applicationDetails"])])])]}),_:1})]),_:1})),[[Ge,m.value]]),t(il,{ref_key:"AIModeParamSettingDialogRef",ref:$,onRefresh:J},null,512),t(sl,{ref_key:"TTSModeParamSettingDialogRef",ref:F,onRefresh:Q},null,512),t(dl,{ref_key:"ParamSettingDialogRef",ref:O,onRefresh:we},null,512),t(pl,{ref_key:"AddDatasetDialogRef",ref:K,onAddData:Me,data:w.value,onRefresh:Te,loading:x.value},null,8,["data","loading"]),t(rl,{ref_key:"EditAvatarDialogRef",ref:W,onRefresh:De},null,512),t(ul,{ref_key:"ReasoningParamSettingDialogRef",ref:B,onRefresh:ve},null,512)]),_:1})}}});const Hl=nl(Ol,[["__scopeId","data-v-0a997928"]]);export{Hl as default};
