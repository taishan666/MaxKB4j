var mt=Object.defineProperty;var pt=(P,S,N)=>S in P?mt(P,S,{enumerable:!0,configurable:!0,writable:!0,value:N}):P[S]=N;var Ae=(P,S,N)=>(pt(P,typeof S!="symbol"?S+"":S,N),N);import{cp as re,dy as Se,cq as w,d6 as vt,cZ as v,di as Ge,cu as u,cx as p,cF as y,cA as e,cB as E,cz as t,cE as W,cK as o,cJ as n,cN as Q,cy as ae,cC as he,cD as ke,cH as i,ex as j,dn as Z,d1 as Be,cU as Le,cV as Y,cv as Pe,dw as ft,dv as _t,cr as ve,cT as Ue,dH as gt,dA as yt,eB as ht,eC as kt,ct as Et,dC as bt,ec as Ct,dz as Ie,c_ as ge,cY as St,cR as $t}from"./index-2f436c9e.js";import{S as Dt}from"./SyncWebDialog-e8ba2ad2.js";import{_ as wt}from"./index.vue_vue_type_style_index_0_scope_true_lang-2d244417.js";var ye=(P=>(P.optimization="views.document.hitHandlingMethod.optimization",P.directly_return="views.document.hitHandlingMethod.directly_return",P))(ye||{});const Rt={class:"flex align-center"},Mt={class:"mr-4"},Nt={class:"lighter w-full",style:{"margin-top":"-20px"}},Tt={class:"dialog-footer"},At=re({__name:"ImportDocumentDialog",props:{title:String},emits:["refresh"],setup(P,{expose:S,emit:N}){const R=Se(),{params:{id:h}}=R,O=N,k=w(),_=w(!1),f=w(!1),s=w({sourceUrl:"",selector:"",hitHandlingMethod:"optimization",directlyReturnSimilarity:.9}),M=w(""),U=w(""),$=w([]),g=vt({sourceUrl:[{required:!0,message:v("views.document.form.sourceUrl.requiredMessage"),trigger:"blur"}],directlyReturnSimilarity:[{required:!0,message:v("views.document.form.similarity.requiredMessage"),trigger:"blur"}]}),b=w(!1);Ge(b,m=>{m||(s.value={sourceUrl:"",selector:"",hitHandlingMethod:"optimization",directlyReturnSimilarity:.9},f.value=!1,U.value="",M.value="",$.value=[])});const C=(m,D)=>{m?(U.value=m.type,M.value=m.id,s.value={hitHandlingMethod:m.hitHandlingMethod,directlyReturnSimilarity:m.directlyReturnSimilarity,...m.meta},f.value=!1):D?$.value=D:(U.value="1",f.value=!0),b.value=!0},B=async m=>{m&&await m.validate(D=>{if(D){if(f.value){const L={sourceUrlList:s.value.sourceUrl.split(`
`),selector:s.value.selector};j.postWebDocument(h,L,_).then(()=>{Z(v("views.document.tip.importMessage")),O("refresh"),b.value=!1})}else if(M.value){const L={hitHandlingMethod:s.value.hitHandlingMethod,directlyReturnSimilarity:s.value.directlyReturnSimilarity,meta:{sourceUrl:s.value.sourceUrl,selector:s.value.selector}};j.putDocument(h,M.value,L,_).then(()=>{Z(v("common.settingSuccess")),O("refresh"),b.value=!1})}else if($.value.length>0){const L={hitHandlingMethod:s.value.hitHandlingMethod,directlyReturnSimilarity:s.value.directlyReturnSimilarity,id_list:$.value};j.batchEditHitHandling(h,L,_).then(()=>{Z(v("common.settingSuccess")),O("refresh"),b.value=!1})}}})};return S({open:C}),(m,D)=>{const L=u("el-input"),z=u("el-form-item"),J=u("AppIcon"),ee=u("el-tooltip"),V=u("el-radio"),le=u("el-radio-group"),ie=u("el-input-number"),ue=u("el-form"),oe=u("el-button"),ce=u("el-dialog");return p(),y(ce,{title:P.title,modelValue:b.value,"onUpdate:modelValue":D[7]||(D[7]=H=>b.value=H),"close-on-click-modal":!1,"close-on-press-escape":!1,"destroy-on-close":!0},{footer:e(()=>[E("span",Tt,[t(oe,{onClick:D[5]||(D[5]=W(H=>b.value=!1,["prevent"]))},{default:e(()=>[o(n(m.$t("common.cancel")),1)]),_:1}),t(oe,{type:"primary",onClick:D[6]||(D[6]=H=>B(k.value)),loading:_.value},{default:e(()=>[o(n(m.$t("common.confirm")),1)]),_:1},8,["loading"])])]),default:e(()=>[t(ue,{"label-position":"top",ref_key:"webFormRef",ref:k,rules:g,model:s.value,"require-asterisk-position":"right"},{default:e(()=>[f.value?(p(),y(z,{key:0,label:m.$t("views.document.form.sourceUrl.label"),prop:"sourceUrl"},{default:e(()=>[t(L,{modelValue:s.value.sourceUrl,"onUpdate:modelValue":D[0]||(D[0]=H=>s.value.sourceUrl=H),placeholder:m.$t("views.document.form.sourceUrl.placeholder"),rows:10,type:"textarea"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):!f.value&&U.value==="1"?(p(),y(z,{key:1,label:m.$t("views.document.form.sourceUrl.label"),prop:"sourceUrl"},{default:e(()=>[t(L,{modelValue:s.value.sourceUrl,"onUpdate:modelValue":D[1]||(D[1]=H=>s.value.sourceUrl=H),placeholder:m.$t("views.document.form.sourceUrl.requiredMessage")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):Q("",!0),U.value==="1"?(p(),y(z,{key:2,label:m.$t("views.document.form.selector.label")},{default:e(()=>[t(L,{modelValue:s.value.selector,"onUpdate:modelValue":D[2]||(D[2]=H=>s.value.selector=H),placeholder:m.$t("views.document.form.selector.placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):Q("",!0),f.value?Q("",!0):(p(),y(z,{key:3},{label:e(()=>[E("div",Rt,[E("span",Mt,n(m.$t("views.document.form.hitHandlingMethod.label")),1),t(ee,{effect:"dark",content:m.$t("views.document.form.hitHandlingMethod.tooltip"),placement:"right"},{default:e(()=>[t(J,{iconName:"app-warning",class:"app-warning-icon"})]),_:1},8,["content"])])]),default:e(()=>[t(le,{modelValue:s.value.hitHandlingMethod,"onUpdate:modelValue":D[3]||(D[3]=H=>s.value.hitHandlingMethod=H),class:"radio-block mt-4"},{default:e(()=>[(p(!0),ae(he,null,ke(i(ye),(H,G)=>(p(),y(V,{key:G,value:G},{default:e(()=>[o(n(m.$t(H)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})),!f.value&&s.value.hitHandlingMethod==="directly_return"?(p(),y(z,{key:4,prop:"directlyReturnSimilarity"},{default:e(()=>[E("div",Nt,[E("span",null,n(m.$t("views.document.form.similarity.label")),1),t(ie,{modelValue:s.value.directlyReturnSimilarity,"onUpdate:modelValue":D[4]||(D[4]=H=>s.value.directlyReturnSimilarity=H),min:0,max:1,precision:3,step:.1,"value-on-clear":0,"controls-position":"right",size:"small",class:"ml-4 mr-4"},null,8,["modelValue"]),E("span",null,n(m.$t("views.document.form.similarity.placeholder")),1)])]),_:1})):Q("",!0)]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])}}}),Ut={class:"my-header flex"},It=["id"],Vt={class:"content-height"},Gt={class:"p-16"},Bt={class:"flex align-center"},Lt={class:"ellipsis"},Pt={class:"dialog-footer"},zt=re({__name:"SelectDatasetDialog",emits:["refresh"],setup(P,{expose:S,emit:N}){const{dataset:R}=Be(),h=Se(),{params:{id:O}}=h,k=N,_=w(!1),f=w(!1),s=w(""),M=w([]),U=w([]);Ge(f,B=>{B||(s.value="",M.value=[],U.value=[])});const $=B=>{U.value=B,b(),f.value=!0},g=()=>{j.putMigrateMulDocument(O,s.value,U.value,_).then(B=>{k("refresh"),f.value=!1})};function b(){R.asyncGetAllDataset(_).then(B=>{var m;M.value=(m=B.data)==null?void 0:m.filter(D=>D.id!==O)})}const C=()=>{b()};return S({open:$}),(B,m)=>{const D=u("Refresh"),L=u("el-icon"),z=u("el-button"),J=u("AppAvatar"),ee=u("el-radio"),V=u("el-card"),le=u("el-col"),ie=u("el-row"),ue=u("el-scrollbar"),oe=u("el-radio-group"),ce=u("el-dialog"),H=Le("loading");return p(),y(ce,{title:B.$t("views.log.selectDataset"),modelValue:f.value,"onUpdate:modelValue":m[2]||(m[2]=G=>f.value=G),width:"600",class:"select-dataset-dialog","close-on-click-modal":!1,"close-on-press-escape":!1},{header:e(({titleId:G,titleClass:se})=>[E("div",Ut,[E("h4",{id:G,class:Y(se)},n(B.$t("views.log.selectDataset")),11,It),t(z,{link:"",class:"ml-16",onClick:C},{default:e(()=>[t(L,{class:"mr-4"},{default:e(()=>[t(D)]),_:1}),o(n(B.$t("common.refresh")),1)]),_:1})])]),footer:e(()=>[E("span",Pt,[t(z,{onClick:m[1]||(m[1]=W(G=>f.value=!1,["prevent"]))},{default:e(()=>[o(n(B.$t("common.cancel")),1)]),_:1}),t(z,{type:"primary",onClick:g,disabled:!s.value||_.value},{default:e(()=>[o(n(B.$t("common.confirm")),1)]),_:1},8,["disabled"])])]),default:e(()=>[E("div",Vt,[t(oe,{modelValue:s.value,"onUpdate:modelValue":m[0]||(m[0]=G=>s.value=G),class:"card__radio"},{default:e(()=>[t(ue,{height:"500"},{default:e(()=>[E("div",Gt,[Pe((p(),y(ie,{gutter:12},{default:e(()=>[(p(!0),ae(he,null,ke(M.value,(G,se)=>(p(),y(le,{span:12,key:se,class:"mb-16"},{default:e(()=>[t(V,{shadow:"never",class:Y(["mb-8",G.id===s.value?"active":""])},{default:e(()=>[t(ee,{value:G.id,size:"large"},{default:e(()=>[E("div",Bt,[(G==null?void 0:G.type)==="0"?(p(),y(J,{key:0,class:"mr-8 avatar-blue",shape:"square",size:32},{default:e(()=>m[3]||(m[3]=[E("img",{src:ft,style:{width:"58%"},alt:""},null,-1)])),_:1})):Q("",!0),(G==null?void 0:G.type)==="1"?(p(),y(J,{key:1,class:"mr-8 avatar-purple",shape:"square",size:32},{default:e(()=>m[4]||(m[4]=[E("img",{src:_t,style:{width:"58%"},alt:""},null,-1)])),_:1})):Q("",!0),E("span",Lt,n(G.name),1)])]),_:2},1032,["value"])]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),[[H,_.value]])])]),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["title","modelValue"])}}});const A={EMBEDDING:1,GENERATE_PROBLEM:2,SYNC:3},r={PENDING:"0",STARTED:"1",SUCCESS:"2",FAILURE:"3",REVOKE:"4",REVOKED:"5",IGNORED:"n"};class Ve{constructor(S){Ae(this,"task_status");S||(S=""),S=S.split("").reverse().join(""),this.task_status={};for(let N in A){const R=A[N],h=R-1;this.task_status[R]=S[h]?S[h]:"n"}}toString(){const S=[];for(let N in A){const R=A[N];S.push(this.task_status[R])}return S.reverse().join("")}}const Ht=re({__name:"StatusTable",props:{status:{},statusMeta:{},stateMap:{},taskTypeMap:{}},setup(P){const S=P,N=k=>{const _=new Ve(k.status);return Object.keys(A).map(f=>{const s=A[f];return{[s]:{[_.task_status[s]]:k.count}}}).reduce((f,s)=>({...f,...s}),{})},R=(k,_)=>k==null&&_?_:_==null&&k?k:typeof k=="object"&&typeof _=="object"?Ue.mergeWith(k,_,R):k+_,h=ve(()=>(S.statusMeta.aggs?S.statusMeta.aggs:[]).map(k=>N(k)).reduce((k,_)=>Ue.mergeWith(k,_,R),{})),O=ve(()=>Object.keys(A).map(k=>{const _=A[k],f=new Ve(S.status);return{type:_,state:f.task_status[_],aggs:h.value[_],time:S.statusMeta.state_time[_]}}).filter(k=>k.state!==r.IGNORED));return(k,_)=>{const f=u("SuccessFilled"),s=u("el-icon"),M=u("el-text"),U=u("CircleCloseFilled"),$=u("Loading");return p(!0),ae(he,null,ke(O.value,g=>(p(),ae("div",{key:g.type},[E("span",null,n(k.taskTypeMap[g.type])+"ï¼š",1),E("span",null,[g.state===i(r).SUCCESS||g.state===i(r).REVOKED?(p(),y(M,{key:0},{default:e(()=>[t(s,{class:"success"},{default:e(()=>[t(f)]),_:1}),o(" "+n(k.stateMap[g.state](g.type)),1)]),_:2},1024)):g.state===i(r).FAILURE?(p(),y(M,{key:1},{default:e(()=>[t(s,{class:"danger"},{default:e(()=>[t(U)]),_:1}),o(" "+n(k.stateMap[g.state](g.type)),1)]),_:2},1024)):g.state===i(r).STARTED?(p(),y(M,{key:2},{default:e(()=>[t(s,{class:"is-loading primary"},{default:e(()=>[t($)]),_:1}),o(" "+n(k.stateMap[g.state](g.type)),1)]),_:2},1024)):g.state===i(r).PENDING?(p(),y(M,{key:3},{default:e(()=>[t(s,{class:"is-loading primary"},{default:e(()=>[t($)]),_:1}),o(" "+n(k.stateMap[g.state](g.type)),1)]),_:2},1024)):g.state===i(r).REVOKE?(p(),y(M,{key:4},{default:e(()=>[t(s,{class:"is-loading primary"},{default:e(()=>[t($)]),_:1}),o(" "+n(k.stateMap[g.state](g.type)),1)]),_:2},1024)):Q("",!0)]),E("span",{class:"ml-8 lighter",style:gt({color:[i(r).FAILURE,i(r).REVOKED].includes(g.state)?"#F54A45":""})},n(k.$t("views.document.fileStatus.finish"))+" "+n(Object.keys(g.aggs?g.aggs:{}).filter(b=>b==i(r).SUCCESS).map(b=>g.aggs[b]).reduce((b,C)=>b+C,0))+"/"+n(Object.values(g.aggs?g.aggs:{}).reduce((b,C)=>b+C,0)),5),t(M,{type:"info",class:"ml-12"},{default:e(()=>{var b;return[o(n(g.time?(b=g.time[g.state==i(r).REVOKED?i(r).REVOKED:i(r).PENDING])==null?void 0:b.substring(0,19):void 0),1)]}),_:2},1024)]))),128)}}}),Ot=re({__name:"Status",props:{status:{},statusMeta:{}},setup(P){const S=P,N=w(!1),R=[r.REVOKE,r.STARTED,r.PENDING,r.FAILURE,r.REVOKED,r.SUCCESS],h=ve(()=>{let f={key:0,value:""};for(const s in R){const M=R[s],U=S.status.indexOf(M);if(U>-1){f={key:S.status.length-U,value:M};break}}return f}),O={[A.EMBEDDING]:v("views.document.fileStatus.EMBEDDING"),[A.GENERATE_PROBLEM]:v("views.document.fileStatus.GENERATE"),[A.SYNC]:v("views.document.fileStatus.SYNC")},k={[A.EMBEDDING]:v("views.dataset.setting.vectorization"),[A.GENERATE_PROBLEM]:v("views.document.generateQuestion.title"),[A.SYNC]:v("views.dataset.setting.sync")},_={[r.PENDING]:f=>v("views.document.fileStatus.PENDING"),[r.STARTED]:f=>O[f],[r.REVOKE]:f=>v("views.document.fileStatus.REVOKE"),[r.REVOKED]:f=>v("views.document.fileStatus.SUCCESS"),[r.FAILURE]:f=>v("views.document.fileStatus.FAILURE"),[r.SUCCESS]:f=>v("views.document.fileStatus.SUCCESS")};return(f,s)=>{const M=u("SuccessFilled"),U=u("el-icon"),$=u("el-text"),g=u("CircleCloseFilled"),b=u("Loading"),C=u("el-popover");return p(),y(C,{visible:N.value,"onUpdate:visible":s[0]||(s[0]=B=>N.value=B),placement:"top",trigger:"hover","popper-style":{width:"auto"}},{default:e(()=>[N.value?(p(),y(Ht,{key:0,status:f.status,statusMeta:f.statusMeta,taskTypeMap:k,stateMap:_},null,8,["status","statusMeta"])):Q("",!0)]),reference:e(()=>{var B,m,D,L,z,J;return[((B=h.value)==null?void 0:B.value)===i(r).SUCCESS||((m=h.value)==null?void 0:m.value)===i(r).REVOKED?(p(),y($,{key:0},{default:e(()=>[t(U,{class:"success"},{default:e(()=>[t(M)]),_:1}),o(" "+n(_[h.value.value](h.value.key)),1)]),_:1})):((D=h.value)==null?void 0:D.value)===i(r).FAILURE?(p(),y($,{key:1},{default:e(()=>[t(U,{class:"danger"},{default:e(()=>[t(g)]),_:1}),o(" "+n(_[h.value.value](h.value.key)),1)]),_:1})):((L=h.value)==null?void 0:L.value)===i(r).STARTED?(p(),y($,{key:2},{default:e(()=>[t(U,{class:"is-loading primary"},{default:e(()=>[t(b)]),_:1}),o(" "+n(_[h.value.value](h.value.key)),1)]),_:1})):((z=h.value)==null?void 0:z.value)===i(r).PENDING?(p(),y($,{key:3},{default:e(()=>[t(U,{class:"is-loading primary"},{default:e(()=>[t(b)]),_:1}),o(" "+n(_[h.value.value](h.value.key)),1)]),_:1})):((J=h.value)==null?void 0:J.value)===i(r).REVOKE?(p(),y($,{key:4},{default:e(()=>[t(U,{class:"is-loading primary"},{default:e(()=>[t(b)]),_:1}),o(" "+n(_[h.value.value](h.value.key)),1)]),_:1})):Q("",!0)]}),_:1},8,["visible"])}}}),Ft={class:"dialog-footer"},jt=re({__name:"EmbeddingContentDialog",setup(P,{expose:S}){const N=w(!1),R=w("error"),h={all:["0","1","2","3","4","5","n"],error:["0","1","3","4","5","n"]},O=w(),k=()=>{O.value&&O.value(h[R.value]),f()},_=s=>{O.value=s,N.value=!0},f=()=>{O.value=void 0,N.value=!1};return S({open:_,close:f}),(s,M)=>{const U=u("el-radio"),$=u("el-radio-group"),g=u("el-button"),b=u("el-dialog");return p(),y(b,{modelValue:N.value,"onUpdate:modelValue":M[1]||(M[1]=C=>N.value=C),title:s.$t("components.selectParagraph.title"),"before-close":f,width:"450"},{footer:e(()=>[E("div",Ft,[t(g,{onClick:f},{default:e(()=>[o(n(s.$t("common.cancel")),1)]),_:1}),t(g,{type:"primary",onClick:k},{default:e(()=>[o(n(s.$t("common.submit")),1)]),_:1})])]),default:e(()=>[t($,{modelValue:R.value,"onUpdate:modelValue":M[0]||(M[0]=C=>R.value=C),class:"radio-block"},{default:e(()=>[t(U,{value:"error",size:"large",class:"mb-16"},{default:e(()=>[o(n(s.$t("components.selectParagraph.error")),1)]),_:1}),t(U,{value:"all",size:"large"},{default:e(()=>[o(n(s.$t("components.selectParagraph.all")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"])}}}),Kt={class:"main-calc-height"},qt={class:"p-24"},Qt={class:"flex-between"},Wt={key:0},Yt={class:"mr-4"},Zt={class:"mr-4"},Jt={key:1},Xt={class:"mr-4"},xt={class:"mr-4"},el={key:0,class:"mul-operation w-full flex"},ne="documents",tl=re({__name:"index",setup(P){const S=yt(),N=Se(),{params:{id:R}}=N,{common:h,dataset:O,document:k}=Be(),_=(l,a)=>{const d=l.split("").reverse();return a-1>d.length+1?"n":d[a-1]};ht(()=>{h.savePage(ne,null),h.saveCondition(ne,null)}),kt(l=>{l.name!=="Paragraph"?(h.savePage(ne,null),h.saveCondition(ne,null)):h.saveCondition(ne,{filterText:b.value,filterMethod:C.value})});const f=ve(()=>h.paginationConfig[ne]),s=ve(()=>h.search[ne]),M=w(),U=w(),$=w(!1);let g;const b=w(""),C=w({}),B=w(""),m=w([]),D=w(null),L=w({}),z=w({current_page:1,page_size:10,total:0}),J=w(),ee=w(),V=w([]),le=w(""),ie=w(),ue=l=>{j.exportDocument(l.name,l.dataset_id,l.id,$).then(()=>{Z(v("common.exportSuccess"))})},oe=l=>{j.exportDocumentZip(l.name,l.dataset_id,l.id,$).then(()=>{Z(v("common.exportSuccess"))})};function ce(l){const a=[];V.value.map(K=>{K&&a.push(K.id)});const d={id_list:a,type:l};j.batchCancelTask(R,d,$).then(()=>{var K;Z(v("views.document.tip.cancelSuccess")),(K=ee.value)==null||K.clearSelection()})}function H(){var l;(l=ee.value)==null||l.clearSelection()}function G(l){const a=[];l?a.push(l.id):V.value.map(d=>{d&&a.push(d.id)}),ie.value.open(a)}function se(l){C.value[l.attr]=l.command,l.attr=="status"&&(C.value.task_type=l.task_type),F()}function X(l,a,d){return{attr:l,command:a,task_type:d}}const fe=(l,a)=>{j.cancelTask(l.dataset_id,l.id,{type:a}).then(()=>{Z(v("views.document.tip.sendMessage"))})};function ze(){le.value=v("views.document.importDocument"),J.value.open()}function $e(l){le.value=v("common.setting"),J.value.open(l)}const He=l=>{V.value=l};function Oe(){le.value=v("common.setting");const l=V.value.map(a=>a.id);J.value.open(null,l)}const Fe=()=>{g=setInterval(()=>{F(!0)},6e3)},je=()=>{g&&clearInterval(g)};function Ke(l){var a;(a=l.meta)!=null&&a.sourceUrl?ge(v("views.document.sync.confirmTitle"),v("views.document.sync.confirmMessage1"),{confirmButtonText:v("views.document.sync.label"),confirmButtonClass:"danger"}).then(()=>{j.putDocumentSync(l.datasetId,l.id).then(()=>{F()})}).catch(()=>{}):ge(v("common.tip"),v("views.document.sync.confirmMessage2"),{confirmButtonText:v("common.confirm"),type:"warning"}).then(()=>{}).catch(()=>{})}function De(l){var d;const a=K=>j.putDocumentRefresh(l.datasetId,l.id,K).then(()=>{F()});(d=M.value)==null||d.open(a)}function qe(l,a){a&&a.type==="selection"||S.push({path:`/dataset/${R}/${l.id}`})}function Qe(l){$.value=!0;const a=[{name:l}];k.asyncPostDocument(R,a).then(()=>{F(),Z(v("common.createSuccess"))}).catch(()=>{$.value=!1})}function We(){const l=[];V.value.map(a=>{a&&l.push(a.id)}),j.delMulSyncDocument(R,l,$).then(()=>{Z(v("views.document.sync.successMessage")),F()})}function Ye(){ge(`${v("views.document.delete.confirmTitle1")} ${V.value.length} ${v("views.document.delete.confirmTitle2")}`,v("views.document.delete.confirmMessage"),{confirmButtonText:v("common.confirm"),confirmButtonClass:"danger"}).then(()=>{const l=[];V.value.map(a=>{a&&l.push(a.id)}),j.delMulDocument(R,l,$).then(()=>{var a;Z(v("views.document.delete.successMessage")),(a=ee.value)==null||a.clearSelection(),F()})}).catch(()=>{})}function Ze(){var d;const l=V.value.map(K=>K.id),a=K=>{j.batchRefresh(R,l,K,$).then(()=>{var q;Z(v("views.document.tip.vectorizationSuccess")),(q=ee.value)==null||q.clearSelection()})};(d=M.value)==null||d.open(a)}function we(l){ge(`${v("views.document.delete.confirmTitle3")} ${l.name} ?`,`${v("views.document.delete.confirmMessage1")} ${l.paragraphCount} ${v("views.document.delete.confirmMessage2")}`,{confirmButtonText:v("common.confirm"),confirmButtonClass:"danger"}).then(()=>{j.delDocument(R,l.id,$).then(()=>{Z(v("common.deleteSuccess")),F()})}).catch(()=>{})}function Re(l,a,d){j.putDocument(R,l,a,$).then(K=>{const q=m.value.findIndex(be=>be.id===l);return m.value.splice(q,1,K.data),Z(d),!0}).catch(()=>!1)}function Je(l){const a={isActive:!l.isActive},d=l.isActive?v("common.status.disableSuccess"):v("common.status.enableSuccess");D.value&&Re(l.id,a,d)}function Xe(l,a){l?Re(a,{name:l},v("common.modifySuccess")):St(v("views.document.tip.nameMessage"))}function xe(l){D.value=l.id}function et(){D.value=null}function tt(){z.value.current_page=1,F()}function lt({prop:l,order:a}){B.value=a==="ascending"?l:`-${l}`,F()}function F(l){const a={...b.value&&{name:b.value},...C.value,order_by:B.value};j.getDocument(R,z.value,a,l?void 0:$).then(d=>{m.value=d.data.records,z.value.total=d.data.total})}function nt(){O.asyncGetDatasetDetail(R,$).then(l=>{L.value=l.data})}function at(){var l;(l=ee.value)==null||l.clearSelection(),F()}function Me(){z.value.current_page=1,F()}const Ne=w();function Ee(l){const a=[];l?a.push(l.id):V.value.map(d=>{d&&a.push(d.id)}),Ne.value.open(a,"document")}return Et(()=>{nt(),f.value&&(z.value=f.value),s.value&&(b.value=s.value.filterText,C.value=s.value.filterMethod),F(),Fe()}),bt(()=>{je()}),(l,a)=>{const d=u("el-button"),K=u("el-input"),q=u("el-table-column"),be=u("ReadWrite"),Ce=u("Filter"),x=u("el-icon"),I=u("el-dropdown-item"),me=u("el-dropdown-menu"),pe=u("el-dropdown"),ot=u("el-switch"),te=u("AppIcon"),de=u("el-tooltip"),st=u("Setting"),Te=u("MoreFilled"),_e=u("Connection"),it=u("Refresh"),ut=u("app-table"),ct=u("el-text"),dt=u("LayoutContainer"),rt=Le("loading");return p(),y(dt,{header:l.$t("common.fileUpload.document"),class:"document-main"},{default:e(()=>[E("div",Kt,[E("div",qt,[E("div",Qt,[E("div",null,[L.value.type==="0"?(p(),y(d,{key:0,type:"primary",onClick:a[0]||(a[0]=c=>i(S).push({path:"/dataset/upload",query:{id:i(R)}}))},{default:e(()=>[o(n(l.$t("views.document.uploadDocument")),1)]),_:1})):Q("",!0),L.value.type==="1"?(p(),y(d,{key:1,type:"primary",onClick:ze},{default:e(()=>[o(n(l.$t("views.document.importDocument")),1)]),_:1})):Q("",!0),L.value.type==="1"?(p(),y(d,{key:2,onClick:We,disabled:V.value.length===0},{default:e(()=>[o(n(l.$t("views.document.syncDocument")),1)]),_:1},8,["disabled"])):Q("",!0),t(d,{onClick:a[1]||(a[1]=c=>G()),disabled:V.value.length===0},{default:e(()=>[o(n(l.$t("views.document.setting.migration")),1)]),_:1},8,["disabled"]),t(d,{onClick:Ze,disabled:V.value.length===0},{default:e(()=>[o(n(l.$t("views.dataset.setting.vectorization")),1)]),_:1},8,["disabled"]),t(d,{onClick:a[2]||(a[2]=c=>Ee()),disabled:V.value.length===0},{default:e(()=>[o(n(l.$t("views.document.generateQuestion.title")),1)]),_:1},8,["disabled"]),t(d,{onClick:Oe,disabled:V.value.length===0},{default:e(()=>[o(n(l.$t("common.setting")),1)]),_:1},8,["disabled"]),t(d,{onClick:Ye,disabled:V.value.length===0},{default:e(()=>[o(n(l.$t("common.delete")),1)]),_:1},8,["disabled"])]),t(K,{modelValue:b.value,"onUpdate:modelValue":a[3]||(a[3]=c=>b.value=c),placeholder:l.$t("views.document.searchBar.placeholder"),"prefix-icon":"Search",class:"w-240",onChange:F,clearable:""},null,8,["modelValue","placeholder"])]),Pe((p(),y(ut,{ref_key:"multipleTableRef",ref:ee,class:"mt-16",data:m.value,"pagination-config":z.value,"quick-create":L.value.type==="0",onSizeChange:tt,onChangePage:F,onCellMouseEnter:xe,onCellMouseLeave:et,onCreatQuick:Qe,onRowClick:qe,onSelectionChange:He,onSortChange:lt,"row-key":c=>c.id,storeKey:ne},{default:e(()=>[t(q,{type:"selection",width:"55","reserve-selection":!0}),t(q,{prop:"name",label:l.$t("views.document.table.name"),"min-width":"280"},{default:e(({row:c})=>[t(be,{onChange:T=>Xe(T,c.id),data:c.name,showEditIcon:c.id===D.value},null,8,["onChange","data","showEditIcon"])]),_:1},8,["label"]),t(q,{prop:"charLength",label:l.$t("views.document.table.charLength"),align:"right","min-width":"90",sortable:""},{default:e(({row:c})=>[o(n(i(Ct)(c.charLength)),1)]),_:1},8,["label"]),t(q,{prop:"paragraphCount",label:l.$t("views.document.table.paragraph"),align:"right","min-width":"90",sortable:""},null,8,["label"]),t(q,{prop:"status",label:l.$t("views.document.fileStatus.label"),width:"130"},{header:e(()=>[E("div",null,[E("span",null,n(l.$t("views.document.fileStatus.label")),1),t(pe,{trigger:"click",onCommand:se},{dropdown:e(()=>[t(me,{style:{width:"100px"}},{default:e(()=>[t(I,{class:Y([C.value.status?"":"is-active","justify-center"]),command:X("status","")},{default:e(()=>[o(n(l.$t("views.document.table.all")),1)]),_:1},8,["class","command"]),t(I,{class:Y([C.value.status===i(r).SUCCESS?"is-active":"","justify-center"]),command:X("status",i(r).SUCCESS)},{default:e(()=>[o(n(l.$t("views.document.fileStatus.SUCCESS")),1)]),_:1},8,["class","command"]),t(I,{class:Y([C.value.status===i(r).FAILURE?"is-active":"","justify-center"]),command:X("status",i(r).FAILURE)},{default:e(()=>[o(n(l.$t("views.document.fileStatus.FAILURE")),1)]),_:1},8,["class","command"]),t(I,{class:Y([C.value.status===i(r).STARTED&&C.value.task_type==i(A).EMBEDDING?"is-active":"","justify-center"]),command:X("status",i(r).STARTED,i(A).EMBEDDING)},{default:e(()=>[o(n(l.$t("views.document.fileStatus.EMBEDDING")),1)]),_:1},8,["class","command"]),t(I,{class:Y([C.value.status===i(r).PENDING?"is-active":"","justify-center"]),command:X("status",i(r).PENDING)},{default:e(()=>[o(n(l.$t("views.document.fileStatus.PENDING")),1)]),_:1},8,["class","command"]),t(I,{class:Y([C.value.status===i(r).STARTED&&C.value.task_type===i(A).GENERATE_PROBLEM?"is-active":"","justify-center"]),command:X("status",i(r).STARTED,i(A).GENERATE_PROBLEM)},{default:e(()=>[o(n(l.$t("views.document.fileStatus.GENERATE")),1)]),_:1},8,["class","command"])]),_:1})]),default:e(()=>[t(d,{style:{"margin-top":"1px"},link:"",type:C.value.status?"primary":""},{default:e(()=>[t(x,null,{default:e(()=>[t(Ce)]),_:1})]),_:1},8,["type"])]),_:1})])]),default:e(({row:c})=>[t(Ot,{status:c.status,"status-meta":c.statusMeta},null,8,["status","status-meta"])]),_:1},8,["label"]),t(q,{width:"130"},{header:e(()=>[E("div",null,[E("span",null,n(l.$t("views.document.enableStatus.label")),1),t(pe,{trigger:"click",onCommand:se},{dropdown:e(()=>[t(me,{style:{width:"100px"}},{default:e(()=>[t(I,{class:Y([C.value.isActive===""?"is-active":"","justify-center"]),command:X("isActive","")},{default:e(()=>[o(n(l.$t("views.document.table.all")),1)]),_:1},8,["class","command"]),t(I,{class:Y([C.value.isActive===!0?"is-active":"","justify-center"]),command:X("isActive",!0)},{default:e(()=>[o(n(l.$t("views.document.enableStatus.enable")),1)]),_:1},8,["class","command"]),t(I,{class:Y([C.value.isActive===!1?"is-active":"","justify-center"]),command:X("isActive",!1)},{default:e(()=>[o(n(l.$t("views.document.enableStatus.close")),1)]),_:1},8,["class","command"])]),_:1})]),default:e(()=>[t(d,{style:{"margin-top":"1px"},link:"",type:C.value.isActive?"primary":""},{default:e(()=>[t(x,null,{default:e(()=>[t(Ce)]),_:1})]),_:1},8,["type"])]),_:1})])]),default:e(({row:c})=>[E("div",{onClick:a[4]||(a[4]=W(()=>{},["stop"]))},[t(ot,{loading:$.value,size:"small",modelValue:c.isActive,"onUpdate:modelValue":T=>c.isActive=T,"before-change":()=>Je(c)},null,8,["loading","modelValue","onUpdate:modelValue","before-change"])])]),_:1}),t(q,{width:"170"},{header:e(()=>[E("div",null,[E("span",null,n(l.$t("views.document.form.hitHandlingMethod.label")),1),t(pe,{trigger:"click",onCommand:se},{dropdown:e(()=>[t(me,{style:{width:"150px"}},{default:e(()=>[t(I,{class:Y([C.value.hitHandlingMethod?"":"is-active","justify-center"]),command:X("hitHandlingMethod","")},{default:e(()=>[o(n(l.$t("views.document.table.all")),1)]),_:1},8,["class","command"]),(p(!0),ae(he,null,ke(i(ye),(c,T)=>(p(),y(I,{key:T,class:Y([C.value.hitHandlingMethod===T?"is-active":"","justify-center"]),command:X("hitHandlingMethod",T)},{default:e(()=>[o(n(l.$t(c)),1)]),_:2},1032,["class","command"]))),128))]),_:1})]),default:e(()=>[t(d,{style:{"margin-top":"1px"},link:"",type:C.value.hitHandlingMethod?"primary":""},{default:e(()=>[t(x,null,{default:e(()=>[t(Ce)]),_:1})]),_:1},8,["type"])]),_:1})])]),default:e(({row:c})=>[o(n(l.$t(i(ye)[c.hitHandlingMethod])),1)]),_:1}),t(q,{prop:"createTime",label:l.$t("common.createTime"),width:"175",sortable:""},{default:e(({row:c})=>[o(n(i(Ie)(c.createTime)),1)]),_:1},8,["label"]),t(q,{prop:"updateTime",label:l.$t("views.document.table.updateTime"),width:"175",sortable:""},{default:e(({row:c})=>[o(n(i(Ie)(c.updateTime)),1)]),_:1},8,["label"]),t(q,{label:l.$t("common.operation"),align:"left",width:"110",fixed:"right"},{default:e(({row:c})=>[L.value.type==="0"?(p(),ae("div",Wt,[E("span",Yt,[[i(r).STARTED,i(r).PENDING].includes(_(c.status,i(A).EMBEDDING))?(p(),y(de,{key:0,effect:"dark",content:l.$t("views.document.setting.cancelVectorization"),placement:"top"},{default:e(()=>[t(d,{type:"primary",text:"",onClick:W(T=>fe(c,i(A).EMBEDDING),["stop"])},{default:e(()=>[t(te,{iconName:"app-close",style:{"font-size":"16px"}})]),_:2},1032,["onClick"])]),_:2},1032,["content"])):(p(),y(de,{key:1,effect:"dark",content:l.$t("views.dataset.setting.vectorization"),placement:"top"},{default:e(()=>[t(d,{type:"primary",text:"",onClick:W(T=>De(c),["stop"])},{default:e(()=>[t(te,{iconName:"app-document-refresh",style:{"font-size":"16px"}})]),_:2},1032,["onClick"])]),_:2},1032,["content"]))]),E("span",Zt,[t(de,{effect:"dark",content:l.$t("common.setting"),placement:"top"},{default:e(()=>[t(d,{type:"primary",text:"",onClick:W(T=>$e(c),["stop"])},{default:e(()=>[t(x,null,{default:e(()=>[t(st)]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),E("span",{onClick:a[5]||(a[5]=W(()=>{},["stop"]))},[t(pe,{trigger:"click"},{dropdown:e(()=>[t(me,null,{default:e(()=>[[i(r).STARTED,i(r).PENDING].includes(_(c.status,i(A).GENERATE_PROBLEM))?(p(),y(I,{key:0,onClick:T=>fe(c,i(A).GENERATE_PROBLEM)},{default:e(()=>[t(x,null,{default:e(()=>[t(_e)]),_:1}),o(" "+n(l.$t("views.document.setting.cancelGenerateQuestion")),1)]),_:2},1032,["onClick"])):(p(),y(I,{key:1,onClick:T=>Ee(c)},{default:e(()=>[t(x,null,{default:e(()=>[t(_e)]),_:1}),o(" "+n(l.$t("views.document.generateQuestion.title")),1)]),_:2},1032,["onClick"])),t(I,{onClick:T=>G(c)},{default:e(()=>[t(te,{iconName:"app-migrate"}),o(" "+n(l.$t("views.document.setting.migration")),1)]),_:2},1032,["onClick"]),t(I,{onClick:T=>ue(c)},{default:e(()=>[t(te,{iconName:"app-export"}),o(" "+n(l.$t("views.document.setting.export"))+" Excel ",1)]),_:2},1032,["onClick"]),t(I,{onClick:T=>oe(c)},{default:e(()=>[t(te,{iconName:"app-export"}),o(" "+n(l.$t("views.document.setting.export"))+" Zip ",1)]),_:2},1032,["onClick"]),t(I,{icon:"Delete",onClick:W(T=>we(c),["stop"])},{default:e(()=>[o(n(l.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:e(()=>[t(d,{text:"",type:"primary"},{default:e(()=>[t(x,null,{default:e(()=>[t(Te)]),_:1})]),_:1})]),_:2},1024)])])):Q("",!0),L.value.type==="1"?(p(),ae("div",Jt,[E("span",Xt,[t(de,{effect:"dark",content:l.$t("views.dataset.setting.sync"),placement:"top"},{default:e(()=>[t(d,{type:"primary",text:"",onClick:W(T=>Ke(c),["stop"])},{default:e(()=>[t(x,null,{default:e(()=>[t(it)]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),E("span",xt,[[i(r).STARTED,i(r).PENDING].includes(_(c.status,i(A).EMBEDDING))?(p(),y(de,{key:0,effect:"dark",content:l.$t("views.document.setting.cancelVectorization"),placement:"top"},{default:e(()=>[t(d,{type:"primary",text:"",onClick:W(T=>fe(c,i(A).EMBEDDING),["stop"])},{default:e(()=>[t(te,{iconName:"app-close",style:{"font-size":"16px"}})]),_:2},1032,["onClick"])]),_:2},1032,["content"])):(p(),y(de,{key:1,effect:"dark",content:l.$t("views.dataset.setting.vectorization"),placement:"top"},{default:e(()=>[t(d,{type:"primary",text:"",onClick:W(T=>De(c),["stop"])},{default:e(()=>[t(te,{iconName:"app-document-refresh",style:{"font-size":"16px"}})]),_:2},1032,["onClick"])]),_:2},1032,["content"]))]),E("span",{onClick:a[6]||(a[6]=W(()=>{},["stop"]))},[t(pe,{trigger:"click"},{dropdown:e(()=>[t(me,null,{default:e(()=>[t(I,{icon:"Setting",onClick:T=>$e(c)},{default:e(()=>[o(n(l.$t("common.setting")),1)]),_:2},1032,["onClick"]),[i(r).STARTED,i(r).PENDING].includes(_(c.status,i(A).GENERATE_PROBLEM))?(p(),y(I,{key:0,onClick:T=>fe(c,i(A).GENERATE_PROBLEM)},{default:e(()=>[t(x,null,{default:e(()=>[t(_e)]),_:1}),o(" "+n(l.$t("views.document.setting.cancelGenerateQuestion")),1)]),_:2},1032,["onClick"])):(p(),y(I,{key:1,onClick:T=>Ee(c)},{default:e(()=>[t(x,null,{default:e(()=>[t(_e)]),_:1}),o(" "+n(l.$t("views.document.generateQuestion.title")),1)]),_:2},1032,["onClick"])),t(I,{onClick:T=>G(c)},{default:e(()=>[t(te,{iconName:"app-migrate"}),o(" "+n(l.$t("views.document.setting.migration")),1)]),_:2},1032,["onClick"]),t(I,{onClick:T=>ue(c)},{default:e(()=>[t(te,{iconName:"app-export"}),o(" "+n(l.$t("views.document.setting.export"))+" Excel ",1)]),_:2},1032,["onClick"]),t(I,{onClick:T=>oe(c)},{default:e(()=>[t(te,{iconName:"app-export"}),o(" "+n(l.$t("views.document.setting.export"))+" Zip ",1)]),_:2},1032,["onClick"]),t(I,{icon:"Delete",onClick:W(T=>we(c),["stop"])},{default:e(()=>[o(n(l.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:e(()=>[t(d,{text:"",type:"primary"},{default:e(()=>[t(x,null,{default:e(()=>[t(Te)]),_:1})]),_:1})]),_:2},1024)])])):Q("",!0)]),_:1},8,["label"])]),_:1},8,["data","pagination-config","quick-create","row-key"])),[[rt,$.value]])]),t(At,{ref_key:"ImportDocumentDialogRef",ref:J,title:le.value,onRefresh:Me},null,8,["title"]),t(Dt,{ref_key:"SyncWebDialogRef",ref:U,onRefresh:Me},null,512),t(zt,{ref_key:"SelectDatasetDialogRef",ref:ie,onRefresh:at},null,512),t(wt,{ref_key:"GenerateRelatedDialogRef",ref:Ne,onRefresh:F},null,512)]),V.value.length!==0?(p(),ae("div",el,[t(d,{disabled:V.value.length===0,onClick:a[7]||(a[7]=c=>ce(1))},{default:e(()=>[o(n(l.$t("views.document.setting.cancelVectorization")),1)]),_:1},8,["disabled"]),t(d,{disabled:V.value.length===0,onClick:a[8]||(a[8]=c=>ce(2))},{default:e(()=>[o(n(l.$t("views.document.setting.cancelGenerate")),1)]),_:1},8,["disabled"]),t(ct,{type:"info",class:"secondary ml-24"},{default:e(()=>[o(n(l.$t("views.document.selected"))+" "+n(V.value.length)+" "+n(l.$t("views.document.items")),1)]),_:1}),t(d,{class:"ml-16",type:"primary",link:"",onClick:H},{default:e(()=>[o(n(l.$t("common.clear")),1)]),_:1})])):Q("",!0),t(jt,{ref_key:"embeddingContentDialogRef",ref:M},null,512)]),_:1},8,["header"])}}});const sl=$t(tl,[["__scopeId","data-v-5f71120e"]]);export{sl as default};
