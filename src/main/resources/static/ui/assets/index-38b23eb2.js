import{dV as K,dW as de,eF as me,dX as ce,cp as R,cq as p,cZ as V,di as W,ct as X,cu as r,cx as y,cF as w,cA as s,cB as d,cV as pe,cJ as C,cz as o,cE as B,cK as L,dn as H,cr as P,cy as O,dw as _e,cN as q,cH as M,cC as Z,d6 as ve,cU as fe,cv as J,cD as be,c_ as ge,cR as he}from"./index-eeff5fe9.js";const D="/team/member",Ae=()=>K(`${D}`),Me=m=>de(`${D}/_batch`,m),ye=m=>me(`${D}/${m}`),$e=m=>K(`${D}/${m}`),Ce=(m,T)=>ce(`${D}/${m}`,T),x={getTeamMember:Ae,postCreatTeamMember:Me,delTeamMember:ye,getMemberPermissions:$e,putMemberPermissions:Ce},Ee=["id"],ke={class:"dialog-sub-title"},Se={class:"dialog-footer"},Ne=R({__name:"CreateMemberDialog",emits:["refresh"],setup(m,{expose:T,emit:_}){const E=_,v=p(!1),f=p({users:[]}),h=p(),u=p(!1),U=p({users:[{type:"array",required:!0,message:V("views.team.teamForm.form.userName.requiredMessage"),trigger:"change"}]});W(v,e=>{e||(f.value={users:[]},u.value=!1)});const G=()=>{v.value=!0},n=async e=>{e&&await e.validate((i,A)=>{if(i){u.value=!0;let k=f.value.users.map(S=>S.id);x.postCreatTeamMember(k).then(S=>{H(V("common.submitSuccess")),E("refresh",k),v.value=!1,u.value=!1}).catch(()=>{u.value=!1})}})};return X(()=>{}),T({open:G,close}),(e,i)=>{const A=r("tags-input"),k=r("el-form-item"),S=r("el-form"),N=r("el-button"),I=r("el-dialog");return y(),w(I,{modelValue:v.value,"onUpdate:modelValue":i[4]||(i[4]=t=>v.value=t),"close-on-press-escape":!1,"close-on-click-modal":!1,"destroy-on-close":!0,width:"600",class:"member-dialog"},{header:s(({titleId:t,titleClass:$})=>[d("h4",{id:t,class:pe($)},C(e.$t("views.team.addMember")),11,Ee),d("div",ke,C(e.$t("views.team.addSubTitle")),1)]),footer:s(()=>[d("span",Se,[o(N,{onClick:i[2]||(i[2]=B(t=>v.value=!1,["prevent"]))},{default:s(()=>[L(C(e.$t("common.cancel")),1)]),_:1}),o(N,{type:"primary",onClick:i[3]||(i[3]=t=>n(h.value)),loading:u.value},{default:s(()=>[L(C(e.$t("common.add")),1)]),_:1},8,["loading"])])]),default:s(()=>[o(S,{ref_key:"addMemberFormRef",ref:h,model:f.value,"label-position":"top",rules:U.value,"require-asterisk-position":"right",onSubmit:i[1]||(i[1]=B(()=>{},["prevent"]))},{default:s(()=>[o(k,{label:e.$t("views.team.teamForm.form.userName.label"),prop:"users"},{default:s(()=>[o(A,{tags:f.value.users,"onUpdate:tags":i[0]||(i[0]=t=>f.value.users=t),placeholder:e.$t("views.team.teamForm.form.userName.placeholder")},null,8,["tags","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}});var a=(m=>(m.MANAGE="MANAGE",m.USE="USE",m.DATASET="DATASET",m.APPLICATION="APPLICATION",m))(a||{});const Ve={class:"p-24 pt-0"},we={class:"flex align-center"},Ue=R({__name:"PermissionSetting",props:{data:{type:Array,default:()=>[]},id:String,type:String,tableHeight:Number,manage:Boolean},emits:["update:data"],setup(m,{emit:T}){const _=m,E=P(()=>_.type===a.DATASET),v=P(()=>_.type===a.APPLICATION),f=p({[a.MANAGE]:P({get:()=>u.value.some(n=>n.operate[a.MANAGE]),set:n=>{n?u.value.map(e=>{e.operate[a.MANAGE]=!0,e.operate[a.USE]=!0}):u.value.map(e=>{e.operate[a.MANAGE]=!1})}}),[a.USE]:P({get:()=>u.value.some(n=>n.operate[a.USE]),set:n=>{n?u.value.map(e=>{e.operate[a.USE]=!0}):u.value.map(e=>{e.operate[a.USE]=!1,e.operate[a.MANAGE]=!1})}})}),h=p(""),u=P(()=>_.data.filter(n=>n.name.toLowerCase().includes(h.value.toLowerCase()))),U=p({[a.MANAGE]:P(()=>u.value.every(e=>!e.operate[a.MANAGE])?!1:!u.value.every(e=>e.operate[a.MANAGE])),[a.USE]:P(()=>u.value.every(e=>!e.operate[a.USE])?!1:!u.value.every(e=>e.operate[a.USE]))});function G(n,e,i){_.data.map(A=>{A.id===e.id&&(A.operate[n]=i,n===a.MANAGE&&i?A.operate[a.USE]=!0:n===a.USE&&!i&&(A.operate[a.MANAGE]=!1))})}return(n,e)=>{const i=r("el-input"),A=r("AppAvatar"),k=r("auto-tooltip"),S=r("el-table-column"),N=r("el-checkbox"),I=r("el-table");return y(),O(Z,null,[o(i,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=t=>h.value=t),placeholder:n.$t("common.search"),"prefix-icon":"Search",class:"p-24 pt-0 pb-0 mb-16 mt-4",clearable:""},null,8,["modelValue","placeholder"]),d("div",Ve,[o(I,{data:u.value,"max-height":m.tableHeight},{default:s(()=>[o(S,{prop:"name",label:v.value?n.$t("views.application.applicationForm.form.appName.label"):n.$t("views.dataset.datasetForm.form.datasetName.label")},{default:s(({row:t})=>[d("div",we,[v.value?(y(),w(A,{key:0,name:t.name,pinyinColor:"",class:"mr-12",shape:"square",size:24},null,8,["name"])):E.value?(y(),w(A,{key:1,class:"mr-12 avatar-blue",shape:"square",size:24},{default:s(()=>e[3]||(e[3]=[d("img",{src:_e,style:{width:"58%"},alt:""},null,-1)])),_:1})):q("",!0),o(k,{content:t==null?void 0:t.name},{default:s(()=>[L(C(t==null?void 0:t.name),1)]),_:2},1032,["content"])])]),_:1},8,["label"]),o(S,{label:n.$t("views.team.setting.management"),align:"center",width:"100",fixed:"right"},{header:s(()=>[o(N,{disabled:_.manage,modelValue:f.value[M(a).MANAGE],"onUpdate:modelValue":e[1]||(e[1]=t=>f.value[M(a).MANAGE]=t),indeterminate:U.value[M(a).MANAGE],label:n.$t("views.team.setting.management")},null,8,["disabled","modelValue","indeterminate","label"])]),default:s(({row:t})=>[o(N,{disabled:_.manage,modelValue:t.operate[M(a).MANAGE],"onUpdate:modelValue":$=>t.operate[M(a).MANAGE]=$,onChange:$=>G(M(a).MANAGE,t,$)},null,8,["disabled","modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["label"]),o(S,{label:n.$t("views.team.setting.check"),align:"center",width:"100",fixed:"right"},{header:s(()=>[o(N,{disabled:_.manage,modelValue:f.value[M(a).USE],"onUpdate:modelValue":e[2]||(e[2]=t=>f.value[M(a).USE]=t),indeterminate:U.value[M(a).USE],label:n.$t("views.team.setting.check")},null,8,["disabled","modelValue","indeterminate","label"])]),default:s(({row:t})=>[o(N,{disabled:_.manage,modelValue:t.operate[M(a).USE],"onUpdate:modelValue":$=>t.operate[M(a).USE]=$,onChange:$=>G(M(a).USE,t,$)},null,8,["disabled","modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["label"])]),_:1},8,["data","max-height"])])],64)}}}),Te={class:"team-manage flex main-calc-height"},Ge={class:"team-member p-8 border-r"},Pe={class:"flex-between p-16"},Le={class:"team-member-input"},Ie={class:"list-height-left"},xe={class:"flex-between"},De={class:"mr-8"},Fe={class:"cursor"},Be={class:"permission-setting flex"},He={class:"team-manage__table"},Oe={class:"p-24 pb-0 mb-4"},qe={class:"submit-button"},Re=R({__name:"index",setup(m){const T=p(),_=p(!1),E=p(!1),v=p([]),f=p([]),h=p(""),u=p(""),U=p(""),G=p(a.DATASET),n=p(0),e=ve([{label:V("views.dataset.title"),value:a.DATASET,data:[]},{label:V("views.application.title"),value:a.APPLICATION,data:[]}]);W(U,l=>{l?f.value=v.value.filter(c=>c.username.toLowerCase().includes(l.toLowerCase())):f.value=v.value});function i(l){return l==="manage"}function A(){E.value=!0;const l={teamMemberPermissionList:[]};e.map(c=>{c.data.map(b=>{l.teamMemberPermissionList.push({targetId:b.id,type:b.type,operate:b.operate})})}),x.putMemberPermissions(h.value,l).then(()=>{H(V("common.submitSuccess")),k(h.value)}).catch(()=>{E.value=!1})}function k(l){E.value=!0,x.getMemberPermissions(l).then(c=>{(!c.data||Object.keys(c.data).length>0)&&e.map(b=>{Object.keys(c.data).indexOf(b.value)!==-1&&(b.data=c.data[b.value])}),E.value=!1}).catch(()=>{E.value=!1})}function S(l){ge(`${V("views.team.delete.confirmTitle")}${l.username}?`,V("views.team.delete.confirmMessage"),{confirmButtonText:V("common.confirm"),confirmButtonClass:"danger"}).then(()=>{_.value=!0,x.delTeamMember(l.id).then(()=>{H(V("common.deleteSuccess")),t()}).catch(()=>{_.value=!1})}).catch(()=>{})}function N(l){h.value=l.id,u.value=l.type,k(l.id)}function I(){var l;(l=T.value)==null||l.open()}function t(l){_.value=!0,x.getTeamMember().then(c=>{v.value=c.data,f.value=c.data;const b=l&&v.value.find(F=>F.userId===l)||null;h.value=b?b.id:v.value[0].id,u.value=b?b.type:v.value[0].type,k(h.value),_.value=!1}).catch(()=>{_.value=!1})}function $(l){t(l&&l[0])}return X(()=>{n.value=window.innerHeight-330,window.onresize=()=>(()=>{n.value=window.innerHeight-330})(),t()}),(l,c)=>{const b=r("AppIcon"),F=r("el-button"),Q=r("el-input"),Y=r("el-tag"),ee=r("MoreFilled"),ae=r("el-icon"),te=r("el-dropdown-item"),le=r("el-dropdown-menu"),ne=r("el-dropdown"),se=r("common-list"),oe=r("el-scrollbar"),re=r("el-tab-pane"),ie=r("el-tabs"),ue=r("LayoutContainer"),z=fe("loading");return y(),w(ue,{header:l.$t("views.team.title")},{default:s(()=>[d("div",Te,[d("div",Ge,[d("div",Pe,[d("h4",null,C(l.$t("views.team.member")),1),o(F,{type:"primary",link:"",onClick:I},{default:s(()=>[o(b,{iconName:"app-add-users",class:"add-user-icon"})]),_:1})]),d("div",Le,[o(Q,{modelValue:U.value,"onUpdate:modelValue":c[0]||(c[0]=g=>U.value=g),placeholder:l.$t("views.team.searchBar.placeholder"),"prefix-icon":"Search",clearable:""},null,8,["modelValue","placeholder"])]),d("div",Ie,[o(oe,null,{default:s(()=>[J((y(),w(se,{data:f.value,class:"mt-8",onClick:N,"default-active":h.value},{default:s(({row:g})=>[d("div",xe,[d("div",null,[d("span",De,C(g.username),1),i(g.type)?(y(),w(Y,{key:0,class:"default-tag"},{default:s(()=>[L(C(l.$t("views.team.manage")),1)]),_:1})):q("",!0)]),d("div",{onClick:c[1]||(c[1]=B(()=>{},["stop"])),style:{"margin-top":"5px"}},[i(g.type)?q("",!0):(y(),w(ne,{key:0,trigger:"click"},{dropdown:s(()=>[o(le,null,{default:s(()=>[o(te,{onClick:B(j=>S(g),["prevent"])},{default:s(()=>[L(C(l.$t("views.team.delete.button")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:s(()=>[d("span",Fe,[o(ae,{class:"rotate-90"},{default:s(()=>[o(ee)]),_:1})])]),_:2},1024))])])]),_:1},8,["data","default-active"])),[[z,_.value]])]),_:1})])]),J((y(),O("div",Be,[d("div",He,[d("h4",Oe,C(l.$t("views.team.permissionSetting")),1),o(ie,{modelValue:G.value,"onUpdate:modelValue":c[2]||(c[2]=g=>G.value=g),class:"team-manage__tabs"},{default:s(()=>[(y(!0),O(Z,null,be(e,(g,j)=>(y(),w(re,{key:g.value,label:g.label,name:g.value},{default:s(()=>[(y(),w(Ue,{key:j,data:g.data,type:g.value,tableHeight:n.value,manage:i(u.value)},null,8,["data","type","tableHeight","manage"]))]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),d("div",qe,[o(F,{type:"primary",onClick:A},{default:s(()=>[L(C(l.$t("common.save")),1)]),_:1})])])),[[z,E.value]])]),o(Ne,{ref_key:"CreateMemberRef",ref:T,onRefresh:$},null,512)]),_:1},8,["header"])}}});const je=he(Re,[["__scopeId","data-v-2d33a06b"]]);export{je as default};
