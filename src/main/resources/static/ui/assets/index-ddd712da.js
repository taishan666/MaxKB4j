import{cp as se,dy as ie,d1 as ce,cq as u,d6 as _e,cZ as I,di as X,cu as s,cx as P,cF as M,cA as l,cB as g,cz as t,cE as G,cK as C,cJ as f,dn as j,cU as ge,er as De,cv as be,cN as Re,cy as he,cC as $e,cD as ye,cV as Ve,eD as Q,ep as Ie,cY as Pe,cr as fe,ct as Me,dC as Se,cH as Ce,dz as ke,c_ as xe}from"./index-ba87ae2c.js";import{_ as ze}from"./ParagraphDialog.vue_vue_type_script_setup_true_lang-7627761c.js";import"./ParagraphForm.vue_vue_type_script_setup_true_lang-f7da2b13.js";const Be={class:"dialog-footer"},qe=se({__name:"CreateProblemDialog",emits:["refresh"],setup(ee,{expose:F,emit:S}){const w=ie(),{params:{id:x}}=w,{problem:T}=ce(),D=S,R=u(),k=u(!1),d=u({data:""}),m=_e({data:[{required:!0,message:I("views.problem.tip.requiredMessage"),trigger:"blur"}]}),i=u(!1);X(i,h=>{h||(d.value={data:""})});const b=()=>{i.value=!0},v=async h=>{h&&await h.validate((p,_)=>{if(p){const V=d.value.data.split(`
`).filter(function($){return $!==""});T.asyncPostProblem(x,V,k).then($=>{j(I("common.createSuccess")),D("refresh"),i.value=!1})}})};return F({open:b}),(h,p)=>{const _=s("el-input"),V=s("el-form-item"),$=s("el-form"),z=s("el-button"),q=s("el-dialog");return P(),M(q,{title:h.$t("views.problem.createProblem"),modelValue:i.value,"onUpdate:modelValue":p[3]||(p[3]=r=>i.value=r),"close-on-click-modal":!1,"close-on-press-escape":!1,"destroy-on-close":!0},{footer:l(()=>[g("span",Be,[t(z,{onClick:p[1]||(p[1]=G(r=>i.value=!1,["prevent"]))},{default:l(()=>[C(f(h.$t("common.cancel")),1)]),_:1}),t(z,{type:"primary",onClick:p[2]||(p[2]=r=>v(R.value)),loading:k.value},{default:l(()=>[C(f(h.$t("common.confirm")),1)]),_:1},8,["loading"])])]),default:l(()=>[t($,{"label-position":"top",ref_key:"problemFormRef",ref:R,rules:m,model:d.value,"require-asterisk-position":"right"},{default:l(()=>[t(V,{label:h.$t("views.problem.title"),prop:"data"},{default:l(()=>[t(_,{modelValue:d.value.data,"onUpdate:modelValue":p[0]||(p[0]=r=>d.value.data=r),placeholder:h.$t("views.problem.tip.placeholder"),rows:10,type:"textarea"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])}}}),Le={class:"bold title align-center p-24 pb-0"},Te={class:"p-8",style:{"padding-bottom":"8px"}},Ue={class:"flex lighter align-center"},Ne={class:"p-24",style:{"padding-bottom":"8px","padding-top":"16px"}},Ae={class:"flex-between mb-16"},Ee={class:"bold title align-center"},He={class:"dialog-footer"},we=se({__name:"RelateProblemDialog",emits:["refresh"],setup(ee,{expose:F,emit:S}){const{problem:w,document:x}=ce(),T=ie(),{params:{id:D}}=T,R=S,k=u(!1),d=u(!1),m=u([]),i=u([]),b=u([]),v=u(""),h=u([]),p=u([]),_=u(""),V=u(""),$=u("title"),z=u(""),q=u(!1),r=_e({current_page:1,page_size:50,total:0});function B(){const a={problem_id_list:h.value,paragraphList:p.value.map(o=>({paragraph_id:o.id,document_id:o.document_id}))};Q.postMulAssociationProblem(D,a,d).then(()=>{j(I("views.problem.tip.relatedSuccess")),k.value=!1})}function O(a){q.value?E(a.id)?p.value.splice(p.value.indexOf(a.id),1):p.value.push(a):E(a.id)?w.asyncDisassociationProblem(D,a.documentId,a.id,v.value,d).then(()=>{A(v.value)}):w.asyncAssociationProblem(D,a.documentId,a.id,v.value,d).then(()=>{A(v.value)})}function J(){r.current_page=1,b.value=[],_.value&&N(_.value)}function Y(a){r.current_page=1,b.value=[],_.value=a.id,N(a.id)}function U(){x.asyncGetAllDocument(D,d).then(a=>{var o;i.value=a.data,m.value=a.data,_.value=((o=i.value)==null?void 0:o.length)>0?i.value[0].id:"",_.value&&N(_.value)})}function N(a){Ie.getParagraph(D,a||_.value,r,V.value&&{[$.value]:V.value},d).then(o=>{b.value=[...b.value,...o.data.records],r.total=o.data.total})}function A(a){Q.getDetailProblems(D,a,d).then(o=>{p.value=o.data})}function W(a){return p.value.filter(o=>o.documentId===a).length}function E(a){return p.value.some(o=>o.id===a)}return X(k,a=>{a||(m.value=[],i.value=[],b.value=[],p.value=[],q.value=!1,_.value="",V.value="",$.value="title",R("refresh"))}),X(z,a=>{var o;b.value=[],m.value=a?i.value.filter(L=>L.name.includes(a)):i.value,_.value=((o=m.value)==null?void 0:o.length)>0?m.value[0].id:""}),F({open:a=>{U(),a.length==1?(v.value=a[0],A(a)):a.length>1&&(h.value=a,q.value=!0),k.value=!0}}),(a,o)=>{const L=s("el-input"),Z=s("auto-tooltip"),e=s("el-badge"),c=s("common-list"),y=s("el-scrollbar"),le=s("el-col"),H=s("el-text"),ae=s("el-option"),ue=s("el-select"),de=s("el-empty"),oe=s("CardBox"),ne=s("InfiniteScroll"),pe=s("el-row"),re=s("el-button"),me=s("el-dialog"),ve=ge("loading");return P(),M(me,{title:a.$t("views.problem.relateParagraph.title"),modelValue:k.value,"onUpdate:modelValue":o[5]||(o[5]=n=>k.value=n),width:"80%",class:"paragraph-dialog","destroy-on-close":"","close-on-click-modal":!1,"close-on-press-escape":!1},De({default:l(()=>[be((P(),M(pe,null,{default:l(()=>[t(le,{span:6},{default:l(()=>[t(y,{height:"500","wrap-class":"paragraph-scrollbar"},{default:l(()=>[g("div",Le,f(a.$t("views.problem.relateParagraph.selectDocument")),1),g("div",Te,[t(L,{modelValue:z.value,"onUpdate:modelValue":o[0]||(o[0]=n=>z.value=n),placeholder:a.$t("views.problem.relateParagraph.placeholder"),"prefix-icon":"Search",clearable:""},null,8,["modelValue","placeholder"]),t(c,{data:m.value,class:"mt-8",onClick:Y,"default-active":_.value},{default:l(({row:n})=>[g("span",Ue,[t(Z,{content:n.name},{default:l(()=>[C(f(n.name),1)]),_:2},1032,["content"]),W(n.id)?(P(),M(e,{key:0,value:W(n.id),type:"primary",class:"paragraph-badge ml-4"},null,8,["value"])):Re("",!0)])]),_:1},8,["data","default-active"])])]),_:1})]),_:1}),t(le,{span:18,class:"border-l"},{default:l(()=>[t(y,{height:"500","wrap-class":"paragraph-scrollbar"},{default:l(()=>[g("div",Ne,[g("div",Ae,[g("div",Ee,[C(f(a.$t("components.selectParagraph.title"))+" ",1),t(H,null,{default:l(()=>[C(" （"+f(a.$t("views.problem.relateParagraph.selectedParagraph"))+"："+f(W(_.value))+" "+f(a.$t("views.problem.relateParagraph.count"))+"） ",1)]),_:1})]),t(L,{modelValue:V.value,"onUpdate:modelValue":o[2]||(o[2]=n=>V.value=n),placeholder:a.$t("common.search"),class:"input-with-select",style:{width:"260px"},onChange:J},{prepend:l(()=>[t(ue,{modelValue:$.value,"onUpdate:modelValue":o[1]||(o[1]=n=>$.value=n),placeholder:"Select",style:{width:"80px"}},{default:l(()=>[t(ae,{label:a.$t("common.title"),value:"title"},null,8,["label"]),t(ae,{label:a.$t("common.content"),value:"content"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue","placeholder"])]),b.value.length==0?(P(),M(de,{key:0,description:a.$t("common.noData")},null,8,["description"])):(P(),M(ne,{key:1,size:b.value.length,total:r.total,page_size:r.page_size,current_page:r.current_page,"onUpdate:current_page":o[3]||(o[3]=n=>r.current_page=n),onLoad:N,loading:d.value},{default:l(()=>[(P(!0),he($e,null,ye(b.value,(n,K)=>(P(),M(oe,{key:K,shadow:"hover",title:n.title||"-",description:n.content,class:Ve(["paragraph-card cursor mb-16",E(n.id)?"selected":""]),showIcon:!1,onClick:Xe=>O(n)},null,8,["title","description","class","onClick"]))),128))]),_:1},8,["size","total","page_size","current_page","loading"]))])]),_:1})]),_:1})]),_:1})),[[ve,d.value]])]),_:2},[q.value?{name:"footer",fn:l(()=>[g("div",He,[t(re,{onClick:o[4]||(o[4]=n=>k.value=!1)},{default:l(()=>[C(f(a.$t("common.cancel")),1)]),_:1}),t(re,{type:"primary",onClick:B},{default:l(()=>[C(f(a.$t("common.confirm")),1)]),_:1})])]),key:"0"}:void 0]),1032,["title","modelValue"])}}});const Fe={class:"p-8"},We={class:"active-button"},je={class:"mr-4"},Ge={class:"footer-content flex-between"},Qe=se({__name:"DetailProblemDrawer",props:{currentId:{},currentContent:{},next:{},pre:{},pre_disable:{type:Boolean},next_disable:{type:Boolean}},emits:["update:currentId","update:currentContent","refresh"],setup(ee,{expose:F,emit:S}){const w=ee,x=S,T=ie(),{params:{id:D}}=T,{problem:R}=ce(),k=u(),d=u(),m=u(!1),i=u(!1),b=u([]);function v(r){R.asyncDisassociationProblem(r.dataset_id,r.document_id,r.id,w.currentId,m).then(()=>{$()})}function h(){k.value.open([w.currentId])}function p(r){d.value.open(r)}function _(r){if(r){const B={content:r};Q.putProblems(D,w.currentId,B,m).then(()=>{x("update:currentContent",r),j(I("common.modifySuccess"))})}else Pe(I("views.problem.tip.errorMessage"))}function V(){b.value=[]}function $(){w.currentId&&i.value&&Q.getDetailProblems(D,w.currentId,m).then(r=>{b.value=r.data})}function z(){$()}return X(()=>w.currentId,()=>{b.value=[],$()}),X(i,r=>{r||(x("update:currentId",""),x("update:currentContent",""),x("refresh"))}),F({open:()=>{$(),i.value=!0}}),(r,B)=>{const O=s("ReadWrite"),J=s("el-form-item"),Y=s("AppIcon"),U=s("el-button"),N=s("el-tooltip"),A=s("el-scrollbar"),W=s("Document"),E=s("el-icon"),te=s("el-text"),a=s("CardBox"),o=s("el-form"),L=s("el-drawer"),Z=ge("loading");return P(),M(L,{modelValue:i.value,"onUpdate:modelValue":B[1]||(B[1]=e=>i.value=e),size:"60%",onClose:V},{header:l(()=>[g("h4",null,f(r.$t("views.problem.detailProblem")),1)]),footer:l(()=>[g("div",null,[t(U,{onClick:h},{default:l(()=>[C(f(r.$t("views.problem.relateParagraph.title")),1)]),_:1}),t(U,{onClick:r.pre,disabled:r.pre_disable||m.value},{default:l(()=>[C(f(r.$t("views.log.buttons.prev")),1)]),_:1},8,["onClick","disabled"]),t(U,{onClick:r.next,disabled:r.next_disable||m.value},{default:l(()=>[C(f(r.$t("views.log.buttons.next")),1)]),_:1},8,["onClick","disabled"])])]),default:l(()=>[g("div",null,[t(A,null,{default:l(()=>[g("div",Fe,[be((P(),M(o,{"label-position":"top",onSubmit:B[0]||(B[0]=G(()=>{},["prevent"]))},{default:l(()=>[t(J,{label:r.$t("views.problem.title")},{default:l(()=>[t(O,{onChange:_,data:r.currentContent,showEditIcon:!0,maxlength:256},null,8,["data"])]),_:1},8,["label"]),t(J,{label:r.$t("views.problem.relateParagraph.title")},{default:l(()=>[(P(!0),he($e,null,ye(b.value,(e,c)=>(P(),M(a,{key:c,title:e.title||"-",class:"paragraph-source-card cursor mb-8",showIcon:!1,onClick:G(y=>p(e),["stop"])},{description:l(()=>[t(A,{height:"80"},{default:l(()=>[C(f(e.content),1)]),_:2},1024)]),footer:l(()=>[g("div",Ge,[t(te,null,{default:l(()=>[t(E,null,{default:l(()=>[t(W)]),_:1}),C(" "+f(e==null?void 0:e.documentName),1)]),_:2},1024)])]),default:l(()=>[g("div",We,[g("span",je,[t(N,{effect:"dark",content:r.$t("views.problem.setting.cancelRelated"),placement:"top"},{default:l(()=>[t(U,{type:"primary",text:"",onClick:G(y=>v(e),["stop"])},{default:l(()=>[t(Y,{iconName:"app-quxiaoguanlian"})]),_:2},1032,["onClick"])]),_:2},1032,["content"])])])]),_:2},1032,["title","onClick"]))),128))]),_:1},8,["label"])]),_:1})),[[Z,m.value]])])]),_:1}),t(ze,{ref_key:"ParagraphDialogRef",ref:d,title:r.$t("views.paragraph.editParagraph"),onRefresh:z},null,8,["title"]),t(we,{ref_key:"RelateProblemDialogRef",ref:k,onRefresh:z},null,512)])]),_:1},8,["modelValue"])}}}),Je={class:"main-calc-height"},Ke={class:"p-24"},Oe={class:"flex-between"},Ye={key:1},Ze={class:"mr-4"},at=se({__name:"index",setup(ee){const F=ie(),{params:{id:S}}=F,{problem:w}=ce(),x=u(),T=u(),D=u(),R=u(!1),k=u(""),d=u(""),m=u(""),i=_e({current_page:1,page_size:10,total:0}),b=u(""),v=u([]),h=fe(()=>v.value.map((e,c)=>({[e.id]:c})).reduce((e,c)=>({...e,...c}),{})),p=u(),_=u([]);function V(e){const c=[];e?c.push(e.id):_.value.map(y=>{y&&c.push(y.id)}),x.value.open(c)}function $(){D.value.open()}const z=e=>{_.value=e};function q(e){R.value=!0;const c=[e];w.asyncPostProblem(S,c).then(y=>{o(),j(I("common.createSuccess"))}).catch(()=>{R.value=!1})}function r(){const e=[];_.value.map(c=>{c&&e.push(c.id)}),Q.delMulProblem(S,e,R).then(()=>{var c;j(I("views.document.delete.successMessage")),(c=p.value)==null||c.clearSelection(),o()})}function B(e){xe(`${I("views.problem.delete.confirmTitle")} ${e.content} ?`,`${I("views.problem.delete.confirmMessage1")} ${e.paragraphCount} ${I("views.problem.delete.confirmMessage2")}`,{confirmButtonText:I("common.confirm"),confirmButtonClass:"danger"}).then(()=>{Q.delProblems(S,e.id,R).then(()=>{j(I("common.deleteSuccess")),o()})}).catch(()=>{})}function O(e,c){if(e){const y={content:e};Q.putProblems(S,c,y,R).then(()=>{o(),j(I("common.modifySuccess"))})}else Pe(I("views.problem.tip.errorMessage"))}function J(e){k.value=e.id}function Y(){k.value=""}const U=()=>{let e=h.value[d.value]+1;if(e>=v.value.length){if(e+(i.current_page-1)*i.page_size>=i.total-1)return;i.current_page=i.current_page+1,o().then(()=>{e=0,d.value=v.value[e].id,m.value=v.value[e].content})}else d.value=v.value[e].id,m.value=v.value[e].content},N=fe(()=>h.value[d.value]-1<0&&i.current_page<=1),A=fe(()=>{let e=h.value[d.value]+1;return e>=v.value.length&&e+(i.current_page-1)*i.page_size>=i.total-1}),W=()=>{let e=h.value[d.value]-1;if(e<0){if(i.current_page<=1)return;i.current_page=i.current_page-1,o().then(c=>{e=i.page_size-1,d.value=v.value[e].id,m.value=v.value[e].content})}else d.value=v.value[e].id,m.value=v.value[e].content};function E(e,c){c&&c.type==="selection"||e.paragraphCount&&(d.value=e.id,m.value=e.content,T.value.open())}const te=({row:e})=>d.value===(e==null?void 0:e.id)?"highlight":"";function a(){i.current_page=1,o()}function o(){return w.asyncGetProblem(S,i,b.value&&{content:b.value},R).then(e=>{v.value=e.data.records,i.total=e.data.total})}function L(){var e;o(),(e=p.value)==null||e.clearSelection()}function Z(){i.current_page=1,o()}return Me(()=>{o()}),Se(()=>{}),(e,c)=>{const y=s("el-button"),le=s("el-input"),H=s("el-table-column"),ae=s("ReadWrite"),ue=s("el-link"),de=s("Connection"),oe=s("el-icon"),ne=s("el-tooltip"),pe=s("Delete"),re=s("app-table"),me=s("LayoutContainer"),ve=ge("loading");return P(),M(me,{header:e.$t("views.problem.title")},{default:l(()=>[g("div",Je,[g("div",Ke,[g("div",Oe,[g("div",null,[t(y,{type:"primary",onClick:$},{default:l(()=>[C(f(e.$t("views.problem.createProblem")),1)]),_:1}),t(y,{onClick:c[0]||(c[0]=n=>V()),disabled:_.value.length===0},{default:l(()=>[C(f(e.$t("views.problem.relateParagraph.title")),1)]),_:1},8,["disabled"]),t(y,{onClick:r,disabled:_.value.length===0},{default:l(()=>[C(f(e.$t("views.problem.setting.batchDelete")),1)]),_:1},8,["disabled"])]),t(le,{modelValue:b.value,"onUpdate:modelValue":c[1]||(c[1]=n=>b.value=n),placeholder:e.$t("views.problem.searchBar.placeholder"),"prefix-icon":"Search",class:"w-240",onChange:o,clearable:""},null,8,["modelValue","placeholder"])]),be((P(),M(re,{ref_key:"multipleTableRef",ref:p,class:"mt-16",data:v.value,"pagination-config":i,"quick-create":"",quickCreateName:e.$t("views.problem.quickCreateName"),quickCreatePlaceholder:e.$t("views.problem.quickCreateProblem"),quickCreateMaxlength:256,onSizeChange:a,onChangePage:o,onCellMouseEnter:J,onCellMouseLeave:Y,onCreatQuick:q,onRowClick:E,onSelectionChange:z,"row-class-name":te,"row-key":n=>n.id},{default:l(()=>[t(H,{type:"selection",width:"55","reserve-selection":!0}),t(H,{prop:"content",label:e.$t("views.problem.title"),"min-width":"280"},{default:l(({row:n})=>[t(ae,{onChange:K=>O(K,n.id),data:n.content,showEditIcon:n.id===k.value,maxlength:256},null,8,["onChange","data","showEditIcon"])]),_:1},8,["label"]),t(H,{prop:"paragraphCount",label:e.$t("views.problem.table.paragraphCount"),align:"right","min-width":"100"},{default:l(({row:n})=>[n.paragraphCount?(P(),M(ue,{key:0,type:"primary",onClick:G(K=>E(n),["stop"])},{default:l(()=>[C(f(n.paragraphCount),1)]),_:2},1032,["onClick"])):(P(),he("span",Ye,f(n.paragraphCount),1))]),_:1},8,["label"]),t(H,{prop:"createTime",label:e.$t("common.createTime"),width:"170"},{default:l(({row:n})=>[C(f(Ce(ke)(n.createTime)),1)]),_:1},8,["label"]),t(H,{prop:"updateTime",label:e.$t("views.problem.table.updateTime"),width:"170"},{default:l(({row:n})=>[C(f(Ce(ke)(n.updateTime)),1)]),_:1},8,["label"]),t(H,{label:e.$t("common.operation"),align:"left",fixed:"right"},{default:l(({row:n})=>[g("div",null,[g("span",Ze,[t(ne,{effect:"dark",content:e.$t("views.problem.relateParagraph.title"),placement:"top"},{default:l(()=>[t(y,{type:"primary",text:"",onClick:G(K=>V(n),["stop"])},{default:l(()=>[t(oe,null,{default:l(()=>[t(de)]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),g("span",null,[t(ne,{effect:"dark",content:e.$t("common.delete"),placement:"top"},{default:l(()=>[t(y,{type:"primary",text:"",onClick:G(K=>B(n),["stop"])},{default:l(()=>[t(oe,null,{default:l(()=>[t(pe)]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"])])])]),_:1},8,["label"])]),_:1},8,["data","pagination-config","quickCreateName","quickCreatePlaceholder","row-key"])),[[ve,R.value]])])]),t(qe,{ref_key:"CreateProblemDialogRef",ref:D,onRefresh:Z},null,512),t(Qe,{next:U,pre:W,ref_key:"DetailProblemRef",ref:T,currentId:d.value,"onUpdate:currentId":c[2]||(c[2]=n=>d.value=n),currentContent:m.value,"onUpdate:currentContent":c[3]||(c[3]=n=>m.value=n),pre_disable:N.value,next_disable:A.value,onRefresh:L},null,8,["currentId","currentContent","pre_disable","next_disable"]),t(we,{ref_key:"RelateProblemDialogRef",ref:x,onRefresh:L},null,512)]),_:1},8,["header"])}}});export{at as default};
