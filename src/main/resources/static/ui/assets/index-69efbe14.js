import{cp as ve,d1 as me,dy as fe,cq as p,d6 as _e,cZ as g,di as Be,cu as s,cx as r,cF as f,cA as t,cB as v,cz as l,cE as U,cK as m,cJ as u,cy as x,cC as ee,cD as te,dv as Ie,dw as ze,cN as M,eo as ae,ct as Le,cU as Te,cv as xe,cV as de,cH as ce,eb as re,dn as Y,c_ as pe,ew as qe,cR as Fe}from"./index-27b17fb7.js";import{_ as Ne}from"./ParagraphDialog.vue_vue_type_script_setup_true_lang-a5cd19cf.js";import{_ as Ge}from"./index.vue_vue_type_style_index_0_scope_true_lang-acb9b5f3.js";import"./ParagraphForm.vue_vue_type_script_setup_true_lang-fa2fb9ce.js";const He={class:"flex align-center"},Qe={class:"dialog-footer"},je=ve({__name:"SelectDocumentDialog",emits:["refresh"],setup(ge,{expose:q,emit:K}){const{dataset:P,document:S}=me(),F=fe(),{params:{id:B,documentId:w}}=F,I=K,k=p(),i=p(!1),D=p(!1),_=p({dataset_id:"",document_id:""}),z=_e({dataset_id:[{required:!0,message:g("views.log.selectDatasetPlaceholder"),trigger:"change"}],document_id:[{required:!0,message:g("views.log.documentPlaceholder"),trigger:"change"}]}),$=p([]),d=p([]),h=p(!1),L=p([]);Be(i,c=>{var o;c||(_.value={dataset_id:"",document_id:""},$.value=[],d.value=[],L.value=[],(o=k.value)==null||o.clearValidate())});function N(c){_.value.document_id="",O(c)}function O(c){S.asyncGetAllDocument(c,D).then(o=>{var V;d.value=(V=o.data)==null?void 0:V.filter(R=>R.id!==w)})}function G(){P.asyncGetAllDataset(D).then(c=>{$.value=c.data})}const Z=c=>{var o;L.value=c,G(),(o=k.value)==null||o.clearValidate(),i.value=!0},W=async c=>{c&&await c.validate((o,V)=>{o&&ae.putMigrateMulParagraph(B,w,_.value.dataset_id,_.value.document_id,L.value,D).then(()=>{I("refresh"),i.value=!1})})};return q({open:Z}),(c,o)=>{const V=s("AppAvatar"),R=s("el-option"),H=s("el-select"),A=s("el-form-item"),Q=s("el-form"),T=s("el-button"),j=s("el-dialog");return r(),f(j,{title:`${c.$t("views.log.selectDataset")}/${c.$t("common.fileUpload.document")}`,modelValue:i.value,"onUpdate:modelValue":o[5]||(o[5]=e=>i.value=e),width:"500","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:t(()=>[v("span",Qe,[l(T,{onClick:o[3]||(o[3]=U(e=>i.value=!1,["prevent"]))},{default:t(()=>[m(u(c.$t("common.cancel")),1)]),_:1}),l(T,{type:"primary",onClick:o[4]||(o[4]=e=>W(k.value)),loading:D.value},{default:t(()=>[m(u(c.$t("views.document.setting.migration")),1)]),_:1},8,["loading"])])]),default:t(()=>[l(Q,{ref_key:"formRef",ref:k,model:_.value,"label-position":"top","require-asterisk-position":"right",rules:z,onSubmit:o[2]||(o[2]=U(()=>{},["prevent"]))},{default:t(()=>[l(A,{label:c.$t("views.log.selectDataset"),prop:"dataset_id"},{default:t(()=>[l(H,{modelValue:_.value.dataset_id,"onUpdate:modelValue":o[0]||(o[0]=e=>_.value.dataset_id=e),filterable:"",placeholder:c.$t("views.log.selectDatasetPlaceholder"),loading:h.value,onChange:N},{default:t(()=>[(r(!0),x(ee,null,te($.value,e=>(r(),f(R,{key:e.id,label:e.name,value:e.id},{default:t(()=>[v("span",He,[!e.dataset_id&&e.type==="1"?(r(),f(V,{key:0,class:"mr-12 avatar-purple",shape:"square",size:24},{default:t(()=>o[6]||(o[6]=[v("img",{src:Ie,style:{width:"58%"},alt:""},null,-1)])),_:1})):!e.dataset_id&&e.type==="0"?(r(),f(V,{key:1,class:"mr-12 avatar-blue",shape:"square",size:24},{default:t(()=>o[7]||(o[7]=[v("img",{src:ze,style:{width:"58%"},alt:""},null,-1)])),_:1})):M("",!0),m(" "+u(e.name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","loading"])]),_:1},8,["label"]),l(A,{label:c.$t("views.log.saveToDocument"),prop:"document_id"},{default:t(()=>[l(H,{modelValue:_.value.document_id,"onUpdate:modelValue":o[1]||(o[1]=e=>_.value.document_id=e),filterable:"",placeholder:c.$t("views.log.documentPlaceholder"),loading:h.value},{default:t(()=>[(r(!0),x(ee,null,te(d.value,e=>(r(),f(R,{key:e.id,label:e.name,value:e.id},{default:t(()=>[m(u(e.name),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","loading"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}}),Ee={style:{width:"78%"}},Je={style:{display:"inline-block"}},Ke={class:"break-all"},Oe={class:"header-button"},Ze={class:"document-detail__main p-16"},We={class:"flex-between p-8"},Xe={class:"document-detail-height"},Ye={class:"footer-content flex-between"},et={class:"footer-content flex-between"},tt={key:0,class:"mul-operation border-t w-full"},at={class:"ml-8"},lt=ve({__name:"index",setup(ge){const{paragraph:q}=me(),K=fe(),{params:{id:P,documentId:S}}=K,F=p(),B=p(),w=p(!1),I=p(!1),k=p({}),i=p([]),D=p(""),_=p(""),z=p("title"),$=p(!1),d=p([]),h=_e({current_page:1,page_size:30,total:0});function L(){i.value=i.value.filter(e=>!d.value.includes(e.id)),d.value=[],Y(g("views.document.tip.migrationSuccess"))}function N(e){e&&(d.value=[e.id]),F.value.open(d.value)}function O(){pe(`${g("views.document.delete.confirmTitle1")} ${d.value.length} ${g("views.document.delete.confirmTitle2")}`,g("views.paragraph.delete.confirmMessage"),{confirmButtonText:g("common.confirm"),confirmButtonClass:"danger"}).then(()=>{ae.delMulParagraph(P,S,d.value,I).then(()=>{i.value=i.value.filter(e=>!d.value.includes(e.id)),d.value=[],Y(g("views.document.delete.successMessage"))})}).catch(()=>{})}function G(e){$.value=e,d.value=[]}function Z(e){d.value.includes(e)?d.value.splice(d.value.indexOf(e),1):d.value.push(e)}function W(){h.current_page=1,i.value=[],A()}function c(e){const a={isActive:!e.isActive};q.asyncPutParagraph(P,S,e.id,a,I).then(y=>{const E=i.value.findIndex(C=>C.id===e.id);return i.value[E].isActive=!i.value[E].isActive,!0}).catch(()=>!1)}function o(e){pe(`${g("views.paragraph.delete.confirmTitle")} ${e.title||"-"} ?`,g("views.paragraph.delete.confirmMessage"),{confirmButtonText:g("common.confirm"),confirmButtonClass:"danger"}).then(()=>{q.asyncDelParagraph(P,S,e.id,w).then(()=>{const a=i.value.findIndex(y=>y.id===e.id);i.value.splice(a,1),Y(g("common.deleteSuccess"))})}).catch(()=>{})}function V(){D.value=g("views.paragraph.addParagraph"),B.value.open()}function R(e){D.value=g("views.paragraph.paragraphDetail"),B.value.open(e)}function H(){w.value=!0,qe.getDocumentDetail(P,S).then(e=>{k.value=e.data,w.value=!1}).catch(()=>{w.value=!1})}function A(){ae.getParagraph(P,S,h,_.value&&{[z.value]:_.value},w).then(e=>{i.value=[...i.value,...e.data.records],h.total=e.data.total})}function Q(e){if(e){const a=i.value.findIndex(y=>y.id===e.id);i.value.splice(a,1,e)}else h.current_page=1,i.value=[],A()}const T=p();function j(e){const a=[];e?a.push(e.id):d.value.map(y=>{y&&a.push(y)}),T.value.open(a,"paragraph")}return Le(()=>{H(),A()}),(e,a)=>{const y=s("el-link"),E=s("el-text"),C=s("el-button"),le=s("el-option"),he=s("el-select"),we=s("el-input"),be=s("el-empty"),ne=s("CardBox"),ke=s("el-switch"),$e=s("MoreFilled"),oe=s("el-icon"),ye=s("Connection"),X=s("el-dropdown-item"),Ce=s("AppIcon"),De=s("el-dropdown-menu"),Ve=s("el-dropdown"),Pe=s("el-col"),Se=s("el-row"),Ae=s("InfiniteScroll"),Re=s("el-scrollbar"),Me=s("LayoutContainer"),Ue=Te("loading");return r(),f(Me,{"back-to":"-1",class:"document-detail"},{header:t(()=>{var n,J;return[v("div",Ee,[v("h3",Je,u((n=k.value)==null?void 0:n.name),1),((J=k.value)==null?void 0:J.type)==="1"?(r(),f(E,{key:0,type:"info"},{default:t(()=>{var b,se;return[m("（"+u(e.$t("views.document.form.sourceUrl.label"))+"：",1),l(y,{href:(se=(b=k.value)==null?void 0:b.meta)==null?void 0:se.sourceUrl,target:"_blank"},{default:t(()=>{var ie,ue;return[v("span",Ke,u((ue=(ie=k.value)==null?void 0:ie.meta)==null?void 0:ue.sourceUrl),1)]}),_:1},8,["href"]),a[10]||(a[10]=m("） "))]}),_:1})):M("",!0)]),v("div",Oe,[$.value===!1?(r(),f(C,{key:0,onClick:a[0]||(a[0]=b=>G(!0))},{default:t(()=>[m(u(e.$t("views.paragraph.setting.batchSelected")),1)]),_:1})):M("",!0),$.value===!0?(r(),f(C,{key:1,onClick:a[1]||(a[1]=b=>G(!1))},{default:t(()=>[m(u(e.$t("views.paragraph.setting.cancelSelected")),1)]),_:1})):M("",!0),$.value===!1?(r(),f(C,{key:2,onClick:V,type:"primary",disabled:w.value},{default:t(()=>[m(u(e.$t("views.paragraph.addParagraph")),1)]),_:1},8,["disabled"])):M("",!0)])]}),default:t(()=>[xe((r(),x("div",Ze,[v("div",We,[v("span",null,u(h.total)+" "+u(e.$t("views.paragraph.paragraphCount")),1),l(we,{modelValue:_.value,"onUpdate:modelValue":a[3]||(a[3]=n=>_.value=n),placeholder:e.$t("common.search"),class:"input-with-select",style:{width:"260px"},onChange:W,clearable:""},{prepend:t(()=>[l(he,{modelValue:z.value,"onUpdate:modelValue":a[2]||(a[2]=n=>z.value=n),placeholder:"Select",style:{width:"80px"}},{default:t(()=>[l(le,{label:e.$t("common.title"),value:"title"},null,8,["label"]),l(le,{label:e.$t("common.content"),value:"content"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue","placeholder"])]),l(Re,null,{default:t(()=>[v("div",Xe,[i.value.length==0?(r(),f(be,{key:0,description:e.$t("common.noData")},null,8,["description"])):(r(),f(Ae,{key:1,size:i.value.length,total:h.total,page_size:h.page_size,current_page:h.current_page,"onUpdate:current_page":a[7]||(a[7]=n=>h.current_page=n),onLoad:A,loading:w.value},{default:t(()=>[l(Se,null,{default:t(()=>[(r(!0),x(ee,null,te(i.value,(n,J)=>(r(),f(Pe,{xs:24,sm:12,md:8,lg:6,xl:6,key:J,class:"p-8"},{default:t(()=>[$.value===!0?(r(),f(ne,{key:0,shadow:"hover",title:n.title||"-",description:n.content,class:de(["document-card cursor",d.value.includes(n.id)?"selected":""]),showIcon:!1,onClick:b=>Z(n.id)},{footer:t(()=>[v("div",Ye,[v("span",null,u(ce(re)(n==null?void 0:n.content.length)||0)+" "+u(e.$t("views.paragraph.character_count")),1)])]),default:t(()=>[v("div",{class:"active-button",onClick:a[4]||(a[4]=U(()=>{},["stop"]))})]),_:2},1032,["title","description","class","onClick"])):(r(),f(ne,{key:1,shadow:"hover",title:n.title||"-",description:n.content,class:de(["document-card cursor",n.isActive?"":"disabled"]),showIcon:!1,onClick:b=>R(n)},{footer:t(()=>[v("div",et,[v("span",null,u(ce(re)(n==null?void 0:n.content.length)||0)+" "+u(e.$t("views.paragraph.character_count")),1),v("span",{onClick:a[6]||(a[6]=U(()=>{},["stop"]))},[l(Ve,{trigger:"click"},{dropdown:t(()=>[l(De,null,{default:t(()=>[l(X,{onClick:b=>j(n)},{default:t(()=>[l(oe,null,{default:t(()=>[l(ye)]),_:1}),m(" "+u(e.$t("views.document.generateQuestion.title")),1)]),_:2},1032,["onClick"]),l(X,{onClick:b=>N(n)},{default:t(()=>[l(Ce,{iconName:"app-migrate"}),m(" "+u(e.$t("views.document.setting.migration")),1)]),_:2},1032,["onClick"]),l(X,{icon:"Delete",onClick:U(b=>o(n),["stop"])},{default:t(()=>[m(u(e.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:t(()=>[l(C,{text:""},{default:t(()=>[l(oe,null,{default:t(()=>[l($e)]),_:1})]),_:1})]),_:2},1024)])])]),default:t(()=>[v("div",{class:"active-button",onClick:a[5]||(a[5]=U(()=>{},["stop"]))},[l(ke,{loading:w.value,modelValue:n.isActive,"onUpdate:modelValue":b=>n.isActive=b,"before-change":()=>c(n),size:"small"},null,8,["loading","modelValue","onUpdate:modelValue","before-change"])])]),_:2},1032,["title","description","class","onClick"]))]),_:2},1024))),128))]),_:1})]),_:1},8,["size","total","page_size","current_page","loading"]))])]),_:1}),$.value===!0?(r(),x("div",tt,[l(C,{disabled:d.value.length===0,onClick:a[8]||(a[8]=n=>j())},{default:t(()=>[m(u(e.$t("views.document.generateQuestion.title")),1)]),_:1},8,["disabled"]),l(C,{disabled:d.value.length===0,onClick:a[9]||(a[9]=n=>N())},{default:t(()=>[m(u(e.$t("views.document.setting.migration")),1)]),_:1},8,["disabled"]),l(C,{disabled:d.value.length===0,onClick:O},{default:t(()=>[m(u(e.$t("common.delete")),1)]),_:1},8,["disabled"]),v("span",at,u(e.$t("views.document.selected"))+" "+u(d.value.length)+" "+u(e.$t("views.document.items")),1)])):M("",!0)])),[[Ue,h.current_page===1&&w.value||I.value]]),l(Ne,{ref_key:"ParagraphDialogRef",ref:B,title:D.value,onRefresh:Q},null,8,["title"]),l(je,{ref_key:"SelectDocumentDialogRef",ref:F,onRefresh:L},null,512),l(Ge,{ref_key:"GenerateRelatedDialogRef",ref:T,onRefresh:Q},null,512)]),_:1})}}});const ut=Fe(lt,[["__scopeId","data-v-f78b9650"]]);export{ut as default};
