import{cp as X,dy as Y,d1 as Z,cq as n,di as ee,eo as j,ct as le,ep as ae,cu as s,cU as te,cx as f,cy as R,cB as P,cJ as k,cz as a,cA as o,cv as oe,cF as E,cC as z,cD as K,cK as V,cN as G,dl as ne,cR as se,cT as O,eq as ce,cE as Q,cH as W}from"./index-27b17fb7.js";import{_ as de}from"./ParagraphForm.vue_vue_type_script_setup_true_lang-fa2fb9ce.js";const re={class:"bold title p-24",style:{"padding-bottom":"0"}},ie={class:"flex align-center"},ue={class:"p-24",style:{"padding-top":"16px"}},pe=X({__name:"ProblemComponent",props:{problemId:String,docId:String,datasetId:String},setup(A,{expose:F}){const l=A,H=Y(),{params:{id:y,documentId:I}}=H,{problem:C}=Z(),S=n(),v=n(!1),p=n(!1),m=n(""),i=n([]),u=n([]),g=n(!1);ee(()=>l.problemId,e=>{e&&h()},{immediate:!0});function b(e,c){e.id?C.asyncDisassociationProblem(l.datasetId||y,I||l.docId,l.problemId||"",e.id,v).then(t=>{h()}):i.value.splice(c,1)}function h(){v.value=!0,j.getProblem(l.datasetId||y,I||l.docId,l.problemId||"").then(e=>{i.value=e.data,v.value=!1}).catch(()=>{v.value=!1})}function $(){p.value=!0,ne(()=>{var e;(e=S.value)==null||e.focus()})}function D(e){if(l.problemId)(u.value.some(t=>t.id===e)?C.asyncAssociationProblem(l.datasetId||y,I||l.docId,l.problemId,e,v):j.postProblem(l.datasetId||y,I||l.docId,l.problemId,{content:e},v)).then(()=>{h(),m.value="",p.value=!1});else{const c=u.value.find(d=>d.id===e),t=c?c.content:e;i.value.some(d=>d.content===t)||i.value.push({content:t}),m.value="",p.value=!1}}const T=e=>{B(e)};function B(e){return C.asyncGetProblem(l.datasetId||y,{current_page:1,page_size:100},e&&{content:e},g).then(c=>{u.value=c.data.records})}return le(()=>{B()}),ae(()=>{i.value=[],m.value="",p.value=!1}),F({problemList:i}),(e,c)=>{const t=s("el-divider"),d=s("Plus"),w=s("el-icon"),x=s("el-button"),_=s("el-option"),L=s("el-select"),N=s("auto-tooltip"),U=s("TagEllipsis"),q=s("el-scrollbar"),M=te("loading");return f(),R(z,null,[P("p",re,[P("span",ie,[P("span",null,k(e.$t("views.paragraph.relatedProblem.title")),1),a(t,{direction:"vertical",class:"mr-4"}),a(x,{text:"",onClick:$},{default:o(()=>[a(w,null,{default:o(()=>[a(d)]),_:1})]),_:1})])]),oe((f(),R("div",null,[a(q,{height:"500px"},{default:o(()=>[P("div",ue,[p.value?(f(),E(L,{key:0,modelValue:m.value,"onUpdate:modelValue":c[0]||(c[0]=r=>m.value=r),filterable:"","allow-create":"","default-first-option":"","reserve-keyword":!1,placeholder:e.$t("views.paragraph.relatedProblem.placeholder"),remote:"","remote-method":T,loading:g.value,onChange:D,onBlur:c[1]||(c[1]=r=>p.value=!1),class:"mb-16","popper-class":"select-popper","popper-append-to-body":!1},{default:o(()=>[(f(!0),R(z,null,K(u.value,r=>(f(),E(_,{key:r.id,label:r.content,value:r.id},{default:o(()=>[V(k(r.content),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","loading"])):G("",!0),(f(!0),R(z,null,K(i.value,(r,J)=>(f(),E(U,{key:J,onClose:ge=>b(r,J),class:"question-tag",type:"info",effect:"plain",closable:""},{default:o(()=>[a(N,{content:r.content},{default:o(()=>[V(k(r.content),1)]),_:2},1032,["content"])]),_:2},1032,["onClose"]))),128))])]),_:1})])),[[M,v.value]])],64)}}});const me=se(pe,[["__scopeId","data-v-cf3ffed5"]]),ve={class:"p-24",style:{"padding-bottom":"8px"}},_e={style:{position:"absolute",right:"20px",top:"20px"}},fe={key:0,class:"text-right p-24 pt-0"},be={class:"dialog-footer"},Ie=X({__name:"ParagraphDialog",props:{title:String},emits:["refresh"],setup(A,{expose:F,emit:l}){const{paragraph:H}=Z(),y=Y(),{params:{id:I,documentId:C}}=y,S=l,v=n(),p=n(),m=n(!1),i=n(!1),u=n(""),g=n({}),b=n(!1),h=n(""),$=n(""),D=n(null);ee(m,t=>{t||(u.value="",g.value={},b.value=!1,h.value="",$.value="",D.value=null)});const T=()=>{b.value=!1,g.value=O.cloneDeep(D.value)},B=t=>{t?(g.value.title=t.title,g.value.content=t.content,D.value=O.cloneDeep(g.value),u.value=t.id,h.value=t.document_id,$.value=t.dataset_id||I):b.value=!0,m.value=!0},e=async()=>{var t,d,w,x;if(await((t=p.value)==null?void 0:t.validate()))if(i.value=!0,u.value)H.asyncPutParagraph($.value,C||h.value,u.value,(d=p.value)==null?void 0:d.form,i).then(_=>{b.value=!1,S("refresh",_.data)});else{const _=v.value.problemList.length>0?{problem_list:v.value.problemList,...(w=p.value)==null?void 0:w.form}:(x=p.value)==null?void 0:x.form;j.postParagraph(I,C,_,i).then(L=>{m.value=!1,S("refresh")})}},c=O.debounce(()=>{e()},200);return F({open:B}),(t,d)=>{const w=s("EditPen"),x=s("el-icon"),_=s("el-button"),L=s("el-scrollbar"),N=s("el-col"),U=s("el-row"),q=s("el-dialog"),M=te("loading");return f(),E(q,{title:A.title,modelValue:m.value,"onUpdate:modelValue":d[2]||(d[2]=r=>m.value=r),width:"80%",class:"paragraph-dialog","destroy-on-close":"","close-on-click-modal":!1,"close-on-press-escape":!1},ce({default:o(()=>[oe((f(),E(U,null,{default:o(()=>[a(N,{span:18},{default:o(()=>[a(L,{height:"500","wrap-class":"paragraph-scrollbar"},{default:o(()=>[P("div",ve,[P("div",_e,[u.value&&!b.value?(f(),E(_,{key:0,text:"",onClick:d[0]||(d[0]=r=>b.value=!0)},{default:o(()=>[a(x,null,{default:o(()=>[a(w)]),_:1})]),_:1})):G("",!0)]),a(de,{ref_key:"paragraphFormRef",ref:p,data:g.value,isEdit:b.value},null,8,["data","isEdit"])])]),_:1}),u.value&&b.value?(f(),R("div",fe,[a(_,{onClick:Q(T,["prevent"])},{default:o(()=>[V(k(t.$t("common.cancel")),1)]),_:1}),a(_,{type:"primary",disabled:i.value,onClick:W(c)},{default:o(()=>[V(k(t.$t("common.save")),1)]),_:1},8,["disabled","onClick"])])):G("",!0)]),_:1}),a(N,{span:6,class:"border-l",style:{width:"300px"}},{default:o(()=>[a(me,{problemId:u.value,docId:h.value,datasetId:$.value,ref_key:"ProblemRef",ref:v},null,8,["problemId","docId","datasetId"])]),_:1})]),_:1})),[[M,i.value]])]),_:2},[u.value?void 0:{name:"footer",fn:o(()=>[P("span",be,[a(_,{onClick:d[1]||(d[1]=Q(r=>m.value=!1,["prevent"]))},{default:o(()=>[V(k(t.$t("common.cancel")),1)]),_:1}),a(_,{disabled:i.value,type:"primary",onClick:W(c)},{default:o(()=>[V(k(t.$t("common.submit")),1)]),_:1},8,["disabled","onClick"])])]),key:"0"}]),1032,["title","modelValue"])}}});export{Ie as _};
