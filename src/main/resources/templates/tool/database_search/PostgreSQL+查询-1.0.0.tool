{"name":"PostgreSQL 查询","desc":"一个连接PostgreSQL数据库执行SQL查询的工具","code":"import groovy.sql.Sql\nimport groovy.json.JsonBuilder\nimport java.sql.Timestamp\nimport java.math.BigDecimal\n\n    def url = \"jdbc:postgresql://${host}:${port}/${database}\"\n    def driver = 'org.postgresql.Driver'\n\n    Sql sql = null\n    try {\n        // 建立数据库连接\n        sql = Sql.newInstance(url, user, password, driver)\n        println \"连接成功！\"\n\n        // 执行查询并获取结果\n        def rows = []\n        sql.eachRow(query) { row ->\n            def map = [:]\n            row.getMetaData().columnCount.times { i ->\n                def columnName = row.getMetaData().getColumnName(i + 1)\n                def value = row[columnName]\n\n                // 处理特殊类型\n                if (value instanceof Timestamp) {\n                    map[columnName] = value.toInstant().toString() // ISO 8601 格式\n                } else if (value instanceof BigDecimal) {\n                    map[columnName] = value.toDouble()\n                } else {\n                    map[columnName] = value\n                }\n            }\n            rows << map\n        }\n\n        // 转换为 JSON 字符串\n        def jsonBuilder = new JsonBuilder(rows)\n        return jsonBuilder.toString()\n    } catch (Exception e) {\n        println \"发生错误：${e.message}\"\n        throw e\n    } finally {\n        sql?.close()\n    }","inputFieldList":[{"name":"query","type":"string","source":"reference","isRequired":true}],"initFieldList":[{"attrs":{"maxlength":200,"minlength":1,"show-word-limit":true},"field":"host","label":"host","required":true,"input_type":"TextInput","props_info":{"rules":[{"message":"host 为必填属性","required":true},{"max":200,"min":1,"message":"host长度在 1 到 200 个字符","trigger":"blur"}]},"default_value":"127.0.0.1","show_default_value":false},{"attrs":{"maxlength":200,"minlength":1,"show-word-limit":true},"field":"port","label":"port","required":true,"input_type":"TextInput","props_info":{"rules":[{"message":"port 为必填属性","required":true},{"max":200,"min":1,"message":"port长度在 1 到 200 个字符","trigger":"blur"}]},"default_value":"5432","show_default_value":true},{"attrs":{"maxlength":200,"minlength":1,"show-word-limit":true},"field":"user","label":"user","required":true,"input_type":"TextInput","props_info":{"rules":[{"message":"user 为必填属性","required":true},{"max":200,"min":1,"message":"user长度在 1 到 200 个字符","trigger":"blur"}]},"default_value":"postgres","show_default_value":true},{"attrs":{"type":"password","maxlength":200,"minlength":1,"show-password":true,"show-word-limit":true},"field":"password","label":"password","required":true,"input_type":"PasswordInput","props_info":{"rules":[{"message":"password 为必填属性","required":true},{"max":200,"min":1,"message":"password长度在 1 到 200 个字符","trigger":"blur"}]},"default_value":"******","show_default_value":true},{"attrs":{"maxlength":200,"minlength":1,"show-word-limit":true},"field":"database","label":"database","required":true,"input_type":"TextInput","props_info":{"rules":[{"message":"database 为必填属性","required":true},{"max":200,"min":1,"message":"database长度在 1 到 200 个字符","trigger":"blur"}]},"default_value":"postgres","show_default_value":true}],"initParams":{},"userId":"ee95e0e38acaad23bd73d9bea414a97d","isActive":true,"toolType":"CUSTOM","label":"database_search","scope":"WORKSPACE","icon":"./tool/postgresql/icon.png","folderId":"default","id":"213bdf3658687c9305172a077828c233","version":"1.0.0","createTime":1762328134000,"updateTime":1764938352552}