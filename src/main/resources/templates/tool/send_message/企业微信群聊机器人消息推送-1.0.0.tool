{"name":"企业微信群聊机器人消息推送","desc":"自定义机器人发送群聊消息","code":"@Grab('org.apache.httpcomponents:httpclient:4.5.14')\n@Grab('org.apache.httpcomponents:httpcore:4.4.16')\n@Grab('com.fasterxml.jackson.core:jackson-databind:2.15.3')\n\nimport org.apache.http.client.methods.HttpPost\nimport org.apache.http.entity.StringEntity\nimport org.apache.http.impl.client.HttpClients\nimport org.apache.http.util.EntityUtils\nimport com.fasterxml.jackson.databind.ObjectMapper\n\n/**\n * 企业微信机器人推送消息\n * @param push_message 推送的消息内容\n * @param accessKey 机器人的accessKey\n * @param is_at_all 是否@所有人\n * @param at_mobiles 需要@的手机号，多个手机号用逗号分隔\n * @return 推送结果\n */\ndef wecomrobot(push_message, accessKey, is_at_all, at_mobiles) {\n    // 构建@列表\n    def mentioned_mobile_list = []\n    if (is_at_all) {\n        mentioned_mobile_list.add(\"@all\")\n    }\n    if (at_mobiles) {\n        def mobile_numbers = at_mobiles.split(\",\").collect { it.trim() }\n        mentioned_mobile_list.addAll(mobile_numbers)\n    }\n    \n    // 构建请求URL\n    def url = \"https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=${accessKey}\"\n    \n    // 创建HttpClient并设置请求\n    HttpClients.createDefault().withCloseable { httpClient ->\n        def httpPost = new HttpPost(url)\n        \n        // 构建请求体\n        def objectMapper = new ObjectMapper()\n        def requestBody = [\n            \"msgtype\": \"text\",\n            \"text\": [\n                \"content\": push_message,\n                \"mentioned_mobile_list\": mentioned_mobile_list\n            ]\n        ]\n        def jsonBody = objectMapper.writeValueAsString(requestBody)\n        httpPost.setEntity(new StringEntity(jsonBody, \"UTF-8\"))\n        \n        try {\n            // 发送请求\n            def response = httpClient.execute(httpPost)\n            def statusCode = response.getStatusLine().getStatusCode()\n            def responseBody = EntityUtils.toString(response.getEntity(), \"UTF-8\")\n            \n            if (statusCode == 200) {\n                return \"信息：企业微信机器人推送成功。\"\n            } else {\n                return \"错误：企业微信机器人推送失败，状态码：${statusCode}，响应：${responseBody}\"\n            }\n        } catch (Exception e) {\n            return \"错误：企业微信机器人推送异常 - ${e.getMessage()}\"\n        }\n    }\n}\n\n// 示例用法\n// def result = wecomrobot(\"测试消息\", \"your_access_key\", false, \"13800138000,13900139000\")\n// println result","inputFieldList":[{"name":"push_message","type":"string","source":"reference","isRequired":true},{"name":"accessKey","type":"string","source":"custom","isRequired":true},{"name":"is_at_all","type":"int","source":"reference","isRequired":true},{"name":"at_mobiles","type":"array","source":"reference","isRequired":false}],"initFieldList":[{"attrs":{"maxlength":200,"minlength":1,"show-word-limit":true},"field":"key","label":{"attrs":{"tooltip":"key密钥"},"label":"密钥","input_type":"TooltipLabel","props_info":{}},"required":true,"input_type":"TextInput","props_info":{"rules":[{"message":"密钥 为必填属性","required":true},{"max":200,"min":1,"message":"密钥长度在 1 到 200 个字符","trigger":"blur"}]},"default_value":"xxxxxx","show_default_value":true}],"initParams":{},"userId":"81f61a31e5dfe9b68ade2b6faf815924","isActive":true,"toolType":"CUSTOM","scope":"WORKSPACE","icon":"","folderId":"default","id":"b7b809e1f0361727fe52cabe43588a27","createTime":1768891964000,"updateTime":1768961823866}