<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tarzan.maxkb4j.module.application.mapper.ApplicationChatRecordMapper">

    <select id="chatRecordCountTrend" resultType="com.tarzan.maxkb4j.module.application.domian.vo.ApplicationStatisticsVO">
        SELECT SUM ( chat_record.message_tokens + chat_record.answer_tokens ) as "tokens_num",
        chat_record.create_time :: DATE as "day"
        FROM
        application_chat_record chat_record
        <where>
            chat_record.application_id = #{appId}
            <if test="query.startTime != null and query.startTime != ''">
                and  <![CDATA[TO_CHAR(chat_record.create_time, 'YYYY-MM-DD') >= #{query.startTime} ]]>
            </if>
            <if test="query.endTime != null and query.endTime != ''">
                and  <![CDATA[TO_CHAR(chat_record.create_time, 'YYYY-MM-DD') <= #{query.endTime} ]]>
            </if>
        </where>
        GROUP BY "day";
    </select>

</mapper>
